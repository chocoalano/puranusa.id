import{i as V,c as ue,d as de,r as ce,m as me,a as fe}from"./BonusController-CnMrTDG-.js";import{_ as T}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-c-fNq-Gn.js";import{_ as pe}from"./Pagination.vue_vue_type_script_setup_true_lang-CB_rUuml.js";import{_ as ge}from"./index-C9h8PSdL.js";import{_,v as F}from"./index-DBsPyq8S.js";import{_ as L,a as E}from"./CardContent.vue_vue_type_script_setup_true_lang-CnmozILa.js";import{_ as q}from"./CardHeader.vue_vue_type_script_setup_true_lang-9jnBdHpK.js";import{_ as J}from"./CardTitle.vue_vue_type_script_setup_true_lang-CI_uH55v.js";import{_ as _e,a as ve,b as be}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Wm0IkLbg.js";import{_ as xe}from"./DropdownMenuCheckboxItem.vue_vue_type_script_setup_true_lang-9FJt6h9J.js";import{_ as he}from"./Input.vue_vue_type_script_setup_true_lang-DkLAfZys.js";import{_ as ye,a as ke,b as Se,c as we,d as M}from"./SelectValue.vue_vue_type_script_setup_true_lang-DYYIQ-He.js";import{_ as Ce,a as Re,b as j,c as $e,d as De,e as O}from"./TableHeader.vue_vue_type_script_setup_true_lang-YFJtZzp6.js";import{u as Be}from"./usePermissions-QR2nm5rZ.js";import{_ as Ie}from"./AppLayout.vue_vue_type_script_setup_true_lang-DRH_ebPA.js";import{d as Ve,r as m,p as W,q as Fe,E as X,j as R,c as f,g as r,w as n,b as a,e as i,u as t,a1 as Te,v as S,t as A,s as d,Y as Me,dl as je,K as w,aB as Ae,an as Y,Z as Ue,dc as Pe,aa as Ke,F as $,x as D,y as Z,n as o,D as G,ao as Q,at as Ne,aU as ze,aq as He,z as Le,aM as Ee,A as qe,B as Je}from"./vendor-DYgHfk08.js";import"./index-CSEUMRIG.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-1hBkLUKH.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-BuaobLrR.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-Bql-RK5d.js";import"./index-BUE9bFsX.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DRgKjkJL.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-D72m4PHj.js";const Oe={class:"rounded-xl p-4 space-y-6 py-6"},We={class:"flex items-center justify-between"},Xe={class:"grid gap-4 md:grid-cols-2"},Ye={class:"text-2xl font-bold"},Ze={class:"text-xs text-muted-foreground"},Ge={class:"text-2xl font-bold"},Qe={class:"text-xs text-muted-foreground"},et={key:0,class:"flex items-center justify-between rounded-lg border bg-muted/50 p-4"},tt={class:"text-sm font-medium"},st={class:"flex items-center gap-4"},at={class:"relative flex-1"},lt={class:"rounded-md border"},Dt=Ve({__name:"Index",props:{bonuses:{},statistics:{},filters:{}},setup(x){const{isSuperAdmin:U,isAdmin:P}=Be(),p=x,ee=[{title:"Bonus Regular",href:V.url()}],h=m(p.filters.search||""),c=m(p.filters.status?.toString()||"all"),v=m([{id:p.filters.sort_by,desc:p.filters.sort_order==="desc"}]),K=m([]),N=m({}),C=m({}),y=m({open:!1,bonus:null}),g=m({open:!1,bonus:null}),B=m({open:!1}),te=W(()=>Object.keys(C.value).map(e=>p.bonuses.data[parseInt(e)]).filter(Boolean)),k=W(()=>te.value.filter(e=>e.status===0)),b=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e),se=e=>new Date(e).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),ae=e=>{y.value={open:!0,bonus:e}},le=()=>{y.value.bonus&&R.delete(de.url(y.value.bonus.id),{preserveScroll:!0,onSuccess:()=>{y.value={open:!1,bonus:null}}})},ne=e=>{g.value={open:!0,bonus:e}},oe=()=>{if(!g.value.bonus)return;G({}).post(ce.url(g.value.bonus.id),{preserveScroll:!0,onSuccess:()=>{g.value={open:!1,bonus:null},C.value={}}})},re=()=>{k.value.length&&(B.value.open=!0)},ie=()=>{const e=k.value.map(l=>l.id);G({bonus_ids:e}).post(me.url(),{preserveScroll:!0,onSuccess:()=>{C.value={},B.value.open=!1}})},z=[{id:"select",header:({table:e})=>o("input",{type:"checkbox",checked:e.getIsAllPageRowsSelected(),indeterminate:e.getIsSomePageRowsSelected(),onChange:e.getToggleAllPageRowsSelectedHandler(),class:"h-4 w-4 rounded border-gray-300"}),cell:({row:e})=>o("input",{type:"checkbox",checked:e.getIsSelected(),disabled:!e.getCanSelect(),onChange:e.getToggleSelectedHandler(),class:"h-4 w-4 rounded border-gray-300"}),enableSorting:!1},{id:"index",header:()=>o("div",{class:"w-12"},"No"),cell:({row:e})=>{const s=e.index+1+(p.bonuses.current_page-1)*p.bonuses.per_page;return o("div",{class:"font-medium"},s)}},{accessorKey:"member_name",header:({column:e})=>o(_,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"-ml-4"},()=>["Member",o(Q,{class:"ml-2 h-4 w-4"})]),cell:({row:e})=>o("div",[o("div",{class:"font-medium"},e.original.member_name),o("div",{class:"text-xs text-muted-foreground"},e.original.member_ewallet_id)])},{accessorKey:"amount",header:()=>o("div",{class:"text-right"},"Jumlah"),cell:({row:e})=>o("div",{class:"text-right"},[o("div",{class:"font-medium"},b(e.original.amount)),o("div",{class:"text-xs text-muted-foreground"},`Tax: ${b(e.original.tax_amount)}`),o("div",{class:"text-xs text-green-600"},`Netto: ${b(e.original.tax_netto)}`)])},{accessorKey:"status",header:()=>"Status",cell:({row:e})=>{const s=e.original.status;return o(ge,{variant:s===1?"default":"secondary",class:"gap-1"},()=>[o(s===1?Ne:ze,{class:"h-3 w-3"}),e.original.status_text])}},{accessorKey:"created_at",header:({column:e})=>o(_,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"-ml-4"},()=>["Tanggal",o(Q,{class:"ml-2 h-4 w-4"})]),cell:({row:e})=>se(e.getValue("created_at"))},{id:"actions",header:()=>o("div",{class:"text-right"},"Actions"),cell:({row:e})=>{const s=e.original,l=[];return(U||P)&&l.push(o(_,{variant:"outline",size:"sm",onClick:()=>R.visit(fe.url(s.id))},()=>o(He,{class:"h-4 w-4"})),s.status===0?o(_,{variant:"default",size:"sm",onClick:()=>ne(s)},()=>o(Y,{class:"h-4 w-4"})):null,s.status===0?o(_,{variant:"outline",size:"sm",onClick:()=>ae(s)},()=>o(Le,{class:"h-4 w-4 text-destructive"})):null),o("div",{class:"flex justify-end gap-2"},l)}}],I=Fe({get data(){return p.bonuses.data},columns:z,getCoreRowModel:Je(),getSortedRowModel:qe(),getFilteredRowModel:Ee(),state:{get sorting(){return v.value},get columnFilters(){return K.value},get columnVisibility(){return N.value},get rowSelection(){return C.value}},onSortingChange:e=>F(e,v),onColumnFiltersChange:e=>F(e,K),onColumnVisibilityChange:e=>F(e,N),onRowSelectionChange:e=>F(e,C),manualSorting:!0,enableRowSelection:!0});X(v,e=>{e.length>0&&R.get(V.url(),{search:h.value||void 0,status:c.value!=="all"?parseInt(c.value):void 0,sort_by:e[0].id,sort_order:e[0].desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},{deep:!0});let H;return X([h,c],()=>{clearTimeout(H),H=setTimeout(()=>{R.get(V.url(),{search:h.value||void 0,status:c.value!=="all"?parseInt(c.value):void 0,sort_by:v.value[0]?.id||"created_at",sort_order:v.value[0]?.desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},300)}),(e,s)=>(r(),f(Ie,{breadcrumbs:ee},{default:n(()=>[a(t(Te),{title:"Bonus Regular"}),i("div",Oe,[i("div",We,[s[7]||(s[7]=i("div",null,[i("h1",{class:"text-3xl font-bold tracking-tight"},"Bonus Regular"),i("p",{class:"text-muted-foreground"},"Kelola bonus reguler member")],-1)),t(U)||t(P)?(r(),f(t(_),{key:0,onClick:s[0]||(s[0]=l=>t(R).visit(t(ue).url()))},{default:n(()=>[a(t(Me),{class:"h-4 w-4"}),s[6]||(s[6]=d(" Tambah Bonus ",-1))]),_:1})):A("",!0)]),i("div",Xe,[a(t(L),null,{default:n(()=>[a(t(q),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:n(()=>[a(t(J),{class:"text-sm font-medium"},{default:n(()=>[...s[8]||(s[8]=[d("Total Pending",-1)])]),_:1}),a(t(je),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(t(E),null,{default:n(()=>[i("div",Ye,w(b(x.statistics.total_pending)),1),i("p",Ze,w(x.statistics.count_pending)+" bonus ",1)]),_:1})]),_:1}),a(t(L),null,{default:n(()=>[a(t(q),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:n(()=>[a(t(J),{class:"text-sm font-medium"},{default:n(()=>[...s[9]||(s[9]=[d("Total Released",-1)])]),_:1}),a(t(Ae),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(t(E),null,{default:n(()=>[i("div",Ge,w(b(x.statistics.total_released)),1),i("p",Qe,w(x.statistics.count_released)+" bonus ",1)]),_:1})]),_:1})]),k.value.length>0?(r(),S("div",et,[i("p",tt,w(k.value.length)+" bonus pending dipilih ",1),a(t(_),{size:"sm",onClick:re},{default:n(()=>[a(t(Y),{class:"h-4 w-4"}),s[10]||(s[10]=d(" Release Semua ",-1))]),_:1})])):A("",!0),i("div",st,[i("div",at,[a(t(Ue),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),a(t(he),{modelValue:h.value,"onUpdate:modelValue":s[1]||(s[1]=l=>h.value=l),placeholder:"Cari member atau deskripsi...",class:"pl-9"},null,8,["modelValue"])]),a(t(ye),{modelValue:c.value,"onUpdate:modelValue":s[2]||(s[2]=l=>c.value=l)},{default:n(()=>[a(t(ke),{class:"w-40"},{default:n(()=>[a(t(Se),{placeholder:"Semua Status"})]),_:1}),a(t(we),null,{default:n(()=>[a(t(M),{value:"all"},{default:n(()=>[...s[11]||(s[11]=[d("Semua Status",-1)])]),_:1}),a(t(M),{value:"0"},{default:n(()=>[...s[12]||(s[12]=[d("Pending",-1)])]),_:1}),a(t(M),{value:"1"},{default:n(()=>[...s[13]||(s[13]=[d("Released",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(t(_e),null,{default:n(()=>[a(t(ve),{"as-child":""},{default:n(()=>[a(t(_),{variant:"outline",class:"ml-auto"},{default:n(()=>[a(t(Pe),{class:"h-4 w-4"}),s[14]||(s[14]=d(" Kolom ",-1)),a(t(Ke),{class:"ml-2 h-4 w-4"})]),_:1})]),_:1}),a(t(be),{align:"end"},{default:n(()=>[(r(!0),S($,null,D(t(I).getAllColumns().filter(l=>l.getCanHide()),l=>(r(),f(t(xe),{key:l.id,class:"capitalize",checked:l.getIsVisible(),"onUpdate:checked":u=>l.toggleVisibility(!!u)},{default:n(()=>[d(w(l.id),1)]),_:2},1032,["checked","onUpdate:checked"]))),128))]),_:1})]),_:1})]),i("div",lt,[a(t(Ce),null,{default:n(()=>[a(t(Re),null,{default:n(()=>[(r(!0),S($,null,D(t(I).getHeaderGroups(),l=>(r(),f(t(j),{key:l.id},{default:n(()=>[(r(!0),S($,null,D(l.headers,u=>(r(),f(t($e),{key:u.id},{default:n(()=>[u.isPlaceholder?A("",!0):(r(),f(t(Z),{key:0,render:u.column.columnDef.header,props:u.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),a(t(De),null,{default:n(()=>[t(I).getRowModel().rows?.length?(r(!0),S($,{key:0},D(t(I).getRowModel().rows,l=>(r(),f(t(j),{key:l.id,"data-state":l.getIsSelected()?"selected":void 0},{default:n(()=>[(r(!0),S($,null,D(l.getVisibleCells(),u=>(r(),f(t(O),{key:u.id},{default:n(()=>[a(t(Z),{render:u.column.columnDef.cell,props:u.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1032,["data-state"]))),128)):(r(),f(t(j),{key:1},{default:n(()=>[a(t(O),{colspan:z.length,class:"h-24 text-center"},{default:n(()=>[...s[15]||(s[15]=[d(" Tidak ada data bonus. ",-1)])]),_:1},8,["colspan"])]),_:1}))]),_:1})]),_:1})]),a(pe,{data:x.bonuses,url:t(V).url(),filters:{search:h.value||void 0,status:c.value!=="all"?parseInt(c.value):void 0,sort_by:v.value[0]?.id,sort_order:v.value[0]?.desc?"desc":"asc"}},null,8,["data","url","filters"])]),a(T,{open:y.value.open,"onUpdate:open":s[3]||(s[3]=l=>y.value.open=l),title:"Hapus Bonus?",description:"Apakah Anda yakin ingin menghapus bonus ini? Tindakan ini tidak dapat dibatalkan.","confirm-text":"Hapus","cancel-text":"Batal",variant:"destructive",onConfirm:le},null,8,["open"]),a(T,{open:g.value.open,"onUpdate:open":s[4]||(s[4]=l=>g.value.open=l),title:"Release Bonus?",description:`Bonus sebesar ${g.value.bonus?b(g.value.bonus.tax_netto):""} akan ditransfer ke ewallet member. Lanjutkan?`,"confirm-text":"Release","cancel-text":"Batal",onConfirm:oe},null,8,["open","description"]),a(T,{open:B.value.open,"onUpdate:open":s[5]||(s[5]=l=>B.value.open=l),title:`Release ${k.value.length} Bonus?`,description:`Total ${b(k.value.reduce((l,u)=>l+u.tax_netto,0))} akan ditransfer ke ewallet member. Lanjutkan?`,"confirm-text":"Release Semua","cancel-text":"Batal",onConfirm:ie},null,8,["open","title","description"])]),_:1}))}});export{Dt as default};
