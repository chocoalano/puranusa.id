import{ah as F,ak as _e,ai as ve,_ as be,al as xe,am as ye,an as we}from"./AppLayout.vue_vue_type_script_setup_true_lang-CaMmThtw.js";import{_ as U}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-C_6Jj5f9.js";import{_ as Se}from"./Pagination.vue_vue_type_script_setup_true_lang-CHQjYZ-Y.js";import{_ as he}from"./index-2jc_3EYP.js";import{_ as C,v as T}from"./index-CbYnopcj.js";import{_ as q,a as z}from"./CardContent.vue_vue_type_script_setup_true_lang-zYsAvt-E.js";import{_ as O}from"./CardHeader.vue_vue_type_script_setup_true_lang-ys6Fv0Rz.js";import{_ as J}from"./CardTitle.vue_vue_type_script_setup_true_lang-DG1pPKaL.js";import{_ as W}from"./Checkbox.vue_vue_type_script_setup_true_lang-DcC-y0Vc.js";import{_ as X,a as Y,b as Z,d as ke,c as j,e as Re}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DwBsCspi.js";import{_ as Ce}from"./DropdownMenuCheckboxItem.vue_vue_type_script_setup_true_lang-BzQ2SQNK.js";import{d as $e,r as f,d6 as De,p as G,q as Ve,E as Q,j as $,v,g as o,b as a,w as l,u as e,e as u,aj as Be,t as D,s as d,aq as Ie,F as x,an as ee,z as Fe,a1 as Te,c as p,Y as Ae,dd as Me,K as h,aB as Ue,Z as je,aa as Pe,x as V,y as te,n as r,D as se,at as Ke,aS as He,ao as Le,aM as Ne,A as Ee,B as qe}from"./vendor-GEHgRacr.js";import{_ as ze}from"./Input.vue_vue_type_script_setup_true_lang-BJqJA428.js";import{_ as Oe,a as Je,b as We,c as Xe,d as P}from"./SelectValue.vue_vue_type_script_setup_true_lang-CvgLNQNX.js";import{_ as Ye,a as Ze,b as K,c as Ge,d as Qe,e as ae}from"./TableHeader.vue_vue_type_script_setup_true_lang-CwzJNeNR.js";import{u as et}from"./usePermissions-BYbpAoA8.js";import"./index-CMWG4mbA.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-D3VZFIbC.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-Dam_g0Gg.js";import"./index-B_n2dl-_.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Ctpv-4Tl.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-BJ5vlIQ-.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-iYn7fjGn.js";const tt={class:"rounded-xl p-4 space-y-6 py-6"},st={class:"flex items-center justify-between"},at={class:"grid gap-4 md:grid-cols-2"},lt={class:"text-2xl font-bold"},nt={class:"text-xs text-muted-foreground"},ot={class:"text-2xl font-bold"},rt={class:"text-xs text-muted-foreground"},ut={key:0,class:"flex items-center justify-between rounded-lg border bg-muted/50 p-4"},it={class:"text-sm font-medium"},dt={class:"flex items-center gap-4"},mt={class:"relative flex-1"},ct={class:"rounded-md border"},jt=$e({__name:"Index",props:{bonuses:{},statistics:{},filters:{}},setup(m){const{isSuperAdmin:A,isAdmin:M}=et(),g=m,le=[{title:"Bonus Sponsor",href:F.url()}],y=f(g.filters.search||""),c=f(g.filters.status?.toString()||"all"),b=f([{id:g.filters.sort_by,desc:g.filters.sort_order==="desc"}]),H=f([]),L=f({}),k=f({}),[ne,oe]=De(),w=f({open:!1,bonus:null}),_=f({open:!1,bonus:null}),B=f({open:!1}),re=G(()=>Object.keys(k.value).map(s=>g.bonuses.data[parseInt(s)]).filter(Boolean)),S=G(()=>re.value.filter(s=>s.status===0)),R=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s),ue=s=>new Date(s).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),ie=s=>{w.value={open:!0,bonus:s}},de=()=>{w.value.bonus&&$.delete(xe.url(w.value.bonus.id),{preserveScroll:!0,onSuccess:()=>{w.value={open:!1,bonus:null}}})},me=s=>{_.value={open:!0,bonus:s}},ce=()=>{if(!_.value.bonus)return;se({}).post(ye.url(_.value.bonus.id),{preserveScroll:!0,onSuccess:()=>{_.value={open:!1,bonus:null},k.value={}}})},fe=()=>{S.value.length&&(B.value.open=!0)},pe=()=>{const s=S.value.map(n=>n.id);se({bonus_ids:s}).post(we.url(),{preserveScroll:!0,onSuccess:()=>{k.value={},B.value.open=!1}})},N=[{id:"select",header:({table:s})=>r(W,{modelValue:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate","onUpdate:modelValue":t=>s.toggleAllPageRowsSelected(!!t),ariaLabel:"Select all"}),cell:({row:s})=>r(W,{modelValue:s.getIsSelected(),"onUpdate:modelValue":t=>s.toggleSelected(!!t),ariaLabel:"Select row"}),enableSorting:!1,enableHiding:!1},{id:"index",header:()=>r("div",{class:"w-12"},"No"),cell:({row:s})=>{const t=s.index+1+(g.bonuses.current_page-1)*g.bonuses.per_page;return r("div",{class:"font-medium"},t)}},{accessorKey:"member_name",header:()=>"Sponsor (Penerima)",cell:({row:s})=>r("div",[r("div",{class:"font-medium"},s.original.member_name),r("div",{class:"text-xs text-muted-foreground"},s.original.member_ewallet_id)])},{accessorKey:"from_member_name",header:()=>"Downline",cell:({row:s})=>r("div",[r("div",{class:"font-medium"},s.original.from_member_name),r("div",{class:"text-xs text-muted-foreground"},s.original.from_member_ewallet_id)])},{accessorKey:"amount",header:()=>r("div",{class:"text-right"},"Jumlah"),cell:({row:s})=>r("div",{class:"text-right font-medium"},R(s.original.amount))},{accessorKey:"status",header:()=>"Status",cell:({row:s})=>{const t=s.original.status;return r(he,{variant:t===1?"default":"secondary",class:"gap-1"},()=>[r(t===1?Ke:He,{class:"h-3 w-3"}),s.original.status_text])}},{accessorKey:"created_at",header:({column:s})=>r(C,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),class:"-ml-4"},()=>["Tanggal",r(Le,{class:"ml-2 h-4 w-4"})]),cell:({row:s})=>ue(s.getValue("created_at"))},{id:"actions",enableHiding:!1,cell:({row:s})=>{const t=s.original;return r(oe,{bonus:t,onRelease:()=>me(t),onDelete:()=>ie(t)})}}],I=Ve({get data(){return g.bonuses.data},columns:N,getCoreRowModel:qe(),getSortedRowModel:Ee(),getFilteredRowModel:Ne(),onSortingChange:s=>T(s,b),onColumnFiltersChange:s=>T(s,H),onColumnVisibilityChange:s=>T(s,L),onRowSelectionChange:s=>T(s,k),state:{get sorting(){return b.value},get columnFilters(){return H.value},get columnVisibility(){return L.value},get rowSelection(){return k.value}},manualSorting:!0,enableRowSelection:!0});Q(b,s=>{s.length>0&&$.get(F.url(),{search:y.value||void 0,status:c.value!=="all"?parseInt(c.value):void 0,sort_by:s[0].id,sort_order:s[0].desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},{deep:!0});let E;return Q([y,c],()=>{clearTimeout(E),E=setTimeout(()=>{$.get(F.url(),{search:y.value||void 0,status:c.value!=="all"?parseInt(c.value):void 0,sort_by:b.value[0]?.id||"created_at",sort_order:b.value[0]?.desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},300)}),(s,t)=>(o(),v(x,null,[a(e(ne),null,{default:l(({bonus:n,onRelease:i,onDelete:ge})=>[a(e(X),null,{default:l(()=>[a(e(Y),{"as-child":""},{default:l(()=>[a(e(C),{variant:"ghost",class:"h-8 w-8 p-0"},{default:l(()=>[t[6]||(t[6]=u("span",{class:"sr-only"},"Open menu",-1)),a(e(Be),{class:"h-4 w-4"})]),_:1})]),_:1}),a(e(Z),{align:"end"},{default:l(()=>[a(e(ke),null,{default:l(()=>[...t[7]||(t[7]=[d("Actions",-1)])]),_:1}),a(e(j),{onClick:ft=>e($).visit(e(_e).url(n.id))},{default:l(()=>[a(e(Ie),{class:"mr-2 h-4 w-4"}),t[8]||(t[8]=d(" Lihat Detail ",-1))]),_:1},8,["onClick"]),n.status===0&&(e(A)||e(M))?(o(),v(x,{key:0},[a(e(Re)),a(e(j),{onClick:i},{default:l(()=>[a(e(ee),{class:"mr-2 h-4 w-4"}),t[9]||(t[9]=d(" Release Bonus ",-1))]),_:1},8,["onClick"]),a(e(j),{onClick:ge,class:"text-destructive"},{default:l(()=>[a(e(Fe),{class:"mr-2 h-4 w-4"}),t[10]||(t[10]=d(" Hapus Bonus ",-1))]),_:1},8,["onClick"])],64)):D("",!0)]),_:2},1024)]),_:2},1024)]),_:1}),a(be,{breadcrumbs:le},{default:l(()=>[a(e(Te),{title:"Bonus Sponsor"}),u("div",tt,[u("div",st,[t[12]||(t[12]=u("div",null,[u("h1",{class:"text-3xl font-bold tracking-tight"},"Bonus Sponsor"),u("p",{class:"text-muted-foreground"},"Kelola bonus sponsor dari downline")],-1)),e(A)||e(M)?(o(),p(e(C),{key:0,onClick:t[0]||(t[0]=n=>e($).visit(e(ve).url()))},{default:l(()=>[a(e(Ae),{class:"h-4 w-4"}),t[11]||(t[11]=d(" Tambah Bonus ",-1))]),_:1})):D("",!0)]),u("div",at,[a(e(q),null,{default:l(()=>[a(e(O),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[a(e(J),{class:"text-sm font-medium"},{default:l(()=>[...t[13]||(t[13]=[d("Total Pending",-1)])]),_:1}),a(e(Me),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(z),null,{default:l(()=>[u("div",lt,h(R(m.statistics.total_pending)),1),u("p",nt,h(m.statistics.count_pending)+" bonus ",1)]),_:1})]),_:1}),a(e(q),null,{default:l(()=>[a(e(O),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[a(e(J),{class:"text-sm font-medium"},{default:l(()=>[...t[14]||(t[14]=[d("Total Released",-1)])]),_:1}),a(e(Ue),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(z),null,{default:l(()=>[u("div",ot,h(R(m.statistics.total_released)),1),u("p",rt,h(m.statistics.count_released)+" bonus ",1)]),_:1})]),_:1})]),S.value.length>0&&(e(A)||e(M))?(o(),v("div",ut,[u("p",it,h(S.value.length)+" bonus pending dipilih ",1),a(e(C),{size:"sm",onClick:fe},{default:l(()=>[a(e(ee),{class:"h-4 w-4"}),t[15]||(t[15]=d(" Release Semua ",-1))]),_:1})])):D("",!0),u("div",dt,[u("div",mt,[a(e(je),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),a(e(ze),{modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=n=>y.value=n),placeholder:"Cari sponsor atau downline...",class:"pl-9"},null,8,["modelValue"])]),a(e(Oe),{modelValue:c.value,"onUpdate:modelValue":t[2]||(t[2]=n=>c.value=n)},{default:l(()=>[a(e(Je),{class:"w-40"},{default:l(()=>[a(e(We),{placeholder:"Semua Status"})]),_:1}),a(e(Xe),null,{default:l(()=>[a(e(P),{value:"all"},{default:l(()=>[...t[16]||(t[16]=[d("Semua Status",-1)])]),_:1}),a(e(P),{value:"0"},{default:l(()=>[...t[17]||(t[17]=[d("Pending",-1)])]),_:1}),a(e(P),{value:"1"},{default:l(()=>[...t[18]||(t[18]=[d("Released",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(e(X),null,{default:l(()=>[a(e(Y),{"as-child":""},{default:l(()=>[a(e(C),{variant:"outline",class:"ml-auto"},{default:l(()=>[t[19]||(t[19]=d(" Kolom ",-1)),a(e(Pe),{class:"ml-2 h-4 w-4"})]),_:1})]),_:1}),a(e(Z),{align:"end"},{default:l(()=>[(o(!0),v(x,null,V(e(I).getAllColumns().filter(n=>n.getCanHide()),n=>(o(),p(e(Ce),{key:n.id,class:"capitalize","model-value":n.getIsVisible(),"onUpdate:modelValue":i=>{n.toggleVisibility(!!i)}},{default:l(()=>[d(h(n.id),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})]),u("div",ct,[a(e(Ye),null,{default:l(()=>[a(e(Ze),null,{default:l(()=>[(o(!0),v(x,null,V(e(I).getHeaderGroups(),n=>(o(),p(e(K),{key:n.id},{default:l(()=>[(o(!0),v(x,null,V(n.headers,i=>(o(),p(e(Ge),{key:i.id},{default:l(()=>[i.isPlaceholder?D("",!0):(o(),p(e(te),{key:0,render:i.column.columnDef.header,props:i.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),a(e(Qe),null,{default:l(()=>[e(I).getRowModel().rows?.length?(o(!0),v(x,{key:0},V(e(I).getRowModel().rows,n=>(o(),p(e(K),{key:n.id,"data-state":n.getIsSelected()?"selected":void 0},{default:l(()=>[(o(!0),v(x,null,V(n.getVisibleCells(),i=>(o(),p(e(ae),{key:i.id},{default:l(()=>[a(e(te),{render:i.column.columnDef.cell,props:i.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1032,["data-state"]))),128)):(o(),p(e(K),{key:1},{default:l(()=>[a(e(ae),{colspan:N.length,class:"h-24 text-center"},{default:l(()=>[...t[20]||(t[20]=[d(" Tidak ada data bonus. ",-1)])]),_:1},8,["colspan"])]),_:1}))]),_:1})]),_:1})]),m.bonuses.last_page>1?(o(),p(Se,{key:1,data:{current_page:m.bonuses.current_page,last_page:m.bonuses.last_page,per_page:m.bonuses.per_page,from:m.bonuses.from,to:m.bonuses.to,total:m.bonuses.total},url:e(F).url(),filters:{search:y.value||void 0,status:c.value!=="all"?parseInt(c.value):void 0,sort_by:b.value[0]?.id||"created_at",sort_order:b.value[0]?.desc?"desc":"asc"}},null,8,["data","url","filters"])):D("",!0)]),a(U,{open:w.value.open,"onUpdate:open":t[3]||(t[3]=n=>w.value.open=n),title:"Hapus Bonus?",description:"Apakah Anda yakin ingin menghapus bonus ini? Tindakan ini tidak dapat dibatalkan.","confirm-text":"Hapus","cancel-text":"Batal",variant:"destructive",onConfirm:de},null,8,["open"]),a(U,{open:_.value.open,"onUpdate:open":t[4]||(t[4]=n=>_.value.open=n),title:"Release Bonus?",description:`Bonus sebesar ${_.value.bonus?R(_.value.bonus.amount):""} akan ditransfer ke ewallet member. Lanjutkan?`,"confirm-text":"Release","cancel-text":"Batal",onConfirm:ce},null,8,["open","description"]),a(U,{open:B.value.open,"onUpdate:open":t[5]||(t[5]=n=>B.value.open=n),title:`Release ${S.value.length} Bonus?`,description:`Total ${R(S.value.reduce((n,i)=>n+i.amount,0))} akan ditransfer ke ewallet member. Lanjutkan?`,"confirm-text":"Release Semua","cancel-text":"Batal",onConfirm:pe},null,8,["open","title","description"])]),_:1})],64))}});export{jt as default};
