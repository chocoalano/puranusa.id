import{L as ee,M as te,_ as ae}from"./AppLayout.vue_vue_type_script_setup_true_lang-CAMiCJvC.js";import{d as C,v as x,g as f,b as s,u as t,w as i,s as w,ax as se,e as g,K as F,at as le,aV as re,aB as ne,ac as L,ad as N,Z as ie,aa as oe,F as k,x as S,c as h,t as X,r as D,D as H,Q as j,q as ue,y as de,n as u,bG as ce,X as me,ao as fe,aN as pe,A as ge,B as we,E as G,j as Y,a1 as ve,al as A}from"./vendor-ppbe-N6l.js";import{_ as V,a as M}from"./CardContent.vue_vue_type_script_setup_true_lang-vqvbNoPF.js";import{_ as T}from"./CardHeader.vue_vue_type_script_setup_true_lang-_r3YWix0.js";import{_ as W}from"./CardTitle.vue_vue_type_script_setup_true_lang-CuQE-qUU.js";import{f as xe}from"./currency-DfrMaoZy.js";import{_ as _e}from"./Pagination.vue_vue_type_script_setup_true_lang-DUSFRDmQ.js";import{_ as I,v as E}from"./index-BYj0gYCc.js";import{_ as he}from"./Input.vue_vue_type_script_setup_true_lang-DNj-uKug.js";import{_ as be,a as ye,b as ke,c as De,d as B}from"./SelectValue.vue_vue_type_script_setup_true_lang-CzK-upws.js";import{_ as je,a as $e,b as Fe}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DA3JUaxj.js";import{_ as Se}from"./DropdownMenuCheckboxItem.vue_vue_type_script_setup_true_lang-B2B57jfW.js";import{_ as Ce,a as Re,c as Ae,b as P,d as Ve,e as Q}from"./TableHeader.vue_vue_type_script_setup_true_lang-CR2Mc2h7.js";import{_ as Z}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-DRKnPmKW.js";import{_ as Me}from"./index-uV4J0ulh.js";import{u as Te}from"./usePermissions-ooJviFw8.js";import"./index-CSEUMRIG.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-DiRTNO4J.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-BAAtcDkZ.js";import"./index-BUE9bFsX.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CKDVFyjr.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-B3c6JmTR.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-sCt9Ofqi.js";const We={class:"grid gap-4 md:grid-cols-4"},Be={class:"text-2xl font-bold"},Ie={class:"text-2xl font-bold"},Ne={class:"text-2xl font-bold"},Ue={class:"text-2xl font-bold"},Ke=C({__name:"WithdrawalStatistics",props:{statistics:{}},setup(e){return(o,l)=>(f(),x("div",We,[s(t(V),null,{default:i(()=>[s(t(T),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:i(()=>[s(t(W),{class:"text-sm font-medium"},{default:i(()=>[...l[0]||(l[0]=[w("Pending",-1)])]),_:1}),s(t(se),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),s(t(M),null,{default:i(()=>[g("div",Be,F(e.statistics.total_pending),1),l[1]||(l[1]=g("p",{class:"text-xs text-muted-foreground"},"Menunggu persetujuan",-1))]),_:1})]),_:1}),s(t(V),null,{default:i(()=>[s(t(T),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:i(()=>[s(t(W),{class:"text-sm font-medium"},{default:i(()=>[...l[2]||(l[2]=[w("Disetujui",-1)])]),_:1}),s(t(le),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),s(t(M),null,{default:i(()=>[g("div",Ie,F(e.statistics.total_completed),1),l[3]||(l[3]=g("p",{class:"text-xs text-muted-foreground"},"Withdrawal selesai",-1))]),_:1})]),_:1}),s(t(V),null,{default:i(()=>[s(t(T),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:i(()=>[s(t(W),{class:"text-sm font-medium"},{default:i(()=>[...l[4]||(l[4]=[w("Ditolak",-1)])]),_:1}),s(t(re),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),s(t(M),null,{default:i(()=>[g("div",Ne,F(e.statistics.total_failed),1),l[5]||(l[5]=g("p",{class:"text-xs text-muted-foreground"},"Withdrawal gagal",-1))]),_:1})]),_:1}),s(t(V),null,{default:i(()=>[s(t(T),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:i(()=>[s(t(W),{class:"text-sm font-medium"},{default:i(()=>[...l[6]||(l[6]=[w("Total Nominal",-1)])]),_:1}),s(t(ne),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),s(t(M),null,{default:i(()=>[g("div",Ue,F(t(xe)(e.statistics.total_amount)),1),l[7]||(l[7]=g("p",{class:"text-xs text-muted-foreground"},"Total withdrawal berhasil",-1))]),_:1})]),_:1})]))}}),Ee={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},Pe={class:"flex flex-1 gap-4"},Oe={class:"relative flex-1 max-w-sm"},qe=C({__name:"WithdrawalFiltersBar",props:L({table:{}},{search:{default:""},searchModifiers:{},statusFilter:{default:"all"},statusFilterModifiers:{}}),emits:["update:search","update:statusFilter"],setup(e){const o=N(e,"search"),l=N(e,"statusFilter");return(d,r)=>(f(),x("div",Ee,[g("div",Pe,[g("div",Oe,[s(t(ie),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),s(t(he),{modelValue:o.value,"onUpdate:modelValue":r[0]||(r[0]=c=>o.value=c),placeholder:"Cari pelanggan atau referensi...",class:"pl-9"},null,8,["modelValue"])]),s(t(be),{modelValue:l.value,"onUpdate:modelValue":r[1]||(r[1]=c=>l.value=c)},{default:i(()=>[s(t(ye),{class:"w-[180px]"},{default:i(()=>[s(t(ke),{placeholder:"Semua Status"})]),_:1}),s(t(De),null,{default:i(()=>[s(t(B),{value:"all"},{default:i(()=>[...r[2]||(r[2]=[w("Semua Status",-1)])]),_:1}),s(t(B),{value:"pending"},{default:i(()=>[...r[3]||(r[3]=[w("Pending",-1)])]),_:1}),s(t(B),{value:"completed"},{default:i(()=>[...r[4]||(r[4]=[w("Completed",-1)])]),_:1}),s(t(B),{value:"failed"},{default:i(()=>[...r[5]||(r[5]=[w("Failed",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s(t(je),null,{default:i(()=>[s(t($e),{"as-child":""},{default:i(()=>[s(t(I),{variant:"outline",class:"ml-auto"},{default:i(()=>[r[6]||(r[6]=w(" Kolom ",-1)),s(t(oe),{class:"ml-2 h-4 w-4"})]),_:1})]),_:1}),s(t(Fe),{align:"end"},{default:i(()=>[(f(!0),x(k,null,S(e.table.getAllColumns().filter(c=>c.getCanHide()),c=>(f(),h(t(Se),{key:c.id,class:"capitalize","model-value":c.getIsVisible(),"onUpdate:modelValue":_=>c.toggleVisibility(!!_)},{default:i(()=>[w(F(c.id),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})]))}}),ze={class:"rounded-md border"},He=C({__name:"WithdrawalTable",props:{table:{},columns:{},FlexRender:{}},setup(e){return(o,l)=>(f(),x("div",ze,[s(t(Ce),null,{default:i(()=>[s(t(Re),null,{default:i(()=>[(f(!0),x(k,null,S(e.table.getHeaderGroups(),d=>(f(),h(t(P),{key:d.id},{default:i(()=>[(f(!0),x(k,null,S(d.headers,r=>(f(),h(t(Ae),{key:r.id},{default:i(()=>[r.isPlaceholder?X("",!0):(f(),h(t(e.FlexRender),{key:0,render:r.column.columnDef.header,props:r.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),s(t(Ve),null,{default:i(()=>[e.table.getRowModel().rows?.length?(f(!0),x(k,{key:0},S(e.table.getRowModel().rows,d=>(f(),h(t(P),{key:d.id},{default:i(()=>[(f(!0),x(k,null,S(d.getVisibleCells(),r=>(f(),h(t(Q),{key:r.id},{default:i(()=>[s(t(e.FlexRender),{render:r.column.columnDef.cell,props:r.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1024))),128)):(f(),h(t(P),{key:1},{default:i(()=>[s(t(Q),{colspan:e.columns.length,class:"h-24 text-center"},{default:i(()=>[...l[0]||(l[0]=[w(" Tidak ada permintaan withdrawal. ",-1)])]),_:1},8,["colspan"])]),_:1}))]),_:1})]),_:1})]))}}),y=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e??0),Qe="Asia/Jakarta",Ze=e=>{const o=new Date(e);return Number.isNaN(o.getTime())?"-":`${new Intl.DateTimeFormat("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:Qe}).format(o)} WIB`},Je=e=>({pending:"secondary",completed:"default",failed:"destructive"})[e]||"secondary",Le=C({__name:"WithdrawalActionDialogs",props:{approveDialog:{required:!0},approveDialogModifiers:{},rejectDialog:{required:!0},rejectDialogModifiers:{}},emits:L(["approve","reject"],["update:approveDialog","update:rejectDialog"]),setup(e){const o=N(e,"approveDialog"),l=N(e,"rejectDialog");return(d,r)=>(f(),x(k,null,[s(Z,{open:o.value.open,"onUpdate:open":r[0]||(r[0]=c=>o.value.open=c),title:"Setujui Withdrawal?",description:`Apakah Anda yakin ingin menyetujui permintaan withdrawal sebesar ${o.value.withdrawal?t(y)(o.value.withdrawal.amount):""} untuk ${o.value.withdrawal?.customer.name}? Dana akan ditransfer via Midtrans ke rekening tujuan.`,"confirm-text":"Setujui & Transfer","cancel-text":"Batal",onConfirm:r[1]||(r[1]=c=>d.$emit("approve"))},null,8,["open","description"]),s(Z,{open:l.value.open,"onUpdate:open":r[2]||(r[2]=c=>l.value.open=c),title:"Tolak Withdrawal?",description:`Apakah Anda yakin ingin menolak permintaan withdrawal sebesar ${l.value.withdrawal?t(y)(l.value.withdrawal.amount):""} dari ${l.value.withdrawal?.customer.name}?`,"confirm-text":"Tolak","cancel-text":"Batal",variant:"destructive",onConfirm:r[3]||(r[3]=c=>d.$emit("reject"))},null,8,["open","description"])],64))}});function Xe(){const e=D({open:!1,withdrawal:null}),o=D({open:!1,withdrawal:null}),l=a=>e.value={open:!0,withdrawal:a},d=a=>o.value={open:!0,withdrawal:a},r=()=>e.value={open:!1,withdrawal:null},c=()=>o.value={open:!1,withdrawal:null};function _(a){if(!a)return"Terjadi kesalahan";if(typeof a=="string")return a;const n=Object.values(a)[0];if(typeof n=="string")return n;if(Array.isArray(n)&&typeof n[0]=="string")return n[0];const m=Object.keys(a)[0];return m||"Terjadi kesalahan"}return{approveDialog:e,rejectDialog:o,openApproveDialog:l,openRejectDialog:d,handleApprove:()=>{const a=e.value.withdrawal;if(!a)return;H({}).post(te.url(a.id),{preserveScroll:!0,onSuccess:m=>{const p=m.props.flash;if(p?.error){j.error(p.error);return}p?.success&&j.success(p.success),r()},onError:m=>{const p=m.approve||m.general||m.error||_(m);j.error(p),console.error("Error approving withdrawal:",m)}})},handleReject:()=>{const a=o.value.withdrawal;if(!a)return;H({}).post(ee.url(a.id),{preserveScroll:!0,onSuccess:m=>{const p=m.props.flash;if(p?.error){j.error(p.error);return}p?.success&&j.success(p.success),c()},onError:m=>{const p=m.approve||m.general||m.error||_(m);j.error(p),console.error("Error approving withdrawal:",m)}})}}}const J=e=>typeof e=="object"&&e!==null&&!Array.isArray(e),O=e=>{if(!e)return null;if(J(e))return e;if(typeof e=="string")try{const o=JSON.parse(e);return J(o)?o:null}catch{return null}return null};function Ge(e){const o=D([{id:"created_at",desc:!0}]),l=D([]),d=D({}),r=a=>({column:n})=>u(I,{variant:"ghost",onClick:()=>n.toggleSorting(n.getIsSorted()==="asc"),class:"-ml-4"},()=>[a,u(fe,{class:"ml-2 h-4 w-4"})]),{isSuperAdmin:c,isAdmin:_}=Te(),$=[{id:"index",header:()=>u("div",{class:"w-12"},"No"),cell:({row:a})=>{const n=a.index+1+(e.withdrawals.current_page-1)*e.withdrawals.per_page;return u("div",{class:"font-medium"},n)}},{accessorKey:"customer.name",header:r("Pelanggan"),cell:({row:a})=>{const n=a.original.customer;return u("div",[u("div",{class:"font-medium"},n.name),u("div",{class:"text-xs text-muted-foreground"},n.email)])}},{accessorKey:"customer.username",header:r("Username"),cell:({row:a})=>{const n=a.original.customer;return u("div",[u("div",{class:"font-medium"},n.username),u("div",{class:"text-xs text-muted-foreground"},n.email)])}},{accessorKey:"customer.ewallet_saldo",header:()=>"Saldo Sekarang",cell:({row:a})=>u("div",y(a.original.customer.ewallet_saldo))},{accessorKey:"balance_before",header:()=>"Saldo Sebelum",cell:({row:a})=>u("div",y(a.getValue("balance_before")))},{accessorKey:"amount",header:()=>"Penarikan",cell:({row:a})=>u("div",{class:"font-bold text-red-600"},y(a.getValue("amount")))},{id:"admin_fee",header:()=>"Biaya Admin",cell:({row:a})=>{const n=O(a.original.notes);return n?u("div",{class:"text-xs font-medium"},y(n.admin_fee??0)):u("div",{class:"text-xs text-muted-foreground"},"-")}},{id:"net_amount",header:()=>"Penarikan Net",cell:({row:a})=>{const n=O(a.original.notes);return n?u("div",{class:"text-xs font-medium"},y(n.net_amount??0)):u("div",{class:"text-xs text-muted-foreground"},"-")}},{id:"bank_destination",header:()=>"Rekening Tujuan",cell:({row:a})=>{const n=O(a.original.notes);return n?u("div",[u("div",{class:"text-xs font-medium"},`${n.bank_name} - ${n.bank_account}`),u("div",{class:"text-xs text-muted-foreground"},n.bank_holder)]):u("div",{class:"text-xs text-muted-foreground"},"-")}},{accessorKey:"transaction_ref",header:()=>"Referensi",cell:({row:a})=>u("div",{class:"font-mono text-xs"},a.getValue("transaction_ref"))},{accessorKey:"status",header:()=>"Status",cell:({row:a})=>{const n=a.getValue("status");return u(Me,{variant:Je(n)},()=>n)}},{accessorKey:"created_at",header:()=>"Tanggal",cell:({row:a})=>u("div",{class:"text-sm"},Ze(a.getValue("created_at")))},{id:"actions",header:()=>u("div",{class:"text-right"},"Aksi"),cell:({row:a})=>{const n=a.original;if(n.status!=="pending"&&(c||_))return null;const m=n.balance_before<n.amount;return u("div",{class:"flex justify-end gap-2"},[u(I,{size:"sm",onClick:()=>e.onApprove(n),disabled:m},()=>[u(ce,{class:"mr-1 h-4 w-4"}),"Setujui"]),u(I,{size:"sm",variant:"destructive",onClick:()=>e.onReject(n)},()=>[u(me,{class:"mr-1 h-4 w-4"}),"Tolak"])])}}];return{table:ue({get data(){return e.withdrawals.data},columns:$,getCoreRowModel:we(),getSortedRowModel:ge(),getFilteredRowModel:pe(),onSortingChange:a=>E(a,o),onColumnFiltersChange:a=>E(a,l),onColumnVisibilityChange:a=>E(a,d),state:{get sorting(){return o.value},get columnFilters(){return l.value},get columnVisibility(){return d.value}},manualSorting:!0}),columns:$,sorting:o,FlexRender:de}}function Ye(e,o,l=300){let d=null;G(e,()=>{d&&clearTimeout(d),d=setTimeout(o,l)},{deep:!0})}function et(e){const o=e.endpoint??"/admin/withdrawals",l=D(e.initialFilters.search||""),d=D(e.initialFilters.status||"all"),r=()=>({search:l.value||void 0,status:d.value!=="all"?d.value:void 0,sort_by:e.sorting.value[0]?.id||"created_at",sort_order:e.sorting.value[0]?.desc?"desc":"asc"}),c=()=>{Y.get(o,r(),{preserveState:!0,preserveScroll:!0})};return Ye([l,d],c,300),{search:l,statusFilter:d,buildQuery:r,go:c}}const tt={class:"rounded-xl p-4 space-y-6 py-6"},jt=C({__name:"Index",props:{withdrawals:{},statistics:{},filters:{}},setup(e){const o=e,{approveDialog:l,rejectDialog:d,openApproveDialog:r,openRejectDialog:c,handleApprove:_,handleReject:$}=Xe(),{table:R,columns:a,sorting:n,FlexRender:m}=Ge({withdrawals:o.withdrawals,onApprove:r,onReject:c}),p=[{id:o.filters.sort_by||"created_at",desc:o.filters.sort_order==="desc"}];n.value=p;const{search:U,statusFilter:K,buildQuery:q}=et({initialFilters:o.filters,sorting:n,endpoint:"/admin/withdrawals"});return G(n,z=>{z.length&&Y.get("/admin/withdrawals",q(),{preserveState:!0,preserveScroll:!0})},{deep:!0}),(z,v)=>(f(),x(k,null,[s(t(ve),{title:"Permintaan Withdrawal"}),s(ae,null,{default:i(()=>[g("div",tt,[v[4]||(v[4]=g("div",null,[g("h2",{class:"text-3xl font-bold tracking-tight"},"Permintaan Withdrawal"),g("p",{class:"text-muted-foreground"},"Kelola permintaan penarikan saldo dari pelanggan")],-1)),s(Ke,{statistics:e.statistics},null,8,["statistics"]),s(qe,{table:t(R),search:t(U),"onUpdate:search":v[0]||(v[0]=b=>A(U)?U.value=b:null),statusFilter:t(K),"onUpdate:statusFilter":v[1]||(v[1]=b=>A(K)?K.value=b:null)},null,8,["table","search","statusFilter"]),s(He,{table:t(R),columns:t(a),FlexRender:t(m)},null,8,["table","columns","FlexRender"]),e.withdrawals.last_page>1?(f(),h(_e,{key:0,data:{current_page:e.withdrawals.current_page,last_page:e.withdrawals.last_page,per_page:e.withdrawals.per_page,from:(e.withdrawals.current_page-1)*e.withdrawals.per_page+1,to:Math.min(e.withdrawals.current_page*e.withdrawals.per_page,e.withdrawals.total),total:e.withdrawals.total},url:"/admin/withdrawals",filters:t(q)()},null,8,["data","filters"])):X("",!0)]),s(Le,{approveDialog:t(l),"onUpdate:approveDialog":v[2]||(v[2]=b=>A(l)?l.value=b:null),rejectDialog:t(d),"onUpdate:rejectDialog":v[3]||(v[3]=b=>A(d)?d.value=b:null),onApprove:t(_),onReject:t($)},null,8,["approveDialog","rejectDialog","onApprove","onReject"])]),_:1})],64))}});export{jt as default};
