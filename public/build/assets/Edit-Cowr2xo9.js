import{d as X,D as q,r as p,E as z,Q as y,c as g,g as u,w as i,b as a,e,u as t,a1 as O,a4 as C,G as R,ae as W,s as l,aT as H,K as r,bl as P,v as f,t as w,M as E,F as j,x as K,J as L,L as I,ab as J,am as Q,aX as Y}from"./vendor-DfMbnFaR.js";import{C as Z,D as M,_ as tt,F as st}from"./AppLayout.vue_vue_type_script_setup_true_lang-3Xwj2Srj.js";import{_ as x,c as at}from"./index-BhPH699V.js";import{_ as V}from"./Label.vue_vue_type_script_setup_true_lang-C_XGMl1H.js";import{_ as et,a as it,b as nt,c as ot,d as lt}from"./SelectValue.vue_vue_type_script_setup_true_lang-VBwlv4qP.js";import{_ as U,a as B}from"./CardContent.vue_vue_type_script_setup_true_lang-NxxB_dAy.js";import{_ as D}from"./CardDescription.vue_vue_type_script_setup_true_lang-DW_PX5BW.js";import{_ as F}from"./CardHeader.vue_vue_type_script_setup_true_lang-Kdg7L6IL.js";import{_ as N}from"./CardTitle.vue_vue_type_script_setup_true_lang-Cj4ck2dV.js";import{_ as rt,a as dt,b as ut,c as mt,d as ct,e as ft,f as _t,g as pt,h as kt}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-Cqsoy_WK.js";import{_ as T}from"./index-Qe8U7avD.js";import"./index-CSEUMRIG.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-Bqij1zEj.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-BOYUcfDs.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-NxThyEhC.js";import"./index-DnSHhU6t.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DrG-1awo.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-CpOM3BUc.js";const bt={class:"rounded-xl p-4 space-y-6 py-6"},vt={class:"mb-6 flex items-center gap-4"},gt={class:"rounded-lg bg-muted p-4 space-y-3"},xt={class:"flex items-center gap-2"},ht={class:"grid grid-cols-2 gap-4 text-sm"},yt={class:"font-medium"},wt={class:"flex items-center gap-1"},$t={key:0,class:"text-muted-foreground"},St={class:"space-y-2"},Ct={class:"space-y-2"},Pt={key:0,class:"flex items-center gap-2"},Et={key:1},jt={key:2,class:"text-muted-foreground"},Kt={class:"flex items-center gap-2"},Lt={key:0,class:"text-sm text-destructive"},Mt={class:"rounded-lg border border-amber-200 bg-amber-50 p-4 dark:border-amber-800 dark:bg-amber-950"},Vt={class:"flex items-start gap-3"},Ut={class:"flex items-center gap-4"},Zt=X({__name:"Edit",props:{stockist:{},provinces:{},assignedKabupaten:{}},setup(m){const c=m,o=q({stockist_kabupaten_id:c.stockist.stockist_kabupaten_id,stockist_kabupaten_name:c.stockist.stockist_kabupaten_name||"",stockist_province_id:c.stockist.stockist_province_id,stockist_province_name:c.stockist.stockist_province_name||""}),_=p(c.stockist.stockist_province_id),k=p([]),b=p(!1),v=p(!1),h=p(!0);z(_,async d=>{if(!d){k.value=[],h.value||(o.stockist_kabupaten_id=null,o.stockist_kabupaten_name="",o.stockist_province_id=null,o.stockist_province_name="");return}const s=c.provinces.find(n=>n.id===d);s&&(o.stockist_province_id=s.id,o.stockist_province_name=s.name),h.value||(o.stockist_kabupaten_id=null,o.stockist_kabupaten_name=""),b.value=!0;try{const n=`${Z.url()}?province_id=${d}`,S=await fetch(n,{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(!S.ok)throw new Error("Failed to fetch cities");k.value=await S.json()}catch(n){console.error(n),y.error("Gagal memuat daftar kota"),k.value=[]}finally{b.value=!1,h.value=!1}},{immediate:!0});const A=d=>{o.stockist_kabupaten_id=d.id,o.stockist_kabupaten_name=d.name,v.value=!1},$=d=>c.assignedKabupaten.includes(d),G=()=>{o.put(st.url(c.stockist.id),{onSuccess:()=>{y.success("Kota stokist berhasil diperbarui")},onError:d=>{const s=Object.values(d)[0];s&&y.error(s)}})};return(d,s)=>(u(),g(tt,null,{default:i(()=>[a(t(O),{title:"Edit Stokist"}),e("div",bt,[e("div",vt,[a(t(C),{href:t(M).url()},{default:i(()=>[a(t(x),{variant:"outline",size:"icon"},{default:i(()=>[a(t(R),{class:"h-4 w-4"})]),_:1})]),_:1},8,["href"]),s[2]||(s[2]=e("div",null,[e("h1",{class:"text-3xl font-bold tracking-tight"},"Edit Stokist"),e("p",{class:"text-muted-foreground"}," Ubah kota wilayah stokist ")],-1))]),e("form",{onSubmit:W(G,["prevent"]),class:"space-y-6 max-w-2xl"},[a(t(U),null,{default:i(()=>[a(t(F),null,{default:i(()=>[a(t(N),{class:"flex items-center gap-2"},{default:i(()=>[a(t(H),{class:"h-5 w-5"}),s[3]||(s[3]=l(" Informasi Stokist ",-1))]),_:1}),a(t(D),null,{default:i(()=>[...s[4]||(s[4]=[l(" Data pelanggan yang menjadi stokist (tidak dapat diubah) ",-1)])]),_:1})]),_:1}),a(t(B),null,{default:i(()=>[e("div",gt,[e("div",xt,[a(t(T),{variant:"secondary",class:"font-mono"},{default:i(()=>[l(r(m.stockist.ewallet_id),1)]),_:1}),a(t(P),{class:"h-4 w-4 text-primary"})]),e("div",ht,[e("div",null,[s[5]||(s[5]=e("span",{class:"font-medium text-muted-foreground"},"Nama:",-1)),e("p",yt,r(m.stockist.name),1)]),e("div",null,[s[6]||(s[6]=e("span",{class:"font-medium text-muted-foreground"},"Email:",-1)),e("p",null,r(m.stockist.email),1)]),e("div",null,[s[7]||(s[7]=e("span",{class:"font-medium text-muted-foreground"},"Telepon:",-1)),e("p",null,r(m.stockist.phone||"-"),1)]),e("div",null,[s[8]||(s[8]=e("span",{class:"font-medium text-muted-foreground"},"Kota Saat Ini:",-1)),e("p",wt,[a(t(E),{class:"h-4 w-4 text-muted-foreground"}),l(" "+r(m.stockist.stockist_kabupaten_name||"-")+" ",1),m.stockist.stockist_province_name?(u(),f("span",$t," ("+r(m.stockist.stockist_province_name)+") ",1)):w("",!0)])])])])]),_:1})]),_:1}),a(t(U),null,{default:i(()=>[a(t(F),null,{default:i(()=>[a(t(N),{class:"flex items-center gap-2"},{default:i(()=>[a(t(E),{class:"h-5 w-5"}),s[9]||(s[9]=l(" Ubah Wilayah Stokist ",-1))]),_:1}),a(t(D),null,{default:i(()=>[...s[10]||(s[10]=[l(" Pilih kota baru untuk wilayah stokist. Setiap kota hanya dapat memiliki 1 stokist. ",-1)])]),_:1})]),_:1}),a(t(B),{class:"space-y-4"},{default:i(()=>[e("div",St,[a(t(V),null,{default:i(()=>[...s[11]||(s[11]=[l("Provinsi ",-1),e("span",{class:"text-destructive"},"*",-1)])]),_:1}),a(t(et),{modelValue:_.value,"onUpdate:modelValue":s[0]||(s[0]=n=>_.value=n)},{default:i(()=>[a(t(it),null,{default:i(()=>[a(t(nt),{placeholder:"Pilih provinsi..."})]),_:1}),a(t(ot),null,{default:i(()=>[(u(!0),f(j,null,K(m.provinces,n=>(u(),g(t(lt),{key:n.id,value:n.id},{default:i(()=>[l(r(n.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),s[12]||(s[12]=e("p",{class:"text-sm text-muted-foreground"}," Pilih provinsi untuk menampilkan daftar kota. ",-1))]),e("div",Ct,[a(t(V),null,{default:i(()=>[...s[13]||(s[13]=[l("Kota ",-1),e("span",{class:"text-destructive"},"*",-1)])]),_:1}),a(t(rt),{open:v.value,"onUpdate:open":s[1]||(s[1]=n=>v.value=n)},{default:i(()=>[a(t(dt),{"as-child":""},{default:i(()=>[a(t(x),{variant:"outline",role:"combobox","aria-expanded":v.value,class:L(["w-full justify-between",{"border-destructive":t(o).errors.stockist_kabupaten_id}]),disabled:!_.value||b.value},{default:i(()=>[b.value?(u(),f("span",Pt,[a(t(I),{class:"h-4 w-4 animate-spin"}),s[14]||(s[14]=l(" Memuat... ",-1))])):t(o).stockist_kabupaten_name?(u(),f("span",Et,r(t(o).stockist_kabupaten_name),1)):(u(),f("span",jt,r(_.value?"Pilih kota...":"Pilih provinsi terlebih dahulu"),1)),a(t(J),{class:"ml-2 h-4 w-4 shrink-0 opacity-50"})]),_:1},8,["aria-expanded","class","disabled"])]),_:1}),a(t(ut),{class:"w-[400px] p-0"},{default:i(()=>[a(t(mt),null,{default:i(()=>[a(t(ct),{placeholder:"Cari kota..."}),a(t(ft),null,{default:i(()=>[a(t(_t),null,{default:i(()=>[...s[15]||(s[15]=[l("Tidak ada kota ditemukan.",-1)])]),_:1}),a(t(pt),null,{default:i(()=>[(u(!0),f(j,null,K(k.value,n=>(u(),g(t(kt),{key:n.id,value:n.name,disabled:$(n.id),onSelect:()=>A(n),class:"flex items-center justify-between"},{default:i(()=>[e("div",Kt,[a(t(Q),{class:L(t(at)("mr-2 h-4 w-4",t(o).stockist_kabupaten_id===n.id?"opacity-100":"opacity-0"))},null,8,["class"]),e("span",null,r(n.name),1)]),$(n.id)?(u(),g(t(T),{key:0,variant:"secondary",class:"text-xs"},{default:i(()=>[...s[16]||(s[16]=[l(" Sudah ada stokist ",-1)])]),_:1})):w("",!0)]),_:2},1032,["value","disabled","onSelect"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),t(o).errors.stockist_kabupaten_id?(u(),f("p",Lt,r(t(o).errors.stockist_kabupaten_id),1)):w("",!0),s[17]||(s[17]=e("p",{class:"text-sm text-muted-foreground"}," Kota yang sudah memiliki stokist lain akan ditandai dan tidak dapat dipilih. ",-1))])]),_:1})]),_:1}),e("div",Mt,[e("div",Vt,[a(t(Y),{class:"h-5 w-5 text-amber-600 dark:text-amber-400 mt-0.5"}),s[18]||(s[18]=e("div",{class:"text-sm text-amber-700 dark:text-amber-300"},[e("p",{class:"font-medium"},"Perhatian"),e("p",{class:"mt-1"}," Mengubah wilayah stokist akan memindahkan tanggung jawab distribusi ke kota baru. Pastikan perubahan ini sudah dikonfirmasi dengan stokist bersangkutan. ")],-1))])]),e("div",Ut,[a(t(x),{type:"submit",disabled:t(o).processing},{default:i(()=>[a(t(P),{class:"mr-2 h-4 w-4"}),l(" "+r(t(o).processing?"Menyimpan...":"Simpan Perubahan"),1)]),_:1},8,["disabled"]),a(t(C),{href:t(M).url()},{default:i(()=>[a(t(x),{variant:"outline",type:"button"},{default:i(()=>[...s[19]||(s[19]=[l("Batal",-1)])]),_:1})]),_:1},8,["href"])])],32)])]),_:1}))}});export{Zt as default};
