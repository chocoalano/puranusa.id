import{M as V,N as ce,_ as me,P as fe,Q as O,R as pe,S as ge}from"./AppLayout.vue_vue_type_script_setup_true_lang-4ED1Xj29.js";import{_ as I}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-Bm7ku-wc.js";import{_ as ve}from"./Pagination.vue_vue_type_script_setup_true_lang-ZI4hZ9bj.js";import{_ as J}from"./index-DWwRQAkq.js";import{_ as g,v as M}from"./index-DPBmQVLp.js";import{_ as T,a as j}from"./CardContent.vue_vue_type_script_setup_true_lang-DBworNJ8.js";import{_ as U}from"./CardHeader.vue_vue_type_script_setup_true_lang-DPu1FEAA.js";import{_ as A}from"./CardTitle.vue_vue_type_script_setup_true_lang-f8O7_Lex.js";import{_ as _e,a as be,b as xe}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-VUM4Jj0u.js";import{_ as he}from"./DropdownMenuCheckboxItem.vue_vue_type_script_setup_true_lang-7zY6IrAA.js";import{_ as ye}from"./Input.vue_vue_type_script_setup_true_lang-bXD-JnOr.js";import{_ as ke,a as we,b as Se,c as Ce,d as K}from"./SelectValue.vue_vue_type_script_setup_true_lang-C9D_fxoj.js";import{_ as $e,a as Re,b as N,c as De,d as Pe,e as Q}from"./TableHeader.vue_vue_type_script_setup_true_lang-gCq3xuQk.js";import{d as Be,r as c,p as W,q as Fe,E as X,j as w,c as v,g as u,w as l,b as a,e as r,u as s,a0 as Ve,v as S,t as Y,s as d,cU as z,Y as Ie,cR as Me,K as h,au as Te,aq as Z,Z as je,cS as Ue,a9 as Ae,F as R,x as D,y as ee,n as o,D as H,cw as Ke,aM as Ne,an as ze,ap as He,z as Ee,aG as Le,A as qe,B as Ge}from"./vendor-MSza8NbP.js";import"./index-DaR_mHDg.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-CAy2W9eb.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-BZBhZv32.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-LF5-spqp.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-B-o61Jab.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-BEfnzQ6f.js";const Oe={class:"rounded-xl p-4 space-y-6 py-6"},Je={class:"flex items-center justify-between"},Qe={class:"flex gap-2"},We={class:"grid gap-4 md:grid-cols-3"},Xe={class:"text-2xl font-bold"},Ye={class:"text-xs text-muted-foreground"},Ze={class:"text-2xl font-bold"},et={class:"text-xs text-muted-foreground"},tt={class:"text-2xl font-bold"},st={key:0,class:"flex items-center justify-between rounded-lg border bg-muted/50 p-4"},at={class:"text-sm font-medium"},lt={class:"flex items-center gap-4"},nt={class:"relative flex-1"},ot={class:"rounded-md border"},Rt=Be({__name:"Index",props:{bonuses:{},statistics:{},filters:{}},setup(_){const p=_,te=[{title:"Bonus Pairing",href:V.url()}],y=c(p.filters.search||""),m=c(p.filters.status?.toString()||"all"),b=c([{id:p.filters.sort_by,desc:p.filters.sort_order==="desc"}]),E=c([]),L=c({}),C=c({}),k=c({open:!1,bonus:null}),f=c({open:!1,bonus:null}),P=c({open:!1}),B=c({open:!1}),se=W(()=>Object.keys(C.value).map(e=>p.bonuses.data[parseInt(e)]).filter(Boolean)),x=W(()=>se.value.filter(e=>e.status===0)),$=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e),ae=e=>new Date(e).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),le=e=>{k.value={open:!0,bonus:e}},ne=()=>{k.value.bonus&&w.delete(fe.url(k.value.bonus.id),{preserveScroll:!0,onSuccess:()=>{k.value={open:!1,bonus:null}}})},oe=e=>{f.value={open:!0,bonus:e}},re=()=>{if(!f.value.bonus)return;H({}).post(O.url(f.value.bonus.id),{preserveScroll:!0,onSuccess:()=>{f.value={open:!1,bonus:null},C.value={}}})},ie=()=>{x.value.length&&(P.value.open=!0)},ue=()=>{const e=x.value.map(n=>n.id);let t=0;e.forEach(n=>{H({}).post(O.url(n),{preserveScroll:!0,onSuccess:()=>{t++,t===e.length&&(C.value={},P.value.open=!1,w.reload({only:["bonuses","statistics"]}))}})})},de=()=>{H({}).post(pe.url(),{preserveScroll:!0,onSuccess:()=>{B.value.open=!1}})},q=[{id:"select",header:({table:e})=>o("input",{type:"checkbox",checked:e.getIsAllPageRowsSelected(),indeterminate:e.getIsSomePageRowsSelected(),onChange:e.getToggleAllPageRowsSelectedHandler(),class:"h-4 w-4 rounded border-gray-300"}),cell:({row:e})=>o("input",{type:"checkbox",checked:e.getIsSelected(),disabled:!e.getCanSelect(),onChange:e.getToggleSelectedHandler(),class:"h-4 w-4 rounded border-gray-300"}),enableSorting:!1},{id:"index",header:()=>o("div",{class:"w-12"},"No"),cell:({row:e})=>{const t=e.index+1+(p.bonuses.current_page-1)*p.bonuses.per_page;return o("div",{class:"font-medium"},t)}},{accessorKey:"member_name",header:()=>"Member",cell:({row:e})=>o("div",[o("div",{class:"font-medium"},e.original.member_name),o("div",{class:"text-xs text-muted-foreground"},e.original.member_ewallet_id)])},{accessorKey:"pair_count",header:()=>"Pasangan",cell:({row:e})=>o(J,{variant:"outline",class:"gap-1"},()=>[o(z,{class:"h-3 w-3"}),`${e.original.pair_count} pasang`])},{accessorKey:"amount",header:()=>o("div",{class:"text-right"},"Jumlah"),cell:({row:e})=>o("div",{class:"text-right font-medium"},$(e.original.amount))},{accessorKey:"status",header:()=>"Status",cell:({row:e})=>{const t=e.original.status;return o(J,{variant:t===1?"default":"secondary",class:"gap-1"},()=>[o(t===1?Ke:Ne,{class:"h-3 w-3"}),e.original.status_text])}},{accessorKey:"created_at",header:({column:e})=>o(g,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"-ml-4"},()=>["Tanggal",o(ze,{class:"ml-2 h-4 w-4"})]),cell:({row:e})=>ae(e.getValue("created_at"))},{id:"actions",header:()=>o("div",{class:"text-right"},"Actions"),cell:({row:e})=>{const t=e.original;return o("div",{class:"flex justify-end gap-2"},[o(g,{variant:"outline",size:"sm",onClick:()=>w.visit(ge.url(t.id))},()=>o(He,{class:"h-4 w-4"})),t.status===0?o(g,{variant:"default",size:"sm",onClick:()=>oe(t)},()=>o(Z,{class:"h-4 w-4"})):null,t.status===0?o(g,{variant:"outline",size:"sm",onClick:()=>le(t)},()=>o(Ee,{class:"h-4 w-4 text-destructive"})):null])}}],F=Fe({get data(){return p.bonuses.data},columns:q,getCoreRowModel:Ge(),getSortedRowModel:qe(),getFilteredRowModel:Le(),state:{get sorting(){return b.value},get columnFilters(){return E.value},get columnVisibility(){return L.value},get rowSelection(){return C.value}},onSortingChange:e=>M(e,b),onColumnFiltersChange:e=>M(e,E),onColumnVisibilityChange:e=>M(e,L),onRowSelectionChange:e=>M(e,C),manualSorting:!0,enableRowSelection:!0});X(b,e=>{e.length>0&&w.get(V.url(),{search:y.value||void 0,status:m.value!=="all"?parseInt(m.value):void 0,sort_by:e[0].id,sort_order:e[0].desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},{deep:!0});let G;return X([y,m],()=>{clearTimeout(G),G=setTimeout(()=>{w.get(V.url(),{search:y.value||void 0,status:m.value!=="all"?parseInt(m.value):void 0,sort_by:b.value[0]?.id||"created_at",sort_order:b.value[0]?.desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},300)}),(e,t)=>(u(),v(me,{breadcrumbs:te},{default:l(()=>[a(s(Ve),{title:"Bonus Pairing"}),r("div",Oe,[r("div",Je,[t[10]||(t[10]=r("div",null,[r("h1",{class:"text-3xl font-bold tracking-tight"},"Bonus Pairing"),r("p",{class:"text-muted-foreground"},"Kelola bonus pairing binary tree")],-1)),r("div",Qe,[a(s(g),{variant:"outline",onClick:t[0]||(t[0]=n=>B.value.open=!0)},{default:l(()=>[a(s(z),{class:"h-4 w-4"}),t[8]||(t[8]=d(" Proses Semua Pairing ",-1))]),_:1}),a(s(g),{onClick:t[1]||(t[1]=n=>s(w).visit(s(ce).url()))},{default:l(()=>[a(s(Ie),{class:"h-4 w-4"}),t[9]||(t[9]=d(" Proses Member ",-1))]),_:1})])]),r("div",We,[a(s(T),null,{default:l(()=>[a(s(U),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[a(s(A),{class:"text-sm font-medium"},{default:l(()=>[...t[11]||(t[11]=[d("Total Pending",-1)])]),_:1}),a(s(Me),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(s(j),null,{default:l(()=>[r("div",Xe,h($(_.statistics.total_pending)),1),r("p",Ye,h(_.statistics.count_pending)+" bonus ",1)]),_:1})]),_:1}),a(s(T),null,{default:l(()=>[a(s(U),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[a(s(A),{class:"text-sm font-medium"},{default:l(()=>[...t[12]||(t[12]=[d("Total Released",-1)])]),_:1}),a(s(Te),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(s(j),null,{default:l(()=>[r("div",Ze,h($(_.statistics.total_released)),1),r("p",et,h(_.statistics.count_released)+" bonus ",1)]),_:1})]),_:1}),a(s(T),null,{default:l(()=>[a(s(U),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[a(s(A),{class:"text-sm font-medium"},{default:l(()=>[...t[13]||(t[13]=[d("Total Pairs Pending",-1)])]),_:1}),a(s(z),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(s(j),null,{default:l(()=>[r("div",tt,h(_.statistics.total_pairs),1),t[14]||(t[14]=r("p",{class:"text-xs text-muted-foreground"}," pairs belum di-release ",-1))]),_:1})]),_:1})]),x.value.length>0?(u(),S("div",st,[r("p",at,h(x.value.length)+" bonus pending dipilih ",1),a(s(g),{size:"sm",onClick:ie},{default:l(()=>[a(s(Z),{class:"h-4 w-4"}),t[15]||(t[15]=d(" Release Semua ",-1))]),_:1})])):Y("",!0),r("div",lt,[r("div",nt,[a(s(je),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),a(s(ye),{modelValue:y.value,"onUpdate:modelValue":t[2]||(t[2]=n=>y.value=n),placeholder:"Cari member atau deskripsi...",class:"pl-9"},null,8,["modelValue"])]),a(s(ke),{modelValue:m.value,"onUpdate:modelValue":t[3]||(t[3]=n=>m.value=n)},{default:l(()=>[a(s(we),{class:"w-40"},{default:l(()=>[a(s(Se),{placeholder:"Semua Status"})]),_:1}),a(s(Ce),null,{default:l(()=>[a(s(K),{value:"all"},{default:l(()=>[...t[16]||(t[16]=[d("Semua Status",-1)])]),_:1}),a(s(K),{value:"0"},{default:l(()=>[...t[17]||(t[17]=[d("Pending",-1)])]),_:1}),a(s(K),{value:"1"},{default:l(()=>[...t[18]||(t[18]=[d("Released",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(s(_e),null,{default:l(()=>[a(s(be),{"as-child":""},{default:l(()=>[a(s(g),{variant:"outline",class:"ml-auto"},{default:l(()=>[a(s(Ue),{class:"h-4 w-4"}),t[19]||(t[19]=d(" Kolom ",-1)),a(s(Ae),{class:"ml-2 h-4 w-4"})]),_:1})]),_:1}),a(s(xe),{align:"end"},{default:l(()=>[(u(!0),S(R,null,D(s(F).getAllColumns().filter(n=>n.getCanHide()),n=>(u(),v(s(he),{key:n.id,class:"capitalize",checked:n.getIsVisible(),"onUpdate:checked":i=>n.toggleVisibility(!!i)},{default:l(()=>[d(h(n.id),1)]),_:2},1032,["checked","onUpdate:checked"]))),128))]),_:1})]),_:1})]),r("div",ot,[a(s($e),null,{default:l(()=>[a(s(Re),null,{default:l(()=>[(u(!0),S(R,null,D(s(F).getHeaderGroups(),n=>(u(),v(s(N),{key:n.id},{default:l(()=>[(u(!0),S(R,null,D(n.headers,i=>(u(),v(s(De),{key:i.id},{default:l(()=>[i.isPlaceholder?Y("",!0):(u(),v(s(ee),{key:0,render:i.column.columnDef.header,props:i.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),a(s(Pe),null,{default:l(()=>[s(F).getRowModel().rows?.length?(u(!0),S(R,{key:0},D(s(F).getRowModel().rows,n=>(u(),v(s(N),{key:n.id,"data-state":n.getIsSelected()?"selected":void 0},{default:l(()=>[(u(!0),S(R,null,D(n.getVisibleCells(),i=>(u(),v(s(Q),{key:i.id},{default:l(()=>[a(s(ee),{render:i.column.columnDef.cell,props:i.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1032,["data-state"]))),128)):(u(),v(s(N),{key:1},{default:l(()=>[a(s(Q),{colspan:q.length,class:"h-24 text-center"},{default:l(()=>[...t[20]||(t[20]=[d(" Tidak ada data bonus. ",-1)])]),_:1},8,["colspan"])]),_:1}))]),_:1})]),_:1})]),a(ve,{data:_.bonuses,url:s(V).url(),filters:{search:y.value||void 0,status:m.value!=="all"?parseInt(m.value):void 0,sort_by:b.value[0]?.id,sort_order:b.value[0]?.desc?"desc":"asc"}},null,8,["data","url","filters"])]),a(I,{open:k.value.open,"onUpdate:open":t[4]||(t[4]=n=>k.value.open=n),title:"Hapus Bonus?",description:"Apakah Anda yakin ingin menghapus bonus ini? Tindakan ini tidak dapat dibatalkan.","confirm-text":"Hapus","cancel-text":"Batal",variant:"destructive",onConfirm:ne},null,8,["open"]),a(I,{open:f.value.open,"onUpdate:open":t[5]||(t[5]=n=>f.value.open=n),title:"Release Bonus?",description:`Bonus sebesar ${f.value.bonus?$(f.value.bonus.amount):""} (${f.value.bonus?.pair_count} pasang) akan ditransfer ke ewallet member. Lanjutkan?`,"confirm-text":"Release","cancel-text":"Batal",onConfirm:re},null,8,["open","description"]),a(I,{open:P.value.open,"onUpdate:open":t[6]||(t[6]=n=>P.value.open=n),title:`Release ${x.value.length} Bonus?`,description:`Total ${$(x.value.reduce((n,i)=>n+i.amount,0))} (${x.value.reduce((n,i)=>n+i.pair_count,0)} pasang) akan ditransfer ke ewallet member. Lanjutkan?`,"confirm-text":"Release Semua","cancel-text":"Batal",onConfirm:ue},null,8,["open","title","description"]),a(I,{open:B.value.open,"onUpdate:open":t[7]||(t[7]=n=>B.value.open=n),title:"Proses Semua Pairing?",description:"Sistem akan memproses bonus pairing untuk SEMUA member yang memiliki pasangan pending. Operasi ini biasanya dilakukan bulanan. Lanjutkan?","confirm-text":"Proses Semua","cancel-text":"Batal",onConfirm:de},null,8,["open"])]),_:1}))}});export{Rt as default};
