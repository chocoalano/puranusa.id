import{ad as D,_ as pe,ae as ge,af as _e,ag as ve}from"./AppLayout.vue_vue_type_script_setup_true_lang-3Xwj2Srj.js";import{_ as P}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-CHMIg_4b.js";import{_ as be}from"./Pagination.vue_vue_type_script_setup_true_lang-C64O0K5A.js";import{_ as xe}from"./index-Qe8U7avD.js";import{_ as V,v as B}from"./index-BhPH699V.js";import{_ as E,a as O}from"./CardContent.vue_vue_type_script_setup_true_lang-NxxB_dAy.js";import{_ as q}from"./CardHeader.vue_vue_type_script_setup_true_lang-Kdg7L6IL.js";import{_ as W}from"./CardTitle.vue_vue_type_script_setup_true_lang-Cj4ck2dV.js";import{_ as z}from"./Checkbox.vue_vue_type_script_setup_true_lang-CwKgDATE.js";import{_ as we,a as ye,b as he,d as Re,e as G,c as J}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-NxThyEhC.js";import{d as Se,r as m,d9 as ke,p as X,q as $e,E as Y,j as A,v as b,g as o,b as t,w as l,u as e,e as r,aj as Ce,t as S,c,s as u,F as x,ao as Z,z as De,a1 as Ve,at as Be,Y as Ae,aC as Fe,K as k,dl as Ie,Z as Te,x as F,y as Q,n as i,D as ee,au as Me,aW as Pe,ap as Ue,aO as je,A as Ke,B as He}from"./vendor-DfMbnFaR.js";import{_ as Ne}from"./Input.vue_vue_type_script_setup_true_lang-Bi8Aupzl.js";import{_ as Le,a as Ee,b as Oe,c as qe,d as U}from"./SelectValue.vue_vue_type_script_setup_true_lang-VBwlv4qP.js";import{_ as We,a as ze,b as j,c as Ge,d as Je,e as se}from"./TableHeader.vue_vue_type_script_setup_true_lang-PuAkTm4y.js";import{u as Xe}from"./usePermissions-Bdkvyget.js";import"./index-CSEUMRIG.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-Bqij1zEj.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-BOYUcfDs.js";import"./index-DnSHhU6t.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DrG-1awo.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-CpOM3BUc.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-DZdfZa6K.js";const Ye={class:"flex h-full flex-1 flex-col gap-6 p-6"},Ze={class:"flex items-center justify-between"},Qe={class:"text-3xl font-bold tracking-tight flex items-center gap-2"},es={class:"grid gap-4 md:grid-cols-4"},ss={class:"text-2xl font-bold"},ts={class:"text-xs text-muted-foreground"},as={class:"text-2xl font-bold text-green-600"},ls={class:"text-xs text-muted-foreground"},ns={class:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between"},os={class:"flex flex-1 items-center gap-4"},rs={class:"relative flex-1 md:max-w-sm"},is={class:"rounded-md border"},As=Se({__name:"Index",props:{bonuses:{},statistics:{},filters:{}},setup(_){const{isSuperAdmin:I,isAdmin:T}=Xe(),f=_,te=[{title:"Bonus Reward",href:D.url()}],w=m(f.filters.search||""),g=m(f.filters.status?.toString()||"all"),y=m([{id:f.filters.sort_by,desc:f.filters.sort_order==="desc"}]),K=m([]),H=m({}),h=m({}),[ae,le]=ke(),v=m({open:!1,bonus:null}),p=m({open:!1,bonus:null}),$=m({open:!1}),ne=X(()=>Object.keys(h.value).map(s=>f.bonuses.data[parseInt(s)]).filter(Boolean)),R=X(()=>ne.value.filter(s=>s.status===0)),C=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s),oe=s=>new Date(s).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),re=s=>{v.value={open:!0,bonus:s}},ie=()=>{v.value.bonus&&A.delete(ge.url(v.value.bonus.id),{preserveScroll:!0,onSuccess:()=>{v.value={open:!1,bonus:null}}})},ue=s=>{p.value={open:!0,bonus:s}},de=()=>{if(!p.value.bonus)return;ee({}).post(_e.url(p.value.bonus.id),{preserveScroll:!0,onSuccess:()=>{p.value={open:!1,bonus:null},h.value={}}})},me=()=>{R.value.length&&($.value.open=!0)},ce=()=>{const s=R.value.map(n=>n.id);ee({ids:s}).post(ve.url(),{preserveScroll:!0,onSuccess:()=>{h.value={},$.value.open=!1}})},N=[{id:"select",header:({table:s})=>i(z,{modelValue:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate","onUpdate:modelValue":a=>s.toggleAllPageRowsSelected(!!a),ariaLabel:"Select all"}),cell:({row:s})=>i(z,{modelValue:s.getIsSelected(),"onUpdate:modelValue":a=>s.toggleSelected(!!a),ariaLabel:"Select row"}),enableSorting:!1,enableHiding:!1},{id:"index",header:()=>i("div",{class:"w-12"},"No"),cell:({row:s})=>i("div",{class:"font-medium"},s.index+1+(f.bonuses.current_page-1)*f.bonuses.per_page)},{accessorKey:"member_name",header:()=>"Member",cell:({row:s})=>i("div",[i("div",{class:"font-medium"},s.original.member_name),i("div",{class:"text-xs text-muted-foreground"},s.original.member_ewallet_id)])},{accessorKey:"reward_type",header:()=>"Tipe Reward",cell:({row:s})=>i("div",{class:"text-sm"},s.original.reward_type||"-")},{accessorKey:"amount",header:()=>i("div",{class:"text-right"},"Jumlah"),cell:({row:s})=>i("div",{class:"text-right font-medium"},C(s.original.amount))},{accessorKey:"status",header:()=>"Status",cell:({row:s})=>i(xe,{variant:s.original.status===1?"default":"secondary",class:"gap-1"},()=>[i(s.original.status===1?Me:Pe,{class:"h-3 w-3"}),s.original.status_text])},{accessorKey:"created_at",header:({column:s})=>i(V,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),class:"-ml-4"},()=>["Tanggal",i(Ue,{class:"ml-2 h-4 w-4"})]),cell:({row:s})=>oe(s.getValue("created_at"))},{id:"actions",enableHiding:!1,cell:({row:s})=>i(le,{bonus:s.original,onRelease:()=>ue(s.original),onDelete:()=>re(s.original)})}],M=$e({get data(){return f.bonuses.data},columns:N,getCoreRowModel:He(),getSortedRowModel:Ke(),getFilteredRowModel:je(),onSortingChange:s=>B(s,y),onColumnFiltersChange:s=>B(s,K),onColumnVisibilityChange:s=>B(s,H),onRowSelectionChange:s=>B(s,h),state:{get sorting(){return y.value},get columnFilters(){return K.value},get columnVisibility(){return H.value},get rowSelection(){return h.value}},manualSorting:!0,enableRowSelection:!0});Y(y,s=>{s.length>0&&A.get(D.url(),{search:w.value||void 0,status:g.value!=="all"?parseInt(g.value):void 0,sort_by:s[0].id,sort_order:s[0].desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},{deep:!0});let L;return Y([w,g],()=>{clearTimeout(L),L=setTimeout(()=>{A.get(D.url(),{search:w.value||void 0,status:g.value!=="all"?parseInt(g.value):void 0,sort_by:y.value[0]?.id||"created_at",sort_order:y.value[0]?.desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},300)}),(s,a)=>(o(),b(x,null,[t(e(ae),null,{default:l(({bonus:n,onRelease:d,onDelete:fe})=>[t(e(we),null,{default:l(()=>[t(e(ye),{"as-child":""},{default:l(()=>[t(e(V),{variant:"ghost",class:"h-8 w-8 p-0"},{default:l(()=>[a[6]||(a[6]=r("span",{class:"sr-only"},"Open menu",-1)),t(e(Ce),{class:"h-4 w-4"})]),_:1})]),_:1}),t(e(he),{align:"end"},{default:l(()=>[t(e(Re),null,{default:l(()=>[...a[7]||(a[7]=[u("Actions",-1)])]),_:1}),n.status===0&&(e(I)||e(T))?(o(),b(x,{key:0},[t(e(G)),t(e(J),{onClick:d},{default:l(()=>[t(e(Z),{class:"mr-2 h-4 w-4"}),a[8]||(a[8]=u(" Release Bonus ",-1))]),_:1},8,["onClick"])],64)):S("",!0),t(e(G)),e(I)&&e(T)?(o(),c(e(J),{key:1,class:"text-destructive",onClick:fe},{default:l(()=>[t(e(De),{class:"mr-2 h-4 w-4"}),a[9]||(a[9]=u(" Hapus ",-1))]),_:1},8,["onClick"])):S("",!0)]),_:2},1024)]),_:2},1024)]),_:1}),t(pe,{breadcrumbs:te},{default:l(()=>[t(e(Ve),{title:"Bonus Reward"}),r("div",Ye,[r("div",Ze,[r("div",null,[r("h1",Qe,[t(e(Be),{class:"h-8 w-8"}),a[10]||(a[10]=u(" Bonus Reward ",-1))]),a[11]||(a[11]=r("p",{class:"text-muted-foreground"},"Kelola bonus reward member",-1))]),e(I)||e(T)?(o(),c(e(V),{key:0,onClick:a[0]||(a[0]=n=>e(A).visit("/bonus/reward/create"))},{default:l(()=>[t(e(Ae),{class:"mr-2 h-4 w-4"}),a[12]||(a[12]=u(" Tambah Bonus ",-1))]),_:1})):S("",!0)]),r("div",es,[t(e(E),null,{default:l(()=>[t(e(q),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[t(e(W),{class:"text-sm font-medium"},{default:l(()=>[...a[13]||(a[13]=[u("Total Pending",-1)])]),_:1}),t(e(Fe),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),t(e(O),null,{default:l(()=>[r("div",ss,k(C(_.statistics.total_pending)),1),r("p",ts,k(_.statistics.count_pending)+" transaksi",1)]),_:1})]),_:1}),t(e(E),null,{default:l(()=>[t(e(q),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[t(e(W),{class:"text-sm font-medium"},{default:l(()=>[...a[14]||(a[14]=[u("Total Released",-1)])]),_:1}),t(e(Ie),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),t(e(O),null,{default:l(()=>[r("div",as,k(C(_.statistics.total_released)),1),r("p",ls,k(_.statistics.count_released)+" transaksi",1)]),_:1})]),_:1})]),r("div",ns,[r("div",os,[r("div",rs,[t(e(Te),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),t(e(Ne),{modelValue:w.value,"onUpdate:modelValue":a[1]||(a[1]=n=>w.value=n),placeholder:"Cari member atau tipe reward...",class:"pl-9"},null,8,["modelValue"])]),t(e(Le),{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=n=>g.value=n)},{default:l(()=>[t(e(Ee),{class:"w-40"},{default:l(()=>[t(e(Oe),{placeholder:"Semua Status"})]),_:1}),t(e(qe),null,{default:l(()=>[t(e(U),{value:"all"},{default:l(()=>[...a[15]||(a[15]=[u("Semua Status",-1)])]),_:1}),t(e(U),{value:"0"},{default:l(()=>[...a[16]||(a[16]=[u("Pending",-1)])]),_:1}),t(e(U),{value:"1"},{default:l(()=>[...a[17]||(a[17]=[u("Released",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),R.value.length?(o(),c(e(V),{key:0,variant:"outline",onClick:me},{default:l(()=>[t(e(Z),{class:"mr-2 h-4 w-4"}),u(" Release "+k(R.value.length)+" Bonus ",1)]),_:1})):S("",!0)]),r("div",is,[t(e(We),null,{default:l(()=>[t(e(ze),null,{default:l(()=>[(o(!0),b(x,null,F(e(M).getHeaderGroups(),n=>(o(),c(e(j),{key:n.id},{default:l(()=>[(o(!0),b(x,null,F(n.headers,d=>(o(),c(e(Ge),{key:d.id},{default:l(()=>[d.isPlaceholder?S("",!0):(o(),c(e(Q),{key:0,render:d.column.columnDef.header,props:d.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),t(e(Je),null,{default:l(()=>[e(M).getRowModel().rows?.length?(o(!0),b(x,{key:0},F(e(M).getRowModel().rows,n=>(o(),c(e(j),{key:n.id,"data-state":n.getIsSelected()&&"selected"},{default:l(()=>[(o(!0),b(x,null,F(n.getVisibleCells(),d=>(o(),c(e(se),{key:d.id},{default:l(()=>[t(e(Q),{render:d.column.columnDef.cell,props:d.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1032,["data-state"]))),128)):(o(),c(e(j),{key:1},{default:l(()=>[t(e(se),{colspan:N.length,class:"h-24 text-center"},{default:l(()=>[...a[18]||(a[18]=[u("Tidak ada data.",-1)])]),_:1},8,["colspan"])]),_:1}))]),_:1})]),_:1})]),t(be,{data:_.bonuses,url:e(D).url()},null,8,["data","url"])]),t(P,{open:v.value.open,title:"Hapus Bonus",description:"Apakah Anda yakin ingin menghapus bonus ini?","confirm-text":"Hapus","onUpdate:open":a[3]||(a[3]=n=>v.value.open=n),onConfirm:ie},null,8,["open"]),t(P,{open:p.value.open,title:"Release Bonus",description:`Apakah Anda yakin ingin merilis bonus sebesar ${p.value.bonus?C(p.value.bonus.amount):""} ke member?`,"confirm-text":"Release","onUpdate:open":a[4]||(a[4]=n=>p.value.open=n),onConfirm:de},null,8,["open","description"]),t(P,{open:$.value.open,title:"Mass Release Bonus",description:`Apakah Anda yakin ingin merilis ${R.value.length} bonus yang dipilih?`,"confirm-text":"Release All","onUpdate:open":a[5]||(a[5]=n=>$.value.open=n),onConfirm:ce},null,8,["open","description"])]),_:1})],64))}});export{As as default};
