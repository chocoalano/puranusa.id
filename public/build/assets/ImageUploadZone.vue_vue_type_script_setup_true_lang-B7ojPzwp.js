import{d as W,r as y,p as C,v as r,g as l,t as f,e,J as d,F as D,x as P,H as k,b as h,u,b9 as G,c as $,L as O,X as L,ba as q,b1 as K,j as B}from"./vendor-CraqpIJ-.js";import{g as X,h as Z}from"./AppLayout.vue_vue_type_script_setup_true_lang-BWDCecJb.js";const Q={class:"space-y-4"},Y={key:0,class:"space-y-2"},ee={class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},ae={class:"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5"},te=["src","alt"],se={key:0,class:"absolute left-2 top-2 flex items-center gap-1 rounded-full bg-yellow-400 px-2 py-1 text-xs font-medium text-yellow-900"},le={class:"absolute inset-0 flex items-center justify-center gap-2 bg-black/50 opacity-0 transition-opacity group-hover:opacity-100"},re=["disabled","onClick"],oe=["disabled","onClick"],ie={key:1,class:"space-y-2"},ne={class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},de={class:"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5"},ue=["src","alt"],ce={class:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent px-2 py-1"},ge={class:"truncate text-xs text-white"},me=["onClick"],be={key:2,class:"space-y-2"},pe={class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},ve=["disabled"],ye={class:"flex flex-col items-center justify-center gap-3 px-6 py-8"},fe={class:"text-center"},he={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},ke={class:"mt-1 text-xs font-medium text-gray-600 dark:text-gray-400"},xe={class:"rounded-lg bg-blue-50 p-3 dark:bg-blue-950/20"},_e={class:"flex gap-2"},je=W({__name:"ImageUploadZone",props:{productId:{},existingImages:{default:()=>[]},maxImages:{default:10},modelValue:{default:()=>[]}},emits:["update:modelValue"],setup(c,{emit:U}){const g=c,w=U,i=y(!1),m=y([...g.modelValue]),b=y([]),n=y(new Set),v=y(!1),x=C(()=>g.maxImages-(g.existingImages.length+m.value.length)),I=C(()=>x.value>0),V=a=>{a.preventDefault(),i.value=!0},T=()=>{i.value=!1},H=a=>{a.preventDefault(),i.value=!1;const s=Array.from(a.dataTransfer?.files||[]);j(s)},M=a=>{const s=a.target,t=Array.from(s.files||[]);j(t),s.value=""},j=a=>{const s=a.filter(o=>o.type.startsWith("image/")),t=["image/jpeg","image/png","image/jpg","image/webp"],p=s.filter(o=>t.includes(o.type));p.length!==s.length&&alert("Beberapa file diabaikan. Hanya JPG, PNG, dan WebP yang diperbolehkan.");const F=2*1024*1024,S=p.filter(o=>o.size>F?(alert(`File ${o.name} terlalu besar. Maksimal 2MB.`),!1):!0),_=x.value,z=S.slice(0,_);S.length>_&&alert(`Hanya ${_} gambar yang dapat ditambahkan. Maksimal ${g.maxImages} gambar.`),z.forEach(o=>{const R=URL.createObjectURL(o);b.value.push({file:o,url:R})}),m.value=[...m.value,...z],w("update:modelValue",m.value)},E=a=>{const s=b.value[a];URL.revokeObjectURL(s.url),b.value.splice(a,1),m.value.splice(a,1),w("update:modelValue",m.value)},N=async a=>{if(confirm("Hapus gambar ini?")){n.value.add(a);try{await B.delete(X.url(a),{preserveScroll:!0,onSuccess:()=>{n.value.delete(a)},onError:()=>{n.value.delete(a),alert("Gagal menghapus gambar")}})}catch{n.value.delete(a),alert("Terjadi kesalahan saat menghapus gambar")}}},A=async a=>{if(g.productId){v.value=!0;try{await B.post(Z.url(g.productId),{media_id:a},{preserveScroll:!0,onFinish:()=>{v.value=!1},onError:()=>{alert("Gagal mengatur gambar utama")}})}catch{v.value=!1,alert("Terjadi kesalahan")}}},J=(a,s="medium")=>a.includes("/original/")?`/storage/${a.replace("/original/",`/${s}/`)}`:`/storage/${a}`;return(a,s)=>(l(),r("div",Q,[c.existingImages.length>0?(l(),r("div",Y,[e("label",ee," Gambar Produk ("+d(c.existingImages.length)+"/"+d(c.maxImages)+") ",1),e("div",ae,[(l(!0),r(D,null,P(c.existingImages,t=>(l(),r("div",{key:t.id,class:k(["group relative aspect-square overflow-hidden rounded-lg border-2 transition-all",[t.is_primary?"border-yellow-400 ring-2 ring-yellow-400 ring-offset-2":"border-gray-200 dark:border-gray-700"]])},[e("img",{src:J(t.url,"small"),alt:t.alt_text,class:"h-full w-full object-cover"},null,8,te),t.is_primary?(l(),r("div",se,[h(u(G),{size:12,class:"fill-current"}),s[0]||(s[0]=e("span",null,"Utama",-1))])):f("",!0),e("div",le,[t.is_primary?f("",!0):(l(),r("button",{key:0,type:"button",disabled:v.value||n.value.has(t.id),onClick:p=>A(t.id),class:"rounded-full bg-yellow-400 p-2 text-yellow-900 transition-colors hover:bg-yellow-500 disabled:cursor-not-allowed disabled:opacity-50",title:"Jadikan gambar utama"},[h(u(G),{size:16})],8,re)),e("button",{type:"button",disabled:n.value.has(t.id)||v.value,onClick:p=>N(t.id),class:"rounded-full bg-red-500 p-2 text-white transition-colors hover:bg-red-600 disabled:cursor-not-allowed disabled:opacity-50",title:"Hapus gambar"},[n.value.has(t.id)?(l(),$(u(O),{key:0,size:16,class:"animate-spin"})):(l(),$(u(L),{key:1,size:16}))],8,oe)])],2))),128))])])):f("",!0),b.value.length>0?(l(),r("div",ie,[e("label",ne," Gambar Baru ("+d(b.value.length)+") ",1),e("div",de,[(l(!0),r(D,null,P(b.value,(t,p)=>(l(),r("div",{key:t.url,class:"group relative aspect-square overflow-hidden rounded-lg border-2 border-gray-200 dark:border-gray-700"},[e("img",{src:t.url,alt:t.file.name,class:"h-full w-full object-cover"},null,8,ue),e("div",ce,[e("p",ge,d(t.file.name),1)]),e("button",{type:"button",onClick:F=>E(p),class:"absolute right-2 top-2 rounded-full bg-red-500 p-1 text-white opacity-0 transition-opacity hover:bg-red-600 group-hover:opacity-100",title:"Hapus"},[h(u(L),{size:16})],8,me)]))),128))])])):f("",!0),I.value?(l(),r("div",be,[e("label",pe," Tambah Gambar ("+d(x.value)+" slot tersisa) ",1),e("div",{onDragover:V,onDragleave:T,onDrop:H,class:k(["relative cursor-pointer rounded-lg border-2 border-dashed transition-colors",[i.value?"border-blue-500 bg-blue-50 dark:bg-blue-950/20":"border-gray-300 bg-gray-50 hover:border-gray-400 dark:border-gray-600 dark:bg-gray-800 dark:hover:border-gray-500"]])},[e("input",{type:"file",accept:"image/jpeg,image/png,image/jpg,image/webp",multiple:"",onChange:M,class:"absolute inset-0 cursor-pointer opacity-0",disabled:!I.value},null,40,ve),e("div",ye,[e("div",{class:k(["rounded-full p-3",i.value?"bg-blue-100 dark:bg-blue-900/30":"bg-gray-100 dark:bg-gray-700"])},[h(u(q),{size:32,class:k(i.value?"text-blue-600 dark:text-blue-400":"text-gray-400")},null,8,["class"])],2),e("div",fe,[e("p",he,d(i.value?"Lepaskan file di sini":"Drag & drop gambar atau klik untuk memilih"),1),s[1]||(s[1]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," JPG, PNG, atau WebP (maks. 2MB per file) ",-1)),e("p",ke," Maksimal "+d(c.maxImages)+" gambar total ",1)])])],34)])):f("",!0),e("div",xe,[e("div",_e,[h(u(K),{size:20,class:"shrink-0 text-blue-600 dark:text-blue-400"}),s[2]||(s[2]=e("div",{class:"text-sm text-blue-800 dark:text-blue-300"},[e("p",{class:"font-medium"},"Tips:"),e("ul",{class:"mt-1 list-inside list-disc space-y-1"},[e("li",null,"Gambar pertama otomatis menjadi gambar utama"),e("li",null,"Klik ikon bintang untuk mengubah gambar utama"),e("li",null,"Semua gambar akan di-generate dalam 5 ukuran responsif"),e("li",null,"Format akan dikonversi ke WebP untuk performa optimal")])],-1))])])]))}});export{je as _};
