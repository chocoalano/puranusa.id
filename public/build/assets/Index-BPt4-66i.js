import{d as Te,r as m,p as Se,v as p,g as u,b as t,u as a,a1 as De,w as s,e as o,a4 as ae,s as r,Y as te,T as Ce,C as I,Z as se,P as Ve,c as K,t as c,bv as Be,F as N,x as L,K as i,aT as Ae,$ as Pe,bw as je,de as le,z as ne,j as C,ae as Re,J as U,Q as _,h as Ee}from"./vendor-ppbe-N6l.js";import{_ as Ie}from"./AppLayout.vue_vue_type_script_setup_true_lang-CAMiCJvC.js";import{_ as re}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-DRKnPmKW.js";import{_ as Ke}from"./index-uV4J0ulh.js";import{_ as v}from"./index-BYj0gYCc.js";import{_ as oe,a as Ne}from"./CardContent.vue_vue_type_script_setup_true_lang-vqvbNoPF.js";import{_ as Ue}from"./CardHeader.vue_vue_type_script_setup_true_lang-_r3YWix0.js";import{_ as Me}from"./CardTitle.vue_vue_type_script_setup_true_lang-CuQE-qUU.js";import{_ as qe,a as ze,b as Oe,c as Fe}from"./DialogTitle.vue_vue_type_script_setup_true_lang-B6sKKqm9.js";import{_ as We}from"./DialogFooter.vue_vue_type_script_setup_true_lang-CsSkQbOR.js";import{_ as He}from"./DialogHeader.vue_vue_type_script_setup_true_lang-CmfbAGT1.js";import{_ as M}from"./Input.vue_vue_type_script_setup_true_lang-DNj-uKug.js";import{_ as V}from"./Label.vue_vue_type_script_setup_true_lang-DqlcMzBV.js";import{_ as Le}from"./Textarea.vue_vue_type_script_setup_true_lang-CBeaEOLc.js";import{_ as Ge,a as Qe,b as Xe}from"./index-PjBYKh8w.js";import{_ as Je,a as Ye,b as Ze,c as ea,d as B}from"./SelectValue.vue_vue_type_script_setup_true_lang-CzK-upws.js";import{_ as aa,a as ta,b as sa,d as la,e as ie,c as q}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DA3JUaxj.js";import{_ as na,a as ra,b as G,c as A,d as oa,e as w}from"./TableHeader.vue_vue_type_script_setup_true_lang-CR2Mc2h7.js";import"./index-CSEUMRIG.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-DiRTNO4J.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-BAAtcDkZ.js";import"./index-BUE9bFsX.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CKDVFyjr.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-B3c6JmTR.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-sCt9Ofqi.js";const ia={class:"container mx-auto py-8 space-y-8"},ua={class:"flex flex-col md:flex-row md:items-center justify-between gap-4"},da={class:"ml-2"},ma={class:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-1 list-none mt-2"},pa={class:"flex items-center gap-2"},fa={class:"flex items-center gap-2"},ca={class:"flex items-center gap-2"},_a={class:"flex items-center gap-2"},va={class:"flex flex-col md:flex-row gap-4"},ga={class:"flex-1 relative"},ka={class:"flex gap-2"},xa={class:"space-y-1"},ba={class:"font-bold text-slate-900 dark:text-slate-100"},ya={class:"text-xs text-muted-foreground line-clamp-1 max-w-[300px]"},$a={class:"pt-1"},ha={class:"text-[10px] bg-slate-100 dark:bg-slate-800 px-2 py-0.5 rounded text-blue-600"},wa={class:"flex flex-col items-center"},Ta={class:"text-sm font-bold"},Sa={key:0,class:"text-[10px] text-destructive"},Da={class:"text-muted-foreground"},Ca={class:"text-[10px] opacity-50"},Va={key:0,class:"p-4 border-t bg-muted/20 flex justify-center"},Ba={class:"flex gap-1"},Aa={class:"grid gap-4 md:grid-cols-2"},Pa={class:"space-y-2"},ja={key:0,class:"text-xs text-destructive"},Ra={class:"space-y-2"},Ea={key:0,class:"text-xs text-destructive"},Ia={class:"space-y-3"},Ka={class:"flex items-center justify-between"},Na={class:"space-y-2"},Ua={key:0,class:"text-xs text-destructive"},Ma={class:"space-y-2"},qa={key:0,class:"text-xs text-destructive"},za={class:"flex items-end"},Oa={key:0,class:"text-xs text-destructive"},Fa={key:0,class:"text-sm text-destructive"},vt=Te({__name:"Index",props:{broadcasts:{},filters:{},defaultTemplateId:{}},setup(T){const P=T,S=m(P.filters.search||""),b=m(P.filters.status||"all"),Q=()=>{C.get("/admin/whatsapp-broadcasts",{search:S.value||void 0,status:b.value!=="all"?b.value:void 0},{preserveState:!0,preserveScroll:!0})},ue=()=>{S.value="",b.value="all",C.get("/admin/whatsapp-broadcasts")},z=m(!1),O=m(!1),k=m(null),x=m(null),F=m(!1),y=m(null),j=m(!1),R=m(""),E=m(""),g=m([]),f=m({}),$=m("");let de=1;const X=l=>{const e=Object.values(l)[0];return typeof e=="string"?e:Array.isArray(e)&&typeof e[0]=="string"?e[0]:"Terjadi kesalahan. Silakan coba lagi."},me=l=>{k.value=l,z.value=!0},J=l=>{z.value=l,l||(k.value=null)},pe=()=>{k.value&&C.post(`/admin/whatsapp-broadcasts/${k.value.id}/send`,{},{preserveScroll:!0,onSuccess:l=>{const e=l.props.flash;if(e?.error){_.error(e.error);return}_.success(e?.success||"Broadcast sedang diproses.")},onError:l=>{_.error(X(l))},onFinish:()=>{J(!1)}})},fe=l=>{x.value=l,O.value=!0},Y=l=>{O.value=l,l||(x.value=null)},W=()=>({id:de++,name:"",phone:""}),Z=l=>{R.value=l?.template_id||P.defaultTemplateId||"",E.value=l?.message||"",g.value=[W()],f.value={},$.value=""},ce=l=>{y.value=l,Z(l),F.value=!0},H=l=>{F.value=l,l||(y.value=null,Z(null))},_e=()=>{if(g.value.length>=50){_.error("Maksimal 50 nomor per sekali test.");return}g.value.push(W())},ve=l=>{if(g.value.length===1){g.value=[W()];return}g.value.splice(l,1)},h=(l,e)=>f.value[`recipients.${l}.${e}`]||"",ge=l=>Object.fromEntries(Object.entries(l).map(([e,n])=>[e,Array.isArray(n)?n[0]||"":n])),ke=()=>{y.value&&(j.value=!0,f.value={},$.value="",Ee.post(`/admin/whatsapp-broadcasts/${y.value.id}/test-send-multiple`,{template_id:R.value,message:E.value,recipients:g.value.map(l=>({name:l.name,phone:l.phone}))},{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(l=>{const e=Number(l.data?.queued_count||0),n=Number(l.data?.duplicates_skipped||0);let d=l.data?.message||"Test kirim masuk antrean queue.";e>0&&n>0&&(d+=` (${n} nomor duplikat diabaikan)`),_.success(d),H(!1)}).catch(l=>{const e=l.response?.data,n=e?.errors;n&&(f.value=ge(n)),$.value=e?.message||"Gagal memasukkan test kirim ke antrean.",_.error($.value)}).finally(()=>{j.value=!1}))},xe=()=>{x.value&&C.delete(`/admin/whatsapp-broadcasts/${x.value.id}`,{preserveScroll:!0,onSuccess:l=>{const e=l.props.flash;if(e?.error){_.error(e.error);return}_.success(e?.success||"Riwayat berhasil dihapus.")},onError:l=>{_.error(X(l))},onFinish:()=>{Y(!1)}})},be={draft:"outline",processing:"secondary",sent:"default",partial:"secondary",failed:"destructive"},ye=l=>be[l],ee=l=>l?new Date(l).toLocaleString("id-ID",{dateStyle:"medium",timeStyle:"short"}):"-",$e=Se(()=>P.broadcasts.links??[]),he=l=>l.active?"default":"outline",we=l=>l.replace(/<[^>]*>/g,"").replace(/&laquo;/g,"«").replace(/&raquo;/g,"»").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").trim();return(l,e)=>(u(),p(N,null,[t(a(De),{title:"Broadcast WhatsApp"}),t(Ie,null,{default:s(()=>[o("div",ia,[o("div",ua,[e[6]||(e[6]=o("div",null,[o("h1",{class:"text-3xl font-extrabold tracking-tight"},"Broadcast WhatsApp"),o("p",{class:"text-muted-foreground"},"Kelola pengiriman pesan massal ke database pelanggan unik.")],-1)),t(a(ae),{href:"/admin/whatsapp-broadcasts/create"},{default:s(()=>[t(a(v),{class:"font-bold"},{default:s(()=>[t(a(te),{class:"h-5 w-5 mr-2"}),e[5]||(e[5]=r(" Buat Broadcast Baru ",-1))]),_:1})]),_:1})]),t(a(Ge),{class:"border-amber-200 bg-amber-50 dark:bg-amber-950/20 dark:border-amber-900"},{default:s(()=>[t(a(Ce),{class:"h-5 w-5 text-amber-600 dark:text-amber-500"}),o("div",da,[t(a(Qe),{class:"text-amber-800 dark:text-amber-400 font-bold text-base"},{default:s(()=>[...e[7]||(e[7]=[r(" Penting: Ketentuan Penerimaan Pesan ",-1)])]),_:1}),t(a(Xe),{class:"text-amber-700 dark:text-amber-300 mt-2 space-y-2"},{default:s(()=>[e[12]||(e[12]=o("p",null,[r("Berdasarkan kebijakan "),o("strong",null,"WhatsApp Business API"),r(", pesan broadcast Anda hanya akan terkirim dengan sukses jika pelanggan memenuhi kriteria berikut:")],-1)),o("ul",ma,[o("li",pa,[t(a(I),{class:"h-4 w-4 text-amber-600"}),e[8]||(e[8]=r(" Pernah berinteraksi dengan nomor WA Anda. ",-1))]),o("li",fa,[t(a(I),{class:"h-4 w-4 text-amber-600"}),e[9]||(e[9]=r(" Pelanggan menyimpan nomor Anda di kontak. ",-1))]),o("li",ca,[t(a(I),{class:"h-4 w-4 text-amber-600"}),e[10]||(e[10]=r(" Menggunakan Template ID yang telah disetujui. ",-1))]),o("li",_a,[t(a(I),{class:"h-4 w-4 text-amber-600"}),e[11]||(e[11]=r(" Tidak sedang memblokir nomor resmi Anda. ",-1))])]),e[13]||(e[13]=o("p",{class:"text-xs italic mt-2 font-semibold"}," * Pesan ke nomor yang tidak dikenal/tanpa interaksi berisiko gagal terkirim (Undelivered) atau memicu pemblokiran nomor oleh WhatsApp. ",-1))]),_:1})])]),_:1}),t(a(oe),{class:"shadow-sm"},{default:s(()=>[t(a(Ue),{class:"pb-4"},{default:s(()=>[t(a(Me),{class:"text-lg flex items-center gap-2"},{default:s(()=>[t(a(se),{class:"h-5 w-5 text-muted-foreground"}),e[14]||(e[14]=r(" Filter Data ",-1))]),_:1})]),_:1}),t(a(Ne),null,{default:s(()=>[o("div",va,[o("div",ga,[t(a(se),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),t(a(M),{modelValue:S.value,"onUpdate:modelValue":e[0]||(e[0]=n=>S.value=n),placeholder:"Cari berdasarkan judul atau pesan...",class:"pl-10",onKeydown:Ve(Q,["enter"])},null,8,["modelValue"])]),t(a(Je),{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=n=>b.value=n)},{default:s(()=>[t(a(Ye),{class:"w-full md:w-[200px]"},{default:s(()=>[t(a(Ze),{placeholder:"Semua Status"})]),_:1}),t(a(ea),null,{default:s(()=>[t(a(B),{value:"all"},{default:s(()=>[...e[15]||(e[15]=[r("Semua Status",-1)])]),_:1}),t(a(B),{value:"draft"},{default:s(()=>[...e[16]||(e[16]=[r("Draft (Belum Kirim)",-1)])]),_:1}),t(a(B),{value:"processing"},{default:s(()=>[...e[17]||(e[17]=[r("Sedang Diproses",-1)])]),_:1}),t(a(B),{value:"sent"},{default:s(()=>[...e[18]||(e[18]=[r("Selesai Terkirim",-1)])]),_:1}),t(a(B),{value:"failed"},{default:s(()=>[...e[19]||(e[19]=[r("Gagal Total",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o("div",ka,[t(a(v),{onClick:Q},{default:s(()=>[...e[20]||(e[20]=[r("Terapkan Filter",-1)])]),_:1}),S.value||b.value!=="all"?(u(),K(a(v),{key:0,variant:"ghost",onClick:ue},{default:s(()=>[...e[21]||(e[21]=[r(" Reset ",-1)])]),_:1})):c("",!0)])])]),_:1})]),_:1}),t(a(oe),{class:"shadow-sm overflow-hidden"},{default:s(()=>[t(a(na),null,{default:s(()=>[t(a(ra),{class:"bg-muted/50"},{default:s(()=>[t(a(G),null,{default:s(()=>[t(a(A),{class:"font-bold"},{default:s(()=>[...e[22]||(e[22]=[r("Campaign & Pesan",-1)])]),_:1}),t(a(A),{class:"text-center"},{default:s(()=>[...e[23]||(e[23]=[r("Status",-1)])]),_:1}),t(a(A),{class:"text-center"},{default:s(()=>[...e[24]||(e[24]=[r("Target (Penerima)",-1)])]),_:1}),t(a(A),null,{default:s(()=>[...e[25]||(e[25]=[r("Riwayat Pengiriman",-1)])]),_:1}),t(a(A),{class:"text-right"},{default:s(()=>[...e[26]||(e[26]=[r("Aksi",-1)])]),_:1})]),_:1})]),_:1}),t(a(oa),null,{default:s(()=>[T.broadcasts.data.length===0?(u(),K(a(G),{key:0},{default:s(()=>[t(a(w),{colspan:"5",class:"text-center py-12 text-muted-foreground"},{default:s(()=>[t(a(Be),{class:"h-12 w-12 mx-auto mb-3 opacity-20"}),e[27]||(e[27]=o("p",{class:"text-lg"},"Tidak ada data broadcast ditemukan.",-1))]),_:1})]),_:1})):c("",!0),(u(!0),p(N,null,L(T.broadcasts.data,n=>(u(),K(a(G),{key:n.id,class:"group"},{default:s(()=>[t(a(w),null,{default:s(()=>[o("div",xa,[o("p",ba,i(n.title),1),o("p",ya,i(n.message),1),o("div",$a,[o("code",ha," ID: "+i(n.template_id||T.defaultTemplateId||"No ID"),1)])])]),_:2},1024),t(a(w),{class:"text-center"},{default:s(()=>[t(a(Ke),{variant:ye(n.status),class:"capitalize"},{default:s(()=>[r(i(n.status),1)]),_:2},1032,["variant"])]),_:2},1024),t(a(w),{class:"text-center"},{default:s(()=>[o("div",wa,[o("span",Ta,i(n.success_recipients)+" / "+i(n.total_recipients||0),1),n.failed_recipients>0?(u(),p("span",Sa," Gagal: "+i(n.failed_recipients),1)):c("",!0)])]),_:2},1024),t(a(w),{class:"text-sm"},{default:s(()=>[o("p",Da,"Kirim: "+i(ee(n.sent_at)),1),o("p",Ca,"Dibuat: "+i(ee(n.created_at)),1)]),_:2},1024),t(a(w),{class:"text-right"},{default:s(()=>[t(a(aa),null,{default:s(()=>[t(a(ta),{"as-child":""},{default:s(()=>[t(a(v),{variant:"ghost",size:"icon"},{default:s(()=>[t(a(Ae),{class:"h-4 w-4"})]),_:1})]),_:1}),t(a(sa),{align:"end",class:"w-48"},{default:s(()=>[t(a(la),null,{default:s(()=>[...e[28]||(e[28]=[r("Opsi Broadcast",-1)])]),_:1}),t(a(ie)),t(a(ae),{href:`/admin/whatsapp-broadcasts/${n.id}/edit`},{default:s(()=>[t(a(q),null,{default:s(()=>[t(a(Pe),{class:"h-4 w-4 mr-2"}),e[29]||(e[29]=r(" Edit Draft ",-1))]),_:1})]),_:1},8,["href"]),t(a(q),{onClick:d=>me(n)},{default:s(()=>[t(a(je),{class:"h-4 w-4 mr-2"}),e[30]||(e[30]=r(" Kirim Sekarang ",-1))]),_:1},8,["onClick"]),t(a(q),{onClick:d=>ce(n)},{default:s(()=>[t(a(le),{class:"h-4 w-4 mr-2"}),e[31]||(e[31]=r(" Test ke Nomor Custom ",-1))]),_:1},8,["onClick"]),t(a(ie)),t(a(q),{class:"text-destructive focus:bg-destructive/10",onClick:d=>fe(n)},{default:s(()=>[t(a(ne),{class:"h-4 w-4 mr-2"}),e[32]||(e[32]=r(" Hapus Riwayat ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),T.broadcasts.last_page>1?(u(),p("div",Va,[o("nav",Ba,[(u(!0),p(N,null,L($e.value,(n,d)=>(u(),K(a(v),{key:n.url??`${n.label}-${d}`,variant:he(n),disabled:!n.url,size:"sm",onClick:D=>n.url&&a(C).visit(n.url)},{default:s(()=>[r(i(we(n.label)),1)]),_:2},1032,["variant","disabled","onClick"]))),128))])])):c("",!0)]),_:1}),t(a(qe),{open:F.value,"onUpdate:open":H},{default:s(()=>[t(a(ze),{class:"sm:max-w-3xl"},{default:s(()=>[t(a(He),null,{default:s(()=>[t(a(Oe),null,{default:s(()=>[r(i(y.value?`Test Broadcast: ${y.value.title}`:"Test Broadcast"),1)]),_:1}),t(a(Fe),null,{default:s(()=>[...e[33]||(e[33]=[r(" Tambahkan beberapa nomor custom. Semua nomor valid akan masuk antrean queue test kirim. ",-1)])]),_:1})]),_:1}),o("form",{class:"space-y-4",onSubmit:Re(ke,["prevent"])},[o("div",Aa,[o("div",Pa,[t(a(V),{for:"test_template_id"},{default:s(()=>[...e[34]||(e[34]=[r("Template ID",-1)])]),_:1}),t(a(M),{id:"test_template_id",modelValue:R.value,"onUpdate:modelValue":e[2]||(e[2]=n=>R.value=n),placeholder:"Kosongkan untuk default",class:U({"border-destructive":!!f.value.template_id})},null,8,["modelValue","class"]),f.value.template_id?(u(),p("p",ja,i(f.value.template_id),1)):c("",!0)]),o("div",Ra,[t(a(V),{for:"test_message"},{default:s(()=>[...e[35]||(e[35]=[r("Isi Pesan",-1)])]),_:1}),t(a(Le),{id:"test_message",modelValue:E.value,"onUpdate:modelValue":e[3]||(e[3]=n=>E.value=n),rows:"3",class:U({"border-destructive":!!f.value.message})},null,8,["modelValue","class"]),f.value.message?(u(),p("p",Ea,i(f.value.message),1)):c("",!0)])]),o("div",Ia,[o("div",Ka,[t(a(V),null,{default:s(()=>[...e[36]||(e[36]=[r("Daftar Nomor Tujuan",-1)])]),_:1}),t(a(v),{type:"button",variant:"outline",size:"sm",onClick:_e},{default:s(()=>[t(a(te),{class:"h-4 w-4 mr-2"}),e[37]||(e[37]=r(" Tambah Nomor ",-1))]),_:1})]),(u(!0),p(N,null,L(g.value,(n,d)=>(u(),p("div",{key:n.id,class:"grid gap-3 rounded-lg border p-3 md:grid-cols-[1fr_1fr_auto]"},[o("div",Na,[t(a(V),{for:`test_name_${n.id}`},{default:s(()=>[...e[38]||(e[38]=[r("Nama (opsional)",-1)])]),_:1},8,["for"]),t(a(M),{id:`test_name_${n.id}`,modelValue:n.name,"onUpdate:modelValue":D=>n.name=D,placeholder:"Contoh: Admin QA",class:U({"border-destructive":!!h(d,"name")})},null,8,["id","modelValue","onUpdate:modelValue","class"]),h(d,"name")?(u(),p("p",Ua,i(h(d,"name")),1)):c("",!0)]),o("div",Ma,[t(a(V),{for:`test_phone_${n.id}`},{default:s(()=>[...e[39]||(e[39]=[r("No. WhatsApp *",-1)])]),_:1},8,["for"]),t(a(M),{id:`test_phone_${n.id}`,modelValue:n.phone,"onUpdate:modelValue":D=>n.phone=D,placeholder:"081234567890",class:U({"border-destructive":!!h(d,"phone")})},null,8,["id","modelValue","onUpdate:modelValue","class"]),h(d,"phone")?(u(),p("p",qa,i(h(d,"phone")),1)):c("",!0)]),o("div",za,[t(a(v),{type:"button",variant:"ghost",size:"icon",onClick:D=>ve(d)},{default:s(()=>[t(a(ne),{class:"h-4 w-4"})]),_:1},8,["onClick"])])]))),128)),f.value.recipients?(u(),p("p",Oa,i(f.value.recipients),1)):c("",!0)]),$.value?(u(),p("p",Fa,i($.value),1)):c("",!0),t(a(We),null,{default:s(()=>[t(a(v),{type:"button",variant:"outline",onClick:e[4]||(e[4]=n=>H(!1))},{default:s(()=>[...e[40]||(e[40]=[r(" Batal ",-1)])]),_:1}),t(a(v),{type:"submit",disabled:j.value},{default:s(()=>[t(a(le),{class:"h-4 w-4 mr-2"}),r(" "+i(j.value?"Memproses...":"Kirim Test ke Queue"),1)]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"]),t(re,{open:z.value,title:k.value?`Kirim Broadcast: ${k.value.title}?`:"Kirim Broadcast?",description:k.value?"Pesan akan dikirim ke semua nomor customer yang unik. Lanjutkan proses pengiriman sekarang?":"Pesan akan dikirim ke semua nomor customer yang unik.","confirm-text":"Kirim Sekarang","cancel-text":"Batal","onUpdate:open":J,onConfirm:pe},null,8,["open","title","description"]),t(re,{open:O.value,title:x.value?`Hapus Riwayat: ${x.value.title}?`:"Hapus Riwayat?",description:x.value?"Data riwayat broadcast beserta daftar penerima akan dihapus permanen.":"Data riwayat broadcast akan dihapus permanen.","confirm-text":"Hapus","cancel-text":"Batal",variant:"destructive","onUpdate:open":Y,onConfirm:xe},null,8,["open","title","description"])])]),_:1})],64))}});export{vt as default};
