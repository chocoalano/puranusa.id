import{_ as Y,L as ee,M as te}from"./AppLayout.vue_vue_type_script_setup_true_lang-Hu_mZ1eB.js";import{d as E,v as h,g as u,b as a,u as e,w as s,s as c,aw as ae,e as d,K as k,as as le,aR as se,aA as re,r as x,q as ne,E as N,j as U,a0 as oe,c as _,t as P,Z as ie,a9 as de,F as y,x as b,y as W,n as o,D as z,an as ue,bz as ce,X as me,aL as fe,A as pe,B as we}from"./vendor-flWeloHs.js";import{_ as L}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-Cl2-SULB.js";import{_ as ge}from"./Pagination.vue_vue_type_script_setup_true_lang-D5lnraLN.js";import{_ as S,a as V}from"./CardContent.vue_vue_type_script_setup_true_lang-DFr8PgO7.js";import{_ as j}from"./CardHeader.vue_vue_type_script_setup_true_lang-Cgov_qDz.js";import{_ as D}from"./CardTitle.vue_vue_type_script_setup_true_lang-BdUxjhrU.js";import{f as _e}from"./currency-DfrMaoZy.js";import{_ as ve}from"./index-BonpZqDt.js";import{_ as F,v as T}from"./index-D9Hie8NE.js";import{_ as xe,a as he,b as ye}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BLeUwnH4.js";import{_ as be}from"./DropdownMenuCheckboxItem.vue_vue_type_script_setup_true_lang-DlsQO5tE.js";import{_ as ke}from"./Input.vue_vue_type_script_setup_true_lang-BI8FpPnw.js";import{_ as $e,a as Ce,b as Se,c as Ve,d as R}from"./SelectValue.vue_vue_type_script_setup_true_lang-CnNjP2es.js";import{_ as je,a as De,b as M,c as Fe,d as Re,e as q}from"./TableHeader.vue_vue_type_script_setup_true_lang-Dhjk0EnN.js";import"./index-CMWG4mbA.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-D5yDigSh.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-Dv6VzhWI.js";import"./index-DqFeuJ-n.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BC4ik9Oa.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-BsQpZQb0.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-CL8LVL2o.js";const Te={class:"grid gap-4 md:grid-cols-4"},Me={class:"text-2xl font-bold"},Ae={class:"text-2xl font-bold"},Ke={class:"text-2xl font-bold"},Be={class:"text-2xl font-bold"},Ie=E({__name:"WithdrawalStatistics",props:{statistics:{}},setup(i){return(g,r)=>(u(),h("div",Te,[a(e(S),null,{default:s(()=>[a(e(j),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[a(e(D),{class:"text-sm font-medium"},{default:s(()=>[...r[0]||(r[0]=[c("Pending",-1)])]),_:1}),a(e(ae),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(V),null,{default:s(()=>[d("div",Me,k(i.statistics.total_pending),1),r[1]||(r[1]=d("p",{class:"text-xs text-muted-foreground"},"Menunggu persetujuan",-1))]),_:1})]),_:1}),a(e(S),null,{default:s(()=>[a(e(j),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[a(e(D),{class:"text-sm font-medium"},{default:s(()=>[...r[2]||(r[2]=[c("Disetujui",-1)])]),_:1}),a(e(le),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(V),null,{default:s(()=>[d("div",Ae,k(i.statistics.total_completed),1),r[3]||(r[3]=d("p",{class:"text-xs text-muted-foreground"},"Withdrawal selesai",-1))]),_:1})]),_:1}),a(e(S),null,{default:s(()=>[a(e(j),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[a(e(D),{class:"text-sm font-medium"},{default:s(()=>[...r[4]||(r[4]=[c("Ditolak",-1)])]),_:1}),a(e(se),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(V),null,{default:s(()=>[d("div",Ke,k(i.statistics.total_failed),1),r[5]||(r[5]=d("p",{class:"text-xs text-muted-foreground"},"Withdrawal gagal",-1))]),_:1})]),_:1}),a(e(S),null,{default:s(()=>[a(e(j),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[a(e(D),{class:"text-sm font-medium"},{default:s(()=>[...r[6]||(r[6]=[c("Total Nominal",-1)])]),_:1}),a(e(re),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(V),null,{default:s(()=>[d("div",Be,k(e(_e)(i.statistics.total_amount)),1),r[7]||(r[7]=d("p",{class:"text-xs text-muted-foreground"},"Total withdrawal berhasil",-1))]),_:1})]),_:1})]))}}),Ne={class:"rounded-xl p-4 space-y-6 py-6"},Ue={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},Pe={class:"flex flex-1 gap-4"},We={class:"relative flex-1 max-w-sm"},ze={class:"rounded-md border"},ct=E({__name:"Index",props:{withdrawals:{},statistics:{},filters:{}},setup(i){const g=i,r=x(g.filters.search||""),f=x(g.filters.status||"all"),v=x([{id:g.filters.sort_by||"created_at",desc:g.filters.sort_order==="desc"}]),A=x([]),K=x({}),p=x({open:!1,withdrawal:null}),w=x({open:!1,withdrawal:null}),$=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(t),H=t=>new Date(t).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),X=t=>({pending:"secondary",completed:"default",failed:"destructive"})[t]||"secondary",J=t=>{if(!t)return null;try{return JSON.parse(t)}catch{return null}},O=t=>{p.value={open:!0,withdrawal:t}},Z=()=>{if(!p.value.withdrawal)return;z({}).post(ee.url(p.value.withdrawal.id),{preserveScroll:!0,onSuccess:()=>{p.value={open:!1,withdrawal:null}}})},G=t=>{w.value={open:!0,withdrawal:t}},Q=()=>{if(!w.value.withdrawal)return;z({}).post(te.url(w.value.withdrawal.id),{preserveScroll:!0,onSuccess:()=>{w.value={open:!1,withdrawal:null}}})},B=[{id:"index",header:()=>o("div",{class:"w-12"},"No"),cell:({row:t})=>{const l=t.index+1+(g.withdrawals.current_page-1)*g.withdrawals.per_page;return o("div",{class:"font-medium"},l)}},{accessorKey:"customer.name",header:({column:t})=>o(F,{variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),class:"-ml-4"},()=>["Pelanggan",o(ue,{class:"ml-2 h-4 w-4"})]),cell:({row:t})=>{const l=t.original.customer;return o("div",[o("div",{class:"font-medium"},l.name),o("div",{class:"text-xs text-muted-foreground"},l.email)])}},{accessorKey:"customer.ewallet_saldo",header:()=>"Saldo",cell:({row:t})=>o("div",$(t.original.customer.ewallet_saldo))},{accessorKey:"amount",header:()=>"Penarikan",cell:({row:t})=>o("div",{class:"font-bold text-red-600"},$(t.getValue("amount")))},{accessorKey:"notes",header:()=>"Rekening Tujuan",cell:({row:t})=>{const l=J(t.getValue("notes"));return l?o("div",[o("div",{class:"text-xs font-medium"},`${l.bank_name} - ${l.bank_account}`),o("div",{class:"text-xs text-muted-foreground"},l.bank_holder)]):o("div",{class:"text-xs text-muted-foreground"},"-")}},{accessorKey:"transaction_ref",header:()=>"Referensi",cell:({row:t})=>o("div",{class:"font-mono text-xs"},t.getValue("transaction_ref"))},{accessorKey:"status",header:()=>"Status",cell:({row:t})=>{const l=t.getValue("status");return o(ve,{variant:X(l)},()=>l)}},{accessorKey:"created_at",header:()=>"Tanggal",cell:({row:t})=>o("div",{class:"text-sm"},H(t.getValue("created_at")))},{id:"actions",header:()=>o("div",{class:"text-right"},"Aksi"),cell:({row:t})=>{const l=t.original;if(l.status!=="pending")return null;const n=l.customer.ewallet_saldo<l.amount;return o("div",{class:"flex justify-end gap-2"},[o(F,{size:"sm",onClick:()=>O(l),disabled:n},()=>[o(ce,{class:"mr-1 h-4 w-4"}),"Setujui"]),o(F,{size:"sm",variant:"destructive",onClick:()=>G(l)},()=>[o(me,{class:"mr-1 h-4 w-4"}),"Tolak"])])}}],C=ne({get data(){return g.withdrawals.data},columns:B,getCoreRowModel:we(),getSortedRowModel:pe(),getFilteredRowModel:fe(),onSortingChange:t=>T(t,v),onColumnFiltersChange:t=>T(t,A),onColumnVisibilityChange:t=>T(t,K),state:{get sorting(){return v.value},get columnFilters(){return A.value},get columnVisibility(){return K.value}},manualSorting:!0});N(v,t=>{t.length>0&&U.get("/admin/withdrawals",{search:r.value||void 0,status:f.value!=="all"?f.value:void 0,sort_by:t[0].id,sort_order:t[0].desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},{deep:!0});let I;return N([r,f],()=>{clearTimeout(I),I=setTimeout(()=>{U.get("/admin/withdrawals",{search:r.value||void 0,status:f.value!=="all"?f.value:void 0,sort_by:v.value[0]?.id||"created_at",sort_order:v.value[0]?.desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},300)}),(t,l)=>(u(),h(y,null,[a(e(oe),{title:"Permintaan Withdrawal"}),a(Y,null,{default:s(()=>[d("div",Ne,[l[10]||(l[10]=d("div",null,[d("h2",{class:"text-3xl font-bold tracking-tight"},"Permintaan Withdrawal"),d("p",{class:"text-muted-foreground"},"Kelola permintaan penarikan saldo dari pelanggan")],-1)),a(Ie,{statistics:i.statistics},null,8,["statistics"]),d("div",Ue,[d("div",Pe,[d("div",We,[a(e(ie),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),a(e(ke),{modelValue:r.value,"onUpdate:modelValue":l[0]||(l[0]=n=>r.value=n),placeholder:"Cari pelanggan atau referensi...",class:"pl-9"},null,8,["modelValue"])]),a(e($e),{modelValue:f.value,"onUpdate:modelValue":l[1]||(l[1]=n=>f.value=n)},{default:s(()=>[a(e(Ce),{class:"w-[180px]"},{default:s(()=>[a(e(Se),{placeholder:"Semua Status"})]),_:1}),a(e(Ve),null,{default:s(()=>[a(e(R),{value:"all"},{default:s(()=>[...l[4]||(l[4]=[c("Semua Status",-1)])]),_:1}),a(e(R),{value:"pending"},{default:s(()=>[...l[5]||(l[5]=[c("Pending",-1)])]),_:1}),a(e(R),{value:"completed"},{default:s(()=>[...l[6]||(l[6]=[c("Completed",-1)])]),_:1}),a(e(R),{value:"failed"},{default:s(()=>[...l[7]||(l[7]=[c("Failed",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),a(e(xe),null,{default:s(()=>[a(e(he),{"as-child":""},{default:s(()=>[a(e(F),{variant:"outline",class:"ml-auto"},{default:s(()=>[l[8]||(l[8]=c(" Kolom ",-1)),a(e(de),{class:"ml-2 h-4 w-4"})]),_:1})]),_:1}),a(e(ye),{align:"end"},{default:s(()=>[(u(!0),h(y,null,b(e(C).getAllColumns().filter(n=>n.getCanHide()),n=>(u(),_(e(be),{key:n.id,class:"capitalize","model-value":n.getIsVisible(),"onUpdate:modelValue":m=>{n.toggleVisibility(!!m)}},{default:s(()=>[c(k(n.id),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})]),d("div",ze,[a(e(je),null,{default:s(()=>[a(e(De),null,{default:s(()=>[(u(!0),h(y,null,b(e(C).getHeaderGroups(),n=>(u(),_(e(M),{key:n.id},{default:s(()=>[(u(!0),h(y,null,b(n.headers,m=>(u(),_(e(Fe),{key:m.id},{default:s(()=>[m.isPlaceholder?P("",!0):(u(),_(e(W),{key:0,render:m.column.columnDef.header,props:m.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),a(e(Re),null,{default:s(()=>[e(C).getRowModel().rows?.length?(u(!0),h(y,{key:0},b(e(C).getRowModel().rows,n=>(u(),_(e(M),{key:n.id},{default:s(()=>[(u(!0),h(y,null,b(n.getVisibleCells(),m=>(u(),_(e(q),{key:m.id},{default:s(()=>[a(e(W),{render:m.column.columnDef.cell,props:m.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1024))),128)):(u(),_(e(M),{key:1},{default:s(()=>[a(e(q),{colspan:B.length,class:"h-24 text-center"},{default:s(()=>[...l[9]||(l[9]=[c(" Tidak ada permintaan withdrawal. ",-1)])]),_:1},8,["colspan"])]),_:1}))]),_:1})]),_:1})]),i.withdrawals.last_page>1?(u(),_(ge,{key:0,data:{current_page:i.withdrawals.current_page,last_page:i.withdrawals.last_page,per_page:i.withdrawals.per_page,from:(i.withdrawals.current_page-1)*i.withdrawals.per_page+1,to:Math.min(i.withdrawals.current_page*i.withdrawals.per_page,i.withdrawals.total),total:i.withdrawals.total},url:"/admin/withdrawals",filters:{search:r.value||void 0,status:f.value!=="all"?f.value:void 0,sort_by:v.value[0]?.id||"created_at",sort_order:v.value[0]?.desc?"desc":"asc"}},null,8,["data","filters"])):P("",!0)]),a(L,{open:p.value.open,"onUpdate:open":l[2]||(l[2]=n=>p.value.open=n),title:"Setujui Withdrawal?",description:`Apakah Anda yakin ingin menyetujui permintaan withdrawal sebesar ${p.value.withdrawal?$(p.value.withdrawal.amount):""} untuk ${p.value.withdrawal?.customer.name}? Dana akan ditransfer via Midtrans ke rekening tujuan.`,"confirm-text":"Setujui & Transfer","cancel-text":"Batal",onConfirm:Z},null,8,["open","description"]),a(L,{open:w.value.open,"onUpdate:open":l[3]||(l[3]=n=>w.value.open=n),title:"Tolak Withdrawal?",description:`Apakah Anda yakin ingin menolak permintaan withdrawal sebesar ${w.value.withdrawal?$(w.value.withdrawal.amount):""} dari ${w.value.withdrawal?.customer.name}?`,"confirm-text":"Tolak","cancel-text":"Batal",variant:"destructive",onConfirm:Q},null,8,["open","description"])]),_:1})],64))}});export{ct as default};
