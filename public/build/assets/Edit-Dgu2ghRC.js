import{d as J,D as N,r as X,p as P,v as c,g as p,b as s,u as e,a1 as Y,w as a,e as i,a4 as Z,G as ee,K as n,s as l,S as te,bw as se,ae as K,t as _,J as b,de as U,az as ae,c as I,df as le,F as z,x as re,Q as g,j as oe,h as de}from"./vendor-ppbe-N6l.js";import{_ as ie}from"./AppLayout.vue_vue_type_script_setup_true_lang-CAMiCJvC.js";import{_ as R}from"./index-uV4J0ulh.js";import{_ as h}from"./index-BYj0gYCc.js";import{_ as x,a as v}from"./CardContent.vue_vue_type_script_setup_true_lang-vqvbNoPF.js";import{_ as k}from"./CardDescription.vue_vue_type_script_setup_true_lang-DlqFqAdi.js";import{_ as y}from"./CardHeader.vue_vue_type_script_setup_true_lang-_r3YWix0.js";import{_ as E}from"./CardTitle.vue_vue_type_script_setup_true_lang-CuQE-qUU.js";import{_ as w}from"./Input.vue_vue_type_script_setup_true_lang-DNj-uKug.js";import{_ as V}from"./Label.vue_vue_type_script_setup_true_lang-DqlcMzBV.js";import{_ as F}from"./Textarea.vue_vue_type_script_setup_true_lang-CBeaEOLc.js";import{_ as ne,a as ue,b as A,c as T,d as me,e as S}from"./TableHeader.vue_vue_type_script_setup_true_lang-CR2Mc2h7.js";import"./index-CSEUMRIG.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-DiRTNO4J.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-BAAtcDkZ.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DA3JUaxj.js";import"./index-BUE9bFsX.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CKDVFyjr.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-B3c6JmTR.js";const fe={class:"container mx-auto py-6 space-y-6"},pe={class:"flex items-center justify-between gap-4"},ce={class:"flex items-center gap-4"},_e={class:"text-muted-foreground mt-1"},ge={class:"flex items-center gap-2"},be={class:"grid gap-4 md:grid-cols-4"},xe={class:"space-y-2"},ve={key:0,class:"text-sm text-destructive"},ke={class:"space-y-2"},ye={key:0,class:"text-sm text-destructive"},Ve={class:"space-y-2"},Se={key:0,class:"text-sm text-destructive"},we={class:"grid gap-4 md:grid-cols-2"},Te={class:"space-y-2"},$e={key:0,class:"text-sm text-destructive"},he={class:"space-y-2"},Be={key:0,class:"text-sm text-destructive"},Ee={class:"space-y-2"},Ae={key:0,class:"text-sm text-destructive"},je={class:"space-y-2"},Ce={key:0,class:"text-sm text-destructive"},De={class:"flex justify-end"},Ze=J({__name:"Edit",props:{broadcast:{},recipients:{},defaultTemplateId:{}},setup(m){const f=m,u=N({title:f.broadcast.title,message:f.broadcast.message,template_id:f.broadcast.template_id||f.defaultTemplateId||""}),o=N({name:"",phone:"",template_id:f.broadcast.template_id||f.defaultTemplateId||"",message:f.broadcast.message||""}),$=X(!1),j=P(()=>f.broadcast.status==="processing"||u.processing),L=P(()=>!j.value),C=r=>{const t=Object.values(r)[0];return typeof t=="string"?t:Array.isArray(t)&&typeof t[0]=="string"?t[0]:"Terjadi kesalahan. Silakan coba lagi."},D=()=>{u.put(`/admin/whatsapp-broadcasts/${f.broadcast.id}`,{preserveScroll:!0,onSuccess:r=>{const t=r.props.flash;if(t?.error){g.error(t.error);return}g.success(t?.success||"Broadcast berhasil diperbarui.")},onError:r=>{g.error(C(r))}})},M=()=>{confirm("Kirim broadcast ini ke semua nomor customer unik sekarang?")&&oe.post(`/admin/whatsapp-broadcasts/${f.broadcast.id}/send`,{},{preserveScroll:!0,onSuccess:r=>{const t=r.props.flash;if(t?.error){g.error(t.error);return}g.success(t?.success||"Broadcast berhasil diproses.")},onError:r=>{g.error(C(r))}})},O=()=>{o.clearErrors(),$.value=!0,de.post(`/admin/whatsapp-broadcasts/${f.broadcast.id}/test-send`,{name:o.name,phone:o.phone,template_id:o.template_id,message:o.message},{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(r=>{g.success(r.data?.message||"Pesan test berhasil dikirim.")}).catch(r=>{if(r.response?.status===422){const t=r.response?.data?.errors;if(t){const d=Object.fromEntries(Object.entries(t).map(([q,B])=>[q,Array.isArray(B)?B[0]:B]));o.setError(d)}}g.error(r.response?.data?.message||"Gagal mengirim pesan test.")}).finally(()=>{$.value=!1})},G=r=>({draft:"Draft",processing:"Processing",sent:"Sent",partial:"Partial",failed:"Failed"})[r]??r,W=r=>r==="sent"?"default":r==="partial"?"outline":r==="failed"?"destructive":"secondary",H=r=>r==="sent"?"default":r==="failed"?"destructive":"secondary",Q=r=>r?new Date(r).toLocaleString("id-ID"):"-";return(r,t)=>(p(),c(z,null,[s(e(Y),{title:`Edit Broadcast: ${m.broadcast.title}`},null,8,["title"]),s(ie,null,{default:a(()=>[i("div",fe,[i("div",pe,[i("div",ce,[s(e(Z),{href:"/admin/whatsapp-broadcasts"},{default:a(()=>[s(e(h),{variant:"outline",size:"icon"},{default:a(()=>[s(e(ee),{class:"h-4 w-4"})]),_:1})]),_:1}),i("div",null,[t[7]||(t[7]=i("h1",{class:"text-3xl font-bold tracking-tight"},"Edit Broadcast WhatsApp",-1)),i("p",_e,n(m.broadcast.title),1)])]),i("div",ge,[s(e(h),{variant:"outline",disabled:j.value,onClick:D},{default:a(()=>[s(e(te),{class:"h-4 w-4 mr-2"}),t[8]||(t[8]=l(" Simpan ",-1))]),_:1},8,["disabled"]),s(e(h),{disabled:!L.value,onClick:M},{default:a(()=>[s(e(se),{class:"h-4 w-4 mr-2"}),t[9]||(t[9]=l(" Kirim Broadcast ",-1))]),_:1},8,["disabled"])])]),i("div",be,[s(e(x),null,{default:a(()=>[s(e(y),{class:"pb-2"},{default:a(()=>[s(e(k),null,{default:a(()=>[...t[10]||(t[10]=[l("Status",-1)])]),_:1})]),_:1}),s(e(v),null,{default:a(()=>[s(e(R),{variant:W(m.broadcast.status)},{default:a(()=>[l(n(G(m.broadcast.status)),1)]),_:1},8,["variant"])]),_:1})]),_:1}),s(e(x),null,{default:a(()=>[s(e(y),{class:"pb-2"},{default:a(()=>[s(e(k),null,{default:a(()=>[...t[11]||(t[11]=[l("Total Nomor",-1)])]),_:1})]),_:1}),s(e(v),{class:"text-2xl font-bold"},{default:a(()=>[l(n(m.broadcast.total_recipients),1)]),_:1})]),_:1}),s(e(x),null,{default:a(()=>[s(e(y),{class:"pb-2"},{default:a(()=>[s(e(k),null,{default:a(()=>[...t[12]||(t[12]=[l("Berhasil",-1)])]),_:1})]),_:1}),s(e(v),{class:"text-2xl font-bold text-emerald-600"},{default:a(()=>[l(n(m.broadcast.success_recipients),1)]),_:1})]),_:1}),s(e(x),null,{default:a(()=>[s(e(y),{class:"pb-2"},{default:a(()=>[s(e(k),null,{default:a(()=>[...t[13]||(t[13]=[l("Gagal",-1)])]),_:1})]),_:1}),s(e(v),{class:"text-2xl font-bold text-red-600"},{default:a(()=>[l(n(m.broadcast.failed_recipients),1)]),_:1})]),_:1})]),i("form",{class:"space-y-6",onSubmit:K(D,["prevent"])},[s(e(x),null,{default:a(()=>[s(e(y),null,{default:a(()=>[s(e(E),null,{default:a(()=>[...t[14]||(t[14]=[l("Konten Broadcast",-1)])]),_:1}),s(e(k),null,{default:a(()=>[l(" Template default konfigurasi: "+n(m.defaultTemplateId||"-"),1)]),_:1})]),_:1}),s(e(v),{class:"space-y-4"},{default:a(()=>[i("div",xe,[s(e(V),{for:"title"},{default:a(()=>[...t[15]||(t[15]=[l("Judul Broadcast *",-1)])]),_:1}),s(e(w),{id:"title",modelValue:e(u).title,"onUpdate:modelValue":t[0]||(t[0]=d=>e(u).title=d),placeholder:"Contoh: Promo Akhir Pekan",class:b({"border-destructive":e(u).errors.title})},null,8,["modelValue","class"]),e(u).errors.title?(p(),c("p",ve,n(e(u).errors.title),1)):_("",!0)]),i("div",ke,[s(e(V),{for:"template_id"},{default:a(()=>[...t[16]||(t[16]=[l("Qontak Template ID",-1)])]),_:1}),s(e(w),{id:"template_id",modelValue:e(u).template_id,"onUpdate:modelValue":t[1]||(t[1]=d=>e(u).template_id=d),placeholder:"Kosongkan untuk pakai default",class:b({"border-destructive":e(u).errors.template_id})},null,8,["modelValue","class"]),e(u).errors.template_id?(p(),c("p",ye,n(e(u).errors.template_id),1)):_("",!0)]),i("div",Ve,[s(e(V),{for:"message"},{default:a(()=>[...t[17]||(t[17]=[l("Isi Pesan *",-1)])]),_:1}),s(e(F),{id:"message",modelValue:e(u).message,"onUpdate:modelValue":t[2]||(t[2]=d=>e(u).message=d),rows:"7",placeholder:"Tulis isi pesan broadcast...",class:b({"border-destructive":e(u).errors.message})},null,8,["modelValue","class"]),e(u).errors.message?(p(),c("p",Se,n(e(u).errors.message),1)):_("",!0)])]),_:1})]),_:1})],32),i("form",{class:"space-y-6",onSubmit:K(O,["prevent"])},[s(e(x),null,{default:a(()=>[s(e(y),null,{default:a(()=>[s(e(E),{class:"flex items-center gap-2"},{default:a(()=>[s(e(U),{class:"h-5 w-5"}),t[18]||(t[18]=l(" Test Kirim ke Satu Nomor ",-1))]),_:1}),s(e(k),null,{default:a(()=>[...t[19]||(t[19]=[l(" Gunakan fitur ini untuk verifikasi template sebelum kirim massal. ",-1)])]),_:1})]),_:1}),s(e(v),{class:"space-y-4"},{default:a(()=>[i("div",we,[i("div",Te,[s(e(V),{for:"test_name"},{default:a(()=>[...t[20]||(t[20]=[l("Nama Tujuan",-1)])]),_:1}),s(e(w),{id:"test_name",modelValue:e(o).name,"onUpdate:modelValue":t[3]||(t[3]=d=>e(o).name=d),placeholder:"Contoh: Admin QA",class:b({"border-destructive":e(o).errors.name})},null,8,["modelValue","class"]),e(o).errors.name?(p(),c("p",$e,n(e(o).errors.name),1)):_("",!0)]),i("div",he,[s(e(V),{for:"test_phone"},{default:a(()=>[...t[21]||(t[21]=[l("No. WhatsApp Tujuan *",-1)])]),_:1}),s(e(w),{id:"test_phone",modelValue:e(o).phone,"onUpdate:modelValue":t[4]||(t[4]=d=>e(o).phone=d),placeholder:"Contoh: 081234567890",class:b({"border-destructive":e(o).errors.phone})},null,8,["modelValue","class"]),t[22]||(t[22]=i("p",{class:"text-xs text-muted-foreground"}," Otomatis dinormalisasi ke format `62xxxxxxxxxx` ",-1)),e(o).errors.phone?(p(),c("p",Be,n(e(o).errors.phone),1)):_("",!0)])]),i("div",Ee,[s(e(V),{for:"test_template_id"},{default:a(()=>[...t[23]||(t[23]=[l("Template ID (Opsional)",-1)])]),_:1}),s(e(w),{id:"test_template_id",modelValue:e(o).template_id,"onUpdate:modelValue":t[5]||(t[5]=d=>e(o).template_id=d),placeholder:"Kosongkan untuk pakai template dari broadcast",class:b({"border-destructive":e(o).errors.template_id})},null,8,["modelValue","class"]),e(o).errors.template_id?(p(),c("p",Ae,n(e(o).errors.template_id),1)):_("",!0)]),i("div",je,[s(e(V),{for:"test_message"},{default:a(()=>[...t[24]||(t[24]=[l("Pesan Test",-1)])]),_:1}),s(e(F),{id:"test_message",modelValue:e(o).message,"onUpdate:modelValue":t[6]||(t[6]=d=>e(o).message=d),rows:"4",class:b({"border-destructive":e(o).errors.message})},null,8,["modelValue","class"]),t[25]||(t[25]=i("p",{class:"text-xs text-muted-foreground"}," Default mengikuti isi pesan broadcast saat ini. ",-1)),e(o).errors.message?(p(),c("p",Ce,n(e(o).errors.message),1)):_("",!0)]),i("div",De,[s(e(h),{type:"submit",disabled:$.value},{default:a(()=>[s(e(U),{class:"h-4 w-4 mr-2"}),l(" "+n($.value?"Mengirim...":"Kirim Test"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1})],32),s(e(x),null,{default:a(()=>[s(e(y),null,{default:a(()=>[s(e(E),{class:"flex items-center gap-2"},{default:a(()=>[s(e(ae),{class:"h-5 w-5"}),t[26]||(t[26]=l(" Riwayat Penerima ",-1))]),_:1}),s(e(k),null,{default:a(()=>[...t[27]||(t[27]=[l(" Menampilkan maksimal 250 data penerima terakhir ",-1)])]),_:1})]),_:1}),s(e(v),{class:"p-0"},{default:a(()=>[s(e(ne),null,{default:a(()=>[s(e(ue),null,{default:a(()=>[s(e(A),null,{default:a(()=>[s(e(T),null,{default:a(()=>[...t[28]||(t[28]=[l("Nama",-1)])]),_:1}),s(e(T),null,{default:a(()=>[...t[29]||(t[29]=[l("No. HP",-1)])]),_:1}),s(e(T),null,{default:a(()=>[...t[30]||(t[30]=[l("Status",-1)])]),_:1}),s(e(T),null,{default:a(()=>[...t[31]||(t[31]=[l("Response",-1)])]),_:1}),s(e(T),null,{default:a(()=>[...t[32]||(t[32]=[l("Waktu Kirim",-1)])]),_:1})]),_:1})]),_:1}),s(e(me),null,{default:a(()=>[m.recipients.length===0?(p(),I(e(A),{key:0},{default:a(()=>[s(e(S),{colspan:"5",class:"text-center py-8 text-muted-foreground"},{default:a(()=>[s(e(le),{class:"h-10 w-10 mx-auto mb-2 opacity-20"}),t[33]||(t[33]=l(" Belum ada data penerima ",-1))]),_:1})]),_:1})):_("",!0),(p(!0),c(z,null,re(m.recipients,d=>(p(),I(e(A),{key:d.id},{default:a(()=>[s(e(S),null,{default:a(()=>[l(n(d.customer_name||"-"),1)]),_:2},1024),s(e(S),null,{default:a(()=>[l(n(d.normalized_phone),1)]),_:2},1024),s(e(S),null,{default:a(()=>[s(e(R),{variant:H(d.status)},{default:a(()=>[l(n(d.status),1)]),_:2},1032,["variant"])]),_:2},1024),s(e(S),{class:"text-sm text-muted-foreground"},{default:a(()=>[l(n(d.response_message||"-"),1)]),_:2},1024),s(e(S),{class:"text-sm text-muted-foreground"},{default:a(()=>[l(n(Q(d.sent_at)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})],64))}});export{Ze as default};
