import{d as ce,r as x,D as fe,am as ve,p as Y,q as ge,c as b,g as d,w as t,b as l,e as m,u as a,a1 as _e,a4 as z,s as r,Y as ke,t as B,Z as xe,v as $,F as D,x as E,y as X,n as o,K as N,ae as ye,an as ee,Q as y,ao as L,ap as be,aq as we,$ as Ve,z as he,j as Z,B as Se}from"./vendor-DmSXq5eN.js";import{c as $e,i as ae,_ as Ce,t as Pe,a as Ue,e as De,l as Ee,d as Ne}from"./AppLayout.vue_vue_type_script_setup_true_lang-bcsz1tEe.js";import{_ as p}from"./index-CZrke-cb.js";import{_ as q}from"./Input.vue_vue_type_script_setup_true_lang-Oy3zhfwy.js";import{_ as K}from"./index-dZyugrTC.js";import{_ as Ke,a as Re,b as G,c as Fe,d as Ie,e as le}from"./TableHeader.vue_vue_type_script_setup_true_lang-QP8FR1Pn.js";import{_ as je}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-DQF_LabE.js";import{_ as Ae}from"./Pagination.vue_vue_type_script_setup_true_lang-ejQGcEoF.js";import{_ as Me,a as Te,b as ze,c as Be,d as Le}from"./DialogTitle.vue_vue_type_script_setup_true_lang-CzLebWuo.js";import{_ as Ze}from"./DialogFooter.vue_vue_type_script_setup_true_lang-CyUtoqNz.js";import{_ as te}from"./Label.vue_vue_type_script_setup_true_lang--fDAGT08.js";import{_ as R,a as F,b as I,c as j,d as u}from"./SelectValue.vue_vue_type_script_setup_true_lang-CstBw1Qc.js";import{u as qe}from"./usePermissions-Cx4fk-e4.js";import"./index-CMWG4mbA.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-BMZwzIZd.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-BL7Uc97k.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-pb5xULWW.js";import"./index-B_n2dl-_.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-361jQ8Ze.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-BtwiMKEj.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-CJvHroM2.js";const Ge={class:"rounded-xl p-4 space-y-6 py-6"},He={class:"mb-6 flex items-center justify-between"},Je={class:"mb-4 space-y-4"},Oe={class:"flex items-center gap-4"},Qe={class:"relative flex-1"},We={class:"flex flex-wrap items-center gap-4"},Ye={class:"rounded-md border"},Xe={class:"space-y-2"},ea={key:0,class:"text-sm text-destructive"},aa={class:"space-y-2"},Va=ce({__name:"Index",props:{customers:{},filters:{}},setup(H){const w=x({open:!1,data:null}),i=fe({amount:"",description:""}),se=s=>{w.value={open:!0,data:s},i.reset(),i.clearErrors(),i.amount="",i.description=""},A=()=>{w.value.open=!1,i.reset(),i.clearErrors()},ne=()=>{if(!w.value.data)return;const s=Number(i.amount);if(!s||s<1e4){y.error("Jumlah minimal Rp 10.000");return}i.post(Pe.url(w.value.data.id),{preserveScroll:!0,onSuccess:()=>{y.success("Saldo berhasil ditambahkan"),A()},onError:e=>{e.amount?y.error(e.amount):y.error("Gagal menambahkan saldo")}})},oe=(s,e)=>{Z.post(Ee.url(s),{},{onSuccess:()=>{y.success(`Login sebagai ${e}`)},onError:n=>{if(n.message?.includes("419")||n.message?.includes("expired")){y.error("Sesi expired, mencoba ulang..."),window.location.reload();return}y.error("Gagal login sebagai customer")},onFinish:()=>{}})},c=H,{isSuperAdmin:J,isAdmin:O}=qe(),V=x(c.filters.search||""),C=x(c.filters.sort_by||"created_at"),S=x(c.filters.sort_order||"desc"),Q=x(c.filters.per_page||10),f=x(c.filters.package_id||"all"),v=x(c.filters.position||"all"),g=x(c.filters.email_verified||"all"),_=x(c.filters.status||"all"),re=s=>{Z.delete(Ne.url(s),{preserveScroll:!0,onSuccess:()=>{y.success("Pelanggan berhasil dihapus")},onError:()=>{y.error("Gagal menghapus pelanggan")}})},h=x({open:!1,data:null}),ie=s=>{h.value={open:!0,data:s}},P=ve(()=>{Z.get(ae.url(),{search:V.value||void 0,sort_by:C.value,sort_order:S.value,per_page:Q.value,package_id:f.value&&f.value!=="all"?f.value:void 0,position:v.value&&v.value!=="all"?v.value:void 0,email_verified:g.value&&g.value!=="all"?g.value:void 0,status:_.value&&_.value!=="all"?_.value:void 0},{preserveState:!0,preserveScroll:!0})},300),U=()=>{P()},ue=()=>{V.value="",f.value="all",v.value="all",g.value="all",_.value="all",P()},de=Y(()=>V.value||f.value&&f.value!=="all"||v.value&&v.value!=="all"||g.value&&g.value!=="all"||_.value&&_.value!=="all"),M=s=>{C.value===s?S.value=S.value==="asc"?"desc":"asc":(C.value=s,S.value="asc"),P()},me=()=>{h.value.data&&re(h.value.data.id)},W=[{id:"index",header:()=>o("div",{class:"text-left"},"No"),cell:({row:s})=>{const e=s.index+1+(c.customers.current_page-1)*c.customers.per_page;return o("div",{class:"text-left"},e.toString())}},{accessorKey:"username",header:()=>o(p,{variant:"ghost",onClick:()=>M("username")},()=>["Username",o(L,{class:"ml-2 h-4 w-4"})]),cell:({row:s})=>{const e=s.getValue("username");return o("div",{class:"font-mono text-sm"},e||"-")}},{accessorKey:"ewallet_id",header:()=>o(p,{variant:"ghost",onClick:()=>M("ewallet_id")},()=>["Ewallet ID",o(L,{class:"ml-2 h-4 w-4"})]),cell:({row:s})=>o("div",{class:"font-mono text-sm"},s.getValue("ewallet_id"))},{accessorKey:"name",header:()=>o(p,{variant:"ghost",onClick:()=>M("name")},()=>["Nama",o(L,{class:"ml-2 h-4 w-4"})]),cell:({row:s})=>o("div",{},s.getValue("name"))},{accessorKey:"package_name",header:"Paket Member",cell:({row:s})=>{const e=s.original.package_id,n=s.getValue("package_name");return o(K,{variant:e===3?"default":e===2?"secondary":"outline"},()=>n)}},{accessorKey:"level",header:"Peringkat",cell:({row:s})=>{const n=(s.getValue("level")??"-").toString();return o(K,{variant:n==="Director"?"default":n==="Executive"?"secondary":"outline"},()=>n)}},{accessorKey:"phone",header:"Telepon",cell:({row:s})=>{const e=s.getValue("phone");return o("div",{class:"text-sm"},e||"-")}},{accessorKey:"ewallet_saldo",header:()=>o("div",{class:"text-right"},"Saldo"),cell:({row:s})=>{const e=s.getValue("ewallet_saldo");return o("div",{class:"text-right font-medium"},"Rp "+new Intl.NumberFormat("id-ID").format(e))}},{accessorKey:"sponsor_username",header:"Sponsor",cell:({row:s})=>{const e=s.getValue("sponsor_username");return o("div",{class:"text-sm"},e?`@${e}`:"-")}},{accessorKey:"upline_username",header:"Upline",cell:({row:s})=>{const e=s.getValue("upline_username");return o("div",{class:"text-sm"},e?`@${e}`:"-")}},{accessorKey:"position",header:"Posisi",cell:({row:s})=>{const e=s.getValue("position");return e?o(K,{variant:e==="left"?"default":"secondary",class:"capitalize"},()=>e):o("div",{class:"text-center"},"-")}},{accessorKey:"email_verified_at",header:"Status",cell:({row:s})=>{const e=s.getValue("email_verified_at");return o(K,{variant:e?"default":"outline"},()=>e?"Verified":"Unverified")}},{id:"actions",header:()=>o("div",{class:"text-center"},"Aksi"),cell:({row:s})=>{const e=s.original,n=[];return(J.value||O.value)&&n.push(o(p,{variant:"ghost",size:"icon",onClick:()=>se(e),title:"Inject Ewallet"},()=>o(ee,{class:"h-4 w-4 text-green-600"})),o(p,{variant:"ghost",size:"icon",onClick:()=>oe(e.id,e.name),title:"Login sebagai customer"},()=>o(be,{class:"h-4 w-4 text-primary"})),o(z,{href:Ue.url(e.id)},()=>o(p,{variant:"ghost",size:"icon"},()=>o(we,{class:"h-4 w-4"}))),o(z,{href:De.url(e.id)},()=>o(p,{variant:"ghost",size:"icon"},()=>o(Ve,{class:"h-4 w-4"})))),e.status!==2&&e.status!==3&&(J.value||O.value)&&n.push(o(p,{variant:"ghost",size:"icon",onClick:()=>ie(e)},()=>o(he,{class:"h-4 w-4 text-destructive"}))),o("div",{class:"flex items-center justify-center gap-2"},n)}}],pe=Y(()=>c.customers.data),T=ge({get data(){return pe.value},columns:W,getCoreRowModel:Se(),manualSorting:!0,manualPagination:!0});return(s,e)=>(d(),b(Ce,null,{default:t(()=>[l(a(_e),{title:"Kelola Pelanggan"}),m("div",Ge,[m("div",He,[e[10]||(e[10]=m("div",null,[m("h1",{class:"text-3xl font-bold tracking-tight"},"Kelola Pelanggan"),m("p",{class:"text-muted-foreground"}," Kelola data pelanggan dan jaringan MLM ")],-1)),l(a(z),{href:a($e).url()},{default:t(()=>[l(a(p),null,{default:t(()=>[l(a(ke),{class:"mr-2 h-4 w-4"}),e[9]||(e[9]=r(" Tambah Pelanggan ",-1))]),_:1})]),_:1},8,["href"])]),m("div",Je,[m("div",Oe,[m("div",Qe,[l(a(xe),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),l(a(q),{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=n=>V.value=n),placeholder:"Cari nama, email, telepon, atau ewallet ID...",class:"pl-10",onInput:a(P)},null,8,["modelValue","onInput"])]),de.value?(d(),b(a(p),{key:0,variant:"outline",size:"sm",onClick:ue},{default:t(()=>[...e[11]||(e[11]=[r(" Reset Filter ",-1)])]),_:1})):B("",!0)]),m("div",We,[l(a(R),{modelValue:f.value,"onUpdate:modelValue":[e[1]||(e[1]=n=>f.value=n),U]},{default:t(()=>[l(a(F),{class:"w-[180px]"},{default:t(()=>[l(a(I),{placeholder:"Semua Peringkat"})]),_:1}),l(a(j),null,{default:t(()=>[l(a(u),{value:"all"},{default:t(()=>[...e[12]||(e[12]=[r("Semua Peringkat",-1)])]),_:1}),l(a(u),{value:"null"},{default:t(()=>[...e[13]||(e[13]=[r("Tidak ada paket",-1)])]),_:1}),l(a(u),{value:"1"},{default:t(()=>[...e[14]||(e[14]=[r("ZENNER Plus",-1)])]),_:1}),l(a(u),{value:"2"},{default:t(()=>[...e[15]||(e[15]=[r("ZENNER Prime",-1)])]),_:1}),l(a(u),{value:"3"},{default:t(()=>[...e[16]||(e[16]=[r("ZENNER Ultra",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(a(R),{modelValue:v.value,"onUpdate:modelValue":[e[2]||(e[2]=n=>v.value=n),U]},{default:t(()=>[l(a(F),{class:"w-[150px]"},{default:t(()=>[l(a(I),{placeholder:"Semua Posisi"})]),_:1}),l(a(j),null,{default:t(()=>[l(a(u),{value:"all"},{default:t(()=>[...e[17]||(e[17]=[r("Semua Posisi",-1)])]),_:1}),l(a(u),{value:"left"},{default:t(()=>[...e[18]||(e[18]=[r("Left",-1)])]),_:1}),l(a(u),{value:"right"},{default:t(()=>[...e[19]||(e[19]=[r("Right",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(a(R),{modelValue:g.value,"onUpdate:modelValue":[e[3]||(e[3]=n=>g.value=n),U]},{default:t(()=>[l(a(F),{class:"w-[160px]"},{default:t(()=>[l(a(I),{placeholder:"Semua Verifikasi"})]),_:1}),l(a(j),null,{default:t(()=>[l(a(u),{value:"all"},{default:t(()=>[...e[20]||(e[20]=[r("Semua Verifikasi",-1)])]),_:1}),l(a(u),{value:"1"},{default:t(()=>[...e[21]||(e[21]=[r("Verified",-1)])]),_:1}),l(a(u),{value:"0"},{default:t(()=>[...e[22]||(e[22]=[r("Unverified",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(a(R),{modelValue:_.value,"onUpdate:modelValue":[e[4]||(e[4]=n=>_.value=n),U]},{default:t(()=>[l(a(F),{class:"w-[150px]"},{default:t(()=>[l(a(I),{placeholder:"Semua Status"})]),_:1}),l(a(j),null,{default:t(()=>[l(a(u),{value:"all"},{default:t(()=>[...e[23]||(e[23]=[r("Semua Status",-1)])]),_:1}),l(a(u),{value:"1"},{default:t(()=>[...e[24]||(e[24]=[r("Prospek",-1)])]),_:1}),l(a(u),{value:"2"},{default:t(()=>[...e[25]||(e[25]=[r("Pasif",-1)])]),_:1}),l(a(u),{value:"3"},{default:t(()=>[...e[26]||(e[26]=[r("Aktif",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),m("div",Ye,[l(a(Ke),null,{default:t(()=>[l(a(Re),null,{default:t(()=>[(d(!0),$(D,null,E(a(T).getHeaderGroups(),n=>(d(),b(a(G),{key:n.id},{default:t(()=>[(d(!0),$(D,null,E(n.headers,k=>(d(),b(a(Fe),{key:k.id},{default:t(()=>[k.isPlaceholder?B("",!0):(d(),b(a(X),{key:0,render:k.column.columnDef.header,props:k.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),l(a(Ie),null,{default:t(()=>[a(T).getRowModel().rows?.length?(d(!0),$(D,{key:0},E(a(T).getRowModel().rows,n=>(d(),b(a(G),{key:n.id},{default:t(()=>[(d(!0),$(D,null,E(n.getVisibleCells(),k=>(d(),b(a(le),{key:k.id},{default:t(()=>[l(a(X),{render:k.column.columnDef.cell,props:k.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1024))),128)):(d(),b(a(G),{key:1},{default:t(()=>[l(a(le),{colspan:W.length,class:"h-24 text-center"},{default:t(()=>[...e[27]||(e[27]=[r(" Tidak ada data pelanggan. ",-1)])]),_:1},8,["colspan"])]),_:1}))]),_:1})]),_:1})]),l(Ae,{data:H.customers,url:a(ae).url(),filters:{search:V.value||void 0,sort_by:C.value,sort_order:S.value,per_page:Q.value,package_id:f.value&&f.value!=="all"?f.value:void 0,position:v.value&&v.value!=="all"?v.value:void 0,email_verified:g.value&&g.value!=="all"?g.value:void 0,status:_.value&&_.value!=="all"?_.value:void 0}},null,8,["data","url","filters"])]),l(je,{open:h.value.open,"onUpdate:open":e[5]||(e[5]=n=>h.value.open=n),title:"Hapus Pelanggan?",description:`Apakah Anda yakin ingin menghapus pelanggan ${h.value.data?.name}? Tindakan ini tidak dapat dibatalkan dan akan menghapus semua data terkait termasuk jaringan dan bonus.`,"confirm-text":"Hapus","cancel-text":"Batal",variant:"destructive",onConfirm:me},null,8,["open","description"]),l(a(Me),{open:w.value.open,"onUpdate:open":e[8]||(e[8]=n=>!n&&A())},{default:t(()=>[l(a(Te),{class:"sm:max-w-md"},{default:t(()=>[l(a(ze),null,{default:t(()=>[l(a(Be),null,{default:t(()=>[...e[28]||(e[28]=[r("Inject Ewallet",-1)])]),_:1}),l(a(Le),null,{default:t(()=>[r(" Tambahkan saldo ke ewallet "+N(w.value.data?.name)+" ("+N(w.value.data?.ewallet_id)+") ",1)]),_:1})]),_:1}),m("form",{onSubmit:ye(ne,["prevent"]),class:"space-y-4"},[m("div",Xe,[l(a(te),{for:"amount"},{default:t(()=>[...e[29]||(e[29]=[r("Jumlah (Rp)",-1)])]),_:1}),l(a(q),{id:"amount",modelValue:a(i).amount,"onUpdate:modelValue":e[6]||(e[6]=n=>a(i).amount=n),modelModifiers:{number:!0},type:"number",min:"10000",step:"1000",placeholder:"Minimal Rp 10.000",required:""},null,8,["modelValue"]),a(i).errors.amount?(d(),$("p",ea,N(a(i).errors.amount),1)):B("",!0)]),m("div",aa,[l(a(te),{for:"description"},{default:t(()=>[...e[30]||(e[30]=[r("Keterangan (Opsional)",-1)])]),_:1}),l(a(q),{id:"description",modelValue:a(i).description,"onUpdate:modelValue":e[7]||(e[7]=n=>a(i).description=n),type:"text",placeholder:"Contoh: Top up manual oleh admin"},null,8,["modelValue"])]),l(a(Ze),{class:"gap-2 sm:gap-0"},{default:t(()=>[l(a(p),{type:"button",variant:"outline",disabled:a(i).processing,onClick:A},{default:t(()=>[...e[31]||(e[31]=[r(" Batal ",-1)])]),_:1},8,["disabled"]),l(a(p),{type:"submit",disabled:a(i).processing||!a(i).amount||Number(a(i).amount)<1e4},{default:t(()=>[l(a(ee),{class:"mr-2 h-4 w-4"}),r(" "+N(a(i).processing?"Memproses...":"Tambahkan Saldo"),1)]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"])]),_:1}))}});export{Va as default};
