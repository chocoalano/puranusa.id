import{d as me,r as k,D as pe,al as ce,p as Q,q as fe,c as y,g as d,w as t,b as l,e as m,u as a,a0 as ve,a3 as z,s as r,Y as ge,t as A,Z as _e,v as $,F as D,x as E,y as W,n as o,K as U,ad as ke,am as Y,Q as b,an as B,ao as xe,ap as be,$ as ye,z as we,j as L,B as Ve}from"./vendor-u69_SgX4.js";import{c as he,i as X,_ as Se,t as $e,a as Ce,e as Pe,l as Ne,d as De}from"./AppLayout.vue_vue_type_script_setup_true_lang-CNFjYB-7.js";import{_ as p}from"./index-Dgwk259n.js";import{_ as Z}from"./Input.vue_vue_type_script_setup_true_lang-B09zx5te.js";import{_ as G}from"./index-DyUpvQGF.js";import{_ as Ee,a as Ue,b as H,c as Fe,d as Ke,e as ee}from"./TableHeader.vue_vue_type_script_setup_true_lang-C0WMCBTo.js";import{_ as Ie}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-BFGhJpjt.js";import{_ as Re}from"./Pagination.vue_vue_type_script_setup_true_lang-DQuybfRy.js";import{_ as je,a as Te,b as Me,c as ze,d as Ae}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DQ6J_eaU.js";import{_ as Be}from"./DialogFooter.vue_vue_type_script_setup_true_lang-CLunKIAX.js";import{_ as ae}from"./Label.vue_vue_type_script_setup_true_lang-fV06lMYE.js";import{_ as F,a as K,b as I,c as R,d as u}from"./SelectValue.vue_vue_type_script_setup_true_lang-Dglpcc31.js";import"./index-CMWG4mbA.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-dvnhmmY7.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-BW0SaXTm.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BNRb2ZrY.js";import"./index-DqFeuJ-n.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-41k4hIm2.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-_3dn1dX5.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-CbM4MXOh.js";const Le={class:"rounded-xl p-4 space-y-6 py-6"},Ze={class:"mb-6 flex items-center justify-between"},Ge={class:"mb-4 space-y-4"},He={class:"flex items-center gap-4"},qe={class:"relative flex-1"},Je={class:"flex flex-wrap items-center gap-4"},Oe={class:"rounded-md border"},Qe={class:"space-y-2"},We={key:0,class:"text-sm text-destructive"},Ye={class:"space-y-2"},xa=me({__name:"Index",props:{customers:{},filters:{}},setup(q){const w=k({open:!1,data:null}),i=pe({amount:"",description:""}),le=s=>{w.value={open:!0,data:s},i.reset(),i.clearErrors(),i.amount="",i.description=""},j=()=>{w.value.open=!1,i.reset(),i.clearErrors()},te=()=>{if(!w.value.data)return;const s=Number(i.amount);if(!s||s<1e4){b.error("Jumlah minimal Rp 10.000");return}i.post($e.url(w.value.data.id),{preserveScroll:!0,onSuccess:()=>{b.success("Saldo berhasil ditambahkan"),j()},onError:e=>{e.amount?b.error(e.amount):b.error("Gagal menambahkan saldo")}})},se=(s,e)=>{L.post(Ne.url(s),{},{onSuccess:()=>{b.success(`Login sebagai ${e}`)},onError:n=>{if(n.message?.includes("419")||n.message?.includes("expired")){b.error("Sesi expired, mencoba ulang..."),window.location.reload();return}b.error("Gagal login sebagai customer")},onFinish:()=>{}})},c=q,V=k(c.filters.search||""),C=k(c.filters.sort_by||"created_at"),S=k(c.filters.sort_order||"desc"),J=k(c.filters.per_page||10),f=k(c.filters.package_id||"all"),v=k(c.filters.position||"all"),g=k(c.filters.email_verified||"all"),_=k(c.filters.status||"all"),oe=s=>{L.delete(De.url(s),{preserveScroll:!0,onSuccess:()=>{b.success("Pelanggan berhasil dihapus")},onError:()=>{b.error("Gagal menghapus pelanggan")}})},h=k({open:!1,data:null}),ne=s=>{h.value={open:!0,data:s}},P=ce(()=>{L.get(X.url(),{search:V.value||void 0,sort_by:C.value,sort_order:S.value,per_page:J.value,package_id:f.value&&f.value!=="all"?f.value:void 0,position:v.value&&v.value!=="all"?v.value:void 0,email_verified:g.value&&g.value!=="all"?g.value:void 0,status:_.value&&_.value!=="all"?_.value:void 0},{preserveState:!0,preserveScroll:!0})},300),N=()=>{P()},re=()=>{V.value="",f.value="all",v.value="all",g.value="all",_.value="all",P()},ie=Q(()=>V.value||f.value&&f.value!=="all"||v.value&&v.value!=="all"||g.value&&g.value!=="all"||_.value&&_.value!=="all"),T=s=>{C.value===s?S.value=S.value==="asc"?"desc":"asc":(C.value=s,S.value="asc"),P()},ue=()=>{h.value.data&&oe(h.value.data.id)},O=[{id:"index",header:()=>o("div",{class:"text-left"},"No"),cell:({row:s})=>{const e=s.index+1+(c.customers.current_page-1)*c.customers.per_page;return o("div",{class:"text-left"},e.toString())}},{accessorKey:"username",header:()=>o(p,{variant:"ghost",onClick:()=>T("username")},()=>["Username",o(B,{class:"ml-2 h-4 w-4"})]),cell:({row:s})=>{const e=s.getValue("username");return o("div",{class:"font-mono text-sm"},e||"-")}},{accessorKey:"ewallet_id",header:()=>o(p,{variant:"ghost",onClick:()=>T("ewallet_id")},()=>["Ewallet ID",o(B,{class:"ml-2 h-4 w-4"})]),cell:({row:s})=>o("div",{class:"font-mono text-sm"},s.getValue("ewallet_id"))},{accessorKey:"name",header:()=>o(p,{variant:"ghost",onClick:()=>T("name")},()=>["Nama",o(B,{class:"ml-2 h-4 w-4"})]),cell:({row:s})=>o("div",{},s.getValue("name"))},{accessorKey:"package_name",header:"Peringkat",cell:({row:s})=>{const e=s.original.package_id,n=s.getValue("package_name");return o(G,{variant:e===3?"default":e===2?"secondary":"outline"},()=>n)}},{accessorKey:"phone",header:"Telepon",cell:({row:s})=>{const e=s.getValue("phone");return o("div",{class:"text-sm"},e||"-")}},{accessorKey:"ewallet_saldo",header:()=>o("div",{class:"text-right"},"Saldo"),cell:({row:s})=>{const e=s.getValue("ewallet_saldo");return o("div",{class:"text-right font-medium"},"Rp "+new Intl.NumberFormat("id-ID").format(e))}},{accessorKey:"sponsor_name",header:"Sponsor",cell:({row:s})=>{const e=s.getValue("sponsor_name");return o("div",{class:"text-sm"},e||"-")}},{accessorKey:"upline_name",header:"Upline",cell:({row:s})=>{const e=s.getValue("upline_name");return o("div",{class:"text-sm"},e||"-")}},{accessorKey:"position",header:"Posisi",cell:({row:s})=>{const e=s.getValue("position");return e?o(G,{variant:e==="left"?"default":"secondary",class:"capitalize"},()=>e):o("div",{class:"text-center"},"-")}},{accessorKey:"email_verified_at",header:"Status",cell:({row:s})=>{const e=s.getValue("email_verified_at");return o(G,{variant:e?"default":"outline"},()=>e?"Verified":"Unverified")}},{id:"actions",header:()=>o("div",{class:"text-center"},"Aksi"),cell:({row:s})=>{const e=s.original,n=[o(p,{variant:"ghost",size:"icon",onClick:()=>le(e),title:"Inject Ewallet"},()=>o(Y,{class:"h-4 w-4 text-green-600"})),o(p,{variant:"ghost",size:"icon",onClick:()=>se(e.id,e.name),title:"Login sebagai customer"},()=>o(xe,{class:"h-4 w-4 text-primary"})),o(z,{href:Ce.url(e.id)},()=>o(p,{variant:"ghost",size:"icon"},()=>o(be,{class:"h-4 w-4"}))),o(z,{href:Pe.url(e.id)},()=>o(p,{variant:"ghost",size:"icon"},()=>o(ye,{class:"h-4 w-4"})))];return e.status!==2&&e.status!==3&&n.push(o(p,{variant:"ghost",size:"icon",onClick:()=>ne(e)},()=>o(we,{class:"h-4 w-4 text-destructive"}))),o("div",{class:"flex items-center justify-center gap-2"},n)}}],de=Q(()=>c.customers.data),M=fe({get data(){return de.value},columns:O,getCoreRowModel:Ve(),manualSorting:!0,manualPagination:!0});return(s,e)=>(d(),y(Se,null,{default:t(()=>[l(a(ve),{title:"Kelola Pelanggan"}),m("div",Le,[m("div",Ze,[e[10]||(e[10]=m("div",null,[m("h1",{class:"text-3xl font-bold tracking-tight"},"Kelola Pelanggan"),m("p",{class:"text-muted-foreground"}," Kelola data pelanggan dan jaringan MLM ")],-1)),l(a(z),{href:a(he).url()},{default:t(()=>[l(a(p),null,{default:t(()=>[l(a(ge),{class:"mr-2 h-4 w-4"}),e[9]||(e[9]=r(" Tambah Pelanggan ",-1))]),_:1})]),_:1},8,["href"])]),m("div",Ge,[m("div",He,[m("div",qe,[l(a(_e),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),l(a(Z),{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=n=>V.value=n),placeholder:"Cari nama, email, telepon, atau ewallet ID...",class:"pl-10",onInput:a(P)},null,8,["modelValue","onInput"])]),ie.value?(d(),y(a(p),{key:0,variant:"outline",size:"sm",onClick:re},{default:t(()=>[...e[11]||(e[11]=[r(" Reset Filter ",-1)])]),_:1})):A("",!0)]),m("div",Je,[l(a(F),{modelValue:f.value,"onUpdate:modelValue":[e[1]||(e[1]=n=>f.value=n),N]},{default:t(()=>[l(a(K),{class:"w-[180px]"},{default:t(()=>[l(a(I),{placeholder:"Semua Peringkat"})]),_:1}),l(a(R),null,{default:t(()=>[l(a(u),{value:"all"},{default:t(()=>[...e[12]||(e[12]=[r("Semua Peringkat",-1)])]),_:1}),l(a(u),{value:"null"},{default:t(()=>[...e[13]||(e[13]=[r("Tidak ada paket",-1)])]),_:1}),l(a(u),{value:"1"},{default:t(()=>[...e[14]||(e[14]=[r("ZENNER Plus",-1)])]),_:1}),l(a(u),{value:"2"},{default:t(()=>[...e[15]||(e[15]=[r("ZENNER Prime",-1)])]),_:1}),l(a(u),{value:"3"},{default:t(()=>[...e[16]||(e[16]=[r("ZENNER Ultra",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(a(F),{modelValue:v.value,"onUpdate:modelValue":[e[2]||(e[2]=n=>v.value=n),N]},{default:t(()=>[l(a(K),{class:"w-[150px]"},{default:t(()=>[l(a(I),{placeholder:"Semua Posisi"})]),_:1}),l(a(R),null,{default:t(()=>[l(a(u),{value:"all"},{default:t(()=>[...e[17]||(e[17]=[r("Semua Posisi",-1)])]),_:1}),l(a(u),{value:"left"},{default:t(()=>[...e[18]||(e[18]=[r("Left",-1)])]),_:1}),l(a(u),{value:"right"},{default:t(()=>[...e[19]||(e[19]=[r("Right",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(a(F),{modelValue:g.value,"onUpdate:modelValue":[e[3]||(e[3]=n=>g.value=n),N]},{default:t(()=>[l(a(K),{class:"w-[160px]"},{default:t(()=>[l(a(I),{placeholder:"Semua Verifikasi"})]),_:1}),l(a(R),null,{default:t(()=>[l(a(u),{value:"all"},{default:t(()=>[...e[20]||(e[20]=[r("Semua Verifikasi",-1)])]),_:1}),l(a(u),{value:"1"},{default:t(()=>[...e[21]||(e[21]=[r("Verified",-1)])]),_:1}),l(a(u),{value:"0"},{default:t(()=>[...e[22]||(e[22]=[r("Unverified",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(a(F),{modelValue:_.value,"onUpdate:modelValue":[e[4]||(e[4]=n=>_.value=n),N]},{default:t(()=>[l(a(K),{class:"w-[150px]"},{default:t(()=>[l(a(I),{placeholder:"Semua Status"})]),_:1}),l(a(R),null,{default:t(()=>[l(a(u),{value:"all"},{default:t(()=>[...e[23]||(e[23]=[r("Semua Status",-1)])]),_:1}),l(a(u),{value:"1"},{default:t(()=>[...e[24]||(e[24]=[r("Prospek",-1)])]),_:1}),l(a(u),{value:"2"},{default:t(()=>[...e[25]||(e[25]=[r("Pasif",-1)])]),_:1}),l(a(u),{value:"3"},{default:t(()=>[...e[26]||(e[26]=[r("Aktif",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),m("div",Oe,[l(a(Ee),null,{default:t(()=>[l(a(Ue),null,{default:t(()=>[(d(!0),$(D,null,E(a(M).getHeaderGroups(),n=>(d(),y(a(H),{key:n.id},{default:t(()=>[(d(!0),$(D,null,E(n.headers,x=>(d(),y(a(Fe),{key:x.id},{default:t(()=>[x.isPlaceholder?A("",!0):(d(),y(a(W),{key:0,render:x.column.columnDef.header,props:x.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),l(a(Ke),null,{default:t(()=>[a(M).getRowModel().rows?.length?(d(!0),$(D,{key:0},E(a(M).getRowModel().rows,n=>(d(),y(a(H),{key:n.id},{default:t(()=>[(d(!0),$(D,null,E(n.getVisibleCells(),x=>(d(),y(a(ee),{key:x.id},{default:t(()=>[l(a(W),{render:x.column.columnDef.cell,props:x.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1024))),128)):(d(),y(a(H),{key:1},{default:t(()=>[l(a(ee),{colspan:O.length,class:"h-24 text-center"},{default:t(()=>[...e[27]||(e[27]=[r(" Tidak ada data pelanggan. ",-1)])]),_:1},8,["colspan"])]),_:1}))]),_:1})]),_:1})]),l(Re,{data:q.customers,url:a(X).url(),filters:{search:V.value||void 0,sort_by:C.value,sort_order:S.value,per_page:J.value,package_id:f.value&&f.value!=="all"?f.value:void 0,position:v.value&&v.value!=="all"?v.value:void 0,email_verified:g.value&&g.value!=="all"?g.value:void 0,status:_.value&&_.value!=="all"?_.value:void 0}},null,8,["data","url","filters"])]),l(Ie,{open:h.value.open,"onUpdate:open":e[5]||(e[5]=n=>h.value.open=n),title:"Hapus Pelanggan?",description:`Apakah Anda yakin ingin menghapus pelanggan ${h.value.data?.name}? Tindakan ini tidak dapat dibatalkan dan akan menghapus semua data terkait termasuk jaringan dan bonus.`,"confirm-text":"Hapus","cancel-text":"Batal",variant:"destructive",onConfirm:ue},null,8,["open","description"]),l(a(je),{open:w.value.open,"onUpdate:open":e[8]||(e[8]=n=>!n&&j())},{default:t(()=>[l(a(Te),{class:"sm:max-w-md"},{default:t(()=>[l(a(Me),null,{default:t(()=>[l(a(ze),null,{default:t(()=>[...e[28]||(e[28]=[r("Inject Ewallet",-1)])]),_:1}),l(a(Ae),null,{default:t(()=>[r(" Tambahkan saldo ke ewallet "+U(w.value.data?.name)+" ("+U(w.value.data?.ewallet_id)+") ",1)]),_:1})]),_:1}),m("form",{onSubmit:ke(te,["prevent"]),class:"space-y-4"},[m("div",Qe,[l(a(ae),{for:"amount"},{default:t(()=>[...e[29]||(e[29]=[r("Jumlah (Rp)",-1)])]),_:1}),l(a(Z),{id:"amount",modelValue:a(i).amount,"onUpdate:modelValue":e[6]||(e[6]=n=>a(i).amount=n),modelModifiers:{number:!0},type:"number",min:"10000",step:"1000",placeholder:"Minimal Rp 10.000",required:""},null,8,["modelValue"]),a(i).errors.amount?(d(),$("p",We,U(a(i).errors.amount),1)):A("",!0)]),m("div",Ye,[l(a(ae),{for:"description"},{default:t(()=>[...e[30]||(e[30]=[r("Keterangan (Opsional)",-1)])]),_:1}),l(a(Z),{id:"description",modelValue:a(i).description,"onUpdate:modelValue":e[7]||(e[7]=n=>a(i).description=n),type:"text",placeholder:"Contoh: Top up manual oleh admin"},null,8,["modelValue"])]),l(a(Be),{class:"gap-2 sm:gap-0"},{default:t(()=>[l(a(p),{type:"button",variant:"outline",disabled:a(i).processing,onClick:j},{default:t(()=>[...e[31]||(e[31]=[r(" Batal ",-1)])]),_:1},8,["disabled"]),l(a(p),{type:"submit",disabled:a(i).processing||!a(i).amount||Number(a(i).amount)<1e4},{default:t(()=>[l(a(Y),{class:"mr-2 h-4 w-4"}),r(" "+U(a(i).processing?"Memproses...":"Tambahkan Saldo"),1)]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"])]),_:1}))}});export{xa as default};
