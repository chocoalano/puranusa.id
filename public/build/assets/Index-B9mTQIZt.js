import{_ as Y,D as ee,E as te}from"./AppLayout.vue_vue_type_script_setup_true_lang-C9ON-RNz.js";import{d as H,v as h,g as u,b as a,u as e,w as s,s as c,cv as ae,e as d,K as k,cw as le,aM as se,au as re,r as x,q as ne,E as N,j as U,a0 as ie,c as _,t as P,Z as oe,a9 as de,F as y,x as b,y as W,n as i,D as z,an as ue,bt as ce,X as me,aG as fe,A as pe,B as we}from"./vendor-CZXNXaHB.js";import{_ as E}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-DOF9i1Mo.js";import{_ as ge}from"./Pagination.vue_vue_type_script_setup_true_lang-CdNUgtby.js";import{_ as S,a as D}from"./CardContent.vue_vue_type_script_setup_true_lang-tg0tM1mE.js";import{_ as V}from"./CardHeader.vue_vue_type_script_setup_true_lang-DNr1O3j0.js";import{_ as j}from"./CardTitle.vue_vue_type_script_setup_true_lang-DiexmtNY.js";import{_ as _e}from"./index-B-sjbl-G.js";import{_ as F,v as T}from"./index-DQccm4Bv.js";import{_ as ve,a as xe,b as he}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-gjluvqqt.js";import{_ as ye}from"./DropdownMenuCheckboxItem.vue_vue_type_script_setup_true_lang-ClpHUeBV.js";import{_ as be}from"./Input.vue_vue_type_script_setup_true_lang-CQ6gFgAL.js";import{_ as ke,a as $e,b as Ce,c as Se,d as R}from"./SelectValue.vue_vue_type_script_setup_true_lang-Dx5Mn26f.js";import{_ as De,a as Ve,b as I,c as je,d as Fe,e as q}from"./TableHeader.vue_vue_type_script_setup_true_lang-DUNzXVGC.js";import"./index-DaR_mHDg.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-TpB8oA6T.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-Bh3WDF-P.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-B95dSWYf.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-BDsQhCvz.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-ByTOEn2m.js";const Re={class:"grid gap-4 md:grid-cols-4"},Te={class:"text-2xl font-bold"},Ie={class:"text-2xl font-bold"},Me={class:"text-2xl font-bold"},Ae={class:"text-2xl font-bold"},Ke=H({__name:"WithdrawalStatistics",props:{statistics:{}},setup(o){const f=p=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(p);return(p,r)=>(u(),h("div",Re,[a(e(S),null,{default:s(()=>[a(e(V),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[a(e(j),{class:"text-sm font-medium"},{default:s(()=>[...r[0]||(r[0]=[c("Pending",-1)])]),_:1}),a(e(ae),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(D),null,{default:s(()=>[d("div",Te,k(o.statistics.total_pending),1),r[1]||(r[1]=d("p",{class:"text-xs text-muted-foreground"},"Menunggu persetujuan",-1))]),_:1})]),_:1}),a(e(S),null,{default:s(()=>[a(e(V),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[a(e(j),{class:"text-sm font-medium"},{default:s(()=>[...r[2]||(r[2]=[c("Disetujui",-1)])]),_:1}),a(e(le),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(D),null,{default:s(()=>[d("div",Ie,k(o.statistics.total_completed),1),r[3]||(r[3]=d("p",{class:"text-xs text-muted-foreground"},"Withdrawal selesai",-1))]),_:1})]),_:1}),a(e(S),null,{default:s(()=>[a(e(V),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[a(e(j),{class:"text-sm font-medium"},{default:s(()=>[...r[4]||(r[4]=[c("Ditolak",-1)])]),_:1}),a(e(se),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(D),null,{default:s(()=>[d("div",Me,k(o.statistics.total_failed),1),r[5]||(r[5]=d("p",{class:"text-xs text-muted-foreground"},"Withdrawal gagal",-1))]),_:1})]),_:1}),a(e(S),null,{default:s(()=>[a(e(V),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[a(e(j),{class:"text-sm font-medium"},{default:s(()=>[...r[6]||(r[6]=[c("Total Nominal",-1)])]),_:1}),a(e(re),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(D),null,{default:s(()=>[d("div",Ae,k(f(o.statistics.total_amount)),1),r[7]||(r[7]=d("p",{class:"text-xs text-muted-foreground"},"Total withdrawal berhasil",-1))]),_:1})]),_:1})]))}}),Be={class:"rounded-xl p-4 space-y-6 py-6"},Ne={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},Ue={class:"flex flex-1 gap-4"},Pe={class:"relative flex-1 max-w-sm"},We={class:"rounded-md border"},ot=H({__name:"Index",props:{withdrawals:{},statistics:{},filters:{}},setup(o){const f=o,p=x(f.filters.search||""),r=x(f.filters.status||"all"),v=x([{id:f.filters.sort_by||"created_at",desc:f.filters.sort_order==="desc"}]),M=x([]),A=x({}),w=x({open:!1,withdrawal:null}),g=x({open:!1,withdrawal:null}),$=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(t),L=t=>new Date(t).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),X=t=>({pending:"secondary",completed:"default",failed:"destructive"})[t]||"secondary",G=t=>{if(!t)return null;try{return JSON.parse(t)}catch{return null}},J=t=>{w.value={open:!0,withdrawal:t}},O=()=>{if(!w.value.withdrawal)return;z({}).post(ee.url(w.value.withdrawal.id),{preserveScroll:!0,onSuccess:()=>{w.value={open:!1,withdrawal:null}}})},Z=t=>{g.value={open:!0,withdrawal:t}},Q=()=>{if(!g.value.withdrawal)return;z({}).post(te.url(g.value.withdrawal.id),{preserveScroll:!0,onSuccess:()=>{g.value={open:!1,withdrawal:null}}})},K=[{id:"index",header:()=>i("div",{class:"w-12"},"No"),cell:({row:t})=>{const l=t.index+1+(f.withdrawals.current_page-1)*f.withdrawals.per_page;return i("div",{class:"font-medium"},l)}},{accessorKey:"customer.name",header:({column:t})=>i(F,{variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),class:"-ml-4"},()=>["Pelanggan",i(ue,{class:"ml-2 h-4 w-4"})]),cell:({row:t})=>{const l=t.original.customer;return i("div",[i("div",{class:"font-medium"},l.name),i("div",{class:"text-xs text-muted-foreground"},l.email)])}},{accessorKey:"customer.ewallet_saldo",header:()=>"Saldo",cell:({row:t})=>i("div",$(t.original.customer.ewallet_saldo))},{accessorKey:"amount",header:()=>"Penarikan",cell:({row:t})=>i("div",{class:"font-bold text-red-600"},$(t.getValue("amount")))},{accessorKey:"notes",header:()=>"Rekening Tujuan",cell:({row:t})=>{const l=G(t.getValue("notes"));return l?i("div",[i("div",{class:"text-xs font-medium"},`${l.bank_name} - ${l.bank_account}`),i("div",{class:"text-xs text-muted-foreground"},l.bank_holder)]):i("div",{class:"text-xs text-muted-foreground"},"-")}},{accessorKey:"transaction_ref",header:()=>"Referensi",cell:({row:t})=>i("div",{class:"font-mono text-xs"},t.getValue("transaction_ref"))},{accessorKey:"status",header:()=>"Status",cell:({row:t})=>{const l=t.getValue("status");return i(_e,{variant:X(l)},()=>l)}},{accessorKey:"created_at",header:()=>"Tanggal",cell:({row:t})=>i("div",{class:"text-sm"},L(t.getValue("created_at")))},{id:"actions",header:()=>i("div",{class:"text-right"},"Aksi"),cell:({row:t})=>{const l=t.original;if(l.status!=="pending")return null;const n=l.customer.ewallet_saldo<l.amount;return i("div",{class:"flex justify-end gap-2"},[i(F,{size:"sm",onClick:()=>J(l),disabled:n},()=>[i(ce,{class:"mr-1 h-4 w-4"}),"Setujui"]),i(F,{size:"sm",variant:"destructive",onClick:()=>Z(l)},()=>[i(me,{class:"mr-1 h-4 w-4"}),"Tolak"])])}}],C=ne({get data(){return f.withdrawals.data},columns:K,getCoreRowModel:we(),getSortedRowModel:pe(),getFilteredRowModel:fe(),onSortingChange:t=>T(t,v),onColumnFiltersChange:t=>T(t,M),onColumnVisibilityChange:t=>T(t,A),state:{get sorting(){return v.value},get columnFilters(){return M.value},get columnVisibility(){return A.value}},manualSorting:!0});N(v,t=>{t.length>0&&U.get("/admin/withdrawals",{search:p.value||void 0,status:r.value!=="all"?r.value:void 0,sort_by:t[0].id,sort_order:t[0].desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},{deep:!0});let B;return N([p,r],()=>{clearTimeout(B),B=setTimeout(()=>{U.get("/admin/withdrawals",{search:p.value||void 0,status:r.value!=="all"?r.value:void 0,sort_by:v.value[0]?.id||"created_at",sort_order:v.value[0]?.desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},300)}),(t,l)=>(u(),h(y,null,[a(e(ie),{title:"Permintaan Withdrawal"}),a(Y,null,{default:s(()=>[d("div",Be,[l[10]||(l[10]=d("div",null,[d("h2",{class:"text-3xl font-bold tracking-tight"},"Permintaan Withdrawal"),d("p",{class:"text-muted-foreground"},"Kelola permintaan penarikan saldo dari pelanggan")],-1)),a(Ke,{statistics:o.statistics},null,8,["statistics"]),d("div",Ne,[d("div",Ue,[d("div",Pe,[a(e(oe),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),a(e(be),{modelValue:p.value,"onUpdate:modelValue":l[0]||(l[0]=n=>p.value=n),placeholder:"Cari pelanggan atau referensi...",class:"pl-9"},null,8,["modelValue"])]),a(e(ke),{modelValue:r.value,"onUpdate:modelValue":l[1]||(l[1]=n=>r.value=n)},{default:s(()=>[a(e($e),{class:"w-[180px]"},{default:s(()=>[a(e(Ce),{placeholder:"Semua Status"})]),_:1}),a(e(Se),null,{default:s(()=>[a(e(R),{value:"all"},{default:s(()=>[...l[4]||(l[4]=[c("Semua Status",-1)])]),_:1}),a(e(R),{value:"pending"},{default:s(()=>[...l[5]||(l[5]=[c("Pending",-1)])]),_:1}),a(e(R),{value:"completed"},{default:s(()=>[...l[6]||(l[6]=[c("Completed",-1)])]),_:1}),a(e(R),{value:"failed"},{default:s(()=>[...l[7]||(l[7]=[c("Failed",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),a(e(ve),null,{default:s(()=>[a(e(xe),{"as-child":""},{default:s(()=>[a(e(F),{variant:"outline",class:"ml-auto"},{default:s(()=>[l[8]||(l[8]=c(" Kolom ",-1)),a(e(de),{class:"ml-2 h-4 w-4"})]),_:1})]),_:1}),a(e(he),{align:"end"},{default:s(()=>[(u(!0),h(y,null,b(e(C).getAllColumns().filter(n=>n.getCanHide()),n=>(u(),_(e(ye),{key:n.id,class:"capitalize","model-value":n.getIsVisible(),"onUpdate:modelValue":m=>{n.toggleVisibility(!!m)}},{default:s(()=>[c(k(n.id),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})]),d("div",We,[a(e(De),null,{default:s(()=>[a(e(Ve),null,{default:s(()=>[(u(!0),h(y,null,b(e(C).getHeaderGroups(),n=>(u(),_(e(I),{key:n.id},{default:s(()=>[(u(!0),h(y,null,b(n.headers,m=>(u(),_(e(je),{key:m.id},{default:s(()=>[m.isPlaceholder?P("",!0):(u(),_(e(W),{key:0,render:m.column.columnDef.header,props:m.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),a(e(Fe),null,{default:s(()=>[e(C).getRowModel().rows?.length?(u(!0),h(y,{key:0},b(e(C).getRowModel().rows,n=>(u(),_(e(I),{key:n.id},{default:s(()=>[(u(!0),h(y,null,b(n.getVisibleCells(),m=>(u(),_(e(q),{key:m.id},{default:s(()=>[a(e(W),{render:m.column.columnDef.cell,props:m.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1024))),128)):(u(),_(e(I),{key:1},{default:s(()=>[a(e(q),{colspan:K.length,class:"h-24 text-center"},{default:s(()=>[...l[9]||(l[9]=[c(" Tidak ada permintaan withdrawal. ",-1)])]),_:1},8,["colspan"])]),_:1}))]),_:1})]),_:1})]),o.withdrawals.last_page>1?(u(),_(ge,{key:0,data:{current_page:o.withdrawals.current_page,last_page:o.withdrawals.last_page,per_page:o.withdrawals.per_page,from:(o.withdrawals.current_page-1)*o.withdrawals.per_page+1,to:Math.min(o.withdrawals.current_page*o.withdrawals.per_page,o.withdrawals.total),total:o.withdrawals.total},url:"/admin/withdrawals",filters:{search:p.value||void 0,status:r.value!=="all"?r.value:void 0,sort_by:v.value[0]?.id||"created_at",sort_order:v.value[0]?.desc?"desc":"asc"}},null,8,["data","filters"])):P("",!0)]),a(E,{open:w.value.open,"onUpdate:open":l[2]||(l[2]=n=>w.value.open=n),title:"Setujui Withdrawal?",description:`Apakah Anda yakin ingin menyetujui permintaan withdrawal sebesar ${w.value.withdrawal?$(w.value.withdrawal.amount):""} untuk ${w.value.withdrawal?.customer.name}? Dana akan ditransfer via Midtrans ke rekening tujuan.`,"confirm-text":"Setujui & Transfer","cancel-text":"Batal",onConfirm:O},null,8,["open","description"]),a(E,{open:g.value.open,"onUpdate:open":l[3]||(l[3]=n=>g.value.open=n),title:"Tolak Withdrawal?",description:`Apakah Anda yakin ingin menolak permintaan withdrawal sebesar ${g.value.withdrawal?$(g.value.withdrawal.amount):""} dari ${g.value.withdrawal?.customer.name}?`,"confirm-text":"Tolak","cancel-text":"Batal",variant:"destructive",onConfirm:Q},null,8,["open","description"])]),_:1})],64))}});export{ot as default};
