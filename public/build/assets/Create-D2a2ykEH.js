import{d as ta,D as sa,r as c,p as M,E as la,Q as C,c as k,g as u,w as s,b as t,e as l,u as a,a0 as na,a3 as K,G as ia,ad as oa,s as d,aH as da,v as m,t as w,J as $,K as r,aa as U,F as S,x as j,bv as B,M as ua,L as ra,aM as ma,ba as pa}from"./vendor-BgSYH69o.js";import{C as ca,D,_ as _a,E as fa}from"./AppLayout.vue_vue_type_script_setup_true_lang-BLQAiOgB.js";import{_ as v,c as N}from"./index-C6h2rSEx.js";import{_ as P}from"./Label.vue_vue_type_script_setup_true_lang-rNa1VbjU.js";import{_ as ka,a as va,b as ba,c as ga,d as xa}from"./SelectValue.vue_vue_type_script_setup_true_lang-CM9Iafca.js";import{_ as A,a as F}from"./CardContent.vue_vue_type_script_setup_true_lang-DMT_NDq0.js";import{_ as G}from"./CardDescription.vue_vue_type_script_setup_true_lang-BxkDfeDR.js";import{_ as H}from"./CardHeader.vue_vue_type_script_setup_true_lang-CGqIWGeD.js";import{_ as O}from"./CardTitle.vue_vue_type_script_setup_true_lang-DLaLEZPb.js";import{_ as q,a as z,b as R,c as W,d as X,e as I,f as J,g as Q,h as Y}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-vpNARrZl.js";import{_ as L}from"./index-N1u60vhI.js";import"./index-CMWG4mbA.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-DU4k6tzW.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-BasOtxZI.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-C9WGGbb6.js";import"./index-DqFeuJ-n.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CKeFYOA5.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-sGxRETQ-.js";const ya={class:"rounded-xl p-4 space-y-6 py-6"},ha={class:"mb-6 flex items-center gap-4"},wa={class:"space-y-2"},$a={key:0,class:"flex items-center gap-2"},Ca={key:1,class:"text-muted-foreground"},Sa={class:"flex flex-col"},ja={class:"flex items-center gap-2"},Pa={class:"font-medium"},La={class:"text-xs text-muted-foreground"},Va={key:0,class:"text-sm text-destructive"},Ea={key:0,class:"rounded-lg bg-muted p-4 space-y-2"},Ta={class:"flex items-center gap-2 text-sm"},Ma={class:"flex items-center gap-2 text-sm"},Ka={class:"flex items-center gap-2 text-sm"},Ua={class:"space-y-2"},Ba={class:"space-y-2"},Da={key:0,class:"flex items-center gap-2"},Na={key:1},Aa={key:2,class:"text-muted-foreground"},Fa={class:"flex items-center gap-2"},Ga={key:0,class:"text-sm text-destructive"},Ha={class:"rounded-lg border border-blue-200 bg-blue-50 p-4 dark:border-blue-800 dark:bg-blue-950"},Oa={class:"flex items-start gap-3"},qa={class:"flex items-center gap-4"},ue=ta({__name:"Create",props:{customers:{},provinces:{},assignedKabupaten:{}},setup(V){const _=V,i=sa({customer_id:null,stockist_kabupaten_id:null,stockist_kabupaten_name:"",stockist_province_id:null,stockist_province_name:""}),b=c(!1),g=c(""),f=c(null),x=c([]),y=c(!1),h=c(!1),p=M(()=>_.customers.find(o=>o.id===i.customer_id)||null),Z=M(()=>{if(!g.value)return _.customers;const o=g.value.toLowerCase();return _.customers.filter(e=>e.name.toLowerCase().includes(o)||e.ewallet_id.toLowerCase().includes(o)||e.email.toLowerCase().includes(o))});la(f,async o=>{if(!o){x.value=[],i.stockist_kabupaten_id=null,i.stockist_kabupaten_name="",i.stockist_province_id=null,i.stockist_province_name="";return}const e=_.provinces.find(n=>n.id===o);e&&(i.stockist_province_id=e.id,i.stockist_province_name=e.name),i.stockist_kabupaten_id=null,i.stockist_kabupaten_name="",y.value=!0;try{const n=`${ca.url()}?province_id=${o}`,T=await fetch(n,{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(!T.ok)throw new Error("Failed to fetch cities");x.value=await T.json()}catch{C.error("Gagal memuat daftar kota"),x.value=[]}finally{y.value=!1}});const aa=o=>{i.stockist_kabupaten_id=o.id,i.stockist_kabupaten_name=o.name,h.value=!1},E=o=>_.assignedKabupaten.includes(o),ea=()=>{i.post(fa.url(),{onSuccess:()=>{C.success("Stokist berhasil ditambahkan")},onError:o=>{const e=Object.values(o)[0];e&&C.error(e)}})};return(o,e)=>(u(),k(_a,null,{default:s(()=>[t(a(na),{title:"Tambah Stokist"}),l("div",ya,[l("div",ha,[t(a(K),{href:a(D).url()},{default:s(()=>[t(a(v),{variant:"outline",size:"icon"},{default:s(()=>[t(a(ia),{class:"h-4 w-4"})]),_:1})]),_:1},8,["href"]),e[4]||(e[4]=l("div",null,[l("h1",{class:"text-3xl font-bold tracking-tight"},"Tambah Stokist"),l("p",{class:"text-muted-foreground"}," Pilih pelanggan dan tentukan kabupaten/kota untuk dijadikan stokist ")],-1))]),l("form",{onSubmit:oa(ea,["prevent"]),class:"space-y-6 max-w-2xl"},[t(a(A),null,{default:s(()=>[t(a(H),null,{default:s(()=>[t(a(O),{class:"flex items-center gap-2"},{default:s(()=>[t(a(da),{class:"h-5 w-5"}),e[5]||(e[5]=d(" Pilih Pelanggan ",-1))]),_:1}),t(a(G),null,{default:s(()=>[...e[6]||(e[6]=[d(" Pilih pelanggan aktif yang akan dijadikan stokist. Hanya pelanggan yang belum menjadi stokist yang ditampilkan. ",-1)])]),_:1})]),_:1}),t(a(F),{class:"space-y-4"},{default:s(()=>[l("div",wa,[t(a(P),null,{default:s(()=>[...e[7]||(e[7]=[d("Pelanggan ",-1),l("span",{class:"text-destructive"},"*",-1)])]),_:1}),t(a(q),{open:b.value,"onUpdate:open":e[1]||(e[1]=n=>b.value=n)},{default:s(()=>[t(a(z),{"as-child":""},{default:s(()=>[t(a(v),{variant:"outline",role:"combobox","aria-expanded":b.value,class:$(["w-full justify-between",{"border-destructive":a(i).errors.customer_id}])},{default:s(()=>[p.value?(u(),m("span",$a,[t(a(L),{variant:"secondary",class:"font-mono"},{default:s(()=>[d(r(p.value.ewallet_id),1)]),_:1}),d(" "+r(p.value.name),1)])):(u(),m("span",Ca,"Pilih pelanggan...")),t(a(U),{class:"ml-2 h-4 w-4 shrink-0 opacity-50"})]),_:1},8,["aria-expanded","class"])]),_:1}),t(a(R),{class:"w-[400px] p-0"},{default:s(()=>[t(a(W),null,{default:s(()=>[t(a(X),{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=n=>g.value=n),placeholder:"Cari nama, ewallet ID, atau email..."},null,8,["modelValue"]),t(a(I),null,{default:s(()=>[t(a(J),null,{default:s(()=>[...e[8]||(e[8]=[d("Tidak ada pelanggan ditemukan.",-1)])]),_:1}),t(a(Q),null,{default:s(()=>[(u(!0),m(S,null,j(Z.value,n=>(u(),k(a(Y),{key:n.id,value:n.name,onSelect:()=>{a(i).customer_id=n.id,b.value=!1},class:"flex items-center gap-2"},{default:s(()=>[t(a(B),{class:$(a(N)("mr-2 h-4 w-4",a(i).customer_id===n.id?"opacity-100":"opacity-0"))},null,8,["class"]),l("div",Sa,[l("div",ja,[t(a(L),{variant:"outline",class:"font-mono text-xs"},{default:s(()=>[d(r(n.ewallet_id),1)]),_:2},1024),l("span",Pa,r(n.name),1)]),l("span",La,r(n.email),1)])]),_:2},1032,["value","onSelect"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),a(i).errors.customer_id?(u(),m("p",Va,r(a(i).errors.customer_id),1)):w("",!0),e[9]||(e[9]=l("p",{class:"text-sm text-muted-foreground"}," Pilih pelanggan yang akan bertanggung jawab sebagai stokist di wilayah tertentu. ",-1))]),p.value?(u(),m("div",Ea,[l("div",Ta,[e[10]||(e[10]=l("span",{class:"font-medium"},"Nama:",-1)),l("span",null,r(p.value.name),1)]),l("div",Ma,[e[11]||(e[11]=l("span",{class:"font-medium"},"Email:",-1)),l("span",null,r(p.value.email),1)]),l("div",Ka,[e[12]||(e[12]=l("span",{class:"font-medium"},"Telepon:",-1)),l("span",null,r(p.value.phone||"-"),1)])])):w("",!0)]),_:1})]),_:1}),t(a(A),null,{default:s(()=>[t(a(H),null,{default:s(()=>[t(a(O),{class:"flex items-center gap-2"},{default:s(()=>[t(a(ua),{class:"h-5 w-5"}),e[13]||(e[13]=d(" Wilayah Stokist ",-1))]),_:1}),t(a(G),null,{default:s(()=>[...e[14]||(e[14]=[d(" Tentukan kota yang akan dijadikan wilayah stokist. Setiap kota hanya dapat memiliki 1 stokist. ",-1)])]),_:1})]),_:1}),t(a(F),{class:"space-y-4"},{default:s(()=>[l("div",Ua,[t(a(P),null,{default:s(()=>[...e[15]||(e[15]=[d("Provinsi ",-1),l("span",{class:"text-destructive"},"*",-1)])]),_:1}),t(a(ka),{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=n=>f.value=n)},{default:s(()=>[t(a(va),null,{default:s(()=>[t(a(ba),{placeholder:"Pilih provinsi..."})]),_:1}),t(a(ga),null,{default:s(()=>[(u(!0),m(S,null,j(V.provinces,n=>(u(),k(a(xa),{key:n.id,value:n.id},{default:s(()=>[d(r(n.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),e[16]||(e[16]=l("p",{class:"text-sm text-muted-foreground"}," Pilih provinsi terlebih dahulu untuk menampilkan daftar kabupaten/kota. ",-1))]),l("div",Ba,[t(a(P),null,{default:s(()=>[...e[17]||(e[17]=[d("Kota ",-1),l("span",{class:"text-destructive"},"*",-1)])]),_:1}),t(a(q),{open:h.value,"onUpdate:open":e[3]||(e[3]=n=>h.value=n)},{default:s(()=>[t(a(z),{"as-child":""},{default:s(()=>[t(a(v),{variant:"outline",role:"combobox","aria-expanded":h.value,class:$(["w-full justify-between",{"border-destructive":a(i).errors.stockist_kabupaten_id}]),disabled:!f.value||y.value},{default:s(()=>[y.value?(u(),m("span",Da,[t(a(ra),{class:"h-4 w-4 animate-spin"}),e[18]||(e[18]=d(" Memuat... ",-1))])):a(i).stockist_kabupaten_name?(u(),m("span",Na,r(a(i).stockist_kabupaten_name),1)):(u(),m("span",Aa,r(f.value?"Pilih kota...":"Pilih provinsi terlebih dahulu"),1)),t(a(U),{class:"ml-2 h-4 w-4 shrink-0 opacity-50"})]),_:1},8,["aria-expanded","class","disabled"])]),_:1}),t(a(R),{class:"w-[400px] p-0"},{default:s(()=>[t(a(W),null,{default:s(()=>[t(a(X),{placeholder:"Cari kota..."}),t(a(I),null,{default:s(()=>[t(a(J),null,{default:s(()=>[...e[19]||(e[19]=[d("Tidak ada kota ditemukan.",-1)])]),_:1}),t(a(Q),null,{default:s(()=>[(u(!0),m(S,null,j(x.value,n=>(u(),k(a(Y),{key:n.id,value:n.name,disabled:E(n.id),onSelect:()=>aa(n),class:"flex items-center justify-between"},{default:s(()=>[l("div",Fa,[t(a(B),{class:$(a(N)("mr-2 h-4 w-4",a(i).stockist_kabupaten_id===n.id?"opacity-100":"opacity-0"))},null,8,["class"]),l("span",null,r(n.name),1)]),E(n.id)?(u(),k(a(L),{key:0,variant:"secondary",class:"text-xs"},{default:s(()=>[...e[20]||(e[20]=[d(" Sudah ada stokist ",-1)])]),_:1})):w("",!0)]),_:2},1032,["value","disabled","onSelect"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),a(i).errors.stockist_kabupaten_id?(u(),m("p",Ga,r(a(i).errors.stockist_kabupaten_id),1)):w("",!0),e[21]||(e[21]=l("p",{class:"text-sm text-muted-foreground"}," Kota yang sudah memiliki stokist akan ditandai dan tidak dapat dipilih. ",-1))])]),_:1})]),_:1}),l("div",Ha,[l("div",Oa,[t(a(ma),{class:"h-5 w-5 text-blue-600 dark:text-blue-400 mt-0.5"}),e[22]||(e[22]=l("div",{class:"text-sm text-blue-700 dark:text-blue-300"},[l("p",{class:"font-medium"},"Informasi"),l("p",{class:"mt-1"}," Setelah pelanggan dijadikan stokist, mereka akan bertanggung jawab atas distribusi produk di wilayah kota yang ditentukan. Setiap kota hanya dapat memiliki 1 stokist aktif. ")],-1))])]),l("div",qa,[t(a(v),{type:"submit",disabled:a(i).processing},{default:s(()=>[t(a(pa),{class:"mr-2 h-4 w-4"}),d(" "+r(a(i).processing?"Menyimpan...":"Simpan Stokist"),1)]),_:1},8,["disabled"]),t(a(K),{href:a(D).url()},{default:s(()=>[t(a(v),{variant:"outline",type:"button"},{default:s(()=>[...e[23]||(e[23]=[d("Batal",-1)])]),_:1})]),_:1},8,["href"])])],32)])]),_:1}))}});export{ue as default};
