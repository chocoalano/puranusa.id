import{L as ee,M as te,_ as ae}from"./AppLayout.vue_vue_type_script_setup_true_lang-bcsz1tEe.js";import{d as C,v as x,g as f,b as l,u as t,w as i,s as w,ax as le,e as g,K as S,at as se,aS as re,aB as ne,ac as J,ad as K,Z as ie,aa as oe,F as k,x as F,c as h,t as Z,r as D,D as H,Q as j,q as ue,y as de,n as u,bC as ce,X as me,ao as fe,aM as pe,A as ge,B as we,E as G,j as Y,a1 as ve,bu as A}from"./vendor-DmSXq5eN.js";import{_ as V,a as M}from"./CardContent.vue_vue_type_script_setup_true_lang-_1UsOj1j.js";import{_ as T}from"./CardHeader.vue_vue_type_script_setup_true_lang-D4bDsMGa.js";import{_ as W}from"./CardTitle.vue_vue_type_script_setup_true_lang-Bj0VpeXV.js";import{f as xe}from"./currency-DfrMaoZy.js";import{_ as _e}from"./Pagination.vue_vue_type_script_setup_true_lang-ejQGcEoF.js";import{_ as B,v as P}from"./index-CZrke-cb.js";import{_ as he}from"./Input.vue_vue_type_script_setup_true_lang-Oy3zhfwy.js";import{_ as be,a as ye,b as ke,c as De,d as U}from"./SelectValue.vue_vue_type_script_setup_true_lang-CstBw1Qc.js";import{_ as je,a as $e,b as Se}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-pb5xULWW.js";import{_ as Fe}from"./DropdownMenuCheckboxItem.vue_vue_type_script_setup_true_lang-CtpnfcE2.js";import{_ as Ce,a as Re,c as Ae,b as E,d as Ve,e as L}from"./TableHeader.vue_vue_type_script_setup_true_lang-QP8FR1Pn.js";import{_ as Q}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-DQF_LabE.js";import{_ as Me}from"./index-dZyugrTC.js";import{u as Te}from"./usePermissions-Cx4fk-e4.js";import"./index-CMWG4mbA.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-BMZwzIZd.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-BL7Uc97k.js";import"./index-B_n2dl-_.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-361jQ8Ze.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-BtwiMKEj.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-CJvHroM2.js";const We={class:"grid gap-4 md:grid-cols-4"},Ue={class:"text-2xl font-bold"},Be={class:"text-2xl font-bold"},Ke={class:"text-2xl font-bold"},Ie={class:"text-2xl font-bold"},Ne=C({__name:"WithdrawalStatistics",props:{statistics:{}},setup(e){return(o,s)=>(f(),x("div",We,[l(t(V),null,{default:i(()=>[l(t(T),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:i(()=>[l(t(W),{class:"text-sm font-medium"},{default:i(()=>[...s[0]||(s[0]=[w("Pending",-1)])]),_:1}),l(t(le),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),l(t(M),null,{default:i(()=>[g("div",Ue,S(e.statistics.total_pending),1),s[1]||(s[1]=g("p",{class:"text-xs text-muted-foreground"},"Menunggu persetujuan",-1))]),_:1})]),_:1}),l(t(V),null,{default:i(()=>[l(t(T),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:i(()=>[l(t(W),{class:"text-sm font-medium"},{default:i(()=>[...s[2]||(s[2]=[w("Disetujui",-1)])]),_:1}),l(t(se),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),l(t(M),null,{default:i(()=>[g("div",Be,S(e.statistics.total_completed),1),s[3]||(s[3]=g("p",{class:"text-xs text-muted-foreground"},"Withdrawal selesai",-1))]),_:1})]),_:1}),l(t(V),null,{default:i(()=>[l(t(T),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:i(()=>[l(t(W),{class:"text-sm font-medium"},{default:i(()=>[...s[4]||(s[4]=[w("Ditolak",-1)])]),_:1}),l(t(re),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),l(t(M),null,{default:i(()=>[g("div",Ke,S(e.statistics.total_failed),1),s[5]||(s[5]=g("p",{class:"text-xs text-muted-foreground"},"Withdrawal gagal",-1))]),_:1})]),_:1}),l(t(V),null,{default:i(()=>[l(t(T),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:i(()=>[l(t(W),{class:"text-sm font-medium"},{default:i(()=>[...s[6]||(s[6]=[w("Total Nominal",-1)])]),_:1}),l(t(ne),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),l(t(M),null,{default:i(()=>[g("div",Ie,S(t(xe)(e.statistics.total_amount)),1),s[7]||(s[7]=g("p",{class:"text-xs text-muted-foreground"},"Total withdrawal berhasil",-1))]),_:1})]),_:1})]))}}),Pe={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},Ee={class:"flex flex-1 gap-4"},qe={class:"relative flex-1 max-w-sm"},Oe=C({__name:"WithdrawalFiltersBar",props:J({table:{}},{search:{default:""},searchModifiers:{},statusFilter:{default:"all"},statusFilterModifiers:{}}),emits:["update:search","update:statusFilter"],setup(e){const o=K(e,"search"),s=K(e,"statusFilter");return(d,r)=>(f(),x("div",Pe,[g("div",Ee,[g("div",qe,[l(t(ie),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),l(t(he),{modelValue:o.value,"onUpdate:modelValue":r[0]||(r[0]=c=>o.value=c),placeholder:"Cari pelanggan atau referensi...",class:"pl-9"},null,8,["modelValue"])]),l(t(be),{modelValue:s.value,"onUpdate:modelValue":r[1]||(r[1]=c=>s.value=c)},{default:i(()=>[l(t(ye),{class:"w-[180px]"},{default:i(()=>[l(t(ke),{placeholder:"Semua Status"})]),_:1}),l(t(De),null,{default:i(()=>[l(t(U),{value:"all"},{default:i(()=>[...r[2]||(r[2]=[w("Semua Status",-1)])]),_:1}),l(t(U),{value:"pending"},{default:i(()=>[...r[3]||(r[3]=[w("Pending",-1)])]),_:1}),l(t(U),{value:"completed"},{default:i(()=>[...r[4]||(r[4]=[w("Completed",-1)])]),_:1}),l(t(U),{value:"failed"},{default:i(()=>[...r[5]||(r[5]=[w("Failed",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),l(t(je),null,{default:i(()=>[l(t($e),{"as-child":""},{default:i(()=>[l(t(B),{variant:"outline",class:"ml-auto"},{default:i(()=>[r[6]||(r[6]=w(" Kolom ",-1)),l(t(oe),{class:"ml-2 h-4 w-4"})]),_:1})]),_:1}),l(t(Se),{align:"end"},{default:i(()=>[(f(!0),x(k,null,F(e.table.getAllColumns().filter(c=>c.getCanHide()),c=>(f(),h(t(Fe),{key:c.id,class:"capitalize","model-value":c.getIsVisible(),"onUpdate:modelValue":_=>c.toggleVisibility(!!_)},{default:i(()=>[w(S(c.id),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})]))}}),ze={class:"rounded-md border"},He=C({__name:"WithdrawalTable",props:{table:{},columns:{},FlexRender:{}},setup(e){return(o,s)=>(f(),x("div",ze,[l(t(Ce),null,{default:i(()=>[l(t(Re),null,{default:i(()=>[(f(!0),x(k,null,F(e.table.getHeaderGroups(),d=>(f(),h(t(E),{key:d.id},{default:i(()=>[(f(!0),x(k,null,F(d.headers,r=>(f(),h(t(Ae),{key:r.id},{default:i(()=>[r.isPlaceholder?Z("",!0):(f(),h(t(e.FlexRender),{key:0,render:r.column.columnDef.header,props:r.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),l(t(Ve),null,{default:i(()=>[e.table.getRowModel().rows?.length?(f(!0),x(k,{key:0},F(e.table.getRowModel().rows,d=>(f(),h(t(E),{key:d.id},{default:i(()=>[(f(!0),x(k,null,F(d.getVisibleCells(),r=>(f(),h(t(L),{key:r.id},{default:i(()=>[l(t(e.FlexRender),{render:r.column.columnDef.cell,props:r.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1024))),128)):(f(),h(t(E),{key:1},{default:i(()=>[l(t(L),{colspan:e.columns.length,class:"h-24 text-center"},{default:i(()=>[...s[0]||(s[0]=[w(" Tidak ada permintaan withdrawal. ",-1)])]),_:1},8,["colspan"])]),_:1}))]),_:1})]),_:1})]))}}),y=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e??0),Le=e=>new Date(e).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),Qe=e=>({pending:"secondary",completed:"default",failed:"destructive"})[e]||"secondary",Xe=C({__name:"WithdrawalActionDialogs",props:{approveDialog:{required:!0},approveDialogModifiers:{},rejectDialog:{required:!0},rejectDialogModifiers:{}},emits:J(["approve","reject"],["update:approveDialog","update:rejectDialog"]),setup(e){const o=K(e,"approveDialog"),s=K(e,"rejectDialog");return(d,r)=>(f(),x(k,null,[l(Q,{open:o.value.open,"onUpdate:open":r[0]||(r[0]=c=>o.value.open=c),title:"Setujui Withdrawal?",description:`Apakah Anda yakin ingin menyetujui permintaan withdrawal sebesar ${o.value.withdrawal?t(y)(o.value.withdrawal.amount):""} untuk ${o.value.withdrawal?.customer.name}? Dana akan ditransfer via Midtrans ke rekening tujuan.`,"confirm-text":"Setujui & Transfer","cancel-text":"Batal",onConfirm:r[1]||(r[1]=c=>d.$emit("approve"))},null,8,["open","description"]),l(Q,{open:s.value.open,"onUpdate:open":r[2]||(r[2]=c=>s.value.open=c),title:"Tolak Withdrawal?",description:`Apakah Anda yakin ingin menolak permintaan withdrawal sebesar ${s.value.withdrawal?t(y)(s.value.withdrawal.amount):""} dari ${s.value.withdrawal?.customer.name}?`,"confirm-text":"Tolak","cancel-text":"Batal",variant:"destructive",onConfirm:r[3]||(r[3]=c=>d.$emit("reject"))},null,8,["open","description"])],64))}});function Je(){const e=D({open:!1,withdrawal:null}),o=D({open:!1,withdrawal:null}),s=a=>e.value={open:!0,withdrawal:a},d=a=>o.value={open:!0,withdrawal:a},r=()=>e.value={open:!1,withdrawal:null},c=()=>o.value={open:!1,withdrawal:null};function _(a){if(!a)return"Terjadi kesalahan";if(typeof a=="string")return a;const n=Object.values(a)[0];if(typeof n=="string")return n;if(Array.isArray(n)&&typeof n[0]=="string")return n[0];const m=Object.keys(a)[0];return m||"Terjadi kesalahan"}return{approveDialog:e,rejectDialog:o,openApproveDialog:s,openRejectDialog:d,handleApprove:()=>{const a=e.value.withdrawal;if(!a)return;H({}).post(te.url(a.id),{preserveScroll:!0,onSuccess:m=>{const p=m.props.flash;if(p?.error){j.error(p.error);return}p?.success&&j.success(p.success),r()},onError:m=>{const p=m.approve||m.general||m.error||_(m);j.error(p),console.error("Error approving withdrawal:",m)}})},handleReject:()=>{const a=o.value.withdrawal;if(!a)return;H({}).post(ee.url(a.id),{preserveScroll:!0,onSuccess:m=>{const p=m.props.flash;if(p?.error){j.error(p.error);return}p?.success&&j.success(p.success),c()},onError:m=>{const p=m.approve||m.general||m.error||_(m);j.error(p),console.error("Error approving withdrawal:",m)}})}}}const X=e=>typeof e=="object"&&e!==null&&!Array.isArray(e),q=e=>{if(!e)return null;if(X(e))return e;if(typeof e=="string")try{const o=JSON.parse(e);return X(o)?o:null}catch{return null}return null};function Ze(e){const o=D([{id:"created_at",desc:!0}]),s=D([]),d=D({}),r=a=>({column:n})=>u(B,{variant:"ghost",onClick:()=>n.toggleSorting(n.getIsSorted()==="asc"),class:"-ml-4"},()=>[a,u(fe,{class:"ml-2 h-4 w-4"})]),{isSuperAdmin:c,isAdmin:_}=Te(),$=[{id:"index",header:()=>u("div",{class:"w-12"},"No"),cell:({row:a})=>{const n=a.index+1+(e.withdrawals.current_page-1)*e.withdrawals.per_page;return u("div",{class:"font-medium"},n)}},{accessorKey:"customer.name",header:r("Pelanggan"),cell:({row:a})=>{const n=a.original.customer;return u("div",[u("div",{class:"font-medium"},n.name),u("div",{class:"text-xs text-muted-foreground"},n.email)])}},{accessorKey:"customer.username",header:r("Username"),cell:({row:a})=>{const n=a.original.customer;return u("div",[u("div",{class:"font-medium"},n.username),u("div",{class:"text-xs text-muted-foreground"},n.email)])}},{accessorKey:"customer.ewallet_saldo",header:()=>"Saldo Sekarang",cell:({row:a})=>u("div",y(a.original.customer.ewallet_saldo))},{accessorKey:"balance_before",header:()=>"Saldo Sebelum",cell:({row:a})=>u("div",y(a.getValue("balance_before")))},{accessorKey:"amount",header:()=>"Penarikan",cell:({row:a})=>u("div",{class:"font-bold text-red-600"},y(a.getValue("amount")))},{id:"admin_fee",header:()=>"Biaya Admin",cell:({row:a})=>{const n=q(a.original.notes);return n?u("div",{class:"text-xs font-medium"},y(n.admin_fee??0)):u("div",{class:"text-xs text-muted-foreground"},"-")}},{id:"net_amount",header:()=>"Penarikan Net",cell:({row:a})=>{const n=q(a.original.notes);return n?u("div",{class:"text-xs font-medium"},y(n.net_amount??0)):u("div",{class:"text-xs text-muted-foreground"},"-")}},{id:"bank_destination",header:()=>"Rekening Tujuan",cell:({row:a})=>{const n=q(a.original.notes);return n?u("div",[u("div",{class:"text-xs font-medium"},`${n.bank_name} - ${n.bank_account}`),u("div",{class:"text-xs text-muted-foreground"},n.bank_holder)]):u("div",{class:"text-xs text-muted-foreground"},"-")}},{accessorKey:"transaction_ref",header:()=>"Referensi",cell:({row:a})=>u("div",{class:"font-mono text-xs"},a.getValue("transaction_ref"))},{accessorKey:"status",header:()=>"Status",cell:({row:a})=>{const n=a.getValue("status");return u(Me,{variant:Qe(n)},()=>n)}},{accessorKey:"created_at",header:()=>"Tanggal",cell:({row:a})=>u("div",{class:"text-sm"},Le(a.getValue("created_at")))},{id:"actions",header:()=>u("div",{class:"text-right"},"Aksi"),cell:({row:a})=>{const n=a.original;if(n.status!=="pending"&&(c||_))return null;const m=n.balance_before<n.amount;return u("div",{class:"flex justify-end gap-2"},[u(B,{size:"sm",onClick:()=>e.onApprove(n),disabled:m},()=>[u(ce,{class:"mr-1 h-4 w-4"}),"Setujui"]),u(B,{size:"sm",variant:"destructive",onClick:()=>e.onReject(n)},()=>[u(me,{class:"mr-1 h-4 w-4"}),"Tolak"])])}}];return{table:ue({get data(){return e.withdrawals.data},columns:$,getCoreRowModel:we(),getSortedRowModel:ge(),getFilteredRowModel:pe(),onSortingChange:a=>P(a,o),onColumnFiltersChange:a=>P(a,s),onColumnVisibilityChange:a=>P(a,d),state:{get sorting(){return o.value},get columnFilters(){return s.value},get columnVisibility(){return d.value}},manualSorting:!0}),columns:$,sorting:o,FlexRender:de}}function Ge(e,o,s=300){let d=null;G(e,()=>{d&&clearTimeout(d),d=setTimeout(o,s)},{deep:!0})}function Ye(e){const o=e.endpoint??"/admin/withdrawals",s=D(e.initialFilters.search||""),d=D(e.initialFilters.status||"all"),r=()=>({search:s.value||void 0,status:d.value!=="all"?d.value:void 0,sort_by:e.sorting.value[0]?.id||"created_at",sort_order:e.sorting.value[0]?.desc?"desc":"asc"}),c=()=>{Y.get(o,r(),{preserveState:!0,preserveScroll:!0})};return Ge([s,d],c,300),{search:s,statusFilter:d,buildQuery:r,go:c}}const et={class:"rounded-xl p-4 space-y-6 py-6"},Dt=C({__name:"Index",props:{withdrawals:{},statistics:{},filters:{}},setup(e){const o=e,{approveDialog:s,rejectDialog:d,openApproveDialog:r,openRejectDialog:c,handleApprove:_,handleReject:$}=Je(),{table:R,columns:a,sorting:n,FlexRender:m}=Ze({withdrawals:o.withdrawals,onApprove:r,onReject:c}),p=[{id:o.filters.sort_by||"created_at",desc:o.filters.sort_order==="desc"}];n.value=p;const{search:I,statusFilter:N,buildQuery:O}=Ye({initialFilters:o.filters,sorting:n,endpoint:"/admin/withdrawals"});return G(n,z=>{z.length&&Y.get("/admin/withdrawals",O(),{preserveState:!0,preserveScroll:!0})},{deep:!0}),(z,v)=>(f(),x(k,null,[l(t(ve),{title:"Permintaan Withdrawal"}),l(ae,null,{default:i(()=>[g("div",et,[v[4]||(v[4]=g("div",null,[g("h2",{class:"text-3xl font-bold tracking-tight"},"Permintaan Withdrawal"),g("p",{class:"text-muted-foreground"},"Kelola permintaan penarikan saldo dari pelanggan")],-1)),l(Ne,{statistics:e.statistics},null,8,["statistics"]),l(Oe,{table:t(R),search:t(I),"onUpdate:search":v[0]||(v[0]=b=>A(I)?I.value=b:null),statusFilter:t(N),"onUpdate:statusFilter":v[1]||(v[1]=b=>A(N)?N.value=b:null)},null,8,["table","search","statusFilter"]),l(He,{table:t(R),columns:t(a),FlexRender:t(m)},null,8,["table","columns","FlexRender"]),e.withdrawals.last_page>1?(f(),h(_e,{key:0,data:{current_page:e.withdrawals.current_page,last_page:e.withdrawals.last_page,per_page:e.withdrawals.per_page,from:(e.withdrawals.current_page-1)*e.withdrawals.per_page+1,to:Math.min(e.withdrawals.current_page*e.withdrawals.per_page,e.withdrawals.total),total:e.withdrawals.total},url:"/admin/withdrawals",filters:t(O)()},null,8,["data","filters"])):Z("",!0)]),l(Xe,{approveDialog:t(s),"onUpdate:approveDialog":v[2]||(v[2]=b=>A(s)?s.value=b:null),rejectDialog:t(d),"onUpdate:rejectDialog":v[3]||(v[3]=b=>A(d)?d.value=b:null),onApprove:t(_),onReject:t($)},null,8,["approveDialog","rejectDialog","onApprove","onReject"])]),_:1})],64))}});export{Dt as default};
