import{_ as ee,L as te,M as ae}from"./AppLayout.vue_vue_type_script_setup_true_lang-Hu_mZ1eB.js";import{d as H,v as h,g as u,b as s,u as e,w as l,s as c,aw as se,e as d,K as C,as as le,aR as re,aA as ne,r as x,q as oe,E as U,j as N,a0 as ie,c as v,t as P,Z as de,a9 as ue,F as y,x as k,y as W,n as r,D as z,an as L,bz as ce,X as me,aL as fe,A as pe,B as ge}from"./vendor-flWeloHs.js";import{_ as q}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-Cl2-SULB.js";import{_ as we}from"./Pagination.vue_vue_type_script_setup_true_lang-D5lnraLN.js";import{_ as V,a as j}from"./CardContent.vue_vue_type_script_setup_true_lang-DFr8PgO7.js";import{_ as D}from"./CardHeader.vue_vue_type_script_setup_true_lang-Cgov_qDz.js";import{_ as F}from"./CardTitle.vue_vue_type_script_setup_true_lang-BdUxjhrU.js";import{f as ve}from"./currency-DfrMaoZy.js";import{_ as _e}from"./index-BonpZqDt.js";import{_ as $,v as T}from"./index-D9Hie8NE.js";import{_ as xe,a as he,b as ye}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BLeUwnH4.js";import{_ as be}from"./DropdownMenuCheckboxItem.vue_vue_type_script_setup_true_lang-DlsQO5tE.js";import{_ as ke}from"./Input.vue_vue_type_script_setup_true_lang-BI8FpPnw.js";import{_ as $e,a as Ce,b as Se,c as Ve,d as R}from"./SelectValue.vue_vue_type_script_setup_true_lang-CnNjP2es.js";import{_ as je,a as De,b as A,c as Fe,d as Re,e as E}from"./TableHeader.vue_vue_type_script_setup_true_lang-Dhjk0EnN.js";import"./index-CMWG4mbA.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-D5yDigSh.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-Dv6VzhWI.js";import"./index-DqFeuJ-n.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BC4ik9Oa.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-BsQpZQb0.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-CL8LVL2o.js";const Te={class:"grid gap-4 md:grid-cols-4"},Ae={class:"text-2xl font-bold"},Ke={class:"text-2xl font-bold"},Me={class:"text-2xl font-bold"},Be={class:"text-2xl font-bold"},Ie=H({__name:"WithdrawalStatistics",props:{statistics:{}},setup(i){return(w,n)=>(u(),h("div",Te,[s(e(V),null,{default:l(()=>[s(e(D),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[s(e(F),{class:"text-sm font-medium"},{default:l(()=>[...n[0]||(n[0]=[c("Pending",-1)])]),_:1}),s(e(se),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),s(e(j),null,{default:l(()=>[d("div",Ae,C(i.statistics.total_pending),1),n[1]||(n[1]=d("p",{class:"text-xs text-muted-foreground"},"Menunggu persetujuan",-1))]),_:1})]),_:1}),s(e(V),null,{default:l(()=>[s(e(D),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[s(e(F),{class:"text-sm font-medium"},{default:l(()=>[...n[2]||(n[2]=[c("Disetujui",-1)])]),_:1}),s(e(le),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),s(e(j),null,{default:l(()=>[d("div",Ke,C(i.statistics.total_completed),1),n[3]||(n[3]=d("p",{class:"text-xs text-muted-foreground"},"Withdrawal selesai",-1))]),_:1})]),_:1}),s(e(V),null,{default:l(()=>[s(e(D),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[s(e(F),{class:"text-sm font-medium"},{default:l(()=>[...n[4]||(n[4]=[c("Ditolak",-1)])]),_:1}),s(e(re),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),s(e(j),null,{default:l(()=>[d("div",Me,C(i.statistics.total_failed),1),n[5]||(n[5]=d("p",{class:"text-xs text-muted-foreground"},"Withdrawal gagal",-1))]),_:1})]),_:1}),s(e(V),null,{default:l(()=>[s(e(D),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[s(e(F),{class:"text-sm font-medium"},{default:l(()=>[...n[6]||(n[6]=[c("Total Nominal",-1)])]),_:1}),s(e(ne),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),s(e(j),null,{default:l(()=>[d("div",Be,C(e(ve)(i.statistics.total_amount)),1),n[7]||(n[7]=d("p",{class:"text-xs text-muted-foreground"},"Total withdrawal berhasil",-1))]),_:1})]),_:1})]))}}),Ue={class:"rounded-xl p-4 space-y-6 py-6"},Ne={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},Pe={class:"flex flex-1 gap-4"},We={class:"relative flex-1 max-w-sm"},ze={class:"rounded-md border"},ct=H({__name:"Index",props:{withdrawals:{},statistics:{},filters:{}},setup(i){const w=i,n=x(w.filters.search||""),f=x(w.filters.status||"all"),_=x([{id:w.filters.sort_by||"created_at",desc:w.filters.sort_order==="desc"}]),K=x([]),M=x({}),p=x({open:!1,withdrawal:null}),g=x({open:!1,withdrawal:null}),b=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(t),X=t=>new Date(t).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),J=t=>({pending:"secondary",completed:"default",failed:"destructive"})[t]||"secondary",O=t=>{if(!t)return null;try{return JSON.parse(t)}catch{return null}},Z=t=>{p.value={open:!0,withdrawal:t}},G=()=>{if(!p.value.withdrawal)return;z({}).post(te.url(p.value.withdrawal.id),{preserveScroll:!0,onSuccess:()=>{p.value={open:!1,withdrawal:null}}})},Q=t=>{g.value={open:!0,withdrawal:t}},Y=()=>{if(!g.value.withdrawal)return;z({}).post(ae.url(g.value.withdrawal.id),{preserveScroll:!0,onSuccess:()=>{g.value={open:!1,withdrawal:null}}})},B=[{id:"index",header:()=>r("div",{class:"w-12"},"No"),cell:({row:t})=>{const a=t.index+1+(w.withdrawals.current_page-1)*w.withdrawals.per_page;return r("div",{class:"font-medium"},a)}},{accessorKey:"customer.name",header:({column:t})=>r($,{variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),class:"-ml-4"},()=>["Pelanggan",r(L,{class:"ml-2 h-4 w-4"})]),cell:({row:t})=>{const a=t.original.customer;return r("div",[r("div",{class:"font-medium"},a.name),r("div",{class:"text-xs text-muted-foreground"},a.email)])}},{accessorKey:"customer.username",header:({column:t})=>r($,{variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),class:"-ml-4"},()=>["Username",r(L,{class:"ml-2 h-4 w-4"})]),cell:({row:t})=>{const a=t.original.customer;return r("div",[r("div",{class:"font-medium"},a.name),r("div",{class:"text-xs text-muted-foreground"},a.email)])}},{accessorKey:"customer.ewallet_saldo",header:()=>"Saldo",cell:({row:t})=>r("div",b(t.original.customer.ewallet_saldo))},{accessorKey:"amount",header:()=>"Penarikan",cell:({row:t})=>r("div",{class:"font-bold text-red-600"},b(t.getValue("amount")))},{accessorKey:"amount",header:()=>"Biaya Admin",cell:()=>r("div",{class:"font-bold text-red-600"},b(6500))},{accessorKey:"notes",header:()=>"Rekening Tujuan",cell:({row:t})=>{const a=O(t.getValue("notes"));return a?r("div",[r("div",{class:"text-xs font-medium"},`${a.bank_name} - ${a.bank_account}`),r("div",{class:"text-xs text-muted-foreground"},a.bank_holder)]):r("div",{class:"text-xs text-muted-foreground"},"-")}},{accessorKey:"transaction_ref",header:()=>"Referensi",cell:({row:t})=>r("div",{class:"font-mono text-xs"},t.getValue("transaction_ref"))},{accessorKey:"status",header:()=>"Status",cell:({row:t})=>{const a=t.getValue("status");return r(_e,{variant:J(a)},()=>a)}},{accessorKey:"created_at",header:()=>"Tanggal",cell:({row:t})=>r("div",{class:"text-sm"},X(t.getValue("created_at")))},{id:"actions",header:()=>r("div",{class:"text-right"},"Aksi"),cell:({row:t})=>{const a=t.original;if(a.status!=="pending")return null;const o=a.customer.ewallet_saldo<a.amount;return r("div",{class:"flex justify-end gap-2"},[r($,{size:"sm",onClick:()=>Z(a),disabled:o},()=>[r(ce,{class:"mr-1 h-4 w-4"}),"Setujui"]),r($,{size:"sm",variant:"destructive",onClick:()=>Q(a)},()=>[r(me,{class:"mr-1 h-4 w-4"}),"Tolak"])])}}],S=oe({get data(){return w.withdrawals.data},columns:B,getCoreRowModel:ge(),getSortedRowModel:pe(),getFilteredRowModel:fe(),onSortingChange:t=>T(t,_),onColumnFiltersChange:t=>T(t,K),onColumnVisibilityChange:t=>T(t,M),state:{get sorting(){return _.value},get columnFilters(){return K.value},get columnVisibility(){return M.value}},manualSorting:!0});U(_,t=>{t.length>0&&N.get("/admin/withdrawals",{search:n.value||void 0,status:f.value!=="all"?f.value:void 0,sort_by:t[0].id,sort_order:t[0].desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},{deep:!0});let I;return U([n,f],()=>{clearTimeout(I),I=setTimeout(()=>{N.get("/admin/withdrawals",{search:n.value||void 0,status:f.value!=="all"?f.value:void 0,sort_by:_.value[0]?.id||"created_at",sort_order:_.value[0]?.desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},300)}),(t,a)=>(u(),h(y,null,[s(e(ie),{title:"Permintaan Withdrawal"}),s(ee,null,{default:l(()=>[d("div",Ue,[a[10]||(a[10]=d("div",null,[d("h2",{class:"text-3xl font-bold tracking-tight"},"Permintaan Withdrawal"),d("p",{class:"text-muted-foreground"},"Kelola permintaan penarikan saldo dari pelanggan")],-1)),s(Ie,{statistics:i.statistics},null,8,["statistics"]),d("div",Ne,[d("div",Pe,[d("div",We,[s(e(de),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),s(e(ke),{modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=o=>n.value=o),placeholder:"Cari pelanggan atau referensi...",class:"pl-9"},null,8,["modelValue"])]),s(e($e),{modelValue:f.value,"onUpdate:modelValue":a[1]||(a[1]=o=>f.value=o)},{default:l(()=>[s(e(Ce),{class:"w-[180px]"},{default:l(()=>[s(e(Se),{placeholder:"Semua Status"})]),_:1}),s(e(Ve),null,{default:l(()=>[s(e(R),{value:"all"},{default:l(()=>[...a[4]||(a[4]=[c("Semua Status",-1)])]),_:1}),s(e(R),{value:"pending"},{default:l(()=>[...a[5]||(a[5]=[c("Pending",-1)])]),_:1}),s(e(R),{value:"completed"},{default:l(()=>[...a[6]||(a[6]=[c("Completed",-1)])]),_:1}),s(e(R),{value:"failed"},{default:l(()=>[...a[7]||(a[7]=[c("Failed",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s(e(xe),null,{default:l(()=>[s(e(he),{"as-child":""},{default:l(()=>[s(e($),{variant:"outline",class:"ml-auto"},{default:l(()=>[a[8]||(a[8]=c(" Kolom ",-1)),s(e(ue),{class:"ml-2 h-4 w-4"})]),_:1})]),_:1}),s(e(ye),{align:"end"},{default:l(()=>[(u(!0),h(y,null,k(e(S).getAllColumns().filter(o=>o.getCanHide()),o=>(u(),v(e(be),{key:o.id,class:"capitalize","model-value":o.getIsVisible(),"onUpdate:modelValue":m=>{o.toggleVisibility(!!m)}},{default:l(()=>[c(C(o.id),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})]),d("div",ze,[s(e(je),null,{default:l(()=>[s(e(De),null,{default:l(()=>[(u(!0),h(y,null,k(e(S).getHeaderGroups(),o=>(u(),v(e(A),{key:o.id},{default:l(()=>[(u(!0),h(y,null,k(o.headers,m=>(u(),v(e(Fe),{key:m.id},{default:l(()=>[m.isPlaceholder?P("",!0):(u(),v(e(W),{key:0,render:m.column.columnDef.header,props:m.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),s(e(Re),null,{default:l(()=>[e(S).getRowModel().rows?.length?(u(!0),h(y,{key:0},k(e(S).getRowModel().rows,o=>(u(),v(e(A),{key:o.id},{default:l(()=>[(u(!0),h(y,null,k(o.getVisibleCells(),m=>(u(),v(e(E),{key:m.id},{default:l(()=>[s(e(W),{render:m.column.columnDef.cell,props:m.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1024))),128)):(u(),v(e(A),{key:1},{default:l(()=>[s(e(E),{colspan:B.length,class:"h-24 text-center"},{default:l(()=>[...a[9]||(a[9]=[c(" Tidak ada permintaan withdrawal. ",-1)])]),_:1},8,["colspan"])]),_:1}))]),_:1})]),_:1})]),i.withdrawals.last_page>1?(u(),v(we,{key:0,data:{current_page:i.withdrawals.current_page,last_page:i.withdrawals.last_page,per_page:i.withdrawals.per_page,from:(i.withdrawals.current_page-1)*i.withdrawals.per_page+1,to:Math.min(i.withdrawals.current_page*i.withdrawals.per_page,i.withdrawals.total),total:i.withdrawals.total},url:"/admin/withdrawals",filters:{search:n.value||void 0,status:f.value!=="all"?f.value:void 0,sort_by:_.value[0]?.id||"created_at",sort_order:_.value[0]?.desc?"desc":"asc"}},null,8,["data","filters"])):P("",!0)]),s(q,{open:p.value.open,"onUpdate:open":a[2]||(a[2]=o=>p.value.open=o),title:"Setujui Withdrawal?",description:`Apakah Anda yakin ingin menyetujui permintaan withdrawal sebesar ${p.value.withdrawal?b(p.value.withdrawal.amount):""} untuk ${p.value.withdrawal?.customer.name}? Dana akan ditransfer via Midtrans ke rekening tujuan.`,"confirm-text":"Setujui & Transfer","cancel-text":"Batal",onConfirm:G},null,8,["open","description"]),s(q,{open:g.value.open,"onUpdate:open":a[3]||(a[3]=o=>g.value.open=o),title:"Tolak Withdrawal?",description:`Apakah Anda yakin ingin menolak permintaan withdrawal sebesar ${g.value.withdrawal?b(g.value.withdrawal.amount):""} dari ${g.value.withdrawal?.customer.name}?`,"confirm-text":"Tolak","cancel-text":"Batal",variant:"destructive",onConfirm:Y},null,8,["open","description"])]),_:1})],64))}});export{ct as default};
