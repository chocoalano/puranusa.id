import{a9 as C,_ as ce,aa as fe,ab as pe,ac as ge}from"./AppLayout.vue_vue_type_script_setup_true_lang-DcdoyRoT.js";import{_ as I}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-DGxEEV5o.js";import{_ as _e}from"./Pagination.vue_vue_type_script_setup_true_lang-BvdBiQp-.js";import{_ as ve}from"./index-DdPgXMF5.js";import{_ as D,v as V}from"./index-B-HLTJ14.js";import{_ as H,a as L}from"./CardContent.vue_vue_type_script_setup_true_lang-D_ByHwkr.js";import{_ as E}from"./CardHeader.vue_vue_type_script_setup_true_lang-CnGfQ4dp.js";import{_ as q}from"./CardTitle.vue_vue_type_script_setup_true_lang-g8lPgvYF.js";import{_ as O}from"./Checkbox.vue_vue_type_script_setup_true_lang-CU0k7MP9.js";import{_ as be,a as xe,b as he,d as ye,e as z,c as W}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BccCC61Q.js";import{d as Re,r as m,d3 as Se,p as X,q as we,E as Y,j as B,v as b,g as i,b as t,w as l,u as s,e as r,ai as ke,t as T,s as u,F as x,am as Z,z as $e,a0 as Ce,a1 as De,Y as Ve,aA as Be,K as k,da as Fe,c as g,Z as Ae,x as F,y as G,n as o,D as J,as as Ie,aR as Te,an as Me,aL as Ue,A as je,B as Ke}from"./vendor-BcJu9AAH.js";import{_ as Pe}from"./Input.vue_vue_type_script_setup_true_lang-CtLoVYP_.js";import{_ as Ne,a as He,b as Le,c as Ee,d as M}from"./SelectValue.vue_vue_type_script_setup_true_lang-DOFahpuV.js";import{_ as qe,a as Oe,b as U,c as ze,d as We,e as Q}from"./TableHeader.vue_vue_type_script_setup_true_lang-DwjJXyuR.js";import"./index-CMWG4mbA.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-DREEJQRG.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-DzjjQG7k.js";import"./index-DqFeuJ-n.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-6ChEtU6y.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-DduvX08w.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-B39-Z3w4.js";const Xe={class:"flex h-full flex-1 flex-col gap-6 p-6"},Ye={class:"flex items-center justify-between"},Ze={class:"text-3xl font-bold tracking-tight flex items-center gap-2"},Ge={class:"grid gap-4 md:grid-cols-4"},Je={class:"text-2xl font-bold"},Qe={class:"text-xs text-muted-foreground"},es={class:"text-2xl font-bold text-green-600"},ss={class:"text-xs text-muted-foreground"},ts={class:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between"},as={class:"flex flex-1 items-center gap-4"},ls={class:"relative flex-1 md:max-w-sm"},ns={class:"rounded-md border"},Cs=Re({__name:"Index",props:{bonuses:{},statistics:{},filters:{}},setup(_){const c=_,ee=[{title:"Bonus Retail",href:C.url()}],h=m(c.filters.search||""),p=m(c.filters.status?.toString()||"all"),y=m([{id:c.filters.sort_by,desc:c.filters.sort_order==="desc"}]),j=m([]),K=m({}),R=m({}),[se,te]=Se(),v=m({open:!1,bonus:null}),f=m({open:!1,bonus:null}),$=m({open:!1}),ae=X(()=>Object.keys(R.value).map(e=>c.bonuses.data[parseInt(e)]).filter(Boolean)),S=X(()=>ae.value.filter(e=>e.status===0)),w=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e),le=e=>new Date(e).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),ne=e=>{v.value={open:!0,bonus:e}},oe=()=>{v.value.bonus&&B.delete(fe.url(v.value.bonus.id),{preserveScroll:!0,onSuccess:()=>{v.value={open:!1,bonus:null}}})},re=e=>{f.value={open:!0,bonus:e}},ie=()=>{if(!f.value.bonus)return;J({}).post(pe.url(f.value.bonus.id),{preserveScroll:!0,onSuccess:()=>{f.value={open:!1,bonus:null},R.value={}}})},ue=()=>{S.value.length&&($.value.open=!0)},de=()=>{const e=S.value.map(n=>n.id);J({ids:e}).post(ge.url(),{preserveScroll:!0,onSuccess:()=>{R.value={},$.value.open=!1}})},P=[{id:"select",header:({table:e})=>o(O,{modelValue:e.getIsAllPageRowsSelected()||e.getIsSomePageRowsSelected()&&"indeterminate","onUpdate:modelValue":a=>e.toggleAllPageRowsSelected(!!a),ariaLabel:"Select all"}),cell:({row:e})=>o(O,{modelValue:e.getIsSelected(),"onUpdate:modelValue":a=>e.toggleSelected(!!a),ariaLabel:"Select row"}),enableSorting:!1,enableHiding:!1},{id:"index",header:()=>o("div",{class:"w-12"},"No"),cell:({row:e})=>o("div",{class:"font-medium"},e.index+1+(c.bonuses.current_page-1)*c.bonuses.per_page)},{accessorKey:"member_name",header:()=>"Member",cell:({row:e})=>o("div",[o("div",{class:"font-medium"},e.original.member_name),o("div",{class:"text-xs text-muted-foreground"},e.original.member_ewallet_id)])},{accessorKey:"from_member_name",header:()=>"Dari Member",cell:({row:e})=>o("div",[o("div",{class:"font-medium"},e.original.from_member_name),o("div",{class:"text-xs text-muted-foreground"},e.original.from_member_ewallet_id)])},{accessorKey:"retail_value",header:()=>o("div",{class:"text-right"},"Nilai Retail"),cell:({row:e})=>o("div",{class:"text-right text-muted-foreground"},w(e.original.retail_value))},{accessorKey:"amount",header:()=>o("div",{class:"text-right"},"Bonus"),cell:({row:e})=>o("div",{class:"text-right font-medium"},w(e.original.amount))},{accessorKey:"status",header:()=>"Status",cell:({row:e})=>o(ve,{variant:e.original.status===1?"default":"secondary",class:"gap-1"},()=>[o(e.original.status===1?Ie:Te,{class:"h-3 w-3"}),e.original.status_text])},{accessorKey:"created_at",header:({column:e})=>o(D,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"-ml-4"},()=>["Tanggal",o(Me,{class:"ml-2 h-4 w-4"})]),cell:({row:e})=>le(e.getValue("created_at"))},{id:"actions",enableHiding:!1,cell:({row:e})=>o(te,{bonus:e.original,onRelease:()=>re(e.original),onDelete:()=>ne(e.original)})}],A=we({get data(){return c.bonuses.data},columns:P,getCoreRowModel:Ke(),getSortedRowModel:je(),getFilteredRowModel:Ue(),onSortingChange:e=>V(e,y),onColumnFiltersChange:e=>V(e,j),onColumnVisibilityChange:e=>V(e,K),onRowSelectionChange:e=>V(e,R),state:{get sorting(){return y.value},get columnFilters(){return j.value},get columnVisibility(){return K.value},get rowSelection(){return R.value}},manualSorting:!0,enableRowSelection:!0});Y(y,e=>{e.length>0&&B.get(C.url(),{search:h.value||void 0,status:p.value!=="all"?parseInt(p.value):void 0,sort_by:e[0].id,sort_order:e[0].desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},{deep:!0});let N;return Y([h,p],()=>{clearTimeout(N),N=setTimeout(()=>{B.get(C.url(),{search:h.value||void 0,status:p.value!=="all"?parseInt(p.value):void 0,sort_by:y.value[0]?.id||"created_at",sort_order:y.value[0]?.desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},300)}),(e,a)=>(i(),b(x,null,[t(s(se),null,{default:l(({bonus:n,onRelease:d,onDelete:me})=>[t(s(be),null,{default:l(()=>[t(s(xe),{"as-child":""},{default:l(()=>[t(s(D),{variant:"ghost",class:"h-8 w-8 p-0"},{default:l(()=>[a[6]||(a[6]=r("span",{class:"sr-only"},"Open menu",-1)),t(s(ke),{class:"h-4 w-4"})]),_:1})]),_:1}),t(s(he),{align:"end"},{default:l(()=>[t(s(ye),null,{default:l(()=>[...a[7]||(a[7]=[u("Actions",-1)])]),_:1}),n.status===0?(i(),b(x,{key:0},[t(s(z)),t(s(W),{onClick:d},{default:l(()=>[t(s(Z),{class:"mr-2 h-4 w-4"}),a[8]||(a[8]=u(" Release Bonus ",-1))]),_:1},8,["onClick"])],64)):T("",!0),t(s(z)),t(s(W),{class:"text-destructive",onClick:me},{default:l(()=>[t(s($e),{class:"mr-2 h-4 w-4"}),a[9]||(a[9]=u(" Hapus ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1}),t(ce,{breadcrumbs:ee},{default:l(()=>[t(s(Ce),{title:"Bonus Retail"}),r("div",Xe,[r("div",Ye,[r("div",null,[r("h1",Ze,[t(s(De),{class:"h-8 w-8"}),a[10]||(a[10]=u(" Bonus Retail ",-1))]),a[11]||(a[11]=r("p",{class:"text-muted-foreground"},"Kelola bonus retail dari penjualan member",-1))]),t(s(D),{onClick:a[0]||(a[0]=n=>s(B).visit("/bonus/retail/create"))},{default:l(()=>[t(s(Ve),{class:"mr-2 h-4 w-4"}),a[12]||(a[12]=u(" Tambah Bonus ",-1))]),_:1})]),r("div",Ge,[t(s(H),null,{default:l(()=>[t(s(E),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[t(s(q),{class:"text-sm font-medium"},{default:l(()=>[...a[13]||(a[13]=[u("Total Pending",-1)])]),_:1}),t(s(Be),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),t(s(L),null,{default:l(()=>[r("div",Je,k(w(_.statistics.total_pending)),1),r("p",Qe,k(_.statistics.count_pending)+" transaksi",1)]),_:1})]),_:1}),t(s(H),null,{default:l(()=>[t(s(E),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[t(s(q),{class:"text-sm font-medium"},{default:l(()=>[...a[14]||(a[14]=[u("Total Released",-1)])]),_:1}),t(s(Fe),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),t(s(L),null,{default:l(()=>[r("div",es,k(w(_.statistics.total_released)),1),r("p",ss,k(_.statistics.count_released)+" transaksi",1)]),_:1})]),_:1})]),r("div",ts,[r("div",as,[r("div",ls,[t(s(Ae),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),t(s(Pe),{modelValue:h.value,"onUpdate:modelValue":a[1]||(a[1]=n=>h.value=n),placeholder:"Cari member...",class:"pl-9"},null,8,["modelValue"])]),t(s(Ne),{modelValue:p.value,"onUpdate:modelValue":a[2]||(a[2]=n=>p.value=n)},{default:l(()=>[t(s(He),{class:"w-40"},{default:l(()=>[t(s(Le),{placeholder:"Semua Status"})]),_:1}),t(s(Ee),null,{default:l(()=>[t(s(M),{value:"all"},{default:l(()=>[...a[15]||(a[15]=[u("Semua Status",-1)])]),_:1}),t(s(M),{value:"0"},{default:l(()=>[...a[16]||(a[16]=[u("Pending",-1)])]),_:1}),t(s(M),{value:"1"},{default:l(()=>[...a[17]||(a[17]=[u("Released",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),S.value.length?(i(),g(s(D),{key:0,variant:"outline",onClick:ue},{default:l(()=>[t(s(Z),{class:"mr-2 h-4 w-4"}),u(" Release "+k(S.value.length)+" Bonus ",1)]),_:1})):T("",!0)]),r("div",ns,[t(s(qe),null,{default:l(()=>[t(s(Oe),null,{default:l(()=>[(i(!0),b(x,null,F(s(A).getHeaderGroups(),n=>(i(),g(s(U),{key:n.id},{default:l(()=>[(i(!0),b(x,null,F(n.headers,d=>(i(),g(s(ze),{key:d.id},{default:l(()=>[d.isPlaceholder?T("",!0):(i(),g(s(G),{key:0,render:d.column.columnDef.header,props:d.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),t(s(We),null,{default:l(()=>[s(A).getRowModel().rows?.length?(i(!0),b(x,{key:0},F(s(A).getRowModel().rows,n=>(i(),g(s(U),{key:n.id,"data-state":n.getIsSelected()&&"selected"},{default:l(()=>[(i(!0),b(x,null,F(n.getVisibleCells(),d=>(i(),g(s(Q),{key:d.id},{default:l(()=>[t(s(G),{render:d.column.columnDef.cell,props:d.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1032,["data-state"]))),128)):(i(),g(s(U),{key:1},{default:l(()=>[t(s(Q),{colspan:P.length,class:"h-24 text-center"},{default:l(()=>[...a[18]||(a[18]=[u("Tidak ada data.",-1)])]),_:1},8,["colspan"])]),_:1}))]),_:1})]),_:1})]),t(_e,{data:_.bonuses,url:s(C).url()},null,8,["data","url"])]),t(I,{open:v.value.open,title:"Hapus Bonus",description:"Apakah Anda yakin ingin menghapus bonus ini?","confirm-text":"Hapus","onUpdate:open":a[3]||(a[3]=n=>v.value.open=n),onConfirm:oe},null,8,["open"]),t(I,{open:f.value.open,title:"Release Bonus",description:`Apakah Anda yakin ingin merilis bonus sebesar ${f.value.bonus?w(f.value.bonus.amount):""} ke member?`,"confirm-text":"Release","onUpdate:open":a[4]||(a[4]=n=>f.value.open=n),onConfirm:ie},null,8,["open","description"]),t(I,{open:$.value.open,title:"Mass Release Bonus",description:`Apakah Anda yakin ingin merilis ${S.value.length} bonus yang dipilih?`,"confirm-text":"Release All","onUpdate:open":a[5]||(a[5]=n=>$.value.open=n),onConfirm:de},null,8,["open","description"])]),_:1})],64))}});export{Cs as default};
