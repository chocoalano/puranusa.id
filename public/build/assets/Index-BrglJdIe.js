import{M as I,N as de,_ as ce,P as me,Q as O,R as fe,S as pe}from"./AppLayout.vue_vue_type_script_setup_true_lang-BWDCecJb.js";import{_ as T}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-D8AYChA2.js";import{_ as ge}from"./Pagination.vue_vue_type_script_setup_true_lang-D1dwDX2q.js";import{_ as Q}from"./index-COroZ9V9.js";import{_ as v,v as M}from"./index-DPd1r_cX.js";import{_ as j,a as F}from"./CardContent.vue_vue_type_script_setup_true_lang-DM70BYA8.js";import{_ as U}from"./CardHeader.vue_vue_type_script_setup_true_lang-D25MJpMC.js";import{_ as A}from"./CardTitle.vue_vue_type_script_setup_true_lang-l0wDcl-m.js";import{_ as ve,a as _e,b as be}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DA-zofsy.js";import{_ as xe}from"./DropdownMenuCheckboxItem.vue_vue_type_script_setup_true_lang-Biukrt9b.js";import{_ as he}from"./Input.vue_vue_type_script_setup_true_lang-CqlAd_sW.js";import{_ as ye,a as ke,b as we,c as Se,d as K}from"./SelectValue.vue_vue_type_script_setup_true_lang-Bvtl-Sz4.js";import{_ as Ce,a as $e,b as N,c as Re,d as De,e as W}from"./TableHeader.vue_vue_type_script_setup_true_lang-DUQMK31p.js";import{d as Pe,r as c,p as q,q as Be,D as G,j as p,c as _,g as u,w as l,b as a,e as r,u as t,Z as Ve,v as S,t as X,s as d,cT as z,V as Ie,cQ as Te,J as y,ar as Me,an as Z,W as je,cR as Fe,a7 as Ue,F as R,x as D,y as Y,n as o,cv as Ae,b7 as Ke,ak as Ne,am as ze,z as He,aD as Le,A as Ee,B as Je}from"./vendor-CraqpIJ-.js";import"./index-B7Ms5jW_.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-BmdNsnpq.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-4BlfWucD.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BZHhRcHM.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-CQgGBfly.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-C2jUDPfA.js";const Oe={class:"rounded-xl p-4 space-y-6 py-6"},Qe={class:"flex items-center justify-between"},We={class:"flex gap-2"},qe={class:"grid gap-4 md:grid-cols-3"},Ge={class:"text-2xl font-bold"},Xe={class:"text-xs text-muted-foreground"},Ze={class:"text-2xl font-bold"},Ye={class:"text-xs text-muted-foreground"},et={class:"text-2xl font-bold"},tt={key:0,class:"flex items-center justify-between rounded-lg border bg-muted/50 p-4"},st={class:"text-sm font-medium"},at={class:"flex items-center gap-4"},lt={class:"relative flex-1"},nt={class:"rounded-md border"},$t=Pe({__name:"Index",props:{bonuses:{},statistics:{},filters:{}},setup(b){const g=b,ee=[{title:"Bonus Pairing",href:I.url()}],k=c(g.filters.search||""),m=c(g.filters.status?.toString()||"all"),x=c([{id:g.filters.sort_by,desc:g.filters.sort_order==="desc"}]),H=c([]),L=c({}),C=c({}),w=c({open:!1,bonus:null}),f=c({open:!1,bonus:null}),P=c({open:!1}),B=c({open:!1}),te=q(()=>Object.keys(C.value).map(s=>g.bonuses.data[parseInt(s)]).filter(Boolean)),h=q(()=>te.value.filter(s=>s.status===0)),$=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s),se=s=>new Date(s).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),ae=s=>{w.value={open:!0,bonus:s}},le=()=>{w.value.bonus&&p.delete(me.url(w.value.bonus.id),{preserveScroll:!0,onSuccess:()=>{w.value={open:!1,bonus:null}}})},ne=s=>{f.value={open:!0,bonus:s}},oe=()=>{f.value.bonus&&p.post(O.url(f.value.bonus.id),{},{preserveScroll:!0,onSuccess:()=>{f.value={open:!1,bonus:null},C.value={}}})},re=()=>{h.value.length&&(P.value.open=!0)},ie=()=>{const s=h.value.map(n=>n.id);let e=0;s.forEach(n=>{p.post(O.url(n),{},{preserveScroll:!0,onSuccess:()=>{e++,e===s.length&&(C.value={},P.value.open=!1,p.reload({only:["bonuses","statistics"]}))}})})},ue=()=>{p.post(fe.url(),{},{preserveScroll:!0,onSuccess:()=>{B.value.open=!1}})},E=[{id:"select",header:({table:s})=>o("input",{type:"checkbox",checked:s.getIsAllPageRowsSelected(),indeterminate:s.getIsSomePageRowsSelected(),onChange:s.getToggleAllPageRowsSelectedHandler(),class:"h-4 w-4 rounded border-gray-300"}),cell:({row:s})=>o("input",{type:"checkbox",checked:s.getIsSelected(),disabled:!s.getCanSelect(),onChange:s.getToggleSelectedHandler(),class:"h-4 w-4 rounded border-gray-300"}),enableSorting:!1},{id:"index",header:()=>o("div",{class:"w-12"},"No"),cell:({row:s})=>{const e=s.index+1+(g.bonuses.current_page-1)*g.bonuses.per_page;return o("div",{class:"font-medium"},e)}},{accessorKey:"member_name",header:()=>"Member",cell:({row:s})=>o("div",[o("div",{class:"font-medium"},s.original.member_name),o("div",{class:"text-xs text-muted-foreground"},s.original.member_ewallet_id)])},{accessorKey:"pair_count",header:()=>"Pasangan",cell:({row:s})=>o(Q,{variant:"outline",class:"gap-1"},()=>[o(z,{class:"h-3 w-3"}),`${s.original.pair_count} pasang`])},{accessorKey:"amount",header:()=>o("div",{class:"text-right"},"Jumlah"),cell:({row:s})=>o("div",{class:"text-right font-medium"},$(s.original.amount))},{accessorKey:"status",header:()=>"Status",cell:({row:s})=>{const e=s.original.status;return o(Q,{variant:e===1?"default":"secondary",class:"gap-1"},()=>[o(e===1?Ae:Ke,{class:"h-3 w-3"}),s.original.status_text])}},{accessorKey:"created_at",header:({column:s})=>o(v,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),class:"-ml-4"},()=>["Tanggal",o(Ne,{class:"ml-2 h-4 w-4"})]),cell:({row:s})=>se(s.getValue("created_at"))},{id:"actions",header:()=>o("div",{class:"text-right"},"Actions"),cell:({row:s})=>{const e=s.original;return o("div",{class:"flex justify-end gap-2"},[o(v,{variant:"outline",size:"sm",onClick:()=>p.visit(pe.url(e.id))},()=>o(ze,{class:"h-4 w-4"})),e.status===0?o(v,{variant:"default",size:"sm",onClick:()=>ne(e)},()=>o(Z,{class:"h-4 w-4"})):null,e.status===0?o(v,{variant:"outline",size:"sm",onClick:()=>ae(e)},()=>o(He,{class:"h-4 w-4 text-destructive"})):null])}}],V=Be({get data(){return g.bonuses.data},columns:E,getCoreRowModel:Je(),getSortedRowModel:Ee(),getFilteredRowModel:Le(),state:{get sorting(){return x.value},get columnFilters(){return H.value},get columnVisibility(){return L.value},get rowSelection(){return C.value}},onSortingChange:s=>M(s,x),onColumnFiltersChange:s=>M(s,H),onColumnVisibilityChange:s=>M(s,L),onRowSelectionChange:s=>M(s,C),manualSorting:!0,enableRowSelection:!0});G(x,s=>{s.length>0&&p.get(I.url(),{search:k.value||void 0,status:m.value!=="all"?parseInt(m.value):void 0,sort_by:s[0].id,sort_order:s[0].desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},{deep:!0});let J;return G([k,m],()=>{clearTimeout(J),J=setTimeout(()=>{p.get(I.url(),{search:k.value||void 0,status:m.value!=="all"?parseInt(m.value):void 0,sort_by:x.value[0]?.id||"created_at",sort_order:x.value[0]?.desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},300)}),(s,e)=>(u(),_(ce,{breadcrumbs:ee},{default:l(()=>[a(t(Ve),{title:"Bonus Pairing"}),r("div",Oe,[r("div",Qe,[e[10]||(e[10]=r("div",null,[r("h1",{class:"text-3xl font-bold tracking-tight"},"Bonus Pairing"),r("p",{class:"text-muted-foreground"},"Kelola bonus pairing binary tree")],-1)),r("div",We,[a(t(v),{variant:"outline",onClick:e[0]||(e[0]=n=>B.value.open=!0)},{default:l(()=>[a(t(z),{class:"h-4 w-4"}),e[8]||(e[8]=d(" Proses Semua Pairing ",-1))]),_:1}),a(t(v),{onClick:e[1]||(e[1]=n=>t(p).visit(t(de).url()))},{default:l(()=>[a(t(Ie),{class:"h-4 w-4"}),e[9]||(e[9]=d(" Proses Member ",-1))]),_:1})])]),r("div",qe,[a(t(j),null,{default:l(()=>[a(t(U),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[a(t(A),{class:"text-sm font-medium"},{default:l(()=>[...e[11]||(e[11]=[d("Total Pending",-1)])]),_:1}),a(t(Te),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(t(F),null,{default:l(()=>[r("div",Ge,y($(b.statistics.total_pending)),1),r("p",Xe,y(b.statistics.count_pending)+" bonus ",1)]),_:1})]),_:1}),a(t(j),null,{default:l(()=>[a(t(U),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[a(t(A),{class:"text-sm font-medium"},{default:l(()=>[...e[12]||(e[12]=[d("Total Released",-1)])]),_:1}),a(t(Me),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(t(F),null,{default:l(()=>[r("div",Ze,y($(b.statistics.total_released)),1),r("p",Ye,y(b.statistics.count_released)+" bonus ",1)]),_:1})]),_:1}),a(t(j),null,{default:l(()=>[a(t(U),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[a(t(A),{class:"text-sm font-medium"},{default:l(()=>[...e[13]||(e[13]=[d("Total Pairs Pending",-1)])]),_:1}),a(t(z),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(t(F),null,{default:l(()=>[r("div",et,y(b.statistics.total_pairs),1),e[14]||(e[14]=r("p",{class:"text-xs text-muted-foreground"}," pairs belum di-release ",-1))]),_:1})]),_:1})]),h.value.length>0?(u(),S("div",tt,[r("p",st,y(h.value.length)+" bonus pending dipilih ",1),a(t(v),{size:"sm",onClick:re},{default:l(()=>[a(t(Z),{class:"h-4 w-4"}),e[15]||(e[15]=d(" Release Semua ",-1))]),_:1})])):X("",!0),r("div",at,[r("div",lt,[a(t(je),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),a(t(he),{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=n=>k.value=n),placeholder:"Cari member atau deskripsi...",class:"pl-9"},null,8,["modelValue"])]),a(t(ye),{modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=n=>m.value=n)},{default:l(()=>[a(t(ke),{class:"w-40"},{default:l(()=>[a(t(we),{placeholder:"Semua Status"})]),_:1}),a(t(Se),null,{default:l(()=>[a(t(K),{value:"all"},{default:l(()=>[...e[16]||(e[16]=[d("Semua Status",-1)])]),_:1}),a(t(K),{value:"0"},{default:l(()=>[...e[17]||(e[17]=[d("Pending",-1)])]),_:1}),a(t(K),{value:"1"},{default:l(()=>[...e[18]||(e[18]=[d("Released",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(t(ve),null,{default:l(()=>[a(t(_e),{"as-child":""},{default:l(()=>[a(t(v),{variant:"outline",class:"ml-auto"},{default:l(()=>[a(t(Fe),{class:"h-4 w-4"}),e[19]||(e[19]=d(" Kolom ",-1)),a(t(Ue),{class:"ml-2 h-4 w-4"})]),_:1})]),_:1}),a(t(be),{align:"end"},{default:l(()=>[(u(!0),S(R,null,D(t(V).getAllColumns().filter(n=>n.getCanHide()),n=>(u(),_(t(xe),{key:n.id,class:"capitalize",checked:n.getIsVisible(),"onUpdate:checked":i=>n.toggleVisibility(!!i)},{default:l(()=>[d(y(n.id),1)]),_:2},1032,["checked","onUpdate:checked"]))),128))]),_:1})]),_:1})]),r("div",nt,[a(t(Ce),null,{default:l(()=>[a(t($e),null,{default:l(()=>[(u(!0),S(R,null,D(t(V).getHeaderGroups(),n=>(u(),_(t(N),{key:n.id},{default:l(()=>[(u(!0),S(R,null,D(n.headers,i=>(u(),_(t(Re),{key:i.id},{default:l(()=>[i.isPlaceholder?X("",!0):(u(),_(t(Y),{key:0,render:i.column.columnDef.header,props:i.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),a(t(De),null,{default:l(()=>[t(V).getRowModel().rows?.length?(u(!0),S(R,{key:0},D(t(V).getRowModel().rows,n=>(u(),_(t(N),{key:n.id,"data-state":n.getIsSelected()?"selected":void 0},{default:l(()=>[(u(!0),S(R,null,D(n.getVisibleCells(),i=>(u(),_(t(W),{key:i.id},{default:l(()=>[a(t(Y),{render:i.column.columnDef.cell,props:i.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1032,["data-state"]))),128)):(u(),_(t(N),{key:1},{default:l(()=>[a(t(W),{colspan:E.length,class:"h-24 text-center"},{default:l(()=>[...e[20]||(e[20]=[d(" Tidak ada data bonus. ",-1)])]),_:1},8,["colspan"])]),_:1}))]),_:1})]),_:1})]),a(ge,{data:b.bonuses,url:t(I).url(),filters:{search:k.value||void 0,status:m.value!=="all"?parseInt(m.value):void 0,sort_by:x.value[0]?.id,sort_order:x.value[0]?.desc?"desc":"asc"}},null,8,["data","url","filters"])]),a(T,{open:w.value.open,"onUpdate:open":e[4]||(e[4]=n=>w.value.open=n),title:"Hapus Bonus?",description:"Apakah Anda yakin ingin menghapus bonus ini? Tindakan ini tidak dapat dibatalkan.","confirm-text":"Hapus","cancel-text":"Batal",variant:"destructive",onConfirm:le},null,8,["open"]),a(T,{open:f.value.open,"onUpdate:open":e[5]||(e[5]=n=>f.value.open=n),title:"Release Bonus?",description:`Bonus sebesar ${f.value.bonus?$(f.value.bonus.amount):""} (${f.value.bonus?.pair_count} pasang) akan ditransfer ke ewallet member. Lanjutkan?`,"confirm-text":"Release","cancel-text":"Batal",onConfirm:oe},null,8,["open","description"]),a(T,{open:P.value.open,"onUpdate:open":e[6]||(e[6]=n=>P.value.open=n),title:`Release ${h.value.length} Bonus?`,description:`Total ${$(h.value.reduce((n,i)=>n+i.amount,0))} (${h.value.reduce((n,i)=>n+i.pair_count,0)} pasang) akan ditransfer ke ewallet member. Lanjutkan?`,"confirm-text":"Release Semua","cancel-text":"Batal",onConfirm:ie},null,8,["open","title","description"]),a(T,{open:B.value.open,"onUpdate:open":e[7]||(e[7]=n=>B.value.open=n),title:"Proses Semua Pairing?",description:"Sistem akan memproses bonus pairing untuk SEMUA member yang memiliki pasangan pending. Operasi ini biasanya dilakukan bulanan. Lanjutkan?","confirm-text":"Proses Semua","cancel-text":"Batal",onConfirm:ue},null,8,["open"])]),_:1}))}});export{$t as default};
