import{L as ee,M as te,_ as ae}from"./AppLayout.vue_vue_type_script_setup_true_lang-Dq658Cth.js";import{d as C,v as h,g as p,b as a,u as t,w as r,s as x,aw as le,e as w,K as F,as as se,aR as re,aA as ne,ab as J,ac as B,Z as ie,a9 as oe,F as j,x as R,c as b,t as Z,r as $,D as O,Q as S,q as ue,y as de,n as u,bz as ce,X as me,an as fe,aL as pe,A as ge,B as we,E as G,j as Y,a0 as ve,br as A}from"./vendor-flWeloHs.js";import{_ as V,a as M}from"./CardContent.vue_vue_type_script_setup_true_lang-DFr8PgO7.js";import{_ as T}from"./CardHeader.vue_vue_type_script_setup_true_lang-Cgov_qDz.js";import{_ as W}from"./CardTitle.vue_vue_type_script_setup_true_lang-BdUxjhrU.js";import{f as xe}from"./currency-DfrMaoZy.js";import{_ as _e}from"./Pagination.vue_vue_type_script_setup_true_lang-D5lnraLN.js";import{_ as K,v as P}from"./index-D9Hie8NE.js";import{_ as he}from"./Input.vue_vue_type_script_setup_true_lang-BI8FpPnw.js";import{_ as be,a as ye,b as ke,c as De,d as U}from"./SelectValue.vue_vue_type_script_setup_true_lang-CnNjP2es.js";import{_ as je,a as $e,b as Se}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BLeUwnH4.js";import{_ as Fe}from"./DropdownMenuCheckboxItem.vue_vue_type_script_setup_true_lang-DlsQO5tE.js";import{_ as Re,a as Ce,c as Ae,b as E,d as Ve,e as H}from"./TableHeader.vue_vue_type_script_setup_true_lang-Dhjk0EnN.js";import{_ as Q}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-Cl2-SULB.js";import{_ as Me}from"./index-BonpZqDt.js";import"./index-CMWG4mbA.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-D5yDigSh.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-Dv6VzhWI.js";import"./index-DqFeuJ-n.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BC4ik9Oa.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-BsQpZQb0.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-CL8LVL2o.js";const Te={class:"grid gap-4 md:grid-cols-4"},We={class:"text-2xl font-bold"},Ue={class:"text-2xl font-bold"},Ke={class:"text-2xl font-bold"},Be={class:"text-2xl font-bold"},Ie=C({__name:"WithdrawalStatistics",props:{statistics:{}},setup(e){return(o,l)=>(p(),h("div",Te,[a(t(V),null,{default:r(()=>[a(t(T),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:r(()=>[a(t(W),{class:"text-sm font-medium"},{default:r(()=>[...l[0]||(l[0]=[x("Pending",-1)])]),_:1}),a(t(le),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(t(M),null,{default:r(()=>[w("div",We,F(e.statistics.total_pending),1),l[1]||(l[1]=w("p",{class:"text-xs text-muted-foreground"},"Menunggu persetujuan",-1))]),_:1})]),_:1}),a(t(V),null,{default:r(()=>[a(t(T),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:r(()=>[a(t(W),{class:"text-sm font-medium"},{default:r(()=>[...l[2]||(l[2]=[x("Disetujui",-1)])]),_:1}),a(t(se),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(t(M),null,{default:r(()=>[w("div",Ue,F(e.statistics.total_completed),1),l[3]||(l[3]=w("p",{class:"text-xs text-muted-foreground"},"Withdrawal selesai",-1))]),_:1})]),_:1}),a(t(V),null,{default:r(()=>[a(t(T),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:r(()=>[a(t(W),{class:"text-sm font-medium"},{default:r(()=>[...l[4]||(l[4]=[x("Ditolak",-1)])]),_:1}),a(t(re),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(t(M),null,{default:r(()=>[w("div",Ke,F(e.statistics.total_failed),1),l[5]||(l[5]=w("p",{class:"text-xs text-muted-foreground"},"Withdrawal gagal",-1))]),_:1})]),_:1}),a(t(V),null,{default:r(()=>[a(t(T),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:r(()=>[a(t(W),{class:"text-sm font-medium"},{default:r(()=>[...l[6]||(l[6]=[x("Total Nominal",-1)])]),_:1}),a(t(ne),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(t(M),null,{default:r(()=>[w("div",Be,F(t(xe)(e.statistics.total_amount)),1),l[7]||(l[7]=w("p",{class:"text-xs text-muted-foreground"},"Total withdrawal berhasil",-1))]),_:1})]),_:1})]))}}),Ne={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},Pe={class:"flex flex-1 gap-4"},Ee={class:"relative flex-1 max-w-sm"},qe=C({__name:"WithdrawalFiltersBar",props:J({table:{}},{search:{default:""},searchModifiers:{},statusFilter:{default:"all"},statusFilterModifiers:{}}),emits:["update:search","update:statusFilter"],setup(e){const o=B(e,"search"),l=B(e,"statusFilter");return(d,s)=>(p(),h("div",Ne,[w("div",Pe,[w("div",Ee,[a(t(ie),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),a(t(he),{modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=c=>o.value=c),placeholder:"Cari pelanggan atau referensi...",class:"pl-9"},null,8,["modelValue"])]),a(t(be),{modelValue:l.value,"onUpdate:modelValue":s[1]||(s[1]=c=>l.value=c)},{default:r(()=>[a(t(ye),{class:"w-[180px]"},{default:r(()=>[a(t(ke),{placeholder:"Semua Status"})]),_:1}),a(t(De),null,{default:r(()=>[a(t(U),{value:"all"},{default:r(()=>[...s[2]||(s[2]=[x("Semua Status",-1)])]),_:1}),a(t(U),{value:"pending"},{default:r(()=>[...s[3]||(s[3]=[x("Pending",-1)])]),_:1}),a(t(U),{value:"completed"},{default:r(()=>[...s[4]||(s[4]=[x("Completed",-1)])]),_:1}),a(t(U),{value:"failed"},{default:r(()=>[...s[5]||(s[5]=[x("Failed",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),a(t(je),null,{default:r(()=>[a(t($e),{"as-child":""},{default:r(()=>[a(t(K),{variant:"outline",class:"ml-auto"},{default:r(()=>[s[6]||(s[6]=x(" Kolom ",-1)),a(t(oe),{class:"ml-2 h-4 w-4"})]),_:1})]),_:1}),a(t(Se),{align:"end"},{default:r(()=>[(p(!0),h(j,null,R(e.table.getAllColumns().filter(c=>c.getCanHide()),c=>(p(),b(t(Fe),{key:c.id,class:"capitalize","model-value":c.getIsVisible(),"onUpdate:modelValue":y=>c.toggleVisibility(!!y)},{default:r(()=>[x(F(c.id),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})]))}}),ze={class:"rounded-md border"},Le=C({__name:"WithdrawalTable",props:{table:{},columns:{},FlexRender:{}},setup(e){return(o,l)=>(p(),h("div",ze,[a(t(Re),null,{default:r(()=>[a(t(Ce),null,{default:r(()=>[(p(!0),h(j,null,R(e.table.getHeaderGroups(),d=>(p(),b(t(E),{key:d.id},{default:r(()=>[(p(!0),h(j,null,R(d.headers,s=>(p(),b(t(Ae),{key:s.id},{default:r(()=>[s.isPlaceholder?Z("",!0):(p(),b(t(e.FlexRender),{key:0,render:s.column.columnDef.header,props:s.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),a(t(Ve),null,{default:r(()=>[e.table.getRowModel().rows?.length?(p(!0),h(j,{key:0},R(e.table.getRowModel().rows,d=>(p(),b(t(E),{key:d.id},{default:r(()=>[(p(!0),h(j,null,R(d.getVisibleCells(),s=>(p(),b(t(H),{key:s.id},{default:r(()=>[a(t(e.FlexRender),{render:s.column.columnDef.cell,props:s.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1024))),128)):(p(),b(t(E),{key:1},{default:r(()=>[a(t(H),{colspan:e.columns.length,class:"h-24 text-center"},{default:r(()=>[...l[0]||(l[0]=[x(" Tidak ada permintaan withdrawal. ",-1)])]),_:1},8,["colspan"])]),_:1}))]),_:1})]),_:1})]))}}),D=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e??0),Oe=e=>new Date(e).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),He=e=>({pending:"secondary",completed:"default",failed:"destructive"})[e]||"secondary",Qe=C({__name:"WithdrawalActionDialogs",props:{approveDialog:{required:!0},approveDialogModifiers:{},rejectDialog:{required:!0},rejectDialogModifiers:{}},emits:J(["approve","reject"],["update:approveDialog","update:rejectDialog"]),setup(e){const o=B(e,"approveDialog"),l=B(e,"rejectDialog");return(d,s)=>(p(),h(j,null,[a(Q,{open:o.value.open,"onUpdate:open":s[0]||(s[0]=c=>o.value.open=c),title:"Setujui Withdrawal?",description:`Apakah Anda yakin ingin menyetujui permintaan withdrawal sebesar ${o.value.withdrawal?t(D)(o.value.withdrawal.amount):""} untuk ${o.value.withdrawal?.customer.name}? Dana akan ditransfer via Midtrans ke rekening tujuan.`,"confirm-text":"Setujui & Transfer","cancel-text":"Batal",onConfirm:s[1]||(s[1]=c=>d.$emit("approve"))},null,8,["open","description"]),a(Q,{open:l.value.open,"onUpdate:open":s[2]||(s[2]=c=>l.value.open=c),title:"Tolak Withdrawal?",description:`Apakah Anda yakin ingin menolak permintaan withdrawal sebesar ${l.value.withdrawal?t(D)(l.value.withdrawal.amount):""} dari ${l.value.withdrawal?.customer.name}?`,"confirm-text":"Tolak","cancel-text":"Batal",variant:"destructive",onConfirm:s[3]||(s[3]=c=>d.$emit("reject"))},null,8,["open","description"])],64))}});function Xe(){const e=$({open:!1,withdrawal:null}),o=$({open:!1,withdrawal:null}),l=f=>e.value={open:!0,withdrawal:f},d=f=>o.value={open:!0,withdrawal:f},s=()=>e.value={open:!1,withdrawal:null},c=()=>o.value={open:!1,withdrawal:null};function y(f){if(!f)return"Terjadi kesalahan";if(typeof f=="string")return f;const v=Object.values(f)[0];if(typeof v=="string")return v;if(Array.isArray(v)&&typeof v[0]=="string")return v[0];const m=Object.keys(f)[0];return m||"Terjadi kesalahan"}return{approveDialog:e,rejectDialog:o,openApproveDialog:l,openRejectDialog:d,handleApprove:()=>{const f=e.value.withdrawal;if(!f)return;O({}).post(te.url(f.id),{preserveScroll:!0,onSuccess:m=>{const g=m.props.flash;if(g?.error){S.error(g.error);return}g?.success&&S.success(g.success),s()},onError:m=>{const g=m.approve||m.general||m.error||y(m);S.error(g),console.error("Error approving withdrawal:",m)}})},handleReject:()=>{const f=o.value.withdrawal;if(!f)return;O({}).post(ee.url(f.id),{preserveScroll:!0,onSuccess:m=>{const g=m.props.flash;if(g?.error){S.error(g.error);return}g?.success&&S.success(g.success),c()},onError:m=>{const g=m.approve||m.general||m.error||y(m);S.error(g),console.error("Error approving withdrawal:",m)}})}}}const X=e=>typeof e=="object"&&e!==null&&!Array.isArray(e),q=e=>{if(!e)return null;if(X(e))return e;if(typeof e=="string")try{const o=JSON.parse(e);return X(o)?o:null}catch{return null}return null};function Je(e){const o=$([{id:"created_at",desc:!0}]),l=$([]),d=$({}),s=n=>({column:i})=>u(K,{variant:"ghost",onClick:()=>i.toggleSorting(i.getIsSorted()==="asc"),class:"-ml-4"},()=>[n,u(fe,{class:"ml-2 h-4 w-4"})]),c=[{id:"index",header:()=>u("div",{class:"w-12"},"No"),cell:({row:n})=>{const i=n.index+1+(e.withdrawals.current_page-1)*e.withdrawals.per_page;return u("div",{class:"font-medium"},i)}},{accessorKey:"customer.name",header:s("Pelanggan"),cell:({row:n})=>{const i=n.original.customer;return u("div",[u("div",{class:"font-medium"},i.name),u("div",{class:"text-xs text-muted-foreground"},i.email)])}},{accessorKey:"customer.username",header:s("Username"),cell:({row:n})=>{const i=n.original.customer;return u("div",[u("div",{class:"font-medium"},i.username),u("div",{class:"text-xs text-muted-foreground"},i.email)])}},{accessorKey:"customer.ewallet_saldo",header:()=>"Saldo Sekarang",cell:({row:n})=>u("div",D(n.original.customer.ewallet_saldo))},{accessorKey:"balance_before",header:()=>"Saldo Sebelum",cell:({row:n})=>u("div",D(n.getValue("balance_before")))},{accessorKey:"amount",header:()=>"Penarikan",cell:({row:n})=>u("div",{class:"font-bold text-red-600"},D(n.getValue("amount")))},{id:"admin_fee",header:()=>"Biaya Admin",cell:({row:n})=>{const i=q(n.original.notes);return i?u("div",{class:"text-xs font-medium"},D(i.admin_fee??0)):u("div",{class:"text-xs text-muted-foreground"},"-")}},{id:"net_amount",header:()=>"Penarikan Net",cell:({row:n})=>{const i=q(n.original.notes);return i?u("div",{class:"text-xs font-medium"},D(i.net_amount??0)):u("div",{class:"text-xs text-muted-foreground"},"-")}},{id:"bank_destination",header:()=>"Rekening Tujuan",cell:({row:n})=>{const i=q(n.original.notes);return i?u("div",[u("div",{class:"text-xs font-medium"},`${i.bank_name} - ${i.bank_account}`),u("div",{class:"text-xs text-muted-foreground"},i.bank_holder)]):u("div",{class:"text-xs text-muted-foreground"},"-")}},{accessorKey:"transaction_ref",header:()=>"Referensi",cell:({row:n})=>u("div",{class:"font-mono text-xs"},n.getValue("transaction_ref"))},{accessorKey:"status",header:()=>"Status",cell:({row:n})=>{const i=n.getValue("status");return u(Me,{variant:He(i)},()=>i)}},{accessorKey:"created_at",header:()=>"Tanggal",cell:({row:n})=>u("div",{class:"text-sm"},Oe(n.getValue("created_at")))},{id:"actions",header:()=>u("div",{class:"text-right"},"Aksi"),cell:({row:n})=>{const i=n.original;if(i.status!=="pending")return null;const f=i.balance_before<i.amount;return u("div",{class:"flex justify-end gap-2"},[u(K,{size:"sm",onClick:()=>e.onApprove(i),disabled:f},()=>[u(ce,{class:"mr-1 h-4 w-4"}),"Setujui"]),u(K,{size:"sm",variant:"destructive",onClick:()=>e.onReject(i)},()=>[u(me,{class:"mr-1 h-4 w-4"}),"Tolak"])])}}];return{table:ue({get data(){return e.withdrawals.data},columns:c,getCoreRowModel:we(),getSortedRowModel:ge(),getFilteredRowModel:pe(),onSortingChange:n=>P(n,o),onColumnFiltersChange:n=>P(n,l),onColumnVisibilityChange:n=>P(n,d),state:{get sorting(){return o.value},get columnFilters(){return l.value},get columnVisibility(){return d.value}},manualSorting:!0}),columns:c,sorting:o,FlexRender:de}}function Ze(e,o,l=300){let d=null;G(e,()=>{d&&clearTimeout(d),d=setTimeout(o,l)},{deep:!0})}function Ge(e){const o=e.endpoint??"/admin/withdrawals",l=$(e.initialFilters.search||""),d=$(e.initialFilters.status||"all"),s=()=>({search:l.value||void 0,status:d.value!=="all"?d.value:void 0,sort_by:e.sorting.value[0]?.id||"created_at",sort_order:e.sorting.value[0]?.desc?"desc":"asc"}),c=()=>{Y.get(o,s(),{preserveState:!0,preserveScroll:!0})};return Ze([l,d],c,300),{search:l,statusFilter:d,buildQuery:s,go:c}}const Ye={class:"rounded-xl p-4 space-y-6 py-6"},yt=C({__name:"Index",props:{withdrawals:{},statistics:{},filters:{}},setup(e){const o=e,{approveDialog:l,rejectDialog:d,openApproveDialog:s,openRejectDialog:c,handleApprove:y,handleReject:n}=Xe(),{table:i,columns:f,sorting:v,FlexRender:m}=Je({withdrawals:o.withdrawals,onApprove:s,onReject:c}),g=[{id:o.filters.sort_by||"created_at",desc:o.filters.sort_order==="desc"}];v.value=g;const{search:I,statusFilter:N,buildQuery:z}=Ge({initialFilters:o.filters,sorting:v,endpoint:"/admin/withdrawals"});return G(v,L=>{L.length&&Y.get("/admin/withdrawals",z(),{preserveState:!0,preserveScroll:!0})},{deep:!0}),(L,_)=>(p(),h(j,null,[a(t(ve),{title:"Permintaan Withdrawal"}),a(ae,null,{default:r(()=>[w("div",Ye,[_[4]||(_[4]=w("div",null,[w("h2",{class:"text-3xl font-bold tracking-tight"},"Permintaan Withdrawal"),w("p",{class:"text-muted-foreground"},"Kelola permintaan penarikan saldo dari pelanggan")],-1)),a(Ie,{statistics:e.statistics},null,8,["statistics"]),a(qe,{table:t(i),search:t(I),"onUpdate:search":_[0]||(_[0]=k=>A(I)?I.value=k:null),statusFilter:t(N),"onUpdate:statusFilter":_[1]||(_[1]=k=>A(N)?N.value=k:null)},null,8,["table","search","statusFilter"]),a(Le,{table:t(i),columns:t(f),FlexRender:t(m)},null,8,["table","columns","FlexRender"]),e.withdrawals.last_page>1?(p(),b(_e,{key:0,data:{current_page:e.withdrawals.current_page,last_page:e.withdrawals.last_page,per_page:e.withdrawals.per_page,from:(e.withdrawals.current_page-1)*e.withdrawals.per_page+1,to:Math.min(e.withdrawals.current_page*e.withdrawals.per_page,e.withdrawals.total),total:e.withdrawals.total},url:"/admin/withdrawals",filters:t(z)()},null,8,["data","filters"])):Z("",!0)]),a(Qe,{approveDialog:t(l),"onUpdate:approveDialog":_[2]||(_[2]=k=>A(l)?l.value=k:null),rejectDialog:t(d),"onUpdate:rejectDialog":_[3]||(_[3]=k=>A(d)?d.value=k:null),onApprove:t(y),onReject:t(n)},null,8,["approveDialog","rejectDialog","onApprove","onReject"])]),_:1})],64))}});export{yt as default};
