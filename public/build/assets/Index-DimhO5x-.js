import{W as L,X as ve,_ as ge,Z as pe,$ as _e,a0 as be,a1 as xe}from"./AppLayout.vue_vue_type_script_setup_true_lang-4ba7MJZZ.js";import{_ as T}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-BJL6jlWo.js";import{_ as he}from"./Pagination.vue_vue_type_script_setup_true_lang-R3MZEea8.js";import{_ as Z}from"./index-qWBV6i01.js";import{_ as y,v as M}from"./index-C_d1QX2L.js";import{_ as U,a as j}from"./CardContent.vue_vue_type_script_setup_true_lang-CqrB5hxD.js";import{_ as A}from"./CardHeader.vue_vue_type_script_setup_true_lang-CAU7O7lt.js";import{_ as P}from"./CardTitle.vue_vue_type_script_setup_true_lang-CXovuBmY.js";import{_ as ye,a as ke,b as we}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-B92NEDT-.js";import{_ as Se}from"./DropdownMenuCheckboxItem.vue_vue_type_script_setup_true_lang-BUzbctbx.js";import{_ as Ce}from"./Input.vue_vue_type_script_setup_true_lang-BCOvYMLd.js";import{_ as J,a as O,b as Y,c as G,d as p}from"./SelectValue.vue_vue_type_script_setup_true_lang-uung8Eko.js";import{_ as Re,a as $e,b as K,c as De,d as Be,e as Q}from"./TableHeader.vue_vue_type_script_setup_true_lang-BhipakAw.js";import{u as Ve}from"./usePermissions-DDUSam5l.js";import{d as Ie,r as m,p as ee,q as Fe,E as te,j as V,c as _,g as u,w as l,b as a,e as r,u as e,a1 as Le,v as k,t as z,s as i,Y as Me,df as Te,K as b,aB as Ue,F as $,x as D,an as se,Z as je,dh as Ae,aa as Pe,y as ae,n as o,D as le,di as Ke,at as ze,aU as He,ao as Ne,aq as Ee,z as qe,aM as We,A as Xe,B as Ze}from"./vendor-4-BZYpFr.js";import"./index-CSEUMRIG.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-CQ0bN-pz.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-DAlPCySi.js";import"./index-BUE9bFsX.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DLcPllPw.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-CdMXDPSC.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-DRtGWkTW.js";const Je={class:"rounded-xl p-4 space-y-6 py-6"},Oe={class:"flex items-center justify-between"},Ye={class:"grid gap-4 md:grid-cols-2 lg:grid-cols-4"},Ge={class:"text-2xl font-bold"},Qe={class:"text-xs text-muted-foreground"},et={class:"text-2xl font-bold"},tt={class:"text-xs text-muted-foreground"},st={class:"grid grid-cols-5 gap-2 text-sm"},at={class:"font-semibold text-xs text-muted-foreground"},lt={class:"font-bold"},nt={class:"text-xs text-muted-foreground"},ot={key:0,class:"flex items-center justify-between rounded-lg border bg-muted/50 p-4"},rt={class:"text-sm font-medium"},it={class:"flex items-center gap-4"},ut={class:"relative flex-1"},dt={class:"rounded-md border"},Lt=Ie({__name:"Index",props:{bonuses:{},statistics:{},filters:{}},setup(c){const{isSuperAdmin:H,isAdmin:N}=Ve(),f=c,ne=[{title:"Bonus Matching",href:L.url()}],w=m(f.filters.search||""),v=m(f.filters.status?.toString()||"all"),g=m(f.filters.level?.toString()||"all"),h=m([{id:f.filters.sort_by,desc:f.filters.sort_order==="desc"}]),E=m([]),q=m({}),B=m({}),S=m({open:!1,bonus:null}),x=m({open:!1,bonus:null}),I=m({open:!1}),oe=ee(()=>Object.keys(B.value).map(s=>f.bonuses.data[parseInt(s)]).filter(Boolean)),C=ee(()=>oe.value.filter(s=>s.status===0)),R=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s),re=s=>new Date(s).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),ie=s=>{S.value={open:!0,bonus:s}},ue=()=>{S.value.bonus&&V.delete(pe.url(S.value.bonus.id),{preserveScroll:!0,onSuccess:()=>{S.value={open:!1,bonus:null}}})},de=s=>{x.value={open:!0,bonus:s}},ce=()=>{if(!x.value.bonus)return;le({}).post(_e.url(x.value.bonus.id),{preserveScroll:!0,onSuccess:()=>{x.value={open:!1,bonus:null},B.value={}}})},me=()=>{C.value.length&&(I.value.open=!0)},fe=()=>{const s=C.value.map(n=>n.id);le({bonus_ids:s}).post(be.url(),{preserveScroll:!0,onSuccess:()=>{B.value={},I.value.open=!1}})},W=[{id:"select",header:({table:s})=>o("input",{type:"checkbox",checked:s.getIsAllPageRowsSelected(),indeterminate:s.getIsSomePageRowsSelected(),onChange:s.getToggleAllPageRowsSelectedHandler(),class:"h-4 w-4 rounded border-gray-300"}),cell:({row:s})=>o("input",{type:"checkbox",checked:s.getIsSelected(),disabled:!s.getCanSelect(),onChange:s.getToggleSelectedHandler(),class:"h-4 w-4 rounded border-gray-300"}),enableSorting:!1},{id:"index",header:()=>o("div",{class:"w-12"},"No"),cell:({row:s})=>{const t=s.index+1+(f.bonuses.current_page-1)*f.bonuses.per_page;return o("div",{class:"font-medium"},t)}},{accessorKey:"member_name",header:()=>"Member (Penerima)",cell:({row:s})=>o("div",[o("div",{class:"font-medium"},s.original.member_name),o("div",{class:"text-xs text-muted-foreground"},s.original.member_ewallet_id)])},{accessorKey:"from_member_name",header:()=>"Dari Member",cell:({row:s})=>o("div",[o("div",{class:"font-medium"},s.original.from_member_name),o("div",{class:"text-xs text-muted-foreground"},s.original.from_member_ewallet_id)])},{accessorKey:"level",header:()=>"Level",cell:({row:s})=>o(Z,{variant:"outline",class:"gap-1"},()=>[o(Ke,{class:"h-3 w-3"}),`Level ${s.original.level}`])},{accessorKey:"amount",header:()=>o("div",{class:"text-right"},"Jumlah"),cell:({row:s})=>o("div",{class:"text-right font-medium"},R(s.original.amount))},{accessorKey:"status",header:()=>"Status",cell:({row:s})=>{const t=s.original.status;return o(Z,{variant:t===1?"default":"secondary",class:"gap-1"},()=>[o(t===1?ze:He,{class:"h-3 w-3"}),s.original.status_text])}},{accessorKey:"created_at",header:({column:s})=>o(y,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),class:"-ml-4"},()=>["Tanggal",o(Ne,{class:"ml-2 h-4 w-4"})]),cell:({row:s})=>re(s.getValue("created_at"))},{id:"actions",header:()=>o("div",{class:"text-right"},"Actions"),cell:({row:s})=>{const t=s.original,n=[];return(H||N)&&n.push(o(y,{variant:"outline",size:"sm",onClick:()=>V.visit(xe.url(t.id))},()=>o(Ee,{class:"h-4 w-4"})),t.status===0?o(y,{variant:"default",size:"sm",onClick:()=>de(t)},()=>o(se,{class:"h-4 w-4"})):null,t.status===0?o(y,{variant:"outline",size:"sm",onClick:()=>ie(t)},()=>o(qe,{class:"h-4 w-4 text-destructive"})):null),o("div",{class:"flex justify-end gap-2"},n)}}],F=Fe({get data(){return f.bonuses.data},columns:W,getCoreRowModel:Ze(),getSortedRowModel:Xe(),getFilteredRowModel:We(),state:{get sorting(){return h.value},get columnFilters(){return E.value},get columnVisibility(){return q.value},get rowSelection(){return B.value}},onSortingChange:s=>M(s,h),onColumnFiltersChange:s=>M(s,E),onColumnVisibilityChange:s=>M(s,q),onRowSelectionChange:s=>M(s,B),manualSorting:!0,enableRowSelection:!0});te(h,s=>{s.length>0&&V.get(L.url(),{search:w.value||void 0,status:v.value!=="all"?parseInt(v.value):void 0,level:g.value!=="all"?parseInt(g.value):void 0,sort_by:s[0].id,sort_order:s[0].desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},{deep:!0});let X;return te([w,v,g],()=>{clearTimeout(X),X=setTimeout(()=>{V.get(L.url(),{search:w.value||void 0,status:v.value!=="all"?parseInt(v.value):void 0,level:g.value!=="all"?parseInt(g.value):void 0,sort_by:h.value[0]?.id||"created_at",sort_order:h.value[0]?.desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},300)}),(s,t)=>(u(),_(ge,{breadcrumbs:ne},{default:l(()=>[a(e(Le),{title:"Bonus Matching"}),r("div",Je,[r("div",Oe,[t[8]||(t[8]=r("div",null,[r("h1",{class:"text-3xl font-bold tracking-tight"},"Bonus Matching"),r("p",{class:"text-muted-foreground"},"Kelola bonus matching multi-level")],-1)),e(H)||e(N)?(u(),_(e(y),{key:0,onClick:t[0]||(t[0]=n=>e(V).visit(e(ve).url()))},{default:l(()=>[a(e(Me),{class:"h-4 w-4"}),t[7]||(t[7]=i(" Tambah Bonus ",-1))]),_:1})):z("",!0)]),r("div",Ye,[a(e(U),null,{default:l(()=>[a(e(A),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[a(e(P),{class:"text-sm font-medium"},{default:l(()=>[...t[9]||(t[9]=[i("Total Pending",-1)])]),_:1}),a(e(Te),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(j),null,{default:l(()=>[r("div",Ge,b(R(c.statistics.total_pending)),1),r("p",Qe,b(c.statistics.count_pending)+" bonus ",1)]),_:1})]),_:1}),a(e(U),null,{default:l(()=>[a(e(A),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[a(e(P),{class:"text-sm font-medium"},{default:l(()=>[...t[10]||(t[10]=[i("Total Released",-1)])]),_:1}),a(e(Ue),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(j),null,{default:l(()=>[r("div",et,b(R(c.statistics.total_released)),1),r("p",tt,b(c.statistics.count_released)+" bonus ",1)]),_:1})]),_:1}),a(e(U),{class:"md:col-span-2"},{default:l(()=>[a(e(A),null,{default:l(()=>[a(e(P),{class:"text-sm font-medium"},{default:l(()=>[...t[11]||(t[11]=[i("By Level",-1)])]),_:1})]),_:1}),a(e(j),null,{default:l(()=>[r("div",st,[(u(),k($,null,D([1,2,3,4,5],n=>r("div",{key:n,class:"text-center"},[r("div",at," Level "+b(n),1),r("div",lt,b(R(c.statistics.by_level&&c.statistics.by_level[n]?.total||0)),1),r("div",nt,b(c.statistics.by_level&&c.statistics.by_level[n]?.count||0)+" bonus ",1)])),64))])]),_:1})]),_:1})]),C.value.length>0?(u(),k("div",ot,[r("p",rt,b(C.value.length)+" bonus pending dipilih ",1),a(e(y),{size:"sm",onClick:me},{default:l(()=>[a(e(se),{class:"h-4 w-4"}),t[12]||(t[12]=i(" Release Semua ",-1))]),_:1})])):z("",!0),r("div",it,[r("div",ut,[a(e(je),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),a(e(Ce),{modelValue:w.value,"onUpdate:modelValue":t[1]||(t[1]=n=>w.value=n),placeholder:"Cari member atau deskripsi...",class:"pl-9"},null,8,["modelValue"])]),a(e(J),{modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=n=>v.value=n)},{default:l(()=>[a(e(O),{class:"w-40"},{default:l(()=>[a(e(Y),{placeholder:"Semua Status"})]),_:1}),a(e(G),null,{default:l(()=>[a(e(p),{value:"all"},{default:l(()=>[...t[13]||(t[13]=[i("Semua Status",-1)])]),_:1}),a(e(p),{value:"0"},{default:l(()=>[...t[14]||(t[14]=[i("Pending",-1)])]),_:1}),a(e(p),{value:"1"},{default:l(()=>[...t[15]||(t[15]=[i("Released",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(e(J),{modelValue:g.value,"onUpdate:modelValue":t[3]||(t[3]=n=>g.value=n)},{default:l(()=>[a(e(O),{class:"w-40"},{default:l(()=>[a(e(Y),{placeholder:"Semua Level"})]),_:1}),a(e(G),null,{default:l(()=>[a(e(p),{value:"all"},{default:l(()=>[...t[16]||(t[16]=[i("Semua Level",-1)])]),_:1}),a(e(p),{value:"1"},{default:l(()=>[...t[17]||(t[17]=[i("Level 1",-1)])]),_:1}),a(e(p),{value:"2"},{default:l(()=>[...t[18]||(t[18]=[i("Level 2",-1)])]),_:1}),a(e(p),{value:"3"},{default:l(()=>[...t[19]||(t[19]=[i("Level 3",-1)])]),_:1}),a(e(p),{value:"4"},{default:l(()=>[...t[20]||(t[20]=[i("Level 4",-1)])]),_:1}),a(e(p),{value:"5"},{default:l(()=>[...t[21]||(t[21]=[i("Level 5",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(e(ye),null,{default:l(()=>[a(e(ke),{"as-child":""},{default:l(()=>[a(e(y),{variant:"outline",class:"ml-auto"},{default:l(()=>[a(e(Ae),{class:"h-4 w-4"}),t[22]||(t[22]=i(" Kolom ",-1)),a(e(Pe),{class:"ml-2 h-4 w-4"})]),_:1})]),_:1}),a(e(we),{align:"end"},{default:l(()=>[(u(!0),k($,null,D(e(F).getAllColumns().filter(n=>n.getCanHide()),n=>(u(),_(e(Se),{key:n.id,class:"capitalize",checked:n.getIsVisible(),"onUpdate:checked":d=>n.toggleVisibility(!!d)},{default:l(()=>[i(b(n.id),1)]),_:2},1032,["checked","onUpdate:checked"]))),128))]),_:1})]),_:1})]),r("div",dt,[a(e(Re),null,{default:l(()=>[a(e($e),null,{default:l(()=>[(u(!0),k($,null,D(e(F).getHeaderGroups(),n=>(u(),_(e(K),{key:n.id},{default:l(()=>[(u(!0),k($,null,D(n.headers,d=>(u(),_(e(De),{key:d.id},{default:l(()=>[d.isPlaceholder?z("",!0):(u(),_(e(ae),{key:0,render:d.column.columnDef.header,props:d.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),a(e(Be),null,{default:l(()=>[e(F).getRowModel().rows?.length?(u(!0),k($,{key:0},D(e(F).getRowModel().rows,n=>(u(),_(e(K),{key:n.id,"data-state":n.getIsSelected()?"selected":void 0},{default:l(()=>[(u(!0),k($,null,D(n.getVisibleCells(),d=>(u(),_(e(Q),{key:d.id},{default:l(()=>[a(e(ae),{render:d.column.columnDef.cell,props:d.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1032,["data-state"]))),128)):(u(),_(e(K),{key:1},{default:l(()=>[a(e(Q),{colspan:W.length,class:"h-24 text-center"},{default:l(()=>[...t[23]||(t[23]=[i(" Tidak ada data bonus. ",-1)])]),_:1},8,["colspan"])]),_:1}))]),_:1})]),_:1})]),a(he,{data:c.bonuses,url:e(L).url(),filters:{search:w.value||void 0,status:v.value!=="all"?parseInt(v.value):void 0,level:g.value!=="all"?parseInt(g.value):void 0,sort_by:h.value[0]?.id,sort_order:h.value[0]?.desc?"desc":"asc"}},null,8,["data","url","filters"])]),a(T,{open:S.value.open,"onUpdate:open":t[4]||(t[4]=n=>S.value.open=n),title:"Hapus Bonus?",description:"Apakah Anda yakin ingin menghapus bonus ini? Tindakan ini tidak dapat dibatalkan.","confirm-text":"Hapus","cancel-text":"Batal",variant:"destructive",onConfirm:ue},null,8,["open"]),a(T,{open:x.value.open,"onUpdate:open":t[5]||(t[5]=n=>x.value.open=n),title:"Release Bonus?",description:`Bonus sebesar ${x.value.bonus?R(x.value.bonus.amount):""} akan ditransfer ke ewallet member. Lanjutkan?`,"confirm-text":"Release","cancel-text":"Batal",onConfirm:ce},null,8,["open","description"]),a(T,{open:I.value.open,"onUpdate:open":t[6]||(t[6]=n=>I.value.open=n),title:`Release ${C.value.length} Bonus?`,description:`Total ${R(C.value.reduce((n,d)=>n+d.amount,0))} akan ditransfer ke ewallet member. Lanjutkan?`,"confirm-text":"Release Semua","cancel-text":"Batal",onConfirm:fe},null,8,["open","title","description"])]),_:1}))}});export{Lt as default};
