import{d as Z,r as h,D as X,al as ee,p as ae,q as te,c as _,g as i,w as n,b as l,e as u,u as a,a0 as se,a3 as K,s as p,Y as le,Z as ne,v as b,F as k,x as V,t as R,y as B,n as s,K as $,ad as oe,am as z,Q as c,an as j,ao as re,ap as ie,$ as ue,z as de,j as I,B as ce}from"./vendor-0sCoMzHy.js";import{c as me,i as F,_ as pe,t as fe,a as ge,e as _e,l as ve,d as he}from"./AppLayout.vue_vue_type_script_setup_true_lang-J4pIkQSF.js";import{_ as d}from"./index-DJk7aHkf.js";import{_ as N}from"./Input.vue_vue_type_script_setup_true_lang-nikPKNAJ.js";import{_ as A}from"./index-D12gyL4d.js";import{_ as xe,a as be,b as E,c as ye,d as we,e as L}from"./TableHeader.vue_vue_type_script_setup_true_lang-Bg-l8dVV.js";import{_ as ke}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-BQ9O-qWE.js";import{_ as Ve}from"./Pagination.vue_vue_type_script_setup_true_lang-BBKil_NH.js";import{_ as $e,a as Ce,b as Se,c as De,d as Ke}from"./DialogTitle.vue_vue_type_script_setup_true_lang-C6bUxMpH.js";import{_ as je}from"./DialogFooter.vue_vue_type_script_setup_true_lang-BB1UFE69.js";import{_ as G}from"./Label.vue_vue_type_script_setup_true_lang-f9xrDwSP.js";import"./index-DaR_mHDg.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-BhL6n9ND.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-CAfd5pFE.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-KgsqrYLn.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DEiiatvc.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-CbD5L1KI.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-DMm3rbrx.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-Dc4bXstG.js";const Ie={class:"rounded-xl p-4 space-y-6 py-6"},Ne={class:"mb-6 flex items-center justify-between"},Ee={class:"mb-4 flex items-center gap-4"},Pe={class:"relative flex-1"},Me={class:"rounded-md border"},Te={class:"space-y-2"},Ue={key:0,class:"text-sm text-destructive"},Re={class:"space-y-2"},la=Z({__name:"Index",props:{customers:{},filters:{}},setup(P){const f=h({open:!1,data:null}),r=X({amount:"",description:""}),H=t=>{f.value={open:!0,data:t},r.reset(),r.clearErrors(),r.amount="",r.description=""},C=()=>{f.value.open=!1,r.reset(),r.clearErrors()},q=()=>{if(!f.value.data)return;const t=Number(r.amount);if(!t||t<1e4){c.error("Jumlah minimal Rp 10.000");return}r.post(fe.url(f.value.data.id),{preserveScroll:!0,onSuccess:()=>{c.success("Saldo berhasil ditambahkan"),C()},onError:e=>{e.amount?c.error(e.amount):c.error("Gagal menambahkan saldo")}})},J=(t,e)=>{I.post(ve.url(t),{},{onSuccess:()=>{c.success(`Login sebagai ${e}`)},onError:o=>{if(o.message?.includes("419")||o.message?.includes("expired")){c.error("Sesi expired, mencoba ulang..."),window.location.reload();return}c.error("Gagal login sebagai customer")},onFinish:()=>{}})},g=P,y=h(g.filters.search||""),w=h(g.filters.sort_by||"created_at"),x=h(g.filters.sort_order||"desc"),M=h(g.filters.per_page||10),O=t=>{I.delete(he.url(t),{preserveScroll:!0,onSuccess:()=>{c.success("Pelanggan berhasil dihapus")},onError:()=>{c.error("Gagal menghapus pelanggan")}})},v=h({open:!1,data:null}),Q=t=>{v.value={open:!0,data:t}},T=ee(()=>{I.get(F.url(),{search:y.value,sort_by:w.value,sort_order:x.value,per_page:M.value},{preserveState:!0,preserveScroll:!0})},300),S=t=>{w.value===t?x.value=x.value==="asc"?"desc":"asc":(w.value=t,x.value="asc"),T()},W=()=>{v.value.data&&O(v.value.data.id)},U=[{id:"index",header:()=>s("div",{class:"text-left"},"No"),cell:({row:t})=>{const e=t.index+1+(g.customers.current_page-1)*g.customers.per_page;return s("div",{class:"text-left"},e.toString())}},{accessorKey:"username",header:()=>s(d,{variant:"ghost",onClick:()=>S("username")},()=>["Username",s(j,{class:"ml-2 h-4 w-4"})]),cell:({row:t})=>{const e=t.getValue("username");return s("div",{class:"font-mono text-sm"},e||"-")}},{accessorKey:"ewallet_id",header:()=>s(d,{variant:"ghost",onClick:()=>S("ewallet_id")},()=>["Ewallet ID",s(j,{class:"ml-2 h-4 w-4"})]),cell:({row:t})=>s("div",{class:"font-mono text-sm"},t.getValue("ewallet_id"))},{accessorKey:"name",header:()=>s(d,{variant:"ghost",onClick:()=>S("name")},()=>["Nama",s(j,{class:"ml-2 h-4 w-4"})]),cell:({row:t})=>s("div",{},t.getValue("name"))},{accessorKey:"email",header:"Email",cell:({row:t})=>s("div",{class:"text-sm"},t.getValue("email"))},{accessorKey:"phone",header:"Telepon",cell:({row:t})=>{const e=t.getValue("phone");return s("div",{class:"text-sm"},e||"-")}},{accessorKey:"ewallet_saldo",header:()=>s("div",{class:"text-right"},"Saldo"),cell:({row:t})=>{const e=t.getValue("ewallet_saldo");return s("div",{class:"text-right font-medium"},"Rp "+new Intl.NumberFormat("id-ID").format(e))}},{accessorKey:"sponsor_name",header:"Sponsor",cell:({row:t})=>{const e=t.getValue("sponsor_name");return s("div",{class:"text-sm"},e||"-")}},{accessorKey:"upline_name",header:"Upline",cell:({row:t})=>{const e=t.getValue("upline_name");return s("div",{class:"text-sm"},e||"-")}},{accessorKey:"position",header:"Posisi",cell:({row:t})=>{const e=t.getValue("position");return e?s(A,{variant:e==="left"?"default":"secondary",class:"capitalize"},()=>e):s("div",{class:"text-center"},"-")}},{accessorKey:"email_verified_at",header:"Status",cell:({row:t})=>{const e=t.getValue("email_verified_at");return s(A,{variant:e?"default":"outline"},()=>e?"Verified":"Unverified")}},{id:"actions",header:()=>s("div",{class:"text-center"},"Aksi"),cell:({row:t})=>{const e=t.original,o=[s(d,{variant:"ghost",size:"icon",onClick:()=>H(e),title:"Inject Ewallet"},()=>s(z,{class:"h-4 w-4 text-green-600"})),s(d,{variant:"ghost",size:"icon",onClick:()=>J(e.id,e.name),title:"Login sebagai customer"},()=>s(re,{class:"h-4 w-4 text-primary"})),s(K,{href:ge.url(e.id)},()=>s(d,{variant:"ghost",size:"icon"},()=>s(ie,{class:"h-4 w-4"}))),s(K,{href:_e.url(e.id)},()=>s(d,{variant:"ghost",size:"icon"},()=>s(ue,{class:"h-4 w-4"})))];return e.status!==2&&e.status!==3&&o.push(s(d,{variant:"ghost",size:"icon",onClick:()=>Q(e)},()=>s(de,{class:"h-4 w-4 text-destructive"}))),s("div",{class:"flex items-center justify-center gap-2"},o)}}],Y=ae(()=>g.customers.data),D=te({get data(){return Y.value},columns:U,getCoreRowModel:ce(),manualSorting:!0,manualPagination:!0});return(t,e)=>(i(),_(pe,null,{default:n(()=>[l(a(se),{title:"Kelola Pelanggan"}),u("div",Ie,[u("div",Ne,[e[6]||(e[6]=u("div",null,[u("h1",{class:"text-3xl font-bold tracking-tight"},"Kelola Pelanggan"),u("p",{class:"text-muted-foreground"}," Kelola data pelanggan dan jaringan MLM ")],-1)),l(a(K),{href:a(me).url()},{default:n(()=>[l(a(d),null,{default:n(()=>[l(a(le),{class:"mr-2 h-4 w-4"}),e[5]||(e[5]=p(" Tambah Pelanggan ",-1))]),_:1})]),_:1},8,["href"])]),u("div",Ee,[u("div",Pe,[l(a(ne),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),l(a(N),{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=o=>y.value=o),placeholder:"Cari nama, email, telepon, atau ewallet ID...",class:"pl-10",onInput:a(T)},null,8,["modelValue","onInput"])])]),u("div",Me,[l(a(xe),null,{default:n(()=>[l(a(be),null,{default:n(()=>[(i(!0),b(k,null,V(a(D).getHeaderGroups(),o=>(i(),_(a(E),{key:o.id},{default:n(()=>[(i(!0),b(k,null,V(o.headers,m=>(i(),_(a(ye),{key:m.id},{default:n(()=>[m.isPlaceholder?R("",!0):(i(),_(a(B),{key:0,render:m.column.columnDef.header,props:m.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),l(a(we),null,{default:n(()=>[a(D).getRowModel().rows?.length?(i(!0),b(k,{key:0},V(a(D).getRowModel().rows,o=>(i(),_(a(E),{key:o.id},{default:n(()=>[(i(!0),b(k,null,V(o.getVisibleCells(),m=>(i(),_(a(L),{key:m.id},{default:n(()=>[l(a(B),{render:m.column.columnDef.cell,props:m.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1024))),128)):(i(),_(a(E),{key:1},{default:n(()=>[l(a(L),{colspan:U.length,class:"h-24 text-center"},{default:n(()=>[...e[7]||(e[7]=[p(" Tidak ada data pelanggan. ",-1)])]),_:1},8,["colspan"])]),_:1}))]),_:1})]),_:1})]),l(Ve,{data:P.customers,url:a(F).url(),filters:{search:y.value,sort_by:w.value,sort_order:x.value,per_page:M.value}},null,8,["data","url","filters"])]),l(ke,{open:v.value.open,"onUpdate:open":e[1]||(e[1]=o=>v.value.open=o),title:"Hapus Pelanggan?",description:`Apakah Anda yakin ingin menghapus pelanggan ${v.value.data?.name}? Tindakan ini tidak dapat dibatalkan dan akan menghapus semua data terkait termasuk jaringan dan bonus.`,"confirm-text":"Hapus","cancel-text":"Batal",variant:"destructive",onConfirm:W},null,8,["open","description"]),l(a($e),{open:f.value.open,"onUpdate:open":e[4]||(e[4]=o=>!o&&C())},{default:n(()=>[l(a(Ce),{class:"sm:max-w-md"},{default:n(()=>[l(a(Se),null,{default:n(()=>[l(a(De),null,{default:n(()=>[...e[8]||(e[8]=[p("Inject Ewallet",-1)])]),_:1}),l(a(Ke),null,{default:n(()=>[p(" Tambahkan saldo ke ewallet "+$(f.value.data?.name)+" ("+$(f.value.data?.ewallet_id)+") ",1)]),_:1})]),_:1}),u("form",{onSubmit:oe(q,["prevent"]),class:"space-y-4"},[u("div",Te,[l(a(G),{for:"amount"},{default:n(()=>[...e[9]||(e[9]=[p("Jumlah (Rp)",-1)])]),_:1}),l(a(N),{id:"amount",modelValue:a(r).amount,"onUpdate:modelValue":e[2]||(e[2]=o=>a(r).amount=o),modelModifiers:{number:!0},type:"number",min:"10000",step:"1000",placeholder:"Minimal Rp 10.000",required:""},null,8,["modelValue"]),a(r).errors.amount?(i(),b("p",Ue,$(a(r).errors.amount),1)):R("",!0)]),u("div",Re,[l(a(G),{for:"description"},{default:n(()=>[...e[10]||(e[10]=[p("Keterangan (Opsional)",-1)])]),_:1}),l(a(N),{id:"description",modelValue:a(r).description,"onUpdate:modelValue":e[3]||(e[3]=o=>a(r).description=o),type:"text",placeholder:"Contoh: Top up manual oleh admin"},null,8,["modelValue"])]),l(a(je),{class:"gap-2 sm:gap-0"},{default:n(()=>[l(a(d),{type:"button",variant:"outline",disabled:a(r).processing,onClick:C},{default:n(()=>[...e[11]||(e[11]=[p(" Batal ",-1)])]),_:1},8,["disabled"]),l(a(d),{type:"submit",disabled:a(r).processing||!a(r).amount||Number(a(r).amount)<1e4},{default:n(()=>[l(a(z),{class:"mr-2 h-4 w-4"}),p(" "+$(a(r).processing?"Memproses...":"Tambahkan Saldo"),1)]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"])]),_:1}))}});export{la as default};
