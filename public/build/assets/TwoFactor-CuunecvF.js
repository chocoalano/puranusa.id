import{_ as Z}from"./HeadingSmall.vue_vue_type_script_setup_true_lang-Bm4NwY9_.js";import{_ as G,a as ee,b as te}from"./index-CFdXmdwS.js";import{d as V,p as q,c as v,g as o,u as e,w as a,b as t,aM as se,s as d,K as k,e as s,v as n,F as h,x as F,r as x,dY as U,o as oe,dZ as ae,t as re,aX as le,dF as ne,ao as ie,c$ as j,m as B,dL as ue,J as de,d_ as H,ab as ce,ac as fe,d$ as pe,E as me,e0 as ve,bv as ye,d1 as _e,cQ as be,a0 as he,cz as I,U as we,V as ge,e1 as xe}from"./vendor-Bs9J5EGp.js";import{_ as g}from"./index-x8bH5uI1.js";import{_ as Ce,a as ke}from"./CardContent.vue_vue_type_script_setup_true_lang-BWHkBrZf.js";import{_ as $e}from"./CardDescription.vue_vue_type_script_setup_true_lang-BVqqwHu4.js";import{_ as Se}from"./CardHeader.vue_vue_type_script_setup_true_lang-CiO4by8s.js";import{_ as Fe}from"./CardTitle.vue_vue_type_script_setup_true_lang-DyZsrvsj.js";import{r as Te,s as Re,q as Ee,b as Ae,c as qe,d as je,_ as Ve,f as De,g as ze}from"./Layout.vue_vue_type_script_setup_true_lang-slrVVSOF.js";import{_ as Me}from"./InputError.vue_vue_type_script_setup_true_lang-CGN6Sp0G.js";import{_ as N}from"./Spinner.vue_vue_type_script_setup_true_lang-Dnzqk2oj.js";import{_ as Be,b as Oe,c as Le,d as Ke,a as Pe}from"./DialogTitle.vue_vue_type_script_setup_true_lang-CT6uvKSC.js";import{_ as Ie,a as Ne,b as Qe}from"./PinInputSlot.vue_vue_type_script_setup_true_lang-BoGmNbC5.js";import{_ as Q}from"./index-D-h5IonM.js";import{_ as Ue}from"./AppLayout.vue_vue_type_script_setup_true_lang-oneAxjQP.js";import"./Heading.vue_vue_type_script_setup_true_lang-DpmFHmYm.js";import"./Separator.vue_vue_type_script_setup_true_lang-DM0llgzX.js";import"./index-DaR_mHDg.js";import"./index-C1AfO0BI.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-rVF6Cf0K.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-CWDum3cA.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CbrHoqZt.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Ciactf0d.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-RkxObc6k.js";const He={class:"list-inside list-disc text-sm"},J=V({__name:"AlertError",props:{errors:{},title:{default:"Something went wrong."}},setup(f){const l=f,c=q(()=>Array.from(new Set(l.errors)));return(m,u)=>(o(),v(e(G),{variant:"destructive"},{default:a(()=>[t(e(se),{class:"size-4"}),t(e(ee),null,{default:a(()=>[d(k(f.title),1)]),_:1}),t(e(te),null,{default:a(()=>[s("ul",He,[(o(!0),n(h,null,F(c.value,(y,r)=>(o(),n("li",{key:r},k(y),1))),128))])]),_:1})]),_:1}))}}),M=async f=>{const l=await fetch(f,{headers:{Accept:"application/json"}});if(!l.ok)throw new Error(`Failed to fetch: ${l.status}`);return l.json()},R=x([]),$=x(null),S=x(null),A=x([]),Je=q(()=>S.value!==null&&$.value!==null),O=()=>{const f=async()=>{try{const{svg:p}=await M(Ee.url());S.value=p}catch{R.value.push("Failed to fetch QR code"),S.value=null}},l=async()=>{try{const{secretKey:p}=await M(Re.url());$.value=p}catch{R.value.push("Failed to fetch a setup key"),$.value=null}},c=()=>{$.value=null,S.value=null,m()},m=()=>{R.value=[]};return{qrCodeSvg:S,manualSetupKey:$,recoveryCodesList:A,errors:R,hasSetupData:Je,clearSetupData:c,clearErrors:m,clearTwoFactorAuthData:()=>{c(),m(),A.value=[]},fetchQrCode:f,fetchSetupKey:l,fetchSetupData:async()=>{try{m(),await Promise.all([f(),l()])}catch{S.value=null,$.value=null}},fetchRecoveryCodes:async()=>{try{m(),A.value=await M(Te.url())}catch{R.value.push("Failed to fetch recovery codes"),A.value=[]}}}},We={class:"flex flex-col gap-3 select-none sm:flex-row sm:items-center sm:justify-between"},Xe={key:0,class:"mt-6"},Ye={key:1,class:"mt-3 space-y-3"},Ze={key:0,class:"space-y-2"},Ge=V({__name:"TwoFactorRecoveryCodes",setup(f){const{recoveryCodesList:l,fetchRecoveryCodes:c,errors:m}=O(),u=x(!1),y=U("recoveryCodeSectionRef"),r=async()=>{!u.value&&!l.value.length&&await c(),u.value=!u.value,u.value&&(await H(),y.value?.scrollIntoView({behavior:"smooth"}))};return oe(async()=>{l.value.length||await c()}),(p,_)=>(o(),v(e(Ce),{class:"w-full"},{default:a(()=>[t(e(Se),null,{default:a(()=>[t(e(Fe),{class:"flex gap-3"},{default:a(()=>[t(e(ae),{class:"size-4"}),_[0]||(_[0]=d("2FA Recovery Codes ",-1))]),_:1}),t(e($e),null,{default:a(()=>[..._[1]||(_[1]=[d(" Recovery codes let you regain access if you lose your 2FA device. Store them in a secure password manager. ",-1)])]),_:1})]),_:1}),t(e(ke),null,{default:a(()=>[s("div",We,[t(e(g),{onClick:r,class:"w-fit"},{default:a(()=>[(o(),v(le(u.value?e(ne):e(ie)),{class:"size-4"})),d(" "+k(u.value?"Hide":"View")+" Recovery Codes ",1)]),_:1}),u.value&&e(l).length?(o(),v(e(j),B({key:0},e(Ae).form(),{method:"post",options:{preserveScroll:!0},onSuccess:e(c)}),{default:a(({processing:w})=>[t(e(g),{variant:"secondary",type:"submit",disabled:w},{default:a(()=>[t(e(ue)),_[2]||(_[2]=d(" Regenerate Codes ",-1))]),_:1},8,["disabled"])]),_:1},16,["onSuccess"])):re("",!0)]),s("div",{class:de(["relative overflow-hidden transition-all duration-300",u.value?"h-auto opacity-100":"h-0 opacity-0"])},[e(m)?.length?(o(),n("div",Xe,[t(J,{errors:e(m)},null,8,["errors"])])):(o(),n("div",Ye,[s("div",{ref_key:"recoveryCodeSectionRef",ref:y,class:"grid gap-1 rounded-lg bg-muted p-4 font-mono text-sm"},[e(l).length?(o(!0),n(h,{key:1},F(e(l),(w,C)=>(o(),n("div",{key:C},k(w),1))),128)):(o(),n("div",Ze,[(o(),n(h,null,F(8,w=>s("div",{key:w,class:"h-4 animate-pulse rounded bg-muted-foreground/20"})),64))]))],512),_[3]||(_[3]=s("p",{class:"text-xs text-muted-foreground select-none"},[d(" Each recovery code can be used once to access your account and will be removed after use. If you need more, click "),s("span",{class:"font-bold"},"Regenerate Codes"),d(" above. ")],-1))]))],2)]),_:1})]),_:1}))}}),et={class:"mb-3 w-auto rounded-full border border-border bg-card p-0.5 shadow-sm"},tt={class:"relative overflow-hidden rounded-full border border-border bg-muted p-2.5"},st={class:"absolute inset-0 grid grid-cols-5 opacity-50"},ot={class:"absolute inset-0 grid grid-rows-5 opacity-50"},at={class:"relative flex w-auto flex-col items-center justify-center space-y-5"},rt={class:"relative mx-auto flex max-w-md items-center overflow-hidden"},lt={class:"relative mx-auto aspect-square w-64 overflow-hidden rounded-lg border border-border"},nt={key:0,class:"absolute inset-0 z-10 flex aspect-square h-auto w-full animate-pulse items-center justify-center bg-background"},it={key:1,class:"relative z-10 overflow-hidden border p-5"},ut=["innerHTML"],dt={class:"flex w-full items-center space-x-5"},ct={class:"flex w-full items-center justify-center space-x-2"},ft={class:"flex w-full items-stretch overflow-hidden rounded-xl border border-border"},pt={key:0,class:"flex h-full w-full items-center justify-center bg-muted p-3"},mt=["value"],vt=["value"],yt={class:"flex w-full flex-col items-center justify-center space-y-3 py-2"},_t={class:"flex w-full items-center space-x-5"},bt=V({__name:"TwoFactorSetupModal",props:ce({requiresConfirmation:{type:Boolean},twoFactorEnabled:{type:Boolean}},{isOpen:{type:Boolean},isOpenModifiers:{}}),emits:["update:isOpen"],setup(f){const l=f,c=fe(f,"isOpen"),{copy:m,copied:u}=pe(),{qrCodeSvg:y,manualSetupKey:r,clearSetupData:p,fetchSetupData:_,errors:w}=O(),C=x(!1),T=x([]),L=q(()=>T.value.join("")),K=U("pinInputContainerRef"),D=q(()=>l.twoFactorEnabled?{title:"Two-Factor Authentication Enabled",description:"Two-factor authentication is now enabled. Scan the QR code or enter the setup key in your authenticator app.",buttonText:"Close"}:C.value?{title:"Verify Authentication Code",description:"Enter the 6-digit code from your authenticator app",buttonText:"Continue"}:{title:"Enable Two-Factor Authentication",description:"To finish enabling two-factor authentication, scan the QR code or enter the setup key in your authenticator app",buttonText:"Continue"}),W=()=>{if(l.requiresConfirmation){C.value=!0,H(()=>{K.value?.querySelector("input")?.focus()});return}p(),c.value=!1},X=()=>{l.twoFactorEnabled&&p(),C.value=!1,T.value=[]};return me(()=>c.value,async P=>{if(!P){X();return}y.value||await _()}),(P,i)=>(o(),v(e(Be),{open:c.value,"onUpdate:open":i[5]||(i[5]=b=>c.value=b)},{default:a(()=>[t(e(Pe),{class:"sm:max-w-md"},{default:a(()=>[t(e(Oe),{class:"flex items-center justify-center"},{default:a(()=>[s("div",et,[s("div",tt,[s("div",st,[(o(),n(h,null,F(5,b=>s("div",{key:`col-${b}`,class:"border-r border-border last:border-r-0"})),64))]),s("div",ot,[(o(),n(h,null,F(5,b=>s("div",{key:`row-${b}`,class:"border-b border-border last:border-b-0"})),64))]),t(e(ve),{class:"relative z-20 size-6 text-foreground"})])]),t(e(Le),null,{default:a(()=>[d(k(D.value.title),1)]),_:1}),t(e(Ke),{class:"text-center"},{default:a(()=>[d(k(D.value.description),1)]),_:1})]),_:1}),s("div",at,[C.value?(o(),v(e(j),B({key:1},e(qe).form(),{"reset-on-error":"",onFinish:i[3]||(i[3]=b=>T.value=[]),onSuccess:i[4]||(i[4]=b=>c.value=!1)}),{default:a(({errors:b,processing:z})=>[s("input",{type:"hidden",name:"code",value:L.value},null,8,vt),s("div",{ref_key:"pinInputContainerRef",ref:K,class:"relative w-full space-y-3"},[s("div",yt,[t(e(Ie),{id:"otp",placeholder:"â—‹",modelValue:T.value,"onUpdate:modelValue":i[1]||(i[1]=E=>T.value=E),type:"number",otp:""},{default:a(()=>[t(e(Ne),null,{default:a(()=>[(o(),n(h,null,F(6,(E,Y)=>t(e(Qe),{autofocus:"",key:E,index:Y,disabled:z},null,8,["index","disabled"])),64))]),_:2},1024)]),_:2},1032,["modelValue"]),t(Me,{message:b?.confirmTwoFactorAuthentication?.code},null,8,["message"])]),s("div",_t,[t(e(g),{type:"button",variant:"outline",class:"w-auto flex-1",onClick:i[2]||(i[2]=E=>C.value=!1),disabled:z},{default:a(()=>[...i[7]||(i[7]=[d(" Back ",-1)])]),_:1},8,["disabled"]),t(e(g),{type:"submit",class:"w-auto flex-1",disabled:z||L.value.length<6},{default:a(()=>[...i[8]||(i[8]=[d(" Confirm ",-1)])]),_:1},8,["disabled"])])],512)]),_:1},16)):(o(),n(h,{key:0},[e(w)?.length?(o(),v(J,{key:0,errors:e(w)},null,8,["errors"])):(o(),n(h,{key:1},[s("div",rt,[s("div",lt,[e(y)?(o(),n("div",it,[s("div",{innerHTML:e(y),class:"flex aspect-square size-full items-center justify-center"},null,8,ut)])):(o(),n("div",nt,[t(e(N),{class:"size-6"})]))])]),s("div",dt,[t(e(g),{class:"w-full",onClick:W},{default:a(()=>[d(k(D.value.buttonText),1)]),_:1})]),i[6]||(i[6]=s("div",{class:"relative flex w-full items-center justify-center"},[s("div",{class:"absolute inset-0 top-1/2 h-px w-full bg-border"}),s("span",{class:"relative bg-card px-2 py-1"},"or, enter the code manually")],-1)),s("div",ct,[s("div",ft,[e(r)?(o(),n(h,{key:1},[s("input",{type:"text",readonly:"",value:e(r),class:"h-full w-full bg-background p-3 text-foreground"},null,8,mt),s("button",{onClick:i[0]||(i[0]=b=>e(m)(e(r)||"")),class:"relative block h-auto border-l border-border px-3 hover:bg-muted"},[e(u)?(o(),v(e(ye),{key:0,class:"w-4 text-green-500"})):(o(),v(e(_e),{key:1,class:"w-4"}))])],64)):(o(),n("div",pt,[t(e(N))]))])])],64))],64))])]),_:1})]),_:1},8,["open"]))}}),ht={class:"space-y-6"},wt={key:0,class:"flex flex-col items-start justify-start space-y-4"},gt={key:1,class:"flex flex-col items-start justify-start space-y-4"},xt={class:"relative inline"},Ht=V({__name:"TwoFactor",props:{requiresConfirmation:{type:Boolean,default:!1},twoFactorEnabled:{type:Boolean,default:!1}},setup(f){const l=[{title:"Two-Factor Authentication",href:je.url()}],{hasSetupData:c,clearTwoFactorAuthData:m}=O(),u=x(!1);return be(()=>{m()}),(y,r)=>(o(),v(Ue,{breadcrumbs:l},{default:a(()=>[t(e(he),{title:"Two-Factor Authentication"}),t(Ve,null,{default:a(()=>[s("div",ht,[t(Z,{title:"Two-Factor Authentication",description:"Manage your two-factor authentication settings"}),f.twoFactorEnabled?(o(),n("div",gt,[t(e(Q),{variant:"default"},{default:a(()=>[...r[7]||(r[7]=[d("Enabled",-1)])]),_:1}),r[9]||(r[9]=s("p",{class:"text-muted-foreground"}," With two-factor authentication enabled, you will be prompted for a secure, random pin during login, which you can retrieve from the TOTP-supported application on your phone. ",-1)),t(Ge),s("div",xt,[t(e(j),we(ge(e(ze).form())),{default:a(({processing:p})=>[t(e(g),{variant:"destructive",type:"submit",disabled:p},{default:a(()=>[t(e(xe)),r[8]||(r[8]=d(" Disable 2FA ",-1))]),_:1},8,["disabled"])]),_:1},16)])])):(o(),n("div",wt,[t(e(Q),{variant:"destructive"},{default:a(()=>[...r[3]||(r[3]=[d("Disabled",-1)])]),_:1}),r[6]||(r[6]=s("p",{class:"text-muted-foreground"}," When you enable two-factor authentication, you will be prompted for a secure pin during login. This pin can be retrieved from a TOTP-supported application on your phone. ",-1)),s("div",null,[e(c)?(o(),v(e(g),{key:0,onClick:r[0]||(r[0]=p=>u.value=!0)},{default:a(()=>[t(e(I)),r[4]||(r[4]=d("Continue Setup ",-1))]),_:1})):(o(),v(e(j),B({key:1},e(De).form(),{onSuccess:r[1]||(r[1]=p=>u.value=!0)}),{default:a(({processing:p})=>[t(e(g),{type:"submit",disabled:p},{default:a(()=>[t(e(I)),r[5]||(r[5]=d("Enable 2FA",-1))]),_:1},8,["disabled"])]),_:1},16))])])),t(bt,{isOpen:u.value,"onUpdate:isOpen":r[2]||(r[2]=p=>u.value=p),requiresConfirmation:f.requiresConfirmation,twoFactorEnabled:f.twoFactorEnabled},null,8,["isOpen","requiresConfirmation","twoFactorEnabled"])])]),_:1})]),_:1}))}});export{Ht as default};
