import{N as B,_ as pe,O as ge,P as _e,Q as ve}from"./AppLayout.vue_vue_type_script_setup_true_lang-BpcLPOXg.js";import{_ as P}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-DA4pNA17.js";import{_ as be}from"./Pagination.vue_vue_type_script_setup_true_lang-CQM_G0lK.js";import{_ as xe}from"./index-CRPqrtU2.js";import{_ as A,v as F}from"./index-B4cH97KR.js";import{_ as O,a as E}from"./CardContent.vue_vue_type_script_setup_true_lang-LKEwQoWP.js";import{_ as q}from"./CardHeader.vue_vue_type_script_setup_true_lang-N3E9ALN1.js";import{_ as z}from"./CardTitle.vue_vue_type_script_setup_true_lang-Mk0zvokq.js";import{_ as J}from"./Checkbox.vue_vue_type_script_setup_true_lang-CHDpuY8C.js";import{_ as he,a as ye,b as ke,d as Se,e as Q,c as W}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-D90ORJgI.js";import{d as we,r as m,d8 as Re,p as X,q as Ce,E as Y,j as I,v as _,g as n,b as t,w as l,u as e,e as r,aj as $e,t as w,s as u,F as v,an as Z,z as De,a1 as Ve,c as p,Y as Be,aB as Ae,K as R,df as Fe,Z as Ie,x as T,y as G,n as i,D as ee,at as Te,aU as Me,ao as Pe,aM as Ue,A as je,B as Ke}from"./vendor-FclwbLvj.js";import{_ as Ne}from"./Input.vue_vue_type_script_setup_true_lang-ZVESK4JK.js";import{_ as He,a as Le,b as Oe,c as Ee,d as U}from"./SelectValue.vue_vue_type_script_setup_true_lang-BqISnkMA.js";import{_ as qe,a as ze,b as j,c as Je,d as Qe,e as se}from"./TableHeader.vue_vue_type_script_setup_true_lang-BhZiDflO.js";import{u as We}from"./usePermissions-DzkwVpfD.js";import"./index-CMWG4mbA.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-ByVucR83.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-9OZOAxj9.js";import"./index-B_n2dl-_.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-ZLo4HemS.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-DuXcz617.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-D_xJ4jwR.js";const Xe={class:"flex h-full flex-1 flex-col gap-6 p-6"},Ye={class:"flex items-center justify-between"},Ze={class:"grid gap-4 md:grid-cols-4"},Ge={class:"text-2xl font-bold"},es={class:"text-xs text-muted-foreground"},ss={class:"text-2xl font-bold text-green-600"},ts={class:"text-xs text-muted-foreground"},as={class:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between"},ls={class:"flex flex-1 items-center gap-4"},os={class:"relative flex-1 md:max-w-sm"},ns={class:"rounded-md border"},Vs=we({__name:"Index",props:{bonuses:{},statistics:{},filters:{}},setup(b){const{isSuperAdmin:C,isAdmin:$}=We(),c=b,te=[{title:"Bonus Cashback",href:B.url()}],h=m(c.filters.search||""),g=m(c.filters.status?.toString()||"all"),y=m([{id:c.filters.sort_by,desc:c.filters.sort_order==="desc"}]),K=m([]),N=m({}),k=m({}),[ae,le]=Re(),x=m({open:!1,bonus:null}),f=m({open:!1,bonus:null}),D=m({open:!1}),oe=X(()=>Object.keys(k.value).map(s=>c.bonuses.data[parseInt(s)]).filter(Boolean)),S=X(()=>oe.value.filter(s=>s.status===0)),V=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s),ne=s=>new Date(s).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),re=s=>{x.value={open:!0,bonus:s}},ie=()=>{x.value.bonus&&I.delete(ge.url(x.value.bonus.id),{preserveScroll:!0,onSuccess:()=>{x.value={open:!1,bonus:null}}})},ue=s=>{f.value={open:!0,bonus:s}},de=()=>{if(!f.value.bonus)return;ee({}).post(_e.url(f.value.bonus.id),{preserveScroll:!0,onSuccess:()=>{f.value={open:!1,bonus:null},k.value={}}})},me=()=>{S.value.length&&(D.value.open=!0)},ce=()=>{const s=S.value.map(o=>o.id);ee({ids:s}).post(ve.url(),{preserveScroll:!0,onSuccess:()=>{k.value={},D.value.open=!1}})},H=[{id:"select",header:({table:s})=>i(J,{modelValue:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate","onUpdate:modelValue":a=>s.toggleAllPageRowsSelected(!!a),ariaLabel:"Select all"}),cell:({row:s})=>i(J,{modelValue:s.getIsSelected(),"onUpdate:modelValue":a=>s.toggleSelected(!!a),ariaLabel:"Select row"}),enableSorting:!1,enableHiding:!1},{id:"index",header:()=>i("div",{class:"w-12"},"No"),cell:({row:s})=>i("div",{class:"font-medium"},s.index+1+(c.bonuses.current_page-1)*c.bonuses.per_page)},{accessorKey:"member_name",header:()=>"Member",cell:({row:s})=>i("div",[i("div",{class:"font-medium"},s.original.member_name),i("div",{class:"text-xs text-muted-foreground"},s.original.member_ewallet_id)])},{accessorKey:"order_id",header:()=>"Order ID",cell:({row:s})=>i("div",{class:"font-mono text-sm"},s.original.order_id||"-")},{accessorKey:"amount",header:()=>i("div",{class:"text-right"},"Jumlah"),cell:({row:s})=>i("div",{class:"text-right font-medium"},V(s.original.amount))},{accessorKey:"status",header:()=>"Status",cell:({row:s})=>i(xe,{variant:s.original.status===1?"default":"secondary",class:"gap-1"},()=>[i(s.original.status===1?Te:Me,{class:"h-3 w-3"}),s.original.status_text])},{accessorKey:"created_at",header:({column:s})=>i(A,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),class:"-ml-4"},()=>["Tanggal",i(Pe,{class:"ml-2 h-4 w-4"})]),cell:({row:s})=>ne(s.getValue("created_at"))},{id:"actions",enableHiding:!1,cell:({row:s})=>i(le,{bonus:s.original,onRelease:()=>ue(s.original),onDelete:()=>re(s.original)})}],M=Ce({get data(){return c.bonuses.data},columns:H,getCoreRowModel:Ke(),getSortedRowModel:je(),getFilteredRowModel:Ue(),onSortingChange:s=>F(s,y),onColumnFiltersChange:s=>F(s,K),onColumnVisibilityChange:s=>F(s,N),onRowSelectionChange:s=>F(s,k),state:{get sorting(){return y.value},get columnFilters(){return K.value},get columnVisibility(){return N.value},get rowSelection(){return k.value}},manualSorting:!0,enableRowSelection:!0});Y(y,s=>{s.length>0&&I.get(B.url(),{search:h.value||void 0,status:g.value!=="all"?parseInt(g.value):void 0,sort_by:s[0].id,sort_order:s[0].desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},{deep:!0});let L;return Y([h,g],()=>{clearTimeout(L),L=setTimeout(()=>{I.get(B.url(),{search:h.value||void 0,status:g.value!=="all"?parseInt(g.value):void 0,sort_by:y.value[0]?.id||"created_at",sort_order:y.value[0]?.desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},300)}),(s,a)=>(n(),_(v,null,[t(e(ae),null,{default:l(({bonus:o,onRelease:d,onDelete:fe})=>[t(e(he),null,{default:l(()=>[t(e(ye),{"as-child":""},{default:l(()=>[t(e(A),{variant:"ghost",class:"h-8 w-8 p-0"},{default:l(()=>[a[6]||(a[6]=r("span",{class:"sr-only"},"Open menu",-1)),t(e($e),{class:"h-4 w-4"})]),_:1})]),_:1}),t(e(ke),{align:"end"},{default:l(()=>[t(e(Se),null,{default:l(()=>[...a[7]||(a[7]=[u("Actions",-1)])]),_:1}),o.status===0&&(e(C)||e($))?(n(),_(v,{key:0},[t(e(Q)),t(e(W),{onClick:d},{default:l(()=>[t(e(Z),{class:"mr-2 h-4 w-4"}),a[8]||(a[8]=u(" Release Bonus ",-1))]),_:1},8,["onClick"])],64)):w("",!0),e(C)||e($)?(n(),_(v,{key:1},[t(e(Q)),t(e(W),{class:"text-destructive",onClick:fe},{default:l(()=>[t(e(De),{class:"mr-2 h-4 w-4"}),a[9]||(a[9]=u(" Hapus ",-1))]),_:1},8,["onClick"])],64)):w("",!0)]),_:2},1024)]),_:2},1024)]),_:1}),t(pe,{breadcrumbs:te},{default:l(()=>[t(e(Ve),{title:"Bonus Cashback"}),r("div",Xe,[r("div",Ye,[a[11]||(a[11]=r("div",null,[r("h1",{class:"text-3xl font-bold tracking-tight"},"Bonus Cashback"),r("p",{class:"text-muted-foreground"},"Kelola bonus cashback member")],-1)),e(C)||e($)?(n(),p(e(A),{key:0,onClick:a[0]||(a[0]=o=>e(I).visit("/bonus/cashback/create"))},{default:l(()=>[t(e(Be),{class:"mr-2 h-4 w-4"}),a[10]||(a[10]=u(" Tambah Bonus ",-1))]),_:1})):w("",!0)]),r("div",Ze,[t(e(O),null,{default:l(()=>[t(e(q),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[t(e(z),{class:"text-sm font-medium"},{default:l(()=>[...a[12]||(a[12]=[u("Total Pending",-1)])]),_:1}),t(e(Ae),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),t(e(E),null,{default:l(()=>[r("div",Ge,R(V(b.statistics.total_pending)),1),r("p",es,R(b.statistics.count_pending)+" transaksi",1)]),_:1})]),_:1}),t(e(O),null,{default:l(()=>[t(e(q),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[t(e(z),{class:"text-sm font-medium"},{default:l(()=>[...a[13]||(a[13]=[u("Total Released",-1)])]),_:1}),t(e(Fe),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),t(e(E),null,{default:l(()=>[r("div",ss,R(V(b.statistics.total_released)),1),r("p",ts,R(b.statistics.count_released)+" transaksi",1)]),_:1})]),_:1})]),r("div",as,[r("div",ls,[r("div",os,[t(e(Ie),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),t(e(Ne),{modelValue:h.value,"onUpdate:modelValue":a[1]||(a[1]=o=>h.value=o),placeholder:"Cari member...",class:"pl-9"},null,8,["modelValue"])]),t(e(He),{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=o=>g.value=o)},{default:l(()=>[t(e(Le),{class:"w-40"},{default:l(()=>[t(e(Oe),{placeholder:"Semua Status"})]),_:1}),t(e(Ee),null,{default:l(()=>[t(e(U),{value:"all"},{default:l(()=>[...a[14]||(a[14]=[u("Semua Status",-1)])]),_:1}),t(e(U),{value:"0"},{default:l(()=>[...a[15]||(a[15]=[u("Pending",-1)])]),_:1}),t(e(U),{value:"1"},{default:l(()=>[...a[16]||(a[16]=[u("Released",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),S.value.length&&(e(C)||e($))?(n(),p(e(A),{key:0,variant:"outline",onClick:me},{default:l(()=>[t(e(Z),{class:"mr-2 h-4 w-4"}),u(" Release "+R(S.value.length)+" Bonus ",1)]),_:1})):w("",!0)]),r("div",ns,[t(e(qe),null,{default:l(()=>[t(e(ze),null,{default:l(()=>[(n(!0),_(v,null,T(e(M).getHeaderGroups(),o=>(n(),p(e(j),{key:o.id},{default:l(()=>[(n(!0),_(v,null,T(o.headers,d=>(n(),p(e(Je),{key:d.id},{default:l(()=>[d.isPlaceholder?w("",!0):(n(),p(e(G),{key:0,render:d.column.columnDef.header,props:d.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),t(e(Qe),null,{default:l(()=>[e(M).getRowModel().rows?.length?(n(!0),_(v,{key:0},T(e(M).getRowModel().rows,o=>(n(),p(e(j),{key:o.id,"data-state":o.getIsSelected()&&"selected"},{default:l(()=>[(n(!0),_(v,null,T(o.getVisibleCells(),d=>(n(),p(e(se),{key:d.id},{default:l(()=>[t(e(G),{render:d.column.columnDef.cell,props:d.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1032,["data-state"]))),128)):(n(),p(e(j),{key:1},{default:l(()=>[t(e(se),{colspan:H.length,class:"h-24 text-center"},{default:l(()=>[...a[17]||(a[17]=[u("Tidak ada data. ",-1)])]),_:1},8,["colspan"])]),_:1}))]),_:1})]),_:1})]),t(be,{data:b.bonuses,url:e(B).url()},null,8,["data","url"])]),t(P,{open:x.value.open,title:"Hapus Bonus",description:"Apakah Anda yakin ingin menghapus bonus ini?","confirm-text":"Hapus","onUpdate:open":a[3]||(a[3]=o=>x.value.open=o),onConfirm:ie},null,8,["open"]),t(P,{open:f.value.open,title:"Release Bonus",description:`Apakah Anda yakin ingin merilis bonus sebesar ${f.value.bonus?V(f.value.bonus.amount):""} ke member?`,"confirm-text":"Release","onUpdate:open":a[4]||(a[4]=o=>f.value.open=o),onConfirm:de},null,8,["open","description"]),t(P,{open:D.value.open,title:"Mass Release Bonus",description:`Apakah Anda yakin ingin merilis ${S.value.length} bonus yang dipilih?`,"confirm-text":"Release All","onUpdate:open":a[5]||(a[5]=o=>D.value.open=o),onConfirm:ce},null,8,["open","description"])]),_:1})],64))}});export{Vs as default};
