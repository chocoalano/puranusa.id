import{d as ee,r as h,D as T,al as ae,p as te,q as se,c as _,g as i,w as o,b as l,e as u,u as a,a0 as le,a3 as D,s as m,Y as oe,Z as ne,v as x,F as k,x as V,t as R,y as B,n as s,K as $,ad as re,am as U,Q as p,an as z,ao as ie,ap as ue,$ as de,z as ce,j as F,B as me}from"./vendor-CVW9Nval.js";import{c as pe,i as A,_ as fe,t as ge,a as _e,e as ve,l as he,d as be}from"./AppLayout.vue_vue_type_script_setup_true_lang-BbJISVUI.js";import{_ as d}from"./index-B7p2qoN8.js";import{_ as j}from"./Input.vue_vue_type_script_setup_true_lang-Dtyom-PX.js";import{_ as L}from"./index-gctV3Ayh.js";import{_ as xe,a as ye,b as I,c as we,d as ke,e as G}from"./TableHeader.vue_vue_type_script_setup_true_lang-BqOLyMdL.js";import{_ as Ve}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-BJiLAzyM.js";import{_ as $e}from"./Pagination.vue_vue_type_script_setup_true_lang-DKF3iH7r.js";import{_ as Ce,a as Se,b as De,c as je,d as Ie}from"./DialogTitle.vue_vue_type_script_setup_true_lang-6gwUdpM3.js";import{_ as Ke}from"./DialogFooter.vue_vue_type_script_setup_true_lang-Cn8gwyVG.js";import{_ as H}from"./Label.vue_vue_type_script_setup_true_lang-1GqaQLHe.js";import"./index-DaR_mHDg.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-DenOdfSF.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-BvNVfb1D.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DKSq9Cld.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BE6efEuL.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-1rpGkrO5.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-B6g-EPwh.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-Rp4It03a.js";const Ee={class:"rounded-xl p-4 space-y-6 py-6"},Pe={class:"mb-6 flex items-center justify-between"},Me={class:"mb-4 flex items-center gap-4"},Ne={class:"relative flex-1"},Te={class:"rounded-md border"},Re={class:"space-y-2"},Be={key:0,class:"text-sm text-destructive"},Ue={class:"space-y-2"},oa=ee({__name:"Index",props:{customers:{},filters:{}},setup(K){const f=h({open:!1,data:null}),n=T({amount:"",description:""}),q=t=>{f.value={open:!0,data:t},n.reset(),n.clearErrors(),n.amount="",n.description=""},C=()=>{f.value.open=!1,n.reset(),n.clearErrors()},J=()=>{if(!f.value.data)return;const t=Number(n.amount);if(!t||t<1e4){p.error("Jumlah minimal Rp 10.000");return}n.post(ge.url(f.value.data.id),{preserveScroll:!0,onSuccess:()=>{p.success("Saldo berhasil ditambahkan"),C()},onError:e=>{e.amount?p.error(e.amount):p.error("Gagal menambahkan saldo")}})},O=T({}),Q=(t,e)=>{O.post(he.url(t),{onSuccess:()=>{p.success(`Login sebagai ${e}`)},onError:()=>{p.error("Gagal login sebagai customer")}})},g=K,y=h(g.filters.search||""),w=h(g.filters.sort_by||"created_at"),b=h(g.filters.sort_order||"desc"),E=h(g.filters.per_page||10),W=t=>{F.delete(be.url(t),{preserveScroll:!0,onSuccess:()=>{p.success("Pelanggan berhasil dihapus")},onError:()=>{p.error("Gagal menghapus pelanggan")}})},v=h({open:!1,data:null}),Y=t=>{v.value={open:!0,data:t}},P=ae(()=>{F.get(A.url(),{search:y.value,sort_by:w.value,sort_order:b.value,per_page:E.value},{preserveState:!0,preserveScroll:!0})},300),M=t=>{w.value===t?b.value=b.value==="asc"?"desc":"asc":(w.value=t,b.value="asc"),P()},Z=()=>{v.value.data&&W(v.value.data.id)},N=[{id:"index",header:()=>s("div",{class:"text-left"},"No"),cell:({row:t})=>{const e=t.index+1+(g.customers.current_page-1)*g.customers.per_page;return s("div",{class:"text-left"},e.toString())}},{accessorKey:"ewallet_id",header:()=>s(d,{variant:"ghost",onClick:()=>M("ewallet_id")},()=>["Ewallet ID",s(z,{class:"ml-2 h-4 w-4"})]),cell:({row:t})=>s("div",{class:"font-mono text-sm"},t.getValue("ewallet_id"))},{accessorKey:"name",header:()=>s(d,{variant:"ghost",onClick:()=>M("name")},()=>["Nama",s(z,{class:"ml-2 h-4 w-4"})]),cell:({row:t})=>s("div",{},t.getValue("name"))},{accessorKey:"email",header:"Email",cell:({row:t})=>s("div",{class:"text-sm"},t.getValue("email"))},{accessorKey:"phone",header:"Telepon",cell:({row:t})=>{const e=t.getValue("phone");return s("div",{class:"text-sm"},e||"-")}},{accessorKey:"ewallet_saldo",header:()=>s("div",{class:"text-right"},"Saldo"),cell:({row:t})=>{const e=t.getValue("ewallet_saldo");return s("div",{class:"text-right font-medium"},"Rp "+new Intl.NumberFormat("id-ID").format(e))}},{accessorKey:"position",header:"Posisi",cell:({row:t})=>{const e=t.getValue("position");return e?s(L,{variant:e==="left"?"default":"secondary",class:"capitalize"},()=>e):s("div",{class:"text-center"},"-")}},{accessorKey:"email_verified_at",header:"Status",cell:({row:t})=>{const e=t.getValue("email_verified_at");return s(L,{variant:e?"default":"outline"},()=>e?"Verified":"Unverified")}},{id:"actions",header:()=>s("div",{class:"text-center"},"Aksi"),cell:({row:t})=>{const e=t.original,r=[s(d,{variant:"ghost",size:"icon",onClick:()=>q(e),title:"Inject Ewallet"},()=>s(U,{class:"h-4 w-4 text-green-600"})),s(d,{variant:"ghost",size:"icon",onClick:()=>Q(e.id,e.name),title:"Login sebagai customer"},()=>s(ie,{class:"h-4 w-4 text-primary"})),s(D,{href:_e.url(e.id)},()=>s(d,{variant:"ghost",size:"icon"},()=>s(ue,{class:"h-4 w-4"}))),s(D,{href:ve.url(e.id)},()=>s(d,{variant:"ghost",size:"icon"},()=>s(de,{class:"h-4 w-4"})))];return e.status!==2&&r.push(s(d,{variant:"ghost",size:"icon",onClick:()=>Y(e)},()=>s(ce,{class:"h-4 w-4 text-destructive"}))),s("div",{class:"flex items-center justify-center gap-2"},r)}}],X=te(()=>g.customers.data),S=se({get data(){return X.value},columns:N,getCoreRowModel:me(),manualSorting:!0,manualPagination:!0});return(t,e)=>(i(),_(fe,null,{default:o(()=>[l(a(le),{title:"Kelola Pelanggan"}),u("div",Ee,[u("div",Pe,[e[6]||(e[6]=u("div",null,[u("h1",{class:"text-3xl font-bold tracking-tight"},"Kelola Pelanggan"),u("p",{class:"text-muted-foreground"}," Kelola data pelanggan dan jaringan MLM ")],-1)),l(a(D),{href:a(pe).url()},{default:o(()=>[l(a(d),null,{default:o(()=>[l(a(oe),{class:"mr-2 h-4 w-4"}),e[5]||(e[5]=m(" Tambah Pelanggan ",-1))]),_:1})]),_:1},8,["href"])]),u("div",Me,[u("div",Ne,[l(a(ne),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),l(a(j),{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=r=>y.value=r),placeholder:"Cari nama, email, telepon, atau ewallet ID...",class:"pl-10",onInput:a(P)},null,8,["modelValue","onInput"])])]),u("div",Te,[l(a(xe),null,{default:o(()=>[l(a(ye),null,{default:o(()=>[(i(!0),x(k,null,V(a(S).getHeaderGroups(),r=>(i(),_(a(I),{key:r.id},{default:o(()=>[(i(!0),x(k,null,V(r.headers,c=>(i(),_(a(we),{key:c.id},{default:o(()=>[c.isPlaceholder?R("",!0):(i(),_(a(B),{key:0,render:c.column.columnDef.header,props:c.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),l(a(ke),null,{default:o(()=>[a(S).getRowModel().rows?.length?(i(!0),x(k,{key:0},V(a(S).getRowModel().rows,r=>(i(),_(a(I),{key:r.id},{default:o(()=>[(i(!0),x(k,null,V(r.getVisibleCells(),c=>(i(),_(a(G),{key:c.id},{default:o(()=>[l(a(B),{render:c.column.columnDef.cell,props:c.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1024))),128)):(i(),_(a(I),{key:1},{default:o(()=>[l(a(G),{colspan:N.length,class:"h-24 text-center"},{default:o(()=>[...e[7]||(e[7]=[m(" Tidak ada data pelanggan. ",-1)])]),_:1},8,["colspan"])]),_:1}))]),_:1})]),_:1})]),l($e,{data:K.customers,url:a(A).url(),filters:{search:y.value,sort_by:w.value,sort_order:b.value,per_page:E.value}},null,8,["data","url","filters"])]),l(Ve,{open:v.value.open,"onUpdate:open":e[1]||(e[1]=r=>v.value.open=r),title:"Hapus Pelanggan?",description:`Apakah Anda yakin ingin menghapus pelanggan ${v.value.data?.name}? Tindakan ini tidak dapat dibatalkan dan akan menghapus semua data terkait termasuk jaringan dan bonus.`,"confirm-text":"Hapus","cancel-text":"Batal",variant:"destructive",onConfirm:Z},null,8,["open","description"]),l(a(Ce),{open:f.value.open,"onUpdate:open":e[4]||(e[4]=r=>!r&&C())},{default:o(()=>[l(a(Se),{class:"sm:max-w-md"},{default:o(()=>[l(a(De),null,{default:o(()=>[l(a(je),null,{default:o(()=>[...e[8]||(e[8]=[m("Inject Ewallet",-1)])]),_:1}),l(a(Ie),null,{default:o(()=>[m(" Tambahkan saldo ke ewallet "+$(f.value.data?.name)+" ("+$(f.value.data?.ewallet_id)+") ",1)]),_:1})]),_:1}),u("form",{onSubmit:re(J,["prevent"]),class:"space-y-4"},[u("div",Re,[l(a(H),{for:"amount"},{default:o(()=>[...e[9]||(e[9]=[m("Jumlah (Rp)",-1)])]),_:1}),l(a(j),{id:"amount",modelValue:a(n).amount,"onUpdate:modelValue":e[2]||(e[2]=r=>a(n).amount=r),modelModifiers:{number:!0},type:"number",min:"10000",step:"1000",placeholder:"Minimal Rp 10.000",required:""},null,8,["modelValue"]),a(n).errors.amount?(i(),x("p",Be,$(a(n).errors.amount),1)):R("",!0)]),u("div",Ue,[l(a(H),{for:"description"},{default:o(()=>[...e[10]||(e[10]=[m("Keterangan (Opsional)",-1)])]),_:1}),l(a(j),{id:"description",modelValue:a(n).description,"onUpdate:modelValue":e[3]||(e[3]=r=>a(n).description=r),type:"text",placeholder:"Contoh: Top up manual oleh admin"},null,8,["modelValue"])]),l(a(Ke),{class:"gap-2 sm:gap-0"},{default:o(()=>[l(a(d),{type:"button",variant:"outline",disabled:a(n).processing,onClick:C},{default:o(()=>[...e[11]||(e[11]=[m(" Batal ",-1)])]),_:1},8,["disabled"]),l(a(d),{type:"submit",disabled:a(n).processing||!a(n).amount||Number(a(n).amount)<1e4},{default:o(()=>[l(a(U),{class:"mr-2 h-4 w-4"}),m(" "+$(a(n).processing?"Memproses...":"Tambahkan Saldo"),1)]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"])]),_:1}))}});export{oa as default};
