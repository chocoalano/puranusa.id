import{L as Y,M as ee,_ as te}from"./AppLayout.vue_vue_type_script_setup_true_lang-Dq658Cth.js";import{d as j,v as w,g as m,b as a,u as t,w as n,s as p,aw as ae,e as f,K as k,as as le,aR as se,aA as re,ab as O,ac as T,Z as ne,a9 as ie,F as h,x as $,c as v,t as Q,r as b,D as z,q as oe,y as ue,n as u,bz as de,X as ce,an as me,aL as fe,A as pe,B as ge,E as X,j as J,a0 as we,br as S}from"./vendor-flWeloHs.js";import{_ as F,a as R}from"./CardContent.vue_vue_type_script_setup_true_lang-DFr8PgO7.js";import{_ as C}from"./CardHeader.vue_vue_type_script_setup_true_lang-Cgov_qDz.js";import{_ as V}from"./CardTitle.vue_vue_type_script_setup_true_lang-BdUxjhrU.js";import{f as ve}from"./currency-DfrMaoZy.js";import{_ as xe}from"./Pagination.vue_vue_type_script_setup_true_lang-D5lnraLN.js";import{_ as M,v as K}from"./index-D9Hie8NE.js";import{_ as _e}from"./Input.vue_vue_type_script_setup_true_lang-BI8FpPnw.js";import{_ as he,a as be,b as ye,c as De,d as A}from"./SelectValue.vue_vue_type_script_setup_true_lang-CnNjP2es.js";import{_ as ke,a as $e,b as je}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BLeUwnH4.js";import{_ as Se}from"./DropdownMenuCheckboxItem.vue_vue_type_script_setup_true_lang-DlsQO5tE.js";import{_ as Fe,a as Re,c as Ce,b as I,d as Ve,e as L}from"./TableHeader.vue_vue_type_script_setup_true_lang-Dhjk0EnN.js";import{_ as H}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-Cl2-SULB.js";import{_ as Ae}from"./index-BonpZqDt.js";import"./index-CMWG4mbA.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-D5yDigSh.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-Dv6VzhWI.js";import"./index-DqFeuJ-n.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BC4ik9Oa.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-BsQpZQb0.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-CL8LVL2o.js";const Me={class:"grid gap-4 md:grid-cols-4"},Te={class:"text-2xl font-bold"},We={class:"text-2xl font-bold"},Ue={class:"text-2xl font-bold"},Be={class:"text-2xl font-bold"},Ke=j({__name:"WithdrawalStatistics",props:{statistics:{}},setup(e){return(o,l)=>(m(),w("div",Me,[a(t(F),null,{default:n(()=>[a(t(C),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:n(()=>[a(t(V),{class:"text-sm font-medium"},{default:n(()=>[...l[0]||(l[0]=[p("Pending",-1)])]),_:1}),a(t(ae),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(t(R),null,{default:n(()=>[f("div",Te,k(e.statistics.total_pending),1),l[1]||(l[1]=f("p",{class:"text-xs text-muted-foreground"},"Menunggu persetujuan",-1))]),_:1})]),_:1}),a(t(F),null,{default:n(()=>[a(t(C),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:n(()=>[a(t(V),{class:"text-sm font-medium"},{default:n(()=>[...l[2]||(l[2]=[p("Disetujui",-1)])]),_:1}),a(t(le),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(t(R),null,{default:n(()=>[f("div",We,k(e.statistics.total_completed),1),l[3]||(l[3]=f("p",{class:"text-xs text-muted-foreground"},"Withdrawal selesai",-1))]),_:1})]),_:1}),a(t(F),null,{default:n(()=>[a(t(C),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:n(()=>[a(t(V),{class:"text-sm font-medium"},{default:n(()=>[...l[4]||(l[4]=[p("Ditolak",-1)])]),_:1}),a(t(se),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(t(R),null,{default:n(()=>[f("div",Ue,k(e.statistics.total_failed),1),l[5]||(l[5]=f("p",{class:"text-xs text-muted-foreground"},"Withdrawal gagal",-1))]),_:1})]),_:1}),a(t(F),null,{default:n(()=>[a(t(C),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:n(()=>[a(t(V),{class:"text-sm font-medium"},{default:n(()=>[...l[6]||(l[6]=[p("Total Nominal",-1)])]),_:1}),a(t(re),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(t(R),null,{default:n(()=>[f("div",Be,k(t(ve)(e.statistics.total_amount)),1),l[7]||(l[7]=f("p",{class:"text-xs text-muted-foreground"},"Total withdrawal berhasil",-1))]),_:1})]),_:1})]))}}),Ie={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},Ne={class:"flex flex-1 gap-4"},Pe={class:"relative flex-1 max-w-sm"},qe=j({__name:"WithdrawalFiltersBar",props:O({table:{}},{search:{default:""},searchModifiers:{},statusFilter:{default:"all"},statusFilterModifiers:{}}),emits:["update:search","update:statusFilter"],setup(e){const o=T(e,"search"),l=T(e,"statusFilter");return(d,r)=>(m(),w("div",Ie,[f("div",Ne,[f("div",Pe,[a(t(ne),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),a(t(_e),{modelValue:o.value,"onUpdate:modelValue":r[0]||(r[0]=c=>o.value=c),placeholder:"Cari pelanggan atau referensi...",class:"pl-9"},null,8,["modelValue"])]),a(t(he),{modelValue:l.value,"onUpdate:modelValue":r[1]||(r[1]=c=>l.value=c)},{default:n(()=>[a(t(be),{class:"w-[180px]"},{default:n(()=>[a(t(ye),{placeholder:"Semua Status"})]),_:1}),a(t(De),null,{default:n(()=>[a(t(A),{value:"all"},{default:n(()=>[...r[2]||(r[2]=[p("Semua Status",-1)])]),_:1}),a(t(A),{value:"pending"},{default:n(()=>[...r[3]||(r[3]=[p("Pending",-1)])]),_:1}),a(t(A),{value:"completed"},{default:n(()=>[...r[4]||(r[4]=[p("Completed",-1)])]),_:1}),a(t(A),{value:"failed"},{default:n(()=>[...r[5]||(r[5]=[p("Failed",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),a(t(ke),null,{default:n(()=>[a(t($e),{"as-child":""},{default:n(()=>[a(t(M),{variant:"outline",class:"ml-auto"},{default:n(()=>[r[6]||(r[6]=p(" Kolom ",-1)),a(t(ie),{class:"ml-2 h-4 w-4"})]),_:1})]),_:1}),a(t(je),{align:"end"},{default:n(()=>[(m(!0),w(h,null,$(e.table.getAllColumns().filter(c=>c.getCanHide()),c=>(m(),v(t(Se),{key:c.id,class:"capitalize","model-value":c.getIsVisible(),"onUpdate:modelValue":y=>c.toggleVisibility(!!y)},{default:n(()=>[p(k(c.id),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})]))}}),ze={class:"rounded-md border"},Le=j({__name:"WithdrawalTable",props:{table:{},columns:{},FlexRender:{}},setup(e){return(o,l)=>(m(),w("div",ze,[a(t(Fe),null,{default:n(()=>[a(t(Re),null,{default:n(()=>[(m(!0),w(h,null,$(e.table.getHeaderGroups(),d=>(m(),v(t(I),{key:d.id},{default:n(()=>[(m(!0),w(h,null,$(d.headers,r=>(m(),v(t(Ce),{key:r.id},{default:n(()=>[r.isPlaceholder?Q("",!0):(m(),v(t(e.FlexRender),{key:0,render:r.column.columnDef.header,props:r.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),a(t(Ve),null,{default:n(()=>[e.table.getRowModel().rows?.length?(m(!0),w(h,{key:0},$(e.table.getRowModel().rows,d=>(m(),v(t(I),{key:d.id},{default:n(()=>[(m(!0),w(h,null,$(d.getVisibleCells(),r=>(m(),v(t(L),{key:r.id},{default:n(()=>[a(t(e.FlexRender),{render:r.column.columnDef.cell,props:r.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1024))),128)):(m(),v(t(I),{key:1},{default:n(()=>[a(t(L),{colspan:e.columns.length,class:"h-24 text-center"},{default:n(()=>[...l[0]||(l[0]=[p(" Tidak ada permintaan withdrawal. ",-1)])]),_:1},8,["colspan"])]),_:1}))]),_:1})]),_:1})]))}}),_=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e??0),He=e=>new Date(e).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),Ee=e=>({pending:"secondary",completed:"default",failed:"destructive"})[e]||"secondary",Oe=j({__name:"WithdrawalActionDialogs",props:{approveDialog:{required:!0},approveDialogModifiers:{},rejectDialog:{required:!0},rejectDialogModifiers:{}},emits:O(["approve","reject"],["update:approveDialog","update:rejectDialog"]),setup(e){const o=T(e,"approveDialog"),l=T(e,"rejectDialog");return(d,r)=>(m(),w(h,null,[a(H,{open:o.value.open,"onUpdate:open":r[0]||(r[0]=c=>o.value.open=c),title:"Setujui Withdrawal?",description:`Apakah Anda yakin ingin menyetujui permintaan withdrawal sebesar ${o.value.withdrawal?t(_)(o.value.withdrawal.amount):""} untuk ${o.value.withdrawal?.customer.name}? Dana akan ditransfer via Midtrans ke rekening tujuan.`,"confirm-text":"Setujui & Transfer","cancel-text":"Batal",onConfirm:r[1]||(r[1]=c=>d.$emit("approve"))},null,8,["open","description"]),a(H,{open:l.value.open,"onUpdate:open":r[2]||(r[2]=c=>l.value.open=c),title:"Tolak Withdrawal?",description:`Apakah Anda yakin ingin menolak permintaan withdrawal sebesar ${l.value.withdrawal?t(_)(l.value.withdrawal.amount):""} dari ${l.value.withdrawal?.customer.name}?`,"confirm-text":"Tolak","cancel-text":"Batal",variant:"destructive",onConfirm:r[3]||(r[3]=c=>d.$emit("reject"))},null,8,["open","description"])],64))}});function Qe(){const e=b({open:!1,withdrawal:null}),o=b({open:!1,withdrawal:null}),l=s=>e.value={open:!0,withdrawal:s},d=s=>o.value={open:!0,withdrawal:s},r=()=>e.value={open:!1,withdrawal:null},c=()=>o.value={open:!1,withdrawal:null};return{approveDialog:e,rejectDialog:o,openApproveDialog:l,openRejectDialog:d,handleApprove:()=>{const s=e.value.withdrawal;if(!s)return;z({}).post(ee.url(s.id),{preserveScroll:!0,onSuccess:r})},handleReject:()=>{const s=o.value.withdrawal;if(!s)return;z({}).post(Y.url(s.id),{preserveScroll:!0,onSuccess:c})}}}const E=e=>typeof e=="object"&&e!==null&&!Array.isArray(e),N=e=>{if(!e)return null;if(E(e))return e;if(typeof e=="string")try{const o=JSON.parse(e);return E(o)?o:null}catch{return null}return null};function Xe(e){const o=b([{id:"created_at",desc:!0}]),l=b([]),d=b({}),r=i=>({column:s})=>u(M,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),class:"-ml-4"},()=>[i,u(me,{class:"ml-2 h-4 w-4"})]),c=[{id:"index",header:()=>u("div",{class:"w-12"},"No"),cell:({row:i})=>{const s=i.index+1+(e.withdrawals.current_page-1)*e.withdrawals.per_page;return u("div",{class:"font-medium"},s)}},{accessorKey:"customer.name",header:r("Pelanggan"),cell:({row:i})=>{const s=i.original.customer;return u("div",[u("div",{class:"font-medium"},s.name),u("div",{class:"text-xs text-muted-foreground"},s.email)])}},{accessorKey:"customer.username",header:r("Username"),cell:({row:i})=>{const s=i.original.customer;return u("div",[u("div",{class:"font-medium"},s.username),u("div",{class:"text-xs text-muted-foreground"},s.email)])}},{accessorKey:"customer.ewallet_saldo",header:()=>"Saldo Sekarang",cell:({row:i})=>u("div",_(i.original.customer.ewallet_saldo))},{accessorKey:"balance_before",header:()=>"Saldo Sebelum",cell:({row:i})=>u("div",_(i.getValue("balance_before")))},{accessorKey:"amount",header:()=>"Penarikan",cell:({row:i})=>u("div",{class:"font-bold text-red-600"},_(i.getValue("amount")))},{id:"admin_fee",header:()=>"Biaya Admin",cell:({row:i})=>{const s=N(i.original.notes);return s?u("div",{class:"text-xs font-medium"},_(s.admin_fee??0)):u("div",{class:"text-xs text-muted-foreground"},"-")}},{id:"net_amount",header:()=>"Penarikan Net",cell:({row:i})=>{const s=N(i.original.notes);return s?u("div",{class:"text-xs font-medium"},_(s.net_amount??0)):u("div",{class:"text-xs text-muted-foreground"},"-")}},{id:"bank_destination",header:()=>"Rekening Tujuan",cell:({row:i})=>{const s=N(i.original.notes);return s?u("div",[u("div",{class:"text-xs font-medium"},`${s.bank_name} - ${s.bank_account}`),u("div",{class:"text-xs text-muted-foreground"},s.bank_holder)]):u("div",{class:"text-xs text-muted-foreground"},"-")}},{accessorKey:"transaction_ref",header:()=>"Referensi",cell:({row:i})=>u("div",{class:"font-mono text-xs"},i.getValue("transaction_ref"))},{accessorKey:"status",header:()=>"Status",cell:({row:i})=>{const s=i.getValue("status");return u(Ae,{variant:Ee(s)},()=>s)}},{accessorKey:"created_at",header:()=>"Tanggal",cell:({row:i})=>u("div",{class:"text-sm"},He(i.getValue("created_at")))},{id:"actions",header:()=>u("div",{class:"text-right"},"Aksi"),cell:({row:i})=>{const s=i.original;if(s.status!=="pending")return null;const D=s.balance_before<s.amount;return u("div",{class:"flex justify-end gap-2"},[u(M,{size:"sm",onClick:()=>e.onApprove(s),disabled:D},()=>[u(de,{class:"mr-1 h-4 w-4"}),"Setujui"]),u(M,{size:"sm",variant:"destructive",onClick:()=>e.onReject(s)},()=>[u(ce,{class:"mr-1 h-4 w-4"}),"Tolak"])])}}];return{table:oe({get data(){return e.withdrawals.data},columns:c,getCoreRowModel:ge(),getSortedRowModel:pe(),getFilteredRowModel:fe(),onSortingChange:i=>K(i,o),onColumnFiltersChange:i=>K(i,l),onColumnVisibilityChange:i=>K(i,d),state:{get sorting(){return o.value},get columnFilters(){return l.value},get columnVisibility(){return d.value}},manualSorting:!0}),columns:c,sorting:o,FlexRender:ue}}function Je(e,o,l=300){let d=null;X(e,()=>{d&&clearTimeout(d),d=setTimeout(o,l)},{deep:!0})}function Ze(e){const o=e.endpoint??"/admin/withdrawals",l=b(e.initialFilters.search||""),d=b(e.initialFilters.status||"all"),r=()=>({search:l.value||void 0,status:d.value!=="all"?d.value:void 0,sort_by:e.sorting.value[0]?.id||"created_at",sort_order:e.sorting.value[0]?.desc?"desc":"asc"}),c=()=>{J.get(o,r(),{preserveState:!0,preserveScroll:!0})};return Je([l,d],c,300),{search:l,statusFilter:d,buildQuery:r,go:c}}const Ge={class:"rounded-xl p-4 space-y-6 py-6"},bt=j({__name:"Index",props:{withdrawals:{},statistics:{},filters:{}},setup(e){const o=e,{approveDialog:l,rejectDialog:d,openApproveDialog:r,openRejectDialog:c,handleApprove:y,handleReject:i}=Qe(),{table:s,columns:D,sorting:W,FlexRender:Z}=Xe({withdrawals:o.withdrawals,onApprove:r,onReject:c}),G=[{id:o.filters.sort_by||"created_at",desc:o.filters.sort_order==="desc"}];W.value=G;const{search:U,statusFilter:B,buildQuery:P}=Ze({initialFilters:o.filters,sorting:W,endpoint:"/admin/withdrawals"});return X(W,q=>{q.length&&J.get("/admin/withdrawals",P(),{preserveState:!0,preserveScroll:!0})},{deep:!0}),(q,g)=>(m(),w(h,null,[a(t(we),{title:"Permintaan Withdrawal"}),a(te,null,{default:n(()=>[f("div",Ge,[g[4]||(g[4]=f("div",null,[f("h2",{class:"text-3xl font-bold tracking-tight"},"Permintaan Withdrawal"),f("p",{class:"text-muted-foreground"},"Kelola permintaan penarikan saldo dari pelanggan")],-1)),a(Ke,{statistics:e.statistics},null,8,["statistics"]),a(qe,{table:t(s),search:t(U),"onUpdate:search":g[0]||(g[0]=x=>S(U)?U.value=x:null),statusFilter:t(B),"onUpdate:statusFilter":g[1]||(g[1]=x=>S(B)?B.value=x:null)},null,8,["table","search","statusFilter"]),a(Le,{table:t(s),columns:t(D),FlexRender:t(Z)},null,8,["table","columns","FlexRender"]),e.withdrawals.last_page>1?(m(),v(xe,{key:0,data:{current_page:e.withdrawals.current_page,last_page:e.withdrawals.last_page,per_page:e.withdrawals.per_page,from:(e.withdrawals.current_page-1)*e.withdrawals.per_page+1,to:Math.min(e.withdrawals.current_page*e.withdrawals.per_page,e.withdrawals.total),total:e.withdrawals.total},url:"/admin/withdrawals",filters:t(P)()},null,8,["data","filters"])):Q("",!0)]),a(Oe,{approveDialog:t(l),"onUpdate:approveDialog":g[2]||(g[2]=x=>S(l)?l.value=x:null),rejectDialog:t(d),"onUpdate:rejectDialog":g[3]||(g[3]=x=>S(d)?d.value=x:null),onApprove:t(y),onReject:t(i)},null,8,["approveDialog","rejectDialog","onApprove","onReject"])]),_:1})],64))}});export{bt as default};
