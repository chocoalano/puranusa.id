import{a9 as D,_ as pe,aa as ge,ab as _e,ac as ve}from"./AppLayout.vue_vue_type_script_setup_true_lang-35H6kF2Q.js";import{_ as j}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-CHQ9npTO.js";import{_ as be}from"./Pagination.vue_vue_type_script_setup_true_lang-C9mRYDbu.js";import{_ as xe}from"./index-DJdtjFok.js";import{_ as B,v as V}from"./index-DOPQVStN.js";import{_ as E,a as q}from"./CardContent.vue_vue_type_script_setup_true_lang-BV46Qjf6.js";import{_ as O}from"./CardHeader.vue_vue_type_script_setup_true_lang-DX_68Rs3.js";import{_ as z}from"./CardTitle.vue_vue_type_script_setup_true_lang-6MEUvz4F.js";import{_ as W}from"./Checkbox.vue_vue_type_script_setup_true_lang-CMtdorAb.js";import{_ as ye,a as he,b as Se,d as Re,e as X,c as Y}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DZMMg15k.js";import{d as we,r as m,d4 as ke,p as Z,q as $e,E as G,j as A,v as b,g as r,b as t,w as l,u as e,e as i,aj as Ce,t as k,c,s as u,F as x,an as J,z as De,a1 as Be,a2 as Ve,Y as Ae,aB as Fe,K as $,db as Ie,Z as Me,x as F,y as Q,n as o,D as ee,at as Te,aS as je,ao as Pe,aM as Ue,A as Ke,B as Ne}from"./vendor-DUvsJjJb.js";import{_ as He}from"./Input.vue_vue_type_script_setup_true_lang-CEbduRS7.js";import{_ as Le,a as Ee,b as qe,c as Oe,d as P}from"./SelectValue.vue_vue_type_script_setup_true_lang-DBmRzu0f.js";import{_ as ze,a as We,b as U,c as Xe,d as Ye,e as se}from"./TableHeader.vue_vue_type_script_setup_true_lang-Crus1WCM.js";import{u as Ze}from"./usePermissions-DlA7oHe8.js";import"./index-CMWG4mbA.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-BsVHnDIv.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-C2b1rchR.js";import"./index-B_n2dl-_.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-WS0Mkk1r.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-wUHj3qHV.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-CWW0yFn3.js";const Ge={class:"flex h-full flex-1 flex-col gap-6 p-6"},Je={class:"flex items-center justify-between"},Qe={class:"text-3xl font-bold tracking-tight flex items-center gap-2"},es={class:"grid gap-4 md:grid-cols-4"},ss={class:"text-2xl font-bold"},ts={class:"text-xs text-muted-foreground"},as={class:"text-2xl font-bold text-green-600"},ls={class:"text-xs text-muted-foreground"},ns={class:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between"},os={class:"flex flex-1 items-center gap-4"},rs={class:"relative flex-1 md:max-w-sm"},is={class:"rounded-md border"},As=we({__name:"Index",props:{bonuses:{},statistics:{},filters:{}},setup(_){const{isSuperAdmin:I,isAdmin:M}=Ze(),f=_,te=[{title:"Bonus Retail",href:D.url()}],y=m(f.filters.search||""),g=m(f.filters.status?.toString()||"all"),h=m([{id:f.filters.sort_by,desc:f.filters.sort_order==="desc"}]),K=m([]),N=m({}),S=m({}),[ae,le]=ke(),v=m({open:!1,bonus:null}),p=m({open:!1,bonus:null}),C=m({open:!1}),ne=Z(()=>Object.keys(S.value).map(s=>f.bonuses.data[parseInt(s)]).filter(Boolean)),R=Z(()=>ne.value.filter(s=>s.status===0)),w=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s),oe=s=>new Date(s).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),re=s=>{v.value={open:!0,bonus:s}},ie=()=>{v.value.bonus&&A.delete(ge.url(v.value.bonus.id),{preserveScroll:!0,onSuccess:()=>{v.value={open:!1,bonus:null}}})},ue=s=>{p.value={open:!0,bonus:s}},de=()=>{if(!p.value.bonus)return;ee({}).post(_e.url(p.value.bonus.id),{preserveScroll:!0,onSuccess:()=>{p.value={open:!1,bonus:null},S.value={}}})},me=()=>{R.value.length&&(C.value.open=!0)},ce=()=>{const s=R.value.map(n=>n.id);ee({ids:s}).post(ve.url(),{preserveScroll:!0,onSuccess:()=>{S.value={},C.value.open=!1}})},H=[{id:"select",header:({table:s})=>o(W,{modelValue:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate","onUpdate:modelValue":a=>s.toggleAllPageRowsSelected(!!a),ariaLabel:"Select all"}),cell:({row:s})=>o(W,{modelValue:s.getIsSelected(),"onUpdate:modelValue":a=>s.toggleSelected(!!a),ariaLabel:"Select row"}),enableSorting:!1,enableHiding:!1},{id:"index",header:()=>o("div",{class:"w-12"},"No"),cell:({row:s})=>o("div",{class:"font-medium"},s.index+1+(f.bonuses.current_page-1)*f.bonuses.per_page)},{accessorKey:"member_name",header:()=>"Member",cell:({row:s})=>o("div",[o("div",{class:"font-medium"},s.original.member_name),o("div",{class:"text-xs text-muted-foreground"},s.original.member_ewallet_id)])},{accessorKey:"from_member_name",header:()=>"Dari Member",cell:({row:s})=>o("div",[o("div",{class:"font-medium"},s.original.from_member_name),o("div",{class:"text-xs text-muted-foreground"},s.original.from_member_ewallet_id)])},{accessorKey:"retail_value",header:()=>o("div",{class:"text-right"},"Nilai Retail"),cell:({row:s})=>o("div",{class:"text-right text-muted-foreground"},w(s.original.retail_value))},{accessorKey:"amount",header:()=>o("div",{class:"text-right"},"Bonus"),cell:({row:s})=>o("div",{class:"text-right font-medium"},w(s.original.amount))},{accessorKey:"status",header:()=>"Status",cell:({row:s})=>o(xe,{variant:s.original.status===1?"default":"secondary",class:"gap-1"},()=>[o(s.original.status===1?Te:je,{class:"h-3 w-3"}),s.original.status_text])},{accessorKey:"created_at",header:({column:s})=>o(B,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),class:"-ml-4"},()=>["Tanggal",o(Pe,{class:"ml-2 h-4 w-4"})]),cell:({row:s})=>oe(s.getValue("created_at"))},{id:"actions",enableHiding:!1,cell:({row:s})=>o(le,{bonus:s.original,onRelease:()=>ue(s.original),onDelete:()=>re(s.original)})}],T=$e({get data(){return f.bonuses.data},columns:H,getCoreRowModel:Ne(),getSortedRowModel:Ke(),getFilteredRowModel:Ue(),onSortingChange:s=>V(s,h),onColumnFiltersChange:s=>V(s,K),onColumnVisibilityChange:s=>V(s,N),onRowSelectionChange:s=>V(s,S),state:{get sorting(){return h.value},get columnFilters(){return K.value},get columnVisibility(){return N.value},get rowSelection(){return S.value}},manualSorting:!0,enableRowSelection:!0});G(h,s=>{s.length>0&&A.get(D.url(),{search:y.value||void 0,status:g.value!=="all"?parseInt(g.value):void 0,sort_by:s[0].id,sort_order:s[0].desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},{deep:!0});let L;return G([y,g],()=>{clearTimeout(L),L=setTimeout(()=>{A.get(D.url(),{search:y.value||void 0,status:g.value!=="all"?parseInt(g.value):void 0,sort_by:h.value[0]?.id||"created_at",sort_order:h.value[0]?.desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},300)}),(s,a)=>(r(),b(x,null,[t(e(ae),null,{default:l(({bonus:n,onRelease:d,onDelete:fe})=>[t(e(ye),null,{default:l(()=>[t(e(he),{"as-child":""},{default:l(()=>[t(e(B),{variant:"ghost",class:"h-8 w-8 p-0"},{default:l(()=>[a[6]||(a[6]=i("span",{class:"sr-only"},"Open menu",-1)),t(e(Ce),{class:"h-4 w-4"})]),_:1})]),_:1}),t(e(Se),{align:"end"},{default:l(()=>[t(e(Re),null,{default:l(()=>[...a[7]||(a[7]=[u("Actions",-1)])]),_:1}),n.status===0&&(e(I)||e(M))?(r(),b(x,{key:0},[t(e(X)),t(e(Y),{onClick:d},{default:l(()=>[t(e(J),{class:"mr-2 h-4 w-4"}),a[8]||(a[8]=u(" Release Bonus ",-1))]),_:1},8,["onClick"])],64)):k("",!0),t(e(X)),e(I)||e(M)?(r(),c(e(Y),{key:1,class:"text-destructive",onClick:fe},{default:l(()=>[t(e(De),{class:"mr-2 h-4 w-4"}),a[9]||(a[9]=u(" Hapus ",-1))]),_:1},8,["onClick"])):k("",!0)]),_:2},1024)]),_:2},1024)]),_:1}),t(pe,{breadcrumbs:te},{default:l(()=>[t(e(Be),{title:"Bonus Retail"}),i("div",Ge,[i("div",Je,[i("div",null,[i("h1",Qe,[t(e(Ve),{class:"h-8 w-8"}),a[10]||(a[10]=u(" Bonus Retail ",-1))]),a[11]||(a[11]=i("p",{class:"text-muted-foreground"},"Kelola bonus retail dari penjualan member",-1))]),e(I)||e(M)?(r(),c(e(B),{key:0,onClick:a[0]||(a[0]=n=>e(A).visit("/bonus/retail/create"))},{default:l(()=>[t(e(Ae),{class:"mr-2 h-4 w-4"}),a[12]||(a[12]=u(" Tambah Bonus ",-1))]),_:1})):k("",!0)]),i("div",es,[t(e(E),null,{default:l(()=>[t(e(O),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[t(e(z),{class:"text-sm font-medium"},{default:l(()=>[...a[13]||(a[13]=[u("Total Pending",-1)])]),_:1}),t(e(Fe),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),t(e(q),null,{default:l(()=>[i("div",ss,$(w(_.statistics.total_pending)),1),i("p",ts,$(_.statistics.count_pending)+" transaksi",1)]),_:1})]),_:1}),t(e(E),null,{default:l(()=>[t(e(O),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[t(e(z),{class:"text-sm font-medium"},{default:l(()=>[...a[14]||(a[14]=[u("Total Released",-1)])]),_:1}),t(e(Ie),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),t(e(q),null,{default:l(()=>[i("div",as,$(w(_.statistics.total_released)),1),i("p",ls,$(_.statistics.count_released)+" transaksi",1)]),_:1})]),_:1})]),i("div",ns,[i("div",os,[i("div",rs,[t(e(Me),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),t(e(He),{modelValue:y.value,"onUpdate:modelValue":a[1]||(a[1]=n=>y.value=n),placeholder:"Cari member...",class:"pl-9"},null,8,["modelValue"])]),t(e(Le),{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=n=>g.value=n)},{default:l(()=>[t(e(Ee),{class:"w-40"},{default:l(()=>[t(e(qe),{placeholder:"Semua Status"})]),_:1}),t(e(Oe),null,{default:l(()=>[t(e(P),{value:"all"},{default:l(()=>[...a[15]||(a[15]=[u("Semua Status",-1)])]),_:1}),t(e(P),{value:"0"},{default:l(()=>[...a[16]||(a[16]=[u("Pending",-1)])]),_:1}),t(e(P),{value:"1"},{default:l(()=>[...a[17]||(a[17]=[u("Released",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),R.value.length?(r(),c(e(B),{key:0,variant:"outline",onClick:me},{default:l(()=>[t(e(J),{class:"mr-2 h-4 w-4"}),u(" Release "+$(R.value.length)+" Bonus ",1)]),_:1})):k("",!0)]),i("div",is,[t(e(ze),null,{default:l(()=>[t(e(We),null,{default:l(()=>[(r(!0),b(x,null,F(e(T).getHeaderGroups(),n=>(r(),c(e(U),{key:n.id},{default:l(()=>[(r(!0),b(x,null,F(n.headers,d=>(r(),c(e(Xe),{key:d.id},{default:l(()=>[d.isPlaceholder?k("",!0):(r(),c(e(Q),{key:0,render:d.column.columnDef.header,props:d.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),t(e(Ye),null,{default:l(()=>[e(T).getRowModel().rows?.length?(r(!0),b(x,{key:0},F(e(T).getRowModel().rows,n=>(r(),c(e(U),{key:n.id,"data-state":n.getIsSelected()&&"selected"},{default:l(()=>[(r(!0),b(x,null,F(n.getVisibleCells(),d=>(r(),c(e(se),{key:d.id},{default:l(()=>[t(e(Q),{render:d.column.columnDef.cell,props:d.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1032,["data-state"]))),128)):(r(),c(e(U),{key:1},{default:l(()=>[t(e(se),{colspan:H.length,class:"h-24 text-center"},{default:l(()=>[...a[18]||(a[18]=[u("Tidak ada data.",-1)])]),_:1},8,["colspan"])]),_:1}))]),_:1})]),_:1})]),t(be,{data:_.bonuses,url:e(D).url()},null,8,["data","url"])]),t(j,{open:v.value.open,title:"Hapus Bonus",description:"Apakah Anda yakin ingin menghapus bonus ini?","confirm-text":"Hapus","onUpdate:open":a[3]||(a[3]=n=>v.value.open=n),onConfirm:ie},null,8,["open"]),t(j,{open:p.value.open,title:"Release Bonus",description:`Apakah Anda yakin ingin merilis bonus sebesar ${p.value.bonus?w(p.value.bonus.amount):""} ke member?`,"confirm-text":"Release","onUpdate:open":a[4]||(a[4]=n=>p.value.open=n),onConfirm:de},null,8,["open","description"]),t(j,{open:C.value.open,title:"Mass Release Bonus",description:`Apakah Anda yakin ingin merilis ${R.value.length} bonus yang dipilih?`,"confirm-text":"Release All","onUpdate:open":a[5]||(a[5]=n=>C.value.open=n),onConfirm:ce},null,8,["open","description"])]),_:1})],64))}});export{As as default};
