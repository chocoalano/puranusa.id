import{a2 as V,a3 as fe,_ as pe,a5 as ge,a6 as X,a7 as ve,a8 as _e}from"./AppLayout.vue_vue_type_script_setup_true_lang-35H6kF2Q.js";import{_ as I}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-CHQ9npTO.js";import{_ as be}from"./Pagination.vue_vue_type_script_setup_true_lang-C9mRYDbu.js";import{_ as Y}from"./index-DJdtjFok.js";import{_ as v,v as M}from"./index-DOPQVStN.js";import{_ as U,a as K}from"./CardContent.vue_vue_type_script_setup_true_lang-BV46Qjf6.js";import{_ as z}from"./CardHeader.vue_vue_type_script_setup_true_lang-DX_68Rs3.js";import{_ as H}from"./CardTitle.vue_vue_type_script_setup_true_lang-6MEUvz4F.js";import{_ as xe,a as he,b as ye}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DZMMg15k.js";import{_ as ke}from"./DropdownMenuCheckboxItem.vue_vue_type_script_setup_true_lang-bd4Xog0P.js";import{_ as Se}from"./Input.vue_vue_type_script_setup_true_lang-CEbduRS7.js";import{_ as we,a as Ce,b as $e,c as Re,d as N}from"./SelectValue.vue_vue_type_script_setup_true_lang-DBmRzu0f.js";import{_ as De,a as Be,b as E,c as Pe,d as Fe,e as Z}from"./TableHeader.vue_vue_type_script_setup_true_lang-Crus1WCM.js";import{u as Ve}from"./usePermissions-DlA7oHe8.js";import{d as Ie,r as c,p as Q,q as Me,E as ee,j as S,c as m,g as i,w as n,b as a,e as r,u as e,a1 as Te,v as w,t as T,s as d,df as L,Y as je,db as Ae,K as h,aB as Ue,an as te,Z as Ke,dd as ze,aa as He,F as R,x as D,y as se,n as o,D as q,at as Ne,aS as Ee,ao as Le,aq as qe,z as Oe,aM as Ge,A as Je,B as We}from"./vendor-DUvsJjJb.js";import"./index-CMWG4mbA.js";import"./AvatarFallback.vue_vue_type_script_setup_true_lang-BsVHnDIv.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-C2b1rchR.js";import"./index-B_n2dl-_.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-WS0Mkk1r.js";import"./BreadcrumbSeparator.vue_vue_type_script_setup_true_lang-wUHj3qHV.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-CWW0yFn3.js";const Xe={class:"rounded-xl p-4 space-y-6 py-6"},Ye={class:"flex items-center justify-between"},Ze={class:"flex gap-2"},Qe={class:"grid gap-4 md:grid-cols-3"},et={class:"text-2xl font-bold"},tt={class:"text-xs text-muted-foreground"},st={class:"text-2xl font-bold"},at={class:"text-xs text-muted-foreground"},lt={class:"text-2xl font-bold"},nt={key:0,class:"flex items-center justify-between rounded-lg border bg-muted/50 p-4"},ot={class:"text-sm font-medium"},rt={class:"flex items-center gap-4"},it={class:"relative flex-1"},ut={class:"rounded-md border"},Vt=Ie({__name:"Index",props:{bonuses:{},statistics:{},filters:{}},setup(_){const{isSuperAdmin:j,isAdmin:A}=Ve(),g=_,ae=[{title:"Bonus Pairing",href:V.url()}],y=c(g.filters.search||""),f=c(g.filters.status?.toString()||"all"),b=c([{id:g.filters.sort_by,desc:g.filters.sort_order==="desc"}]),O=c([]),G=c({}),C=c({}),k=c({open:!1,bonus:null}),p=c({open:!1,bonus:null}),B=c({open:!1}),P=c({open:!1}),le=Q(()=>Object.keys(C.value).map(t=>g.bonuses.data[parseInt(t)]).filter(Boolean)),x=Q(()=>le.value.filter(t=>t.status===0)),$=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(t),ne=t=>new Date(t).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),oe=t=>{k.value={open:!0,bonus:t}},re=()=>{k.value.bonus&&S.delete(ge.url(k.value.bonus.id),{preserveScroll:!0,onSuccess:()=>{k.value={open:!1,bonus:null}}})},ie=t=>{p.value={open:!0,bonus:t}},ue=()=>{if(!p.value.bonus)return;q({}).post(X.url(p.value.bonus.id),{preserveScroll:!0,onSuccess:()=>{p.value={open:!1,bonus:null},C.value={}}})},de=()=>{x.value.length&&(B.value.open=!0)},ce=()=>{const t=x.value.map(l=>l.id);let s=0;t.forEach(l=>{q({}).post(X.url(l),{preserveScroll:!0,onSuccess:()=>{s++,s===t.length&&(C.value={},B.value.open=!1,S.reload({only:["bonuses","statistics"]}))}})})},me=()=>{q({}).post(ve.url(),{preserveScroll:!0,onSuccess:()=>{P.value.open=!1}})},J=[{id:"select",header:({table:t})=>o("input",{type:"checkbox",checked:t.getIsAllPageRowsSelected(),indeterminate:t.getIsSomePageRowsSelected(),onChange:t.getToggleAllPageRowsSelectedHandler(),class:"h-4 w-4 rounded border-gray-300"}),cell:({row:t})=>o("input",{type:"checkbox",checked:t.getIsSelected(),disabled:!t.getCanSelect(),onChange:t.getToggleSelectedHandler(),class:"h-4 w-4 rounded border-gray-300"}),enableSorting:!1},{id:"index",header:()=>o("div",{class:"w-12"},"No"),cell:({row:t})=>{const s=t.index+1+(g.bonuses.current_page-1)*g.bonuses.per_page;return o("div",{class:"font-medium"},s)}},{accessorKey:"member_name",header:()=>"Member",cell:({row:t})=>o("div",[o("div",{class:"font-medium"},t.original.member_name),o("div",{class:"text-xs text-muted-foreground"},t.original.member_ewallet_id)])},{accessorKey:"pair_count",header:()=>"Pasangan",cell:({row:t})=>o(Y,{variant:"outline",class:"gap-1"},()=>[o(L,{class:"h-3 w-3"}),`${t.original.pair_count} pasang`])},{accessorKey:"amount",header:()=>o("div",{class:"text-right"},"Jumlah"),cell:({row:t})=>o("div",{class:"text-right font-medium"},$(t.original.amount))},{accessorKey:"status",header:()=>"Status",cell:({row:t})=>{const s=t.original.status;return o(Y,{variant:s===1?"default":"secondary",class:"gap-1"},()=>[o(s===1?Ne:Ee,{class:"h-3 w-3"}),t.original.status_text])}},{accessorKey:"created_at",header:({column:t})=>o(v,{variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),class:"-ml-4"},()=>["Tanggal",o(Le,{class:"ml-2 h-4 w-4"})]),cell:({row:t})=>ne(t.getValue("created_at"))},{id:"actions",header:()=>o("div",{class:"text-right"},"Actions"),cell:({row:t})=>{const s=t.original,l=[];return(j||A)&&l.push(o(v,{variant:"outline",size:"sm",onClick:()=>S.visit(_e.url(s.id))},()=>o(qe,{class:"h-4 w-4"})),s.status===0?o(v,{variant:"default",size:"sm",onClick:()=>ie(s)},()=>o(te,{class:"h-4 w-4"})):null,s.status===0?o(v,{variant:"outline",size:"sm",onClick:()=>oe(s)},()=>o(Oe,{class:"h-4 w-4 text-destructive"})):null),o("div",{class:"flex justify-end gap-2"},l)}}],F=Me({get data(){return g.bonuses.data},columns:J,getCoreRowModel:We(),getSortedRowModel:Je(),getFilteredRowModel:Ge(),state:{get sorting(){return b.value},get columnFilters(){return O.value},get columnVisibility(){return G.value},get rowSelection(){return C.value}},onSortingChange:t=>M(t,b),onColumnFiltersChange:t=>M(t,O),onColumnVisibilityChange:t=>M(t,G),onRowSelectionChange:t=>M(t,C),manualSorting:!0,enableRowSelection:!0});ee(b,t=>{t.length>0&&S.get(V.url(),{search:y.value||void 0,status:f.value!=="all"?parseInt(f.value):void 0,sort_by:t[0].id,sort_order:t[0].desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},{deep:!0});let W;return ee([y,f],()=>{clearTimeout(W),W=setTimeout(()=>{S.get(V.url(),{search:y.value||void 0,status:f.value!=="all"?parseInt(f.value):void 0,sort_by:b.value[0]?.id||"created_at",sort_order:b.value[0]?.desc?"desc":"asc"},{preserveState:!0,preserveScroll:!0})},300)}),(t,s)=>(i(),m(pe,{breadcrumbs:ae},{default:n(()=>[a(e(Te),{title:"Bonus Pairing"}),r("div",Xe,[r("div",Ye,[s[10]||(s[10]=r("div",null,[r("h1",{class:"text-3xl font-bold tracking-tight"},"Bonus Pairing"),r("p",{class:"text-muted-foreground"},"Kelola bonus pairing binary tree")],-1)),r("div",Ze,[e(j)||e(A)?(i(),m(e(v),{key:0,variant:"outline",onClick:s[0]||(s[0]=l=>P.value.open=!0)},{default:n(()=>[a(e(L),{class:"h-4 w-4"}),s[8]||(s[8]=d(" Proses Semua Pairing ",-1))]),_:1})):T("",!0),e(j)||e(A)?(i(),m(e(v),{key:1,onClick:s[1]||(s[1]=l=>e(S).visit(e(fe).url()))},{default:n(()=>[a(e(je),{class:"h-4 w-4"}),s[9]||(s[9]=d(" Proses Member ",-1))]),_:1})):T("",!0)])]),r("div",Qe,[a(e(U),null,{default:n(()=>[a(e(z),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:n(()=>[a(e(H),{class:"text-sm font-medium"},{default:n(()=>[...s[11]||(s[11]=[d("Total Pending",-1)])]),_:1}),a(e(Ae),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(K),null,{default:n(()=>[r("div",et,h($(_.statistics.total_pending)),1),r("p",tt,h(_.statistics.count_pending)+" bonus ",1)]),_:1})]),_:1}),a(e(U),null,{default:n(()=>[a(e(z),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:n(()=>[a(e(H),{class:"text-sm font-medium"},{default:n(()=>[...s[12]||(s[12]=[d("Total Released",-1)])]),_:1}),a(e(Ue),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(K),null,{default:n(()=>[r("div",st,h($(_.statistics.total_released)),1),r("p",at,h(_.statistics.count_released)+" bonus ",1)]),_:1})]),_:1}),a(e(U),null,{default:n(()=>[a(e(z),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:n(()=>[a(e(H),{class:"text-sm font-medium"},{default:n(()=>[...s[13]||(s[13]=[d("Total Pairs Pending",-1)])]),_:1}),a(e(L),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(K),null,{default:n(()=>[r("div",lt,h(_.statistics.total_pairs),1),s[14]||(s[14]=r("p",{class:"text-xs text-muted-foreground"}," pairs belum di-release ",-1))]),_:1})]),_:1})]),x.value.length>0?(i(),w("div",nt,[r("p",ot,h(x.value.length)+" bonus pending dipilih ",1),a(e(v),{size:"sm",onClick:de},{default:n(()=>[a(e(te),{class:"h-4 w-4"}),s[15]||(s[15]=d(" Release Semua ",-1))]),_:1})])):T("",!0),r("div",rt,[r("div",it,[a(e(Ke),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),a(e(Se),{modelValue:y.value,"onUpdate:modelValue":s[2]||(s[2]=l=>y.value=l),placeholder:"Cari member atau deskripsi...",class:"pl-9"},null,8,["modelValue"])]),a(e(we),{modelValue:f.value,"onUpdate:modelValue":s[3]||(s[3]=l=>f.value=l)},{default:n(()=>[a(e(Ce),{class:"w-40"},{default:n(()=>[a(e($e),{placeholder:"Semua Status"})]),_:1}),a(e(Re),null,{default:n(()=>[a(e(N),{value:"all"},{default:n(()=>[...s[16]||(s[16]=[d("Semua Status",-1)])]),_:1}),a(e(N),{value:"0"},{default:n(()=>[...s[17]||(s[17]=[d("Pending",-1)])]),_:1}),a(e(N),{value:"1"},{default:n(()=>[...s[18]||(s[18]=[d("Released",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(e(xe),null,{default:n(()=>[a(e(he),{"as-child":""},{default:n(()=>[a(e(v),{variant:"outline",class:"ml-auto"},{default:n(()=>[a(e(ze),{class:"h-4 w-4"}),s[19]||(s[19]=d(" Kolom ",-1)),a(e(He),{class:"ml-2 h-4 w-4"})]),_:1})]),_:1}),a(e(ye),{align:"end"},{default:n(()=>[(i(!0),w(R,null,D(e(F).getAllColumns().filter(l=>l.getCanHide()),l=>(i(),m(e(ke),{key:l.id,class:"capitalize",checked:l.getIsVisible(),"onUpdate:checked":u=>l.toggleVisibility(!!u)},{default:n(()=>[d(h(l.id),1)]),_:2},1032,["checked","onUpdate:checked"]))),128))]),_:1})]),_:1})]),r("div",ut,[a(e(De),null,{default:n(()=>[a(e(Be),null,{default:n(()=>[(i(!0),w(R,null,D(e(F).getHeaderGroups(),l=>(i(),m(e(E),{key:l.id},{default:n(()=>[(i(!0),w(R,null,D(l.headers,u=>(i(),m(e(Pe),{key:u.id},{default:n(()=>[u.isPlaceholder?T("",!0):(i(),m(e(se),{key:0,render:u.column.columnDef.header,props:u.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),a(e(Fe),null,{default:n(()=>[e(F).getRowModel().rows?.length?(i(!0),w(R,{key:0},D(e(F).getRowModel().rows,l=>(i(),m(e(E),{key:l.id,"data-state":l.getIsSelected()?"selected":void 0},{default:n(()=>[(i(!0),w(R,null,D(l.getVisibleCells(),u=>(i(),m(e(Z),{key:u.id},{default:n(()=>[a(e(se),{render:u.column.columnDef.cell,props:u.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1032,["data-state"]))),128)):(i(),m(e(E),{key:1},{default:n(()=>[a(e(Z),{colspan:J.length,class:"h-24 text-center"},{default:n(()=>[...s[20]||(s[20]=[d(" Tidak ada data bonus. ",-1)])]),_:1},8,["colspan"])]),_:1}))]),_:1})]),_:1})]),a(be,{data:_.bonuses,url:e(V).url(),filters:{search:y.value||void 0,status:f.value!=="all"?parseInt(f.value):void 0,sort_by:b.value[0]?.id,sort_order:b.value[0]?.desc?"desc":"asc"}},null,8,["data","url","filters"])]),a(I,{open:k.value.open,"onUpdate:open":s[4]||(s[4]=l=>k.value.open=l),title:"Hapus Bonus?",description:"Apakah Anda yakin ingin menghapus bonus ini? Tindakan ini tidak dapat dibatalkan.","confirm-text":"Hapus","cancel-text":"Batal",variant:"destructive",onConfirm:re},null,8,["open"]),a(I,{open:p.value.open,"onUpdate:open":s[5]||(s[5]=l=>p.value.open=l),title:"Release Bonus?",description:`Bonus sebesar ${p.value.bonus?$(p.value.bonus.amount):""} (${p.value.bonus?.pair_count} pasang) akan ditransfer ke ewallet member. Lanjutkan?`,"confirm-text":"Release","cancel-text":"Batal",onConfirm:ue},null,8,["open","description"]),a(I,{open:B.value.open,"onUpdate:open":s[6]||(s[6]=l=>B.value.open=l),title:`Release ${x.value.length} Bonus?`,description:`Total ${$(x.value.reduce((l,u)=>l+u.amount,0))} (${x.value.reduce((l,u)=>l+u.pair_count,0)} pasang) akan ditransfer ke ewallet member. Lanjutkan?`,"confirm-text":"Release Semua","cancel-text":"Batal",onConfirm:ce},null,8,["open","title","description"]),a(I,{open:P.value.open,"onUpdate:open":s[7]||(s[7]=l=>P.value.open=l),title:"Proses Semua Pairing?",description:"Sistem akan memproses bonus pairing untuk SEMUA member yang memiliki pasangan pending. Operasi ini biasanya dilakukan bulanan. Lanjutkan?","confirm-text":"Proses Semua","cancel-text":"Batal",onConfirm:me},null,8,["open"])]),_:1}))}});export{Vt as default};
